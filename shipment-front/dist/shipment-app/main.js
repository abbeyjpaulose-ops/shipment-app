"use strict";(self.webpackChunkshipment_app=self.webpackChunkshipment_app||[]).push([[792],{962:()=>{function ns(t,i){return Object.is(t,i)}let je=null,ko=!1,Eo=1;const hn=Symbol("SIGNAL");function re(t){const i=je;return je=t,i}const ec={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function uu(t){if(ko)throw new Error("");if(null===je)return;je.consumerOnSignalRead(t);const i=je.nextProducerIndex++;ic(je),i<je.producerNode.length&&je.producerNode[i]!==t&&is(je)&&nc(je.producerNode[i],je.producerIndexOfThis[i]),je.producerNode[i]!==t&&(je.producerNode[i]=t,je.producerIndexOfThis[i]=is(je)?Om(t,je,i):0),je.producerLastReadVersion[i]=t.version}function Tm(t){if((!is(t)||t.dirty)&&(t.dirty||t.lastCleanEpoch!==Eo)){if(!t.producerMustRecompute(t)&&!pu(t))return t.dirty=!1,void(t.lastCleanEpoch=Eo);t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=Eo}}function km(t){if(void 0===t.liveConsumerNode)return;const i=ko;ko=!0;try{for(const e of t.liveConsumerNode)e.dirty||Am(e)}finally{ko=i}}function Em(){return!1!==je?.consumerAllowSignalWrites}function Am(t){t.dirty=!0,km(t),t.consumerMarkedDirty?.(t)}function tc(t){return t&&(t.nextProducerIndex=0),re(t)}function hu(t,i){if(re(i),t&&void 0!==t.producerNode&&void 0!==t.producerIndexOfThis&&void 0!==t.producerLastReadVersion){if(is(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)nc(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function pu(t){ic(t);for(let i=0;i<t.producerNode.length;i++){const e=t.producerNode[i],n=t.producerLastReadVersion[i];if(n!==e.version||(Tm(e),n!==e.version))return!0}return!1}function gu(t){if(ic(t),is(t))for(let i=0;i<t.producerNode.length;i++)nc(t.producerNode[i],t.producerIndexOfThis[i]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function Om(t,i,e){if(Lm(t),0===t.liveConsumerNode.length&&Rm(t))for(let n=0;n<t.producerNode.length;n++)t.producerIndexOfThis[n]=Om(t.producerNode[n],t,n);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(i)-1}function nc(t,i){if(Lm(t),1===t.liveConsumerNode.length&&Rm(t))for(let n=0;n<t.producerNode.length;n++)nc(t.producerNode[n],t.producerIndexOfThis[n]);const e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[i]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[i]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,i<t.liveConsumerNode.length){const n=t.liveConsumerIndexOfThis[i],o=t.liveConsumerNode[i];ic(o),o.producerIndexOfThis[n]=i}}function is(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function ic(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function Lm(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function Rm(t){return void 0!==t.producerNode}const fu=Symbol("UNSET"),mu=Symbol("COMPUTING"),oc=Symbol("ERRORED"),Hx={...ec,value:fu,dirty:!0,error:null,equal:ns,producerMustRecompute:t=>t.value===fu||t.value===mu,producerRecomputeValue(t){if(t.value===mu)throw new Error("Detected cycle in computations.");const i=t.value;t.value=mu;const e=tc(t);let n;try{n=t.computation()}catch(o){n=oc,t.error=o}finally{hu(t,e)}i!==fu&&i!==oc&&n!==oc&&t.equal(i,n)?t.value=i:(t.value=n,t.version++)}};let Fm=function jx(){throw new Error};function Bm(){Fm()}let rc=null;function Vm(t,i){Em()||Bm(),t.equal(t.value,i)||(t.value=i,function qx(t){t.version++,function Bx(){Eo++}(),km(t),rc?.()}(t))}const $x={...ec,equal:ns,value:void 0};function ke(t){return"function"==typeof t}function _u(t){const e=t(n=>{Error.call(n),n.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const vu=_u(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,o)=>`${o+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function bu(t,i){if(t){const e=t.indexOf(i);0<=e&&t.splice(e,1)}}class xt{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const r of e)r.remove(this);else e.remove(this);const{initialTeardown:n}=this;if(ke(n))try{n()}catch(r){i=r instanceof vu?r.errors:[r]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const r of o)try{zm(r)}catch(s){i=i??[],s instanceof vu?i=[...i,...s.errors]:i.push(s)}}if(i)throw new vu(i)}}add(i){var e;if(i&&i!==this)if(this.closed)zm(i);else{if(i instanceof xt){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(i)}}_hasParent(i){const{_parentage:e}=this;return e===i||Array.isArray(e)&&e.includes(i)}_addParent(i){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(i),e):e?[e,i]:i}_removeParent(i){const{_parentage:e}=this;e===i?this._parentage=null:Array.isArray(e)&&bu(e,i)}remove(i){const{_finalizers:e}=this;e&&bu(e,i),i instanceof xt&&i._removeParent(this)}}xt.EMPTY=(()=>{const t=new xt;return t.closed=!0,t})();const jm=xt.EMPTY;function Um(t){return t instanceof xt||t&&"closed"in t&&ke(t.remove)&&ke(t.add)&&ke(t.unsubscribe)}function zm(t){ke(t)?t():t.unsubscribe()}const $i={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},sc={setTimeout(t,i,...e){const{delegate:n}=sc;return n?.setTimeout?n.setTimeout(t,i,...e):setTimeout(t,i,...e)},clearTimeout(t){const{delegate:i}=sc;return(i?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Gm(t){sc.setTimeout(()=>{const{onUnhandledError:i}=$i;if(!i)throw t;i(t)})}function yu(){}const Qx=Cu("C",void 0,void 0);function Cu(t,i,e){return{kind:t,value:i,error:e}}let qi=null;function ac(t){if($i.useDeprecatedSynchronousErrorHandling){const i=!qi;if(i&&(qi={errorThrown:!1,error:null}),t(),i){const{errorThrown:e,error:n}=qi;if(qi=null,e)throw n}}else t()}class Mu extends xt{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,Um(i)&&i.add(this)):this.destination=tP}static create(i,e,n){return new wu(i,e,n)}next(i){this.isStopped?Su(function Yx(t){return Cu("N",t,void 0)}(i),this):this._next(i)}error(i){this.isStopped?Su(function Zx(t){return Cu("E",void 0,t)}(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?Su(Qx,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Jx=Function.prototype.bind;function Iu(t,i){return Jx.call(t,i)}class Xx{constructor(i){this.partialObserver=i}next(i){const{partialObserver:e}=this;if(e.next)try{e.next(i)}catch(n){cc(n)}}error(i){const{partialObserver:e}=this;if(e.error)try{e.error(i)}catch(n){cc(n)}else cc(i)}complete(){const{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(e){cc(e)}}}class wu extends Mu{constructor(i,e,n){let o;if(super(),ke(i)||!i)o={next:i??void 0,error:e??void 0,complete:n??void 0};else{let r;this&&$i.useDeprecatedNextContext?(r=Object.create(i),r.unsubscribe=()=>this.unsubscribe(),o={next:i.next&&Iu(i.next,r),error:i.error&&Iu(i.error,r),complete:i.complete&&Iu(i.complete,r)}):o=i}this.destination=new Xx(o)}}function cc(t){$i.useDeprecatedSynchronousErrorHandling?function Kx(t){$i.useDeprecatedSynchronousErrorHandling&&qi&&(qi.errorThrown=!0,qi.error=t)}(t):Gm(t)}function Su(t,i){const{onStoppedNotification:e}=$i;e&&sc.setTimeout(()=>e(t,i))}const tP={closed:!0,next:yu,error:function eP(t){throw t},complete:yu},xu="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wi(t){return t}function $m(t){return 0===t.length?Wi:1===t.length?t[0]:function(e){return t.reduce((n,o)=>o(n),e)}}let Qe=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(e,n,o){const r=function oP(t){return t&&t instanceof Mu||function iP(t){return t&&ke(t.next)&&ke(t.error)&&ke(t.complete)}(t)&&Um(t)}(e)?e:new wu(e,n,o);return ac(()=>{const{operator:s,source:a}=this;r.add(s?s.call(r,a):a?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(e){try{return this._subscribe(e)}catch(n){e.error(n)}}forEach(e,n){return new(n=qm(n))((o,r)=>{const s=new wu({next:a=>{try{e(a)}catch(d){r(d),s.unsubscribe()}},error:r,complete:o});this.subscribe(s)})}_subscribe(e){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(e)}[xu](){return this}pipe(...e){return $m(e)(this)}toPromise(e){return new(e=qm(e))((n,o)=>{let r;this.subscribe(s=>r=s,s=>o(s),()=>n(r))})}}return t.create=i=>new t(i),t})();function qm(t){var i;return null!==(i=t??$i.Promise)&&void 0!==i?i:Promise}const rP=_u(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let zt=(()=>{class t extends Qe{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const n=new Wm(this,this);return n.operator=e,n}_throwIfClosed(){if(this.closed)throw new rP}next(e){ac(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(e)}})}error(e){ac(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:n}=this;for(;n.length;)n.shift().error(e)}})}complete(){ac(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:n,isStopped:o,observers:r}=this;return n||o?jm:(this.currentObservers=null,r.push(e),new xt(()=>{this.currentObservers=null,bu(r,e)}))}_checkFinalizedStatuses(e){const{hasError:n,thrownError:o,isStopped:r}=this;n?e.error(o):r&&e.complete()}asObservable(){const e=new Qe;return e.source=this,e}}return t.create=(i,e)=>new Wm(i,e),t})();class Wm extends zt{constructor(i,e){super(),this.destination=i,this.source=e}next(i){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===n||n.call(e,i)}error(i){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===n||n.call(e,i)}complete(){var i,e;null===(e=null===(i=this.destination)||void 0===i?void 0:i.complete)||void 0===e||e.call(i)}_subscribe(i){var e,n;return null!==(n=null===(e=this.source)||void 0===e?void 0:e.subscribe(i))&&void 0!==n?n:jm}}class Gt extends zt{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){const e=super._subscribe(i);return!e.closed&&i.next(this._value),e}getValue(){const{hasError:i,thrownError:e,_value:n}=this;if(i)throw e;return this._throwIfClosed(),n}next(i){super.next(this._value=i)}}function Qm(t){return ke(t?.lift)}function gt(t){return i=>{if(Qm(i))return i.lift(function(e){try{return t(e,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function tt(t,i,e,n,o){return new sP(t,i,e,n,o)}class sP extends Mu{constructor(i,e,n,o,r,s){super(i),this.onFinalize=r,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(d){i.error(d)}}:super._next,this._error=o?function(a){try{o(a)}catch(d){i.error(d)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){i.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(i=this.onFinalize)||void 0===i||i.call(this))}}}function le(t,i){return gt((e,n)=>{let o=0;e.subscribe(tt(n,r=>{n.next(t.call(i,r,o++))}))})}const Zm="https://g.co/ng/security#xss";class B extends Error{constructor(i,e){super(function Ao(t,i){return`NG0${Math.abs(t)}${i?": "+i:""}`}(i,e)),this.code=i}}function ti(t){return{toString:t}.toString()}const Lo="__parameters__";function Fo(t,i,e){return ti(()=>{const n=function Pu(t){return function(...e){if(t){const n=t(...e);for(const o in n)this[o]=n[o]}}}(i);function o(...r){if(this instanceof o)return n.apply(this,r),this;const s=new o(...r);return a.annotation=s,a;function a(d,p,g){const m=d.hasOwnProperty(Lo)?d[Lo]:Object.defineProperty(d,Lo,{value:[]})[Lo];for(;m.length<=g;)m.push(null);return(m[g]=m[g]||[]).push(s),d}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}const Ee=globalThis;function ve(t){for(let i in t)if(t[i]===ve)return i;throw Error("Could not find renamed property on target object.")}function aP(t,i){for(const e in i)i.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=i[e])}function nt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(nt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const i=t.toString();if(null==i)return""+i;const e=i.indexOf("\n");return-1===e?i:i.substring(0,e)}function Du(t,i){return null==t||""===t?null===i?"":i:null==i||""===i?t:t+" "+i}const cP=ve({__forward_ref__:ve});function Se(t){return t.__forward_ref__=Se,t.toString=function(){return nt(this())},t}function Y(t){return dc(t)?t():t}function dc(t){return"function"==typeof t&&t.hasOwnProperty(cP)&&t.__forward_ref__===Se}function z(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Qi(t){return{providers:t.providers||[],imports:t.imports||[]}}function uc(t){return Xm(t,pc)||Xm(t,e_)}function Xm(t,i){return t.hasOwnProperty(i)?t[i]:null}function hc(t){return t&&(t.hasOwnProperty(Nu)||t.hasOwnProperty(gP))?t[Nu]:null}const pc=ve({\u0275prov:ve}),Nu=ve({\u0275inj:ve}),e_=ve({ngInjectableDef:ve}),gP=ve({ngInjectorDef:ve});class j{constructor(i,e){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=z({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ou(t){return t&&!!t.\u0275providers}const os=ve({\u0275cmp:ve}),Lu=ve({\u0275dir:ve}),Ru=ve({\u0275pipe:ve}),n_=ve({\u0275mod:ve}),ni=ve({\u0275fac:ve}),rs=ve({__NG_ELEMENT_ID__:ve}),i_=ve({__NG_ENV_ID__:ve});function ne(t){return"string"==typeof t?t:null==t?"":String(t)}function Fu(t,i){throw new B(-201,!1)}var ce=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(ce||{});let Bu;function o_(){return Bu}function Ft(t){const i=Bu;return Bu=t,i}function r_(t,i,e){const n=uc(t);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:e&ce.Optional?null:void 0!==i?i:void Fu()}const ss={},Vu="__NG_DI_FLAG__",gc="ngTempTokenPath",yP=/\n/gm,s_="__source";let Bo;function Ci(t){const i=Bo;return Bo=t,i}function IP(t,i=ce.Default){if(void 0===Bo)throw new B(-203,!1);return null===Bo?r_(t,void 0,i):Bo.get(t,i&ce.Optional?null:void 0,i)}function q(t,i=ce.Default){return(o_()||IP)(Y(t),i)}function F(t,i=ce.Default){return q(t,fc(i))}function fc(t){return typeof t>"u"||"number"==typeof t?t:(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Hu(t){const i=[];for(let e=0;e<t.length;e++){const n=Y(t[e]);if(Array.isArray(n)){if(0===n.length)throw new B(900,!1);let o,r=ce.Default;for(let s=0;s<n.length;s++){const a=n[s],d=wP(a);"number"==typeof d?-1===d?o=a.token:r|=d:o=a}i.push(q(o,r))}else i.push(q(n))}return i}function as(t,i){return t[Vu]=i,t.prototype[Vu]=i,t}function wP(t){return t[Vu]}const mc=as(Fo("Optional"),8),_c=as(Fo("SkipSelf"),4);function Zi(t,i){return t.hasOwnProperty(ni)?t[ni]:null}function Vo(t,i){t.forEach(e=>Array.isArray(e)?Vo(e,i):i(e))}function c_(t,i,e){i>=t.length?t.push(e):t.splice(i,0,e)}function vc(t,i){return i>=t.length-1?t.pop():t.splice(i,1)[0]}function Wt(t,i,e){let n=Ho(t,i);return n>=0?t[1|n]=e:(n=~n,function l_(t,i,e,n){let o=t.length;if(o==i)t.push(e,n);else if(1===o)t.push(n,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>i;)t[o]=t[o-2],o--;t[i]=e,t[i+1]=n}}(t,n,i,e)),n}function Uu(t,i){const e=Ho(t,i);if(e>=0)return t[1|e]}function Ho(t,i){return function d_(t,i,e){let n=0,o=t.length>>e;for(;o!==n;){const r=n+(o-n>>1),s=t[r<<e];if(i===s)return r<<e;s>i?o=r:n=r+1}return~(o<<e)}(t,i,1)}const Nn={},ue=[],Tn=new j(""),u_=new j("",-1),zu=new j("");class yc{get(i,e=ss){if(e===ss){const n=new Error(`NullInjectorError: No provider for ${nt(i)}!`);throw n.name="NullInjectorError",n}return e}}var Cc=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Cc||{}),pn=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(pn||{}),Mi=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Mi||{});function kP(t,i,e){let n=t.length;for(;;){const o=t.indexOf(i,e);if(-1===o)return o;if(0===o||t.charCodeAt(o-1)<=32){const r=i.length;if(o+r===n||t.charCodeAt(o+r)<=32)return o}e=o+1}}function Gu(t,i,e){let n=0;for(;n<e.length;){const o=e[n];if("number"==typeof o){if(0!==o)break;n++;const r=e[n++],s=e[n++],a=e[n++];t.setAttribute(i,s,a,r)}else{const r=o,s=e[++n];p_(r)?t.setProperty(i,r,s):t.setAttribute(i,r,s),n++}}return n}function h_(t){return 3===t||4===t||6===t}function p_(t){return 64===t.charCodeAt(0)}function cs(t,i){if(null!==i&&0!==i.length)if(null===t||0===t.length)t=i.slice();else{let e=-1;for(let n=0;n<i.length;n++){const o=i[n];"number"==typeof o?e=o:0===e||g_(t,e,o,null,-1===e||2===e?i[++n]:null)}}return t}function g_(t,i,e,n,o){let r=0,s=t.length;if(-1===i)s=-1;else for(;r<t.length;){const a=t[r++];if("number"==typeof a){if(a===i){s=-1;break}if(a>i){s=r-1;break}}}for(;r<t.length;){const a=t[r];if("number"==typeof a)break;if(a===e){if(null===n)return void(null!==o&&(t[r+1]=o));if(n===t[r+1])return void(t[r+2]=o)}r++,null!==n&&r++,null!==o&&r++}-1!==s&&(t.splice(s,0,i),r=s+1),t.splice(r++,0,e),null!==n&&t.splice(r++,0,n),null!==o&&t.splice(r++,0,o)}const f_="ng-template";function EP(t,i,e,n){let o=0;if(n){for(;o<i.length&&"string"==typeof i[o];o+=2)if("class"===i[o]&&-1!==kP(i[o+1].toLowerCase(),e,0))return!0}else if($u(t))return!1;if(o=i.indexOf(1,o),o>-1){let r;for(;++o<i.length&&"string"==typeof(r=i[o]);)if(r.toLowerCase()===e)return!0}return!1}function $u(t){return 4===t.type&&t.value!==f_}function AP(t,i,e){return i===(4!==t.type||e?t.value:f_)}function OP(t,i,e){let n=4;const o=t.attrs,r=null!==o?function FP(t){for(let i=0;i<t.length;i++)if(h_(t[i]))return i;return t.length}(o):0;let s=!1;for(let a=0;a<i.length;a++){const d=i[a];if("number"!=typeof d){if(!s)if(4&n){if(n=2|1&n,""!==d&&!AP(t,d,e)||""===d&&1===i.length){if(gn(n))return!1;s=!0}}else if(8&n){if(null===o||!EP(t,o,d,e)){if(gn(n))return!1;s=!0}}else{const p=i[++a],g=LP(d,o,$u(t),e);if(-1===g){if(gn(n))return!1;s=!0;continue}if(""!==p){let m;if(m=g>r?"":o[g+1].toLowerCase(),2&n&&p!==m){if(gn(n))return!1;s=!0}}}}else{if(!s&&!gn(n)&&!gn(d))return!1;if(s&&gn(d))continue;s=!1,n=d|1&n}}return gn(n)||s}function gn(t){return!(1&t)}function LP(t,i,e,n){if(null===i)return-1;let o=0;if(n||!e){let r=!1;for(;o<i.length;){const s=i[o];if(s===t)return o;if(3===s||6===s)r=!0;else{if(1===s||2===s){let a=i[++o];for(;"string"==typeof a;)a=i[++o];continue}if(4===s)break;if(0===s){o+=4;continue}}o+=r?1:2}return-1}return function BP(t,i){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const n=t[e];if("number"==typeof n)return-1;if(n===i)return e;e++}return-1}(i,t)}function m_(t,i,e=!1){for(let n=0;n<i.length;n++)if(OP(t,i[n],e))return!0;return!1}function __(t,i){return t?":not("+i.trim()+")":i}function HP(t){let i=t[0],e=1,n=2,o="",r=!1;for(;e<t.length;){let s=t[e];if("string"==typeof s)if(2&n){const a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&n?o+="."+s:4&n&&(o+=" "+s);else""!==o&&!gn(s)&&(i+=__(r,o),o=""),n=s,r=r||!gn(n);e++}return""!==o&&(i+=__(r,o)),i}function pe(t){return ti(()=>{const i=b_(t),e={...i,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Cc.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||pn.Emulated,styles:t.styles||ue,_:null,schemas:t.schemas||null,tView:null,id:""};y_(e);const n=t.dependencies;return e.directiveDefs=Mc(n,!1),e.pipeDefs=Mc(n,!0),e.id=function qP(t){let i=0;const e=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(const o of e)i=Math.imul(31,i)+o.charCodeAt(0)|0;return i+=2147483648,"c"+i}(e),e})}function zP(t){return ae(t)||it(t)}function GP(t){return null!==t}function jo(t){return ti(()=>({type:t.type,bootstrap:t.bootstrap||ue,declarations:t.declarations||ue,imports:t.imports||ue,exports:t.exports||ue,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function v_(t,i){if(null==t)return Nn;const e={};for(const n in t)if(t.hasOwnProperty(n)){const o=t[n];let r,s,a=Mi.None;Array.isArray(o)?(a=o[0],r=o[1],s=o[2]??r):(r=o,s=o),i?(e[r]=a!==Mi.None?[n,a]:n,i[r]=s):e[r]=n}return e}function ee(t){return ti(()=>{const i=b_(t);return y_(i),i})}function Vt(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,standalone:!0===t.standalone,onDestroy:t.type.prototype.ngOnDestroy||null}}function ae(t){return t[os]||null}function it(t){return t[Lu]||null}function ft(t){return t[Ru]||null}function bt(t,i){const e=t[n_]||null;if(!e&&!0===i)throw new Error(`Type ${nt(t)} does not have '\u0275mod' property.`);return e}function b_(t){const i={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:t.inputs||Nn,exportAs:t.exportAs||null,standalone:!0===t.standalone,signals:!0===t.signals,selectors:t.selectors||ue,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:v_(t.inputs,i),outputs:v_(t.outputs),debugInfo:null}}function y_(t){t.features?.forEach(i=>i(t))}function Mc(t,i){if(!t)return null;const e=i?ft:zP;return()=>("function"==typeof t?t():t).map(n=>e(n)).filter(GP)}function Uo(t){return{\u0275providers:t}}function WP(...t){return{\u0275providers:qu(0,t),\u0275fromNgModule:!0}}function qu(t,...i){const e=[],n=new Set;let o;const r=s=>{e.push(s)};return Vo(i,s=>{const a=s;Ic(a,r,[],n)&&(o||=[],o.push(a))}),void 0!==o&&C_(o,r),e}function C_(t,i){for(let e=0;e<t.length;e++){const{ngModule:n,providers:o}=t[e];Wu(o,r=>{i(r,n)})}}function Ic(t,i,e,n){if(!(t=Y(t)))return!1;let o=null,r=hc(t);const s=!r&&ae(t);if(r||s){if(s&&!s.standalone)return!1;o=t}else{const d=t.ngModule;if(r=hc(d),!r)return!1;o=d}const a=n.has(o);if(s){if(a)return!1;if(n.add(o),s.dependencies){const d="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const p of d)Ic(p,i,e,n)}}else{if(!r)return!1;{if(null!=r.imports&&!a){let p;n.add(o);try{Vo(r.imports,g=>{Ic(g,i,e,n)&&(p||=[],p.push(g))})}finally{}void 0!==p&&C_(p,i)}if(!a){const p=Zi(o)||(()=>new o);i({provide:o,useFactory:p,deps:ue},o),i({provide:zu,useValue:o,multi:!0},o),i({provide:Tn,useValue:()=>q(o),multi:!0},o)}const d=r.providers;if(null!=d&&!a){const p=t;Wu(d,g=>{i(g,p)})}}}return o!==t&&void 0!==t.providers}function Wu(t,i){for(let e of t)Ou(e)&&(e=e.\u0275providers),Array.isArray(e)?Wu(e,i):i(e)}const QP=ve({provide:String,useValue:ve});function Qu(t){return null!==t&&"object"==typeof t&&QP in t}function Yi(t){return"function"==typeof t}const Zu=new j(""),wc={},YP={};let Yu;function Sc(){return void 0===Yu&&(Yu=new yc),Yu}class Pt{}class zo extends Pt{get destroyed(){return this._destroyed}constructor(i,e,n,o){super(),this.parent=e,this.source=n,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ju(i,s=>this.processProvider(s)),this.records.set(u_,Go(void 0,this)),o.has("environment")&&this.records.set(Pt,Go(void 0,this));const r=this.records.get(Zu);null!=r&&"string"==typeof r.value&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(zu,ue,ce.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const i=re(null);try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of e)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),re(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();const e=Ci(this),n=Ft(void 0);try{return i()}finally{Ci(e),Ft(n)}}get(i,e=ss,n=ce.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(i_))return i[i_](this);n=fc(n);const r=Ci(this),s=Ft(void 0);try{if(!(n&ce.SkipSelf)){let d=this.records.get(i);if(void 0===d){const p=function tD(t){return"function"==typeof t||"object"==typeof t&&t instanceof j}(i)&&uc(i);d=p&&this.injectableDefInScope(p)?Go(Ku(i),wc):null,this.records.set(i,d)}if(null!=d)return this.hydrate(i,d)}return(n&ce.Self?Sc():this.parent).get(i,e=n&ce.Optional&&e===ss?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[gc]=a[gc]||[]).unshift(nt(i)),r)throw a;return function SP(t,i,e,n){const o=t[gc];throw i[s_]&&o.unshift(i[s_]),t.message=function xP(t,i,e,n=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.slice(2):t;let o=nt(i);if(Array.isArray(i))o=i.map(nt).join(" -> ");else if("object"==typeof i){let r=[];for(let s in i)if(i.hasOwnProperty(s)){let a=i[s];r.push(s+":"+("string"==typeof a?JSON.stringify(a):nt(a)))}o=`{${r.join(", ")}}`}return`${e}${n?"("+n+")":""}[${o}]: ${t.replace(yP,"\n  ")}`}("\n"+t.message,o,e,n),t.ngTokenPath=o,t[gc]=null,t}(a,i,"R3InjectorError",this.source)}throw a}finally{Ft(s),Ci(r)}}resolveInjectorInitializers(){const i=re(null),e=Ci(this),n=Ft(void 0);try{const r=this.get(Tn,ue,ce.Self);for(const s of r)s()}finally{Ci(e),Ft(n),re(i)}}toString(){const i=[],e=this.records;for(const n of e.keys())i.push(nt(n));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new B(205,!1)}processProvider(i){let e=Yi(i=Y(i))?i:Y(i&&i.provide);const n=function JP(t){return Qu(t)?Go(void 0,t.useValue):Go(w_(t),wc)}(i);if(!Yi(i)&&!0===i.multi){let o=this.records.get(e);o||(o=Go(void 0,wc,!0),o.factory=()=>Hu(o.multi),this.records.set(e,o)),e=i,o.multi.push(i)}this.records.set(e,n)}hydrate(i,e){const n=re(null);try{return e.value===wc&&(e.value=YP,e.value=e.factory()),"object"==typeof e.value&&e.value&&function eD(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{re(n)}}injectableDefInScope(i){if(!i.providedIn)return!1;const e=Y(i.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(i){const e=this._onDestroyHooks.indexOf(i);-1!==e&&this._onDestroyHooks.splice(e,1)}}function Ku(t){const i=uc(t),e=null!==i?i.factory:Zi(t);if(null!==e)return e;if(t instanceof j)throw new B(204,!1);if(t instanceof Function)return function KP(t){if(t.length>0)throw new B(204,!1);const e=function pP(t){return t&&(t[pc]||t[e_])||null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new B(204,!1)}function w_(t,i,e){let n;if(Yi(t)){const o=Y(t);return Zi(o)||Ku(o)}if(Qu(t))n=()=>Y(t.useValue);else if(function I_(t){return!(!t||!t.useFactory)}(t))n=()=>t.useFactory(...Hu(t.deps||[]));else if(function M_(t){return!(!t||!t.useExisting)}(t))n=()=>q(Y(t.useExisting));else{const o=Y(t&&(t.useClass||t.provide));if(!function XP(t){return!!t.deps}(t))return Zi(o)||Ku(o);n=()=>new o(...Hu(t.deps))}return n}function Go(t,i,e=!1){return{factory:t,value:i,multi:e?[]:void 0}}function Ju(t,i){for(const e of t)Array.isArray(e)?Ju(e,i):e&&Ou(e)?Ju(e.\u0275providers,i):i(e)}function kn(t,i){t instanceof zo&&t.assertNotDestroyed();const n=Ci(t),o=Ft(void 0);try{return i()}finally{Ci(n),Ft(o)}}function S_(){return void 0!==o_()||null!=function MP(){return Bo}()}const Oe=0,H=1,W=2,Ze=3,fn=4,mt=5,Dt=6,qo=7,xe=8,Ye=9,En=10,K=11,ds=12,P_=13,Wo=14,Le=15,Ki=16,Qo=17,ii=18,Zo=19,D_=20,wi=21,Pc=22,rn=23,$=25,th=1,An=7,Yo=9,Ue=10;var Nc=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t}(Nc||{});function rt(t){return Array.isArray(t)&&"object"==typeof t[th]}function yt(t){return Array.isArray(t)&&!0===t[th]}function nh(t){return!!(4&t.flags)}function Ji(t){return t.componentOffset>-1}function Tc(t){return!(1&~t.flags)}function mn(t){return!!t.template}function hs(t){return!!(512&t[W])}class pD{constructor(i,e,n){this.previousValue=i,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}function A_(t,i,e,n){null!==i?i.applyValueToInputSignal(i,n):t[e]=n}function sn(){return O_}function O_(t){return t.type.prototype.ngOnChanges&&(t.setInput=fD),gD}function gD(){const t=R_(this),i=t?.current;if(i){const e=t.previous;if(e===Nn)t.previous=i;else for(let n in i)e[n]=i[n];t.current=null,this.ngOnChanges(i)}}function fD(t,i,e,n,o){const r=this.declaredInputs[n],s=R_(t)||function mD(t,i){return t[L_]=i}(t,{previous:Nn,current:null}),a=s.current||(s.current={}),d=s.previous,p=d[r];a[r]=new pD(p&&p.currentValue,e,d===Nn),A_(t,i,o,e)}sn.ngInherit=!0;const L_="__ngSimpleChanges__";function R_(t){return t[L_]||null}const On=function(t,i,e){};function he(t){for(;Array.isArray(t);)t=t[Oe];return t}function ps(t,i){return he(i[t])}function Nt(t,i){return he(i[t.index])}function gs(t,i){return t.data[i]}function Xi(t,i){return t[i]}function Qt(t,i){const e=i[t];return rt(e)?e:e[Oe]}function ah(t){return!(128&~t[W])}function an(t,i){return null==i?null:t[i]}function V_(t){t[Qo]=0}function H_(t){1024&t[W]||(t[W]|=1024,ah(t)&&Ec(t))}function kc(t){return!!(9216&t[W]||t[rn]?.dirty)}function ch(t){t[En].changeDetectionScheduler?.notify(8),64&t[W]&&(t[W]|=1024),kc(t)&&Ec(t)}function Ec(t){t[En].changeDetectionScheduler?.notify(0);let i=oi(t);for(;null!==i&&!(8192&i[W])&&(i[W]|=8192,ah(i));)i=oi(i)}function Ac(t,i){if(!(256&~t[W]))throw new B(911,!1);null===t[wi]&&(t[wi]=[]),t[wi].push(i)}function oi(t){const i=t[Ze];return yt(i)?i[Ze]:i}const J={lFrame:X_(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let U_=!1;function z_(){return J.bindingsEnabled}function L(){return J.lFrame.lView}function se(){return J.lFrame.tView}function _(t){return J.lFrame.contextLView=t,t[xe]}function v(t){return J.lFrame.contextLView=null,t}function be(){let t=G_();for(;null!==t&&64===t.type;)t=t.parent;return t}function G_(){return J.lFrame.currentTNode}function _n(t,i){const e=J.lFrame;e.currentTNode=t,e.isParent=i}function uh(){return J.lFrame.isParent}function hh(){J.lFrame.isParent=!1}function W_(){return U_}function Q_(t){U_=t}function Tt(){const t=J.lFrame;let i=t.bindingRootIndex;return-1===i&&(i=t.bindingRootIndex=t.tView.bindingStartIndex),i}function ri(){return J.lFrame.bindingIndex}function vn(){return J.lFrame.bindingIndex++}function si(t){const i=J.lFrame,e=i.bindingIndex;return i.bindingIndex=i.bindingIndex+t,e}function TD(t,i){const e=J.lFrame;e.bindingIndex=e.bindingRootIndex=t,ph(i)}function ph(t){J.lFrame.currentDirectiveIndex=t}function Lc(t){J.lFrame.currentQueryIndex=t}function ED(t){const i=t[H];return 2===i.type?i.declTNode:1===i.type?t[mt]:null}function K_(t,i,e){if(e&ce.SkipSelf){let o=i,r=t;for(;!(o=o.parent,null!==o||e&ce.Host||(o=ED(r),null===o||(r=r[Wo],10&o.type))););if(null===o)return!1;i=o,t=r}const n=J.lFrame=J_();return n.currentTNode=i,n.lView=t,!0}function mh(t){const i=J_(),e=t[H];J.lFrame=i,i.currentTNode=e.firstChild,i.lView=t,i.tView=e,i.contextLView=t,i.bindingIndex=e.bindingStartIndex,i.inI18n=!1}function J_(){const t=J.lFrame,i=null===t?null:t.child;return null===i?X_(t):i}function X_(t){const i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=i),i}function ev(){const t=J.lFrame;return J.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const tv=ev;function _h(){const t=ev();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function _t(){return J.lFrame.selectedIndex}function to(t){J.lFrame.selectedIndex=t}function Pe(){const t=J.lFrame;return gs(t.tView,t.selectedIndex)}let iv=!0;function ms(){return iv}function Ln(t){iv=t}function Rc(t,i){for(let e=i.directiveStart,n=i.directiveEnd;e<n;e++){const r=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:d,ngAfterViewChecked:p,ngOnDestroy:g}=r;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),d&&(t.viewHooks??=[]).push(-e,d),p&&((t.viewHooks??=[]).push(e,p),(t.viewCheckHooks??=[]).push(e,p)),null!=g&&(t.destroyHooks??=[]).push(e,g)}}function Fc(t,i,e){ov(t,i,3,e)}function Bc(t,i,e,n){(3&t[W])===e&&ov(t,i,e,n)}function vh(t,i){let e=t[W];(3&e)===i&&(e&=16383,e+=1,t[W]=e)}function ov(t,i,e,n){const r=n??-1,s=i.length-1;let a=0;for(let d=void 0!==n?65535&t[Qo]:0;d<s;d++)if("number"==typeof i[d+1]){if(a=i[d],null!=n&&a>=n)break}else i[d]<0&&(t[Qo]+=65536),(a<r||-1==r)&&(VD(t,e,i,d),t[Qo]=(4294901760&t[Qo])+d+2),d++}function rv(t,i){On(4,t,i);const e=re(null);try{i.call(t)}finally{re(e),On(5,t,i)}}function VD(t,i,e,n){const o=e[n]<0,r=e[n+1],a=t[o?-e[n]:e[n]];o?t[W]>>14<t[Qo]>>16&&(3&t[W])===i&&(t[W]+=16384,rv(a,r)):rv(a,r)}const Ko=-1;class _s{constructor(i,e,n){this.factory=i,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=n}}const yh={};class no{constructor(i,e){this.injector=i,this.parentInjector=e}get(i,e,n){n=fc(n);const o=this.injector.get(i,yh,n);return o!==yh||e===yh?o:this.parentInjector.get(i,e,n)}}function Ch(t){return t!==Ko}function vs(t){return 32767&t}function bs(t,i){let e=function GD(t){return t>>16}(t),n=i;for(;e>0;)n=n[Wo],e--;return n}let Mh=!0;function Vc(t){const i=Mh;return Mh=t,i}const av=255,cv=5;let qD=0;const Rn={};function Hc(t,i){const e=lv(t,i);if(-1!==e)return e;const n=i[H];n.firstCreatePass&&(t.injectorIndex=i.length,Ih(n.data,t),Ih(i,null),Ih(n.blueprint,null));const o=jc(t,i),r=t.injectorIndex;if(Ch(o)){const s=vs(o),a=bs(o,i),d=a[H].data;for(let p=0;p<8;p++)i[r+p]=a[s+p]|d[s+p]}return i[r+8]=o,r}function Ih(t,i){t.push(0,0,0,0,0,0,0,0,i)}function lv(t,i){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===i[t.injectorIndex+8]?-1:t.injectorIndex}function jc(t,i){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,n=null,o=i;for(;null!==o;){if(n=mv(o),null===n)return Ko;if(e++,o=o[Wo],-1!==n.injectorIndex)return n.injectorIndex|e<<16}return Ko}function wh(t,i,e){!function WD(t,i,e){let n;"string"==typeof e?n=e.charCodeAt(0)||0:e.hasOwnProperty(rs)&&(n=e[rs]),null==n&&(n=e[rs]=qD++);const o=n&av;i.data[t+(o>>cv)]|=1<<o}(t,i,e)}function dv(t,i,e){if(e&ce.Optional||void 0!==t)return t;Fu()}function uv(t,i,e,n){if(e&ce.Optional&&void 0===n&&(n=null),!(e&(ce.Self|ce.Host))){const o=t[Ye],r=Ft(void 0);try{return o?o.get(i,n,e&ce.Optional):r_(i,n,e&ce.Optional)}finally{Ft(r)}}return dv(n,0,e)}function hv(t,i,e,n=ce.Default,o){if(null!==t){if(2048&i[W]&&!(n&ce.Self)){const s=function JD(t,i,e,n,o){let r=t,s=i;for(;null!==r&&null!==s&&2048&s[W]&&!(512&s[W]);){const a=pv(r,s,e,n|ce.Self,Rn);if(a!==Rn)return a;let d=r.parent;if(!d){const p=s[D_];if(p){const g=p.get(e,Rn,n);if(g!==Rn)return g}d=mv(s),s=s[Wo]}r=d}return o}(t,i,e,n,Rn);if(s!==Rn)return s}const r=pv(t,i,e,n,Rn);if(r!==Rn)return r}return uv(i,e,n,o)}function pv(t,i,e,n,o){const r=function YD(t){if("string"==typeof t)return t.charCodeAt(0)||0;const i=t.hasOwnProperty(rs)?t[rs]:void 0;return"number"==typeof i?i>=0?i&av:KD:i}(e);if("function"==typeof r){if(!K_(i,t,n))return n&ce.Host?dv(o,0,n):uv(i,e,n,o);try{let s;if(s=r(n),null!=s||n&ce.Optional)return s;Fu()}finally{tv()}}else if("number"==typeof r){let s=null,a=lv(t,i),d=Ko,p=n&ce.Host?i[Le][mt]:null;for((-1===a||n&ce.SkipSelf)&&(d=-1===a?jc(t,i):i[a+8],d!==Ko&&fv(n,!1)?(s=i[H],a=vs(d),i=bs(d,i)):a=-1);-1!==a;){const g=i[H];if(gv(r,a,g.data)){const m=ZD(a,i,e,s,n,p);if(m!==Rn)return m}d=i[a+8],d!==Ko&&fv(n,i[H].data[a+8]===p)&&gv(r,a,i)?(s=g,a=vs(d),i=bs(d,i)):a=-1}}return o}function ZD(t,i,e,n,o,r){const s=i[H],a=s.data[t+8],g=function Uc(t,i,e,n,o){const r=t.providerIndexes,s=i.data,a=1048575&r,d=t.directiveStart,g=r>>20,b=o?a+g:t.directiveEnd;for(let y=n?a:a+g;y<b;y++){const I=s[y];if(y<d&&e===I||y>=d&&I.type===e)return y}if(o){const y=s[d];if(y&&mn(y)&&y.type===e)return d}return null}(a,s,e,null==n?Ji(a)&&Mh:n!=s&&!!(3&a.type),o&ce.Host&&r===a);return null!==g?io(i,s,g,a):Rn}function io(t,i,e,n){let o=t[e];const r=i.data;if(function HD(t){return t instanceof _s}(o)){const s=o;s.resolving&&function _P(t,i){throw i&&i.join(" > "),new B(-200,t)}(function ge(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():ne(t)}(r[e]));const a=Vc(s.canSeeViewProviders);s.resolving=!0;const p=s.injectImpl?Ft(s.injectImpl):null;K_(t,n,ce.Default);try{o=t[e]=s.factory(void 0,r,t,n),i.firstCreatePass&&e>=n.directiveStart&&function BD(t,i,e){const{ngOnChanges:n,ngOnInit:o,ngDoCheck:r}=i.type.prototype;if(n){const s=O_(i);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),r&&((e.preOrderHooks??=[]).push(t,r),(e.preOrderCheckHooks??=[]).push(t,r))}(e,r[e],i)}finally{null!==p&&Ft(p),Vc(a),s.resolving=!1,tv()}}return o}function gv(t,i,e){return!!(e[i+(t>>cv)]&1<<t)}function fv(t,i){return!(t&ce.Self||t&ce.Host&&i)}class st{constructor(i,e){this._tNode=i,this._lView=e}get(i,e,n){return hv(this._tNode,this._lView,i,fc(n),e)}}function KD(){return new st(be(),L())}function ut(t){return ti(()=>{const i=t.prototype.constructor,e=i[ni]||Sh(i),n=Object.prototype;let o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==n;){const r=o[ni]||Sh(o);if(r&&r!==e)return r;o=Object.getPrototypeOf(o)}return r=>new r})}function Sh(t){return dc(t)?()=>{const i=Sh(Y(t));return i&&i()}:Zi(t)}function mv(t){const i=t[H],e=i.type;return 2===e?i.declTNode:1===e?t[mt]:null}function Cv(t,i=null,e=null,n){const o=Mv(t,i,e,n);return o.resolveInjectorInitializers(),o}function Mv(t,i=null,e=null,n,o=new Set){const r=[e||ue,WP(t)];return n=n||("object"==typeof t?void 0:nt(t)),new zo(r,i||Sc(),n||null,o)}class ht{static{this.THROW_IF_NOT_FOUND=ss}static{this.NULL=new yc}static create(i,e){if(Array.isArray(i))return Cv({name:""},e,i,"");{const n=i.name??"";return Cv({name:n},i.parent,i.providers,n)}}static{this.\u0275prov=z({token:ht,providedIn:"any",factory:()=>q(u_)})}static{this.__NG_ELEMENT_ID__=-1}}new j("").__NG_ELEMENT_ID__=t=>{const i=be();if(null===i)throw new B(204,!1);if(2&i.type)return i.value;if(t&ce.Optional)return null;throw new B(204,!1)};function Ph(t){return t.ngOriginalError}const wv=!0;let Cs=(()=>{class t{static{this.__NG_ELEMENT_ID__=c2}static{this.__NG_ENV_ID__=e=>e}}return t})();class a2 extends Cs{constructor(i){super(),this._lView=i}onDestroy(i){return Ac(this._lView,i),()=>function lh(t,i){if(null===t[wi])return;const e=t[wi].indexOf(i);-1!==e&&t[wi].splice(e,1)}(this._lView,i)}}function c2(){return new a2(L())}let Si=(()=>{class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Gt(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const e=this.taskId++;return this.pendingTasks.add(e),e}remove(e){this.pendingTasks.delete(e),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=z({token:t,providedIn:"root",factory:()=>new t})}}return t})();const Fe=class l2 extends zt{constructor(i=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=i,S_()&&(this.destroyRef=F(Cs,{optional:!0})??void 0,this.pendingTasks=F(Si,{optional:!0})??void 0)}emit(i){const e=re(null);try{super.next(i)}finally{re(e)}}subscribe(i,e,n){let o=i,r=e||(()=>null),s=n;if(i&&"object"==typeof i){const d=i;o=d.next?.bind(d),r=d.error?.bind(d),s=d.complete?.bind(d)}this.__isAsync&&(r=this.wrapInTimeout(r),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));const a=super.subscribe({next:o,error:r,complete:s});return i instanceof xt&&i.add(a),a}wrapInTimeout(i){return e=>{const n=this.pendingTasks?.add();setTimeout(()=>{i(e),void 0!==n&&this.pendingTasks?.remove(n)})}}};function Gc(...t){}function Sv(t){let i,e;function n(){t=Gc;try{void 0!==e&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(e),void 0!==i&&clearTimeout(i)}catch{}}return i=setTimeout(()=>{t(),n()}),"function"==typeof requestAnimationFrame&&(e=requestAnimationFrame(()=>{t(),n()})),()=>n()}function xv(t){return queueMicrotask(()=>t()),()=>{t=Gc}}const Dh="isAngularZone",$c=Dh+"_ID";let d2=0;class fe{constructor(i){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Fe(!1),this.onMicrotaskEmpty=new Fe(!1),this.onStable=new Fe(!1),this.onError=new Fe(!1);const{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:r=wv}=i;if(typeof Zone>"u")throw new B(908,!1);Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&n,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=r,function p2(t){const i=()=>{!function h2(t){function i(){Sv(()=>{t.callbackScheduled=!1,Th(t),t.isCheckStableRunning=!0,Nh(t),t.isCheckStableRunning=!1})}t.isCheckStableRunning||t.callbackScheduled||(t.callbackScheduled=!0,t.scheduleInRootZone?Zone.root.run(()=>{i()}):t._outer.run(()=>{i()}),Th(t))}(t)},e=d2++;t._inner=t._inner.fork({name:"angular",properties:{[Dh]:!0,[$c]:e,[$c+e]:!0},onInvokeTask:(n,o,r,s,a,d)=>{if(function g2(t){return Nv(t,"__ignore_ng_zone__")}(d))return n.invokeTask(r,s,a,d);try{return Pv(t),n.invokeTask(r,s,a,d)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||t.shouldCoalesceRunChangeDetection)&&i(),Dv(t)}},onInvoke:(n,o,r,s,a,d,p)=>{try{return Pv(t),n.invoke(r,s,a,d,p)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!function f2(t){return Nv(t,"__scheduler_tick__")}(d)&&i(),Dv(t)}},onHasTask:(n,o,r,s)=>{n.hasTask(r,s),o===r&&("microTask"==s.change?(t._hasPendingMicrotasks=s.microTask,Th(t),Nh(t)):"macroTask"==s.change&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(n,o,r,s)=>(n.handleError(r,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}(s)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(Dh)}static assertInAngularZone(){if(!fe.isInAngularZone())throw new B(909,!1)}static assertNotInAngularZone(){if(fe.isInAngularZone())throw new B(909,!1)}run(i,e,n){return this._inner.run(i,e,n)}runTask(i,e,n,o){const r=this._inner,s=r.scheduleEventTask("NgZoneEvent: "+o,i,u2,Gc,Gc);try{return r.runTask(s,e,n)}finally{r.cancelTask(s)}}runGuarded(i,e,n){return this._inner.runGuarded(i,e,n)}runOutsideAngular(i){return this._outer.run(i)}}const u2={};function Nh(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Th(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&!0===t.callbackScheduled)}function Pv(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Dv(t){t._nesting--,Nh(t)}class kh{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Fe,this.onMicrotaskEmpty=new Fe,this.onStable=new Fe,this.onError=new Fe}run(i,e,n){return i.apply(e,n)}runGuarded(i,e,n){return i.apply(e,n)}runOutsideAngular(i){return i()}runTask(i,e,n,o){return i.apply(e,n)}}function Nv(t,i){return!(!Array.isArray(t)||1!==t.length)&&!0===t[0]?.data?.[i]}class Fn{constructor(){this._console=console}handleError(i){const e=this._findOriginalError(i);this._console.error("ERROR",i),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(i){let e=i&&Ph(i);for(;e&&Ph(e);)e=Ph(e);return e||null}}const _2=new j("",{providedIn:"root",factory:()=>{const t=F(fe),i=F(Fn);return e=>t.runOutsideAngular(()=>i.handleError(e))}});function v2(){return er(be(),L())}function er(t,i){return new Zt(Nt(t,i))}let Zt=(()=>{class t{constructor(e){this.nativeElement=e}static{this.__NG_ELEMENT_ID__=v2}}return t})();function Is(t){return!(128&~t.flags)}const Oh=new Map;let C2=0;function Lh(t){Oh.delete(t[Zo])}const qc="__ngContext__";function Ct(t,i){rt(i)?(t[qc]=i[Zo],function I2(t){Oh.set(t[Zo],t)}(i)):t[qc]=i}function jv(t){return zv(t[ds])}function Uv(t){return zv(t[fn])}function zv(t){for(;null!==t&&!yt(t);)t=t[fn];return t}let Fh;const Ss=new j("",{providedIn:"root",factory:()=>H2}),H2="ng",Kv=new j(""),ai=new j("",{providedIn:"platform",factory:()=>"unknown"}),Jv=new j("",{providedIn:"root",factory:()=>function xi(){if(void 0!==Fh)return Fh;if(typeof document<"u")return document;throw new B(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Xv=()=>null;function Gh(t,i,e=!1){return Xv(t,i,e)}const ab=new j("",{providedIn:"root",factory:()=>!1});let tl;function hb(t){return function Yh(){if(void 0===tl&&(tl=null,Ee.trustedTypes))try{tl=Ee.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return tl}()?.createScriptURL(t)||t}class pb{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Zm})`}}function Pi(t){return t instanceof pb?t.changingThisBreaksApplicationSecurity:t}function ks(t,i){const e=function rN(t){return t instanceof pb&&t.getTypeName()||null}(t);if(null!=e&&e!==i){if("ResourceURL"===e&&"URL"===i)return!0;throw new Error(`Required a safe ${i}, got a ${e} (see ${Zm})`)}return e===i}const lN=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var rr=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(rr||{});function As(t){const i=Os();return i?i.sanitize(rr.URL,t)||"":ks(t,"URL")?Pi(t):function Kh(t){return(t=String(t)).match(lN)?t:"unsafe:"+t}(ne(t))}function Mb(t){const i=Os();if(i)return hb(i.sanitize(rr.RESOURCE_URL,t)||"");if(ks(t,"ResourceURL"))return hb(Pi(t));throw new B(904,!1)}function Os(){const t=L();return t&&t[En].sanitizer}const SN=/^>|^->|<!--|-->|--!>|<!-$/g,xN=/(<|>)/g,PN="\u200b$1\u200b";function Db(t){return t.ownerDocument.defaultView}function Yt(t){return t instanceof Function?t():t}var Di=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Di||{});let ip;function op(t,i){return ip(t,i)}function ar(t,i,e,n,o){if(null!=n){let r,s=!1;yt(n)?r=n:rt(n)&&(s=!0,n=n[Oe]);const a=he(n);0===t&&null!==e?null==o?Fb(i,e,a):ro(i,e,a,o||null,!0):1===t&&null!==e?ro(i,e,a,o||null,!0):2===t?function Rs(t,i,e){t.removeChild(null,i,e)}(i,a,s):3===t&&i.destroyNode(a),null!=r&&function qN(t,i,e,n,o){const r=e[An];r!==he(e)&&ar(i,t,n,r,o);for(let a=Ue;a<e.length;a++){const d=e[a];cl(d[H],d,t,i,n,r)}}(i,t,r,e,o)}}function sp(t,i){return t.createComment(function wb(t){return t.replace(SN,i=>i.replace(xN,PN))}(i))}function rl(t,i,e){return t.createElement(i,e)}function Ob(t,i){i[En].changeDetectionScheduler?.notify(9),cl(t,i,i[K],2,null,null)}function Lb(t,i){const e=t[Yo],n=i[Ze];(rt(n)||i[Le]!==n[Ze][Le])&&(t[W]|=Nc.HasTransplantedViews),null===e?t[Yo]=[i]:e.push(i)}function ap(t,i){const e=t[Yo],n=e.indexOf(i);e.splice(n,1)}function Ls(t,i){if(t.length<=Ue)return;const e=Ue+i,n=t[e];if(n){const o=n[Ki];null!==o&&o!==t&&ap(o,n),i>0&&(t[e-1][fn]=n[fn]);const r=vc(t,Ue+i);!function BN(t,i){Ob(t,i),i[Oe]=null,i[mt]=null}(n[H],n);const s=r[ii];null!==s&&s.detachView(r[H]),n[Ze]=null,n[fn]=null,n[W]&=-129}return n}function sl(t,i){if(!(256&i[W])){const e=i[K];e.destroyNode&&cl(t,i,e,3,null,null),function HN(t){let i=t[ds];if(!i)return cp(t[H],t);for(;i;){let e=null;if(rt(i))e=i[ds];else{const n=i[Ue];n&&(e=n)}if(!e){for(;i&&!i[fn]&&i!==t;)rt(i)&&cp(i[H],i),i=i[Ze];null===i&&(i=t),rt(i)&&cp(i[H],i),e=i&&i[fn]}i=e}}(i)}}function cp(t,i){if(256&i[W])return;const e=re(null);try{i[W]&=-129,i[W]|=256,i[rn]&&gu(i[rn]),function zN(t,i){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let n=0;n<e.length;n+=2){const o=i[e[n]];if(!(o instanceof _s)){const r=e[n+1];if(Array.isArray(r))for(let s=0;s<r.length;s+=2){const a=o[r[s]],d=r[s+1];On(4,a,d);try{d.call(a)}finally{On(5,a,d)}}else{On(4,o,r);try{r.call(o)}finally{On(5,o,r)}}}}}(t,i),function UN(t,i){const e=t.cleanup,n=i[qo];if(null!==e)for(let r=0;r<e.length-1;r+=2)if("string"==typeof e[r]){const s=e[r+3];s>=0?n[s]():n[-s].unsubscribe(),r+=2}else e[r].call(n[e[r+1]]);null!==n&&(i[qo]=null);const o=i[wi];if(null!==o){i[wi]=null;for(let r=0;r<o.length;r++)(0,o[r])()}}(t,i),1===i[H].type&&i[K].destroy();const n=i[Ki];if(null!==n&&yt(i[Ze])){n!==i[Ze]&&ap(n,i);const o=i[ii];null!==o&&o.detachView(t)}Lh(i)}finally{re(e)}}function lp(t,i,e){return function Rb(t,i,e){let n=i;for(;null!==n&&168&n.type;)n=(i=n).parent;if(null===n)return e[Oe];{const{componentOffset:o}=n;if(o>-1){const{encapsulation:r}=t.data[n.directiveStart+o];if(r===pn.None||r===pn.Emulated)return null}return Nt(n,e)}}(t,i.parent,e)}function ro(t,i,e,n,o){t.insertBefore(i,e,n,o)}function Fb(t,i,e){t.appendChild(i,e)}function Bb(t,i,e,n,o){null!==n?ro(t,i,e,n,o):Fb(t,i,e)}function dp(t,i){return t.parentNode(i)}let up,jb=function Hb(t,i,e){return 40&t.type?Nt(t,e):null};function al(t,i,e,n){const o=lp(t,n,i),r=i[K],a=function Vb(t,i,e){return jb(t,i,e)}(n.parent||i[mt],n,i);if(null!=o)if(Array.isArray(e))for(let d=0;d<e.length;d++)Bb(r,o,e[d],a,!1);else Bb(r,o,e,a,!1);void 0!==up&&up(r,n,i,e,o)}function so(t,i){if(null!==i){const e=i.type;if(3&e)return Nt(i,t);if(4&e)return hp(-1,t[i.index]);if(8&e){const n=i.child;if(null!==n)return so(t,n);{const o=t[i.index];return yt(o)?hp(-1,o):he(o)}}if(128&e)return so(t,i.next);if(32&e)return op(i,t)()||he(t[i.index]);{const n=zb(t,i);return null!==n?Array.isArray(n)?n[0]:so(oi(t[Le]),n):so(t,i.next)}}return null}function zb(t,i){return null!==i?t[Le][mt].projection[i.projection]:null}function hp(t,i){const e=Ue+t+1;if(e<i.length){const n=i[e],o=n[H].firstChild;if(null!==o)return so(n,o)}return i[An]}function pp(t,i,e,n,o,r,s){for(;null!=e;){if(128===e.type){e=e.next;continue}const a=n[e.index],d=e.type;if(s&&0===i&&(a&&Ct(he(a),n),e.flags|=2),32&~e.flags)if(8&d)pp(t,i,e.child,n,o,r,!1),ar(i,t,o,a,r);else if(32&d){const p=op(e,n);let g;for(;g=p();)ar(i,t,o,g,r);ar(i,t,o,a,r)}else 16&d?$b(t,i,n,e,o,r):ar(i,t,o,a,r);e=s?e.projectionNext:e.next}}function cl(t,i,e,n,o,r){pp(e,n,t.firstChild,i,o,r,!1)}function $b(t,i,e,n,o,r){const s=e[Le],d=s[mt].projection[n.projection];if(Array.isArray(d))for(let p=0;p<d.length;p++)ar(i,t,o,d[p],r);else{let p=d;const g=s[Ze];Is(n)&&(p.flags|=128),pp(t,i,p,g,o,r,!0)}}function qb(t,i,e){""===e?t.removeAttribute(i,"class"):t.setAttribute(i,"class",e)}function Wb(t,i,e){const{mergedAttrs:n,classes:o,styles:r}=e;null!==n&&Gu(t,i,n),null!==o&&qb(t,i,o),null!==r&&function QN(t,i,e){t.setAttribute(i,"style",e)}(t,i,r)}const ie={};function h(t=1){Qb(se(),L(),_t()+t,!1)}function Qb(t,i,e,n){if(!n)if(3&~i[W]){const r=t.preOrderHooks;null!==r&&Bc(i,r,0,e)}else{const r=t.preOrderCheckHooks;null!==r&&Fc(i,r,e)}to(e)}function R(t,i=ce.Default){const e=L();return null===e?q(t,i):hv(be(),e,Y(t),i)}function Yb(t,i,e,n,o,r){const s=re(null);try{let a=null;o&Mi.SignalBased&&(a=i[n][hn]),null!==a&&void 0!==a.transformFn&&(r=a.transformFn(r)),o&Mi.HasDecoratorInputTransform&&(r=t.inputTransforms[n].call(i,r)),null!==t.setInput?t.setInput(i,a,r,e,n):A_(i,a,n,r)}finally{re(s)}}function ll(t,i,e,n,o,r,s,a,d,p,g){const m=i.blueprint.slice();return m[Oe]=o,m[W]=204|n,(null!==p||t&&2048&t[W])&&(m[W]|=2048),V_(m),m[Ze]=m[Wo]=t,m[xe]=e,m[En]=s||t&&t[En],m[K]=a||t&&t[K],m[Ye]=d||t&&t[Ye]||null,m[mt]=r,m[Zo]=function M2(){return C2++}(),m[Dt]=g,m[D_]=p,m[Le]=2==i.type?t[Le]:m,m}function ao(t,i,e,n,o){let r=t.data[i];if(null===r)r=function gp(t,i,e,n,o){const r=G_(),s=uh(),d=t.data[i]=function nT(t,i,e,n,o,r){let s=i?i.injectorIndex:-1,a=0;return function eo(){return null!==J.skipHydrationRootTNode}()&&(a|=128),{type:e,index:n,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?r:r&&r.parent,e,i,n,o);return null===t.firstChild&&(t.firstChild=d),null!==r&&(s?null==r.child&&null!==d.parent&&(r.child=d):null===r.next&&(r.next=d,d.prev=r)),d}(t,i,e,n,o),function ND(){return J.lFrame.inI18n}()&&(r.flags|=32);else if(64&r.type){r.type=e,r.value=n,r.attrs=o;const s=function fs(){const t=J.lFrame,i=t.currentTNode;return t.isParent?i:i.parent}();r.injectorIndex=null===s?-1:s.injectorIndex}return _n(r,!0),r}function Fs(t,i,e,n){if(0===e)return-1;const o=i.length;for(let r=0;r<e;r++)i.push(n),t.blueprint.push(n),t.data.push(null);return o}function Kb(t,i,e,n,o){const r=_t(),s=2&n;try{to(-1),s&&i.length>$&&Qb(t,i,$,!1),On(s?2:0,o),e(n,o)}finally{to(r),On(s?3:1,o)}}function fp(t,i,e){if(nh(i)){const n=re(null);try{const r=i.directiveEnd;for(let s=i.directiveStart;s<r;s++){const a=t.data[s];a.contentQueries&&a.contentQueries(1,e[s],s)}}finally{re(n)}}}function mp(t,i,e){z_()&&(function lT(t,i,e,n){const o=e.directiveStart,r=e.directiveEnd;Ji(e)&&function mT(t,i,e){const n=Nt(i,t),o=Jb(e);let s=16;e.signals?s=4096:e.onPush&&(s=64);const a=dl(t,ll(t,o,null,s,n,i,null,t[En].rendererFactory.createRenderer(n,e),null,null,null));t[i.index]=a}(i,e,t.data[o+e.componentOffset]),t.firstCreatePass||Hc(e,i),Ct(n,i);const s=e.initialInputs;for(let a=o;a<r;a++){const d=t.data[a],p=io(i,t,a,e);Ct(p,i),null!==s&&_T(0,a-o,p,d,0,s),mn(d)&&(Qt(e.index,i)[xe]=io(i,t,a,e))}}(t,i,e,Nt(e,i)),!(64&~e.flags)&&iy(t,i,e))}function _p(t,i,e=Nt){const n=i.localNames;if(null!==n){let o=i.index+1;for(let r=0;r<n.length;r+=2){const s=n[r+1],a=-1===s?e(i,t):t[s];t[o++]=a}}}function Jb(t){const i=t.tView;return null===i||i.incompleteFirstPass?t.tView=vp(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):i}function vp(t,i,e,n,o,r,s,a,d,p,g){const m=$+n,b=m+o,y=function YN(t,i){const e=[];for(let n=0;n<i;n++)e.push(n<t?null:ie);return e}(m,b),I="function"==typeof p?p():p;return y[H]={type:t,blueprint:y,template:e,queries:null,viewQuery:a,declTNode:i,data:y.slice().fill(null,m),bindingStartIndex:m,expandoStartIndex:b,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof r?r():r,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:d,consts:I,incompleteFirstPass:!1,ssrId:g}}let Xb=()=>null;function ey(t,i,e,n,o){for(let r in i){if(!i.hasOwnProperty(r))continue;const s=i[r];if(void 0===s)continue;n??={};let a,d=Mi.None;Array.isArray(s)?(a=s[0],d=s[1]):a=s;let p=r;if(null!==o){if(!o.hasOwnProperty(r))continue;p=o[r]}0===t?ty(n,e,p,a,d):ty(n,e,p,a)}return n}function ty(t,i,e,n,o){let r;t.hasOwnProperty(e)?(r=t[e]).push(i,n):r=t[e]=[i,n],void 0!==o&&r.push(o)}function jt(t,i,e,n,o,r,s,a){const d=Nt(i,e);let g,p=i.inputs;!a&&null!=p&&(g=p[n])?(Ip(t,e,g,n,o),Ji(i)&&function rT(t,i){const e=Qt(i,t);16&e[W]||(e[W]|=64)}(e,i.index)):3&i.type&&(n=function oT(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(n),o=null!=s?s(o,i.value||"",n):o,r.setProperty(d,n,o))}function bp(t,i,e,n){if(z_()){const o=null===n?null:{"":-1},r=function uT(t,i){const e=t.directiveRegistry;let n=null,o=null;if(e)for(let r=0;r<e.length;r++){const s=e[r];if(m_(i,s.selectors,!1))if(n||(n=[]),mn(s))if(null!==s.findHostDirectiveDefs){const a=[];o=o||new Map,s.findHostDirectiveDefs(s,a,o),n.unshift(...a,s),yp(t,i,a.length)}else n.unshift(s),yp(t,i,0);else o=o||new Map,s.findHostDirectiveDefs?.(s,n,o),n.push(s)}return null===n?null:[n,o]}(t,e);let s,a;null===r?s=a=null:[s,a]=r,null!==s&&ny(t,i,e,s,o,a),o&&function hT(t,i,e){if(i){const n=t.localNames=[];for(let o=0;o<i.length;o+=2){const r=e[i[o+1]];if(null==r)throw new B(-301,!1);n.push(i[o],r)}}}(e,n,o)}e.mergedAttrs=cs(e.mergedAttrs,e.attrs)}function ny(t,i,e,n,o,r){for(let p=0;p<n.length;p++)wh(Hc(e,i),t,n[p].type);!function gT(t,i,e){t.flags|=1,t.directiveStart=i,t.directiveEnd=i+e,t.providerIndexes=i}(e,t.data.length,n.length);for(let p=0;p<n.length;p++){const g=n[p];g.providersResolver&&g.providersResolver(g)}let s=!1,a=!1,d=Fs(t,i,n.length,null);for(let p=0;p<n.length;p++){const g=n[p];e.mergedAttrs=cs(e.mergedAttrs,g.hostAttrs),fT(t,e,i,d,g),pT(d,g,o),null!==g.contentQueries&&(e.flags|=4),(null!==g.hostBindings||null!==g.hostAttrs||0!==g.hostVars)&&(e.flags|=64);const m=g.type.prototype;!s&&(m.ngOnChanges||m.ngOnInit||m.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(m.ngOnChanges||m.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),d++}!function iT(t,i,e){const o=i.directiveEnd,r=t.data,s=i.attrs,a=[];let d=null,p=null;for(let g=i.directiveStart;g<o;g++){const m=r[g],b=e?e.get(m):null,I=b?b.outputs:null;d=ey(0,m.inputs,g,d,b?b.inputs:null),p=ey(1,m.outputs,g,p,I);const P=null===d||null===s||$u(i)?null:vT(d,g,s);a.push(P)}null!==d&&(d.hasOwnProperty("class")&&(i.flags|=8),d.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=a,i.inputs=d,i.outputs=p}(t,e,r)}function iy(t,i,e){const n=e.directiveStart,o=e.directiveEnd,r=e.index,s=function kD(){return J.lFrame.currentDirectiveIndex}();try{to(r);for(let a=n;a<o;a++){const d=t.data[a],p=i[a];ph(a),(null!==d.hostBindings||0!==d.hostVars||null!==d.hostAttrs)&&dT(d,p)}}finally{to(-1),ph(s)}}function dT(t,i){null!==t.hostBindings&&t.hostBindings(1,i)}function yp(t,i,e){i.componentOffset=e,(t.components??=[]).push(i.index)}function pT(t,i,e){if(e){if(i.exportAs)for(let n=0;n<i.exportAs.length;n++)e[i.exportAs[n]]=t;mn(i)&&(e[""]=t)}}function fT(t,i,e,n,o){t.data[n]=o;const r=o.factory||(o.factory=Zi(o.type)),s=new _s(r,mn(o),R);t.blueprint[n]=s,e[n]=s,function aT(t,i,e,n,o){const r=o.hostBindings;if(r){let s=t.hostBindingOpCodes;null===s&&(s=t.hostBindingOpCodes=[]);const a=~i.index;(function cT(t){let i=t.length;for(;i>0;){const e=t[--i];if("number"==typeof e&&e<0)return e}return 0})(s)!=a&&s.push(a),s.push(e,n,r)}}(t,i,n,Fs(t,e,o.hostVars,ie),o)}function Bn(t,i,e,n,o,r){const s=Nt(t,i);!function Cp(t,i,e,n,o,r,s){if(null==r)t.removeAttribute(i,o,e);else{const a=null==s?ne(r):s(r,n||"",o);t.setAttribute(i,o,a,e)}}(i[K],s,r,t.value,e,n,o)}function _T(t,i,e,n,o,r){const s=r[i];if(null!==s)for(let a=0;a<s.length;)Yb(n,e,s[a++],s[a++],s[a++],s[a++])}function vT(t,i,e){let n=null,o=0;for(;o<e.length;){const r=e[o];if(0!==r)if(5!==r){if("number"==typeof r)break;if(t.hasOwnProperty(r)){null===n&&(n=[]);const s=t[r];for(let a=0;a<s.length;a+=3)if(s[a]===i){n.push(r,s[a+1],s[a+2],e[o+1]);break}}o+=2}else o+=2;else o+=4}return n}function oy(t,i,e,n){return[t,!0,0,i,null,n,null,e,null,null]}function ry(t,i){const e=t.contentQueries;if(null!==e){const n=re(null);try{for(let o=0;o<e.length;o+=2){const s=e[o+1];if(-1!==s){const a=t.data[s];Lc(e[o]),a.contentQueries(2,i[s],s)}}}finally{re(n)}}}function dl(t,i){return t[ds]?t[P_][fn]=i:t[ds]=i,t[P_]=i,i}function Mp(t,i,e){Lc(0);const n=re(null);try{i(t,e)}finally{re(n)}}function ul(t,i){const e=t[Ye],n=e?e.get(Fn,null):null;n&&n.handleError(i)}function Ip(t,i,e,n,o){for(let r=0;r<e.length;){const s=e[r++],a=e[r++],d=e[r++];Yb(t.data[s],i[s],n,a,d,o)}}function li(t,i,e){const n=ps(i,t);!function Ab(t,i,e){t.setValue(i,e)}(t[K],n,e)}function bT(t,i){const e=Qt(i,t),n=e[H];!function yT(t,i){for(let e=i.length;e<t.blueprint.length;e++)i.push(t.blueprint[e])}(n,e);const o=e[Oe];null!==o&&null===e[Dt]&&(e[Dt]=Gh(o,e[Ye])),wp(n,e,e[xe])}function wp(t,i,e){mh(i);try{const n=t.viewQuery;null!==n&&Mp(1,n,e);const o=t.template;null!==o&&Kb(t,i,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),i[ii]?.finishViewCreation(t),t.staticContentQueries&&ry(t,i),t.staticViewQueries&&Mp(2,t.viewQuery,e);const r=t.components;null!==r&&function CT(t,i){for(let e=0;e<i.length;e++)bT(t,i[e])}(i,r)}catch(n){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),n}finally{i[W]&=-5,_h()}}function co(t,i){return!i||null===i.firstChild||Is(t)}function Bs(t,i,e,n,o=!1){for(;null!==e;){if(128===e.type){e=o?e.projectionNext:e.next;continue}const r=i[e.index];null!==r&&n.push(he(r)),yt(r)&&dy(r,n);const s=e.type;if(8&s)Bs(t,i,e.child,n);else if(32&s){const a=op(e,i);let d;for(;d=a();)n.push(d)}else if(16&s){const a=zb(i,e);if(Array.isArray(a))n.push(...a);else{const d=oi(i[Le]);Bs(d[H],d,a,n,!0)}}e=o?e.projectionNext:e.next}return n}function dy(t,i){for(let e=Ue;e<t.length;e++){const n=t[e],o=n[H].firstChild;null!==o&&Bs(n[H],n,o,i)}t[An]!==t[Oe]&&i.push(t[An])}let uy=[];const ST={...ec,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{Ec(t.lView)},consumerOnSignalRead(){this.lView[rn]=this}},PT={...ec,consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{let i=oi(t.lView);for(;i&&!hy(i[H]);)i=oi(i);i&&H_(i)},consumerOnSignalRead(){this.lView[rn]=this}};function hy(t){return 2!==t.type}const DT=100;function hl(t,i=!0,e=0){const n=t[En],o=n.rendererFactory;o.begin?.();try{!function NT(t,i){const e=W_();try{Q_(!0),xp(t,i);let n=0;for(;kc(t);){if(n===DT)throw new B(103,!1);n++,xp(t,1)}}finally{Q_(e)}}(t,e)}catch(s){throw i&&ul(t,s),s}finally{o.end?.(),n.inlineEffectRunner?.flush()}}function TT(t,i,e,n){const o=i[W];if(!(256&~o))return;i[En].inlineEffectRunner?.flush(),mh(i);let a=!0,d=null,p=null;hy(t)?(p=function MT(t){return t[rn]??function IT(t){const i=uy.pop()??Object.create(ST);return i.lView=t,i}(t)}(i),d=tc(p)):null===function Nm(){return je}()?(a=!1,p=function xT(t){const i=t[rn]??Object.create(PT);return i.lView=t,i}(i),d=tc(p)):i[rn]&&(gu(i[rn]),i[rn]=null);try{V_(i),function Z_(t){return J.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&Kb(t,i,e,2,n);const g=!(3&~o);if(g){const y=t.preOrderCheckHooks;null!==y&&Fc(i,y,null)}else{const y=t.preOrderHooks;null!==y&&Bc(i,y,0,null),vh(i,0)}if(function kT(t){for(let i=jv(t);null!==i;i=Uv(i)){if(!(i[W]&Nc.HasTransplantedViews))continue;const e=i[Yo];for(let n=0;n<e.length;n++)H_(e[n])}}(i),gy(i,0),null!==t.contentQueries&&ry(t,i),g){const y=t.contentCheckHooks;null!==y&&Fc(i,y)}else{const y=t.contentHooks;null!==y&&Bc(i,y,1),vh(i,1)}!function ZN(t,i){const e=t.hostBindingOpCodes;if(null!==e)try{for(let n=0;n<e.length;n++){const o=e[n];if(o<0)to(~o);else{const r=o,s=e[++n],a=e[++n];TD(s,r),a(2,i[r])}}}finally{to(-1)}}(t,i);const m=t.components;null!==m&&my(i,m,0);const b=t.viewQuery;if(null!==b&&Mp(2,b,n),g){const y=t.viewCheckHooks;null!==y&&Fc(i,y)}else{const y=t.viewHooks;null!==y&&Bc(i,y,2),vh(i,2)}if(!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),i[Pc]){for(const y of i[Pc])y();i[Pc]=null}i[W]&=-73}catch(g){throw Ec(i),g}finally{null!==p&&(hu(p,d),a&&function wT(t){t.lView[rn]!==t&&(t.lView=null,uy.push(t))}(p)),_h()}}function gy(t,i){for(let e=jv(t);null!==e;e=Uv(e))for(let n=Ue;n<e.length;n++)fy(e[n],i)}function ET(t,i,e){fy(Qt(i,t),e)}function fy(t,i){ah(t)&&xp(t,i)}function xp(t,i){const n=t[H],o=t[W],r=t[rn];let s=!!(0===i&&16&o);if(s||=!!(64&o&&0===i),s||=!!(1024&o),s||=!(!r?.dirty||!pu(r)),s||=!1,r&&(r.dirty=!1),t[W]&=-9217,s)TT(n,t,n.template,t[xe]);else if(8192&o){gy(t,1);const a=n.components;null!==a&&my(t,a,1)}}function my(t,i,e){for(let n=0;n<i.length;n++)ET(t,i[n],e)}function Vs(t,i){const e=W_()?64:1088;for(t[En].changeDetectionScheduler?.notify(i);t;){t[W]|=e;const n=oi(t);if(hs(t)&&!n)return t;t=n}return null}class Hs{get rootNodes(){const i=this._lView,e=i[H];return Bs(e,i,e.firstChild,[])}constructor(i,e,n=!0){this._lView=i,this._cdRefInjectingView=e,this.notifyErrorHandler=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[xe]}set context(i){this._lView[xe]=i}get destroyed(){return!(256&~this._lView[W])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const i=this._lView[Ze];if(yt(i)){const e=i[8],n=e?e.indexOf(this):-1;n>-1&&(Ls(i,n),vc(e,n))}this._attachedToViewContainer=!1}sl(this._lView[H],this._lView)}onDestroy(i){Ac(this._lView,i)}markForCheck(){Vs(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[W]&=-129}reattach(){ch(this._lView),this._lView[W]|=128}detectChanges(){this._lView[W]|=1024,hl(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new B(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const i=hs(this._lView),e=this._lView[Ki];null!==e&&!i&&ap(e,this._lView),Ob(this._lView[H],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new B(902,!1);this._appRef=i;const e=hs(this._lView),n=this._lView[Ki];null!==n&&!e&&Lb(n,this._lView),ch(this._lView)}}let di=(()=>{class t{static{this.__NG_ELEMENT_ID__=LT}}return t})();const AT=di,OT=class extends AT{constructor(i,e,n){super(),this._declarationLView=i,this._declarationTContainer=e,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,e){return this.createEmbeddedViewImpl(i,e)}createEmbeddedViewImpl(i,e,n){const o=function cr(t,i,e,n){const o=re(null);try{const r=i.tView,d=ll(t,r,e,4096&t[W]?4096:16,null,i,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null);d[Ki]=t[i.index];const g=t[ii];return null!==g&&(d[ii]=g.createEmbeddedView(r)),wp(r,d,e),d}finally{re(o)}}(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:e,dehydratedView:n});return new Hs(o)}};function LT(){return pl(be(),L())}function pl(t,i){return 4&t.type?new OT(i,t,er(t,i)):null}class ur{}const Qs=new j("",{providedIn:"root",factory:()=>!1}),By=new j(""),Fp=new j("");class Pk{}class Vy{}class Nk{resolveComponentFactory(i){throw function Dk(t){const i=Error(`No component factory found for ${nt(t)}.`);return i.ngComponent=t,i}(i)}}class bl{static{this.NULL=new Nk}}class Bp{}let ui=(()=>{class t{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>function Tk(){const t=L(),e=Qt(be().index,t);return(rt(e)?e:t)[K]}()}}return t})(),kk=(()=>{class t{static{this.\u0275prov=z({token:t,providedIn:"root",factory:()=>null})}}return t})();function Cl(t,i,e){let n=e?t.styles:null,o=e?t.classes:null,r=0;if(null!==i)for(let s=0;s<i.length;s++){const a=i[s];"number"==typeof a?r=a:1==r?o=Du(o,a):2==r&&(n=Du(n,a+": "+i[++s]+";"))}e?t.styles=n:t.stylesWithoutHost=n,e?t.classes=o:t.classesWithoutHost=o}class zy extends bl{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){const e=ae(i);return new Ks(e,this.ngModule)}}function Gy(t,i){const e=[];for(const n in t){if(!t.hasOwnProperty(n))continue;const o=t[n];if(void 0===o)continue;const r=Array.isArray(o),s=r?o[0]:o;e.push(i?{propName:s,templateName:n,isSignal:!!((r?o[1]:Mi.None)&Mi.SignalBased)}:{propName:s,templateName:n})}return e}class Ks extends Vy{get inputs(){const i=this.componentDef,e=i.inputTransforms,n=Gy(i.inputs,!0);if(null!==e)for(const o of n)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return n}get outputs(){return Gy(this.componentDef.outputs,!1)}constructor(i,e){super(),this.componentDef=i,this.ngModule=e,this.componentType=i.type,this.selector=function jP(t){return t.map(HP).join(",")}(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!e}create(i,e,n,o){const r=re(null);try{let s=(o=o||this.ngModule)instanceof Pt?o:o?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const a=s?new no(i,s):i,d=a.get(Bp,null);if(null===d)throw new B(407,!1);const m={rendererFactory:d,sanitizer:a.get(kk,null),inlineEffectRunner:null,changeDetectionScheduler:a.get(ur,null)},b=d.createRenderer(null,this.componentDef),y=this.componentDef.selectors[0][0]||"div",I=n?function KN(t,i,e,n){const r=n.get(ab,!1)||e===pn.ShadowDom,s=t.selectRootElement(i,r);return function JN(t){Xb(t)}(s),s}(b,n,this.componentDef.encapsulation,a):rl(b,y,function Ok(t){const i=t.toLowerCase();return"svg"===i?"svg":"math"===i?"math":null}(y));let P=512;this.componentDef.signals?P|=4096:this.componentDef.onPush||(P|=16);let T=null;null!==I&&(T=Gh(I,a,!0));const A=vp(0,null,null,1,0,null,null,null,null,null,null),E=ll(null,A,null,P,null,null,m,b,a,null,T);mh(E);let V,U,G=null;try{const te=this.componentDef;let Te,bi=null;te.findHostDirectiveDefs?(Te=[],bi=new Map,te.findHostDirectiveDefs(te,Te,bi),Te.push(te)):Te=[te];const Rx=function Rk(t,i){const e=t[H],n=$;return t[n]=i,ao(e,n,2,"#host",null)}(E,I);G=function Fk(t,i,e,n,o,r,s){const a=o[H];!function Bk(t,i,e,n){for(const o of t)i.mergedAttrs=cs(i.mergedAttrs,o.hostAttrs);null!==i.mergedAttrs&&(Cl(i,i.mergedAttrs,!0),null!==e&&Wb(n,e,i))}(n,t,i,s);let d=null;null!==i&&(d=Gh(i,o[Ye]));const p=r.rendererFactory.createRenderer(i,e);let g=16;e.signals?g=4096:e.onPush&&(g=64);const m=ll(o,Jb(e),null,g,o[t.index],t,r,p,null,null,d);return a.firstCreatePass&&yp(a,t,n.length-1),dl(o,m),o[t.index]=m}(Rx,I,te,Te,E,m,b),U=gs(A,$),I&&function Hk(t,i,e,n){if(n)Gu(t,e,["ng-version","18.2.13"]);else{const{attrs:o,classes:r}=function UP(t){const i=[],e=[];let n=1,o=2;for(;n<t.length;){let r=t[n];if("string"==typeof r)2===o?""!==r&&i.push(r,t[++n]):8===o&&e.push(r);else{if(!gn(o))break;o=r}n++}return{attrs:i,classes:e}}(i.selectors[0]);o&&Gu(t,e,o),r&&r.length>0&&qb(t,e,r.join(" "))}}(b,te,I,n),void 0!==e&&function jk(t,i,e){const n=t.projection=[];for(let o=0;o<i.length;o++){const r=e[o];n.push(null!=r?Array.from(r):null)}}(U,this.ngContentSelectors,e),V=function Vk(t,i,e,n,o,r){const s=be(),a=o[H],d=Nt(s,o);ny(a,o,s,e,null,n);for(let g=0;g<e.length;g++)Ct(io(o,a,s.directiveStart+g,s),o);iy(a,o,s),d&&Ct(d,o);const p=io(o,a,s.directiveStart+s.componentOffset,s);if(t[xe]=o[xe]=p,null!==r)for(const g of r)g(p,i);return fp(a,s,o),p}(G,te,Te,bi,E,[Uk]),wp(A,E,null)}catch(te){throw null!==G&&Lh(G),Lh(E),te}finally{_h()}return new Lk(this.componentType,V,er(U,E),E,U)}finally{re(r)}}}class Lk extends Pk{constructor(i,e,n,o,r){super(),this.location=n,this._rootLView=o,this._tNode=r,this.previousInputValues=null,this.instance=e,this.hostView=this.changeDetectorRef=new Hs(o,void 0,!1),this.componentType=i}setInput(i,e){const n=this._tNode.inputs;let o;if(null!==n&&(o=n[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),e))return;const r=this._rootLView;Ip(r[H],r,o,i,e),this.previousInputValues.set(i,e),Vs(Qt(this._tNode.index,r),1)}}get injector(){return new st(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}}function Uk(){const t=be();Rc(L()[H],t)}let bn=(()=>{class t{static{this.__NG_ELEMENT_ID__=zk}}return t})();function zk(){return function Wy(t,i){let e;const n=i[t.index];return yt(n)?e=n:(e=oy(n,i,null,t),i[t.index]=e,dl(i,e)),Qy(e,i,t,n),new $y(e,t,i)}(be(),L())}const Gk=bn,$y=class extends Gk{constructor(i,e,n){super(),this._lContainer=i,this._hostTNode=e,this._hostLView=n}get element(){return er(this._hostTNode,this._hostLView)}get injector(){return new st(this._hostTNode,this._hostLView)}get parentInjector(){const i=jc(this._hostTNode,this._hostLView);if(Ch(i)){const e=bs(i,this._hostLView),n=vs(i);return new st(e[H].data[n+8],e)}return new st(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){const e=qy(this._lContainer);return null!==e&&e[i]||null}get length(){return this._lContainer.length-Ue}createEmbeddedView(i,e,n){let o,r;"number"==typeof n?o=n:null!=n&&(o=n.index,r=n.injector);const a=i.createEmbeddedViewImpl(e||{},r,null);return this.insertImpl(a,o,co(this._hostTNode,null)),a}createComponent(i,e,n,o,r){const s=i&&!function ls(t){return"function"==typeof t}(i);let a;if(s)a=e;else{const I=e||{};a=I.index,n=I.injector,o=I.projectableNodes,r=I.environmentInjector||I.ngModuleRef}const d=s?i:new Ks(ae(i)),p=n||this.parentInjector;if(!r&&null==d.ngModule){const P=(s?p:this.parentInjector).get(Pt,null);P&&(r=P)}ae(d.componentType??{});const y=d.create(p,o,null,r);return this.insertImpl(y.hostView,a,co(this._hostTNode,null)),y}insert(i,e){return this.insertImpl(i,e,!0)}insertImpl(i,e,n){const o=i._lView;if(function yD(t){return yt(t[Ze])}(o)){const a=this.indexOf(i);if(-1!==a)this.detach(a);else{const d=o[Ze],p=new $y(d,d[mt],d[Ze]);p.detach(p.indexOf(i))}}const r=this._adjustIndex(e),s=this._lContainer;return function lr(t,i,e,n=!0){const o=i[H];if(function jN(t,i,e,n){const o=Ue+n,r=e.length;n>0&&(e[o-1][fn]=i),n<r-Ue?(i[fn]=e[o],c_(e,Ue+n,i)):(e.push(i),i[fn]=null),i[Ze]=e;const s=i[Ki];null!==s&&e!==s&&Lb(s,i);const a=i[ii];null!==a&&a.insertView(t),ch(i),i[W]|=128}(o,i,t,e),n){const s=hp(e,t),a=i[K],d=dp(a,t[An]);null!==d&&function VN(t,i,e,n,o,r){n[Oe]=o,n[mt]=i,cl(t,n,e,1,o,r)}(o,t[mt],a,i,d,s)}const r=i[Dt];null!==r&&null!==r.firstChild&&(r.firstChild=null)}(s,o,r,n),i.attachToViewContainerRef(),c_(jp(s),r,i),i}move(i,e){return this.insert(i,e)}indexOf(i){const e=qy(this._lContainer);return null!==e?e.indexOf(i):-1}remove(i){const e=this._adjustIndex(i,-1),n=Ls(this._lContainer,e);n&&(vc(jp(this._lContainer),e),sl(n[H],n))}detach(i){const e=this._adjustIndex(i,-1),n=Ls(this._lContainer,e);return n&&null!=vc(jp(this._lContainer),e)?new Hs(n):null}_adjustIndex(i,e=0){return i??this.length+e}};function qy(t){return t[8]}function jp(t){return t[8]||(t[8]=[])}let Qy=function Yy(t,i,e,n){if(t[An])return;let o;o=8&e.type?he(n):function $k(t,i){const e=t[K],n=e.createComment(""),o=Nt(i,t);return ro(e,dp(e,o),n,function GN(t,i){return t.nextSibling(i)}(e,o),!1),n}(i,e),t[An]=o},Up=()=>!1;const oC=new Set;function kt(t){oC.has(t)||(oC.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function hr(t,i){kt("NgSignals");const e=function zx(t){const i=Object.create($x);i.value=t;const e=()=>(uu(i),i.value);return e[hn]=i,e}(t),n=e[hn];return i?.equal&&(n.equal=i.equal),e.set=o=>Vm(n,o),e.update=o=>function Gx(t,i){Em()||Bm(),Vm(t,i(t.value))}(n,o),e.asReadonly=sC.bind(e),e}function sC(){const t=this[hn];if(void 0===t.readonlyFn){const i=()=>this();i[hn]=t,t.readonlyFn=i}return t.readonlyFn}function aC(t){return function rC(t){return"function"==typeof t&&void 0!==t[hn]}(t)&&"function"==typeof t.set}function ye(t){let i=function vC(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const n=[t];for(;i;){let o;if(mn(t))o=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new B(903,!1);o=i.\u0275dir}if(o){if(e){n.push(o);const s=t;s.inputs=Il(t.inputs),s.inputTransforms=Il(t.inputTransforms),s.declaredInputs=Il(t.declaredInputs),s.outputs=Il(t.outputs);const a=o.hostBindings;a&&gE(t,a);const d=o.viewQuery,p=o.contentQueries;if(d&&hE(t,d),p&&pE(t,p),dE(t,o),aP(t.outputs,o.outputs),mn(o)&&o.data.animation){const g=t.data;g.animation=(g.animation||[]).concat(o.data.animation)}}const r=o.features;if(r)for(let s=0;s<r.length;s++){const a=r[s];a&&a.ngInherit&&a(t),a===ye&&(e=!1)}}i=Object.getPrototypeOf(i)}!function uE(t){let i=0,e=null;for(let n=t.length-1;n>=0;n--){const o=t[n];o.hostVars=i+=o.hostVars,o.hostAttrs=cs(o.hostAttrs,e=cs(e,o.hostAttrs))}}(n)}function dE(t,i){for(const e in i.inputs){if(!i.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;const n=i.inputs[e];if(void 0!==n&&(t.inputs[e]=n,t.declaredInputs[e]=i.declaredInputs[e],null!==i.inputTransforms)){const o=Array.isArray(n)?n[0]:n;if(!i.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=i.inputTransforms[o]}}}function Il(t){return t===Nn?{}:t===ue?[]:t}function hE(t,i){const e=t.viewQuery;t.viewQuery=e?(n,o)=>{i(n,o),e(n,o)}:i}function pE(t,i){const e=t.contentQueries;t.contentQueries=e?(n,o,r)=>{i(n,o,r),e(n,o,r)}:i}function gE(t,i){const e=t.hostBindings;t.hostBindings=e?(n,o)=>{i(n,o),e(n,o)}:i}function IC(t){const i=t.inputConfig,e={};for(const n in i)if(i.hasOwnProperty(n)){const o=i[n];Array.isArray(o)&&o[3]&&(e[n]=o[3])}t.inputTransforms=e}class ho{}class wC{}class Jp extends ho{constructor(i,e,n,o=!0){super(),this.ngModuleType=i,this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new zy(this);const r=bt(i);this._bootstrapComponents=Yt(r.bootstrap),this._r3Injector=Mv(i,e,[{provide:ho,useValue:this},{provide:bl,useValue:this.componentFactoryResolver},...n],nt(i),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}}class Xp extends wC{constructor(i){super(),this.moduleType=i}create(i){return new Jp(this.moduleType,i,[])}}class SC extends ho{constructor(i){super(),this.componentFactoryResolver=new zy(this),this.instance=null;const e=new zo([...i.providers,{provide:ho,useValue:this},{provide:bl,useValue:this.componentFactoryResolver}],i.parent||Sc(),i.debugName,new Set(["environment"]));this.injector=e,i.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}}function wl(t,i,e=null){return new SC({providers:t,parent:i,debugName:e,runEnvironmentInitializers:!0}).injector}function Sl(t){return!!function eg(t){return null!==t&&("function"==typeof t||"object"==typeof t)}(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function Vn(t,i,e){return t[i]=e}function ze(t,i,e){return!Object.is(t[i],e)&&(t[i]=e,!0)}function po(t,i,e,n){const o=ze(t,i,e);return ze(t,i+1,n)||o}function ea(t,i,e,n,o,r,s,a,d,p){const g=e+$,m=i.firstCreatePass?function xE(t,i,e,n,o,r,s,a,d){const p=i.consts,g=ao(i,t,4,s||null,a||null);bp(i,e,g,an(p,d)),Rc(i,g);const m=g.tView=vp(2,g,n,o,r,i.directiveRegistry,i.pipeRegistry,null,i.schemas,p,null);return null!==i.queries&&(i.queries.template(i,g),m.queries=i.queries.embeddedTView(g)),g}(g,i,t,n,o,r,s,a,d):i.data[g];_n(m,!1);const b=xC(i,t,m,e);ms()&&al(i,t,b,m),Ct(b,t);const y=oy(b,t,b,m);return t[g]=y,dl(t,y),function Zy(t,i,e){return Up(t,i,e)}(y,m,t),Tc(m)&&mp(i,t,m),null!=d&&_p(t,m,p),m}function D(t,i,e,n,o,r,s,a){const d=L(),p=se();return ea(d,p,t,i,e,n,o,an(p.consts,r),s,a),D}let xC=function PC(t,i,e,n){return Ln(!0),i[K].createComment("")};var mr=function(t){return t[t.EarlyRead=0]="EarlyRead",t[t.Write=1]="Write",t[t.MixedReadWrite=2]="MixedReadWrite",t[t.Read=3]="Read",t}(mr||{});let AC=(()=>{class t{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=z({token:t,providedIn:"root",factory:()=>new t})}}return t})();class ia{constructor(){this.ngZone=F(fe),this.scheduler=F(ur),this.errorHandler=F(Fn,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[mr.EarlyRead,mr.Write,mr.MixedReadWrite,mr.Read]}execute(){this.executing=!0;for(const i of ia.PHASES)for(const e of this.sequences)if(!e.erroredOrDestroyed&&e.hooks[i])try{e.pipelinedValue=this.ngZone.runOutsideAngular(()=>e.hooks[i](e.pipelinedValue))}catch(n){e.erroredOrDestroyed=!0,this.errorHandler?.handleError(n)}this.executing=!1;for(const i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(const i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(i){this.executing?this.deferredRegistrations.add(i):(this.sequences.add(i),this.scheduler.notify(6))}unregister(i){this.executing&&this.sequences.has(i)?(i.erroredOrDestroyed=!0,i.pipelinedValue=void 0,i.once=!0):(this.sequences.delete(i),this.deferredRegistrations.delete(i))}static{this.\u0275prov=z({token:ia,providedIn:"root",factory:()=>new ia})}}class TE{constructor(i,e,n,o){this.impl=i,this.hooks=e,this.once=n,this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}}function Tl(t,i){!i?.injector&&function Xu(t){if(!S_())throw new B(-203,!1)}();const e=i?.injector??F(ht);return function Kt(t){return"browser"===(t??F(ht)).get(ai)}(e)?(kt("NgAfterNextRender"),function OC(t,i,e,n){const o=i.get(AC);o.impl??=i.get(ia);const r=e?.phase??mr.MixedReadWrite,s=!0!==e?.manualCleanup?i.get(Cs):null,a=new TE(o.impl,function EE(t,i){if(t instanceof Function){const e=[void 0,void 0,void 0,void 0];return e[i]=t,e}return[t.earlyRead,t.write,t.mixedReadWrite,t.read]}(t,r),n,s);return o.impl.register(a),a}(t,e,i,!0)):LC}const LC={destroy(){}};function Hn(t,i,e,n){const o=L();return ze(o,vn(),i)&&(se(),Bn(Pe(),o,t,i,e,n)),Hn}function wr(t,i,e,n,o,r){const a=po(t,ri(),e,o);return si(2),a?i+ne(e)+n+ne(o)+r:ie}function Sr(t,i,e,n,o,r,s,a){const p=function xl(t,i,e,n,o){const r=po(t,i,e,n);return ze(t,i+2,o)||r}(t,ri(),e,o,s);return si(3),p?i+ne(e)+n+ne(o)+r+ne(s)+a:ie}function xr(t,i,e,n,o,r,s,a,d,p){const m=function cn(t,i,e,n,o,r){const s=po(t,i,e,n);return po(t,i+2,o,r)||s}(t,ri(),e,o,s,d);return si(4),m?i+ne(e)+n+ne(o)+r+ne(s)+a+ne(d)+p:ie}function Al(t,i){return t<<17|i<<2}function Ei(t){return t>>17&32767}function ug(t){return 2|t}function fo(t){return(131068&t)>>2}function hg(t,i){return-131069&t|i<<2}function pg(t){return 1|t}function a1(t,i,e,n){const o=t[e+1],r=null===i;let s=n?Ei(o):fo(o),a=!1;for(;0!==s&&(!1===a||r);){const p=t[s+1];gA(t[s],i)&&(a=!0,t[s+1]=n?pg(p):ug(p)),s=n?Ei(p):fo(p)}a&&(t[e+1]=n?ug(o):pg(o))}function gA(t,i){return null===t||null==i||(Array.isArray(t)?t[1]:t)===i||!(!Array.isArray(t)||"string"!=typeof i)&&Ho(t,i)>=0}function C(t,i,e){const n=L();return ze(n,vn(),i)&&jt(se(),Pe(),n,t,i,n[K],e,!1),C}function gg(t,i,e,n,o){const s=o?"class":"style";Ip(t,e,i.inputs[s],s,n)}function Ce(t,i){return function yn(t,i,e,n){const o=L(),r=se(),s=si(2);r.firstUpdatePass&&function m1(t,i,e,n){const o=t.data;if(null===o[e+1]){const r=o[_t()],s=function f1(t,i){return i>=t.expandoStartIndex}(t,e);(function y1(t,i){return!!(t.flags&(i?8:16))})(r,n)&&null===i&&!s&&(i=!1),i=function IA(t,i,e,n){const o=function gh(t){const i=J.lFrame.currentDirectiveIndex;return-1===i?null:t[i]}(t);let r=n?i.residualClasses:i.residualStyles;if(null===o)0===(n?i.classBindings:i.styleBindings)&&(e=ra(e=fg(null,t,i,e,n),i.attrs,n),r=null);else{const s=i.directiveStylingLast;if(-1===s||t[s]!==o)if(e=fg(o,t,i,e,n),null===r){let d=function wA(t,i,e){const n=e?i.classBindings:i.styleBindings;if(0!==fo(n))return t[Ei(n)]}(t,i,n);void 0!==d&&Array.isArray(d)&&(d=fg(null,t,i,d[1],n),d=ra(d,i.attrs,n),function SA(t,i,e,n){t[Ei(e?i.classBindings:i.styleBindings)]=n}(t,i,n,d))}else r=function xA(t,i,e){let n;const o=i.directiveEnd;for(let r=1+i.directiveStylingLast;r<o;r++)n=ra(n,t[r].hostAttrs,e);return ra(n,i.attrs,e)}(t,i,n)}return void 0!==r&&(n?i.residualClasses=r:i.residualStyles=r),e}(o,r,i,n),function hA(t,i,e,n,o,r){let s=r?i.classBindings:i.styleBindings,a=Ei(s),d=fo(s);t[n]=e;let g,p=!1;if(Array.isArray(e)?(g=e[1],(null===g||Ho(e,g)>0)&&(p=!0)):g=e,o)if(0!==d){const b=Ei(t[a+1]);t[n+1]=Al(b,a),0!==b&&(t[b+1]=hg(t[b+1],n)),t[a+1]=function dA(t,i){return 131071&t|i<<17}(t[a+1],n)}else t[n+1]=Al(a,0),0!==a&&(t[a+1]=hg(t[a+1],n)),a=n;else t[n+1]=Al(d,0),0===a?a=n:t[d+1]=hg(t[d+1],n),d=n;p&&(t[n+1]=ug(t[n+1])),a1(t,g,n,!0),a1(t,g,n,!1),function pA(t,i,e,n,o){const r=o?t.residualClasses:t.residualStyles;null!=r&&"string"==typeof i&&Ho(r,i)>=0&&(e[n+1]=pg(e[n+1]))}(i,g,t,n,r),s=Al(a,d),r?i.classBindings=s:i.styleBindings=s}(o,r,i,e,s,n)}}(r,t,s,n),i!==ie&&ze(o,s,i)&&function v1(t,i,e,n,o,r,s,a){if(!(3&i.type))return;const d=t.data,p=d[a+1],g=function uA(t){return!(1&~t)}(p)?b1(d,i,e,o,fo(p),s):void 0;Ol(g)||(Ol(r)||function lA(t){return!(2&~t)}(p)&&(r=b1(d,null,e,o,a,s)),function WN(t,i,e,n,o){if(i)o?t.addClass(e,n):t.removeClass(e,n);else{let r=-1===n.indexOf("-")?void 0:Di.DashCase;null==o?t.removeStyle(e,n,r):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),r|=Di.Important),t.setStyle(e,n,o,r))}}(n,s,ps(_t(),e),o,r))}(r,r.data[_t()],o,o[K],t,o[s+1]=function TA(t,i){return null==t||""===t||("string"==typeof i?t+=i:"object"==typeof t&&(t=nt(Pi(t)))),t}(i,e),n,s)}(t,i,null,!0),Ce}function fg(t,i,e,n,o){let r=null;const s=e.directiveEnd;let a=e.directiveStylingLast;for(-1===a?a=e.directiveStart:a++;a<s&&(r=i[a],n=ra(n,r.hostAttrs,o),r!==t);)a++;return null!==t&&(e.directiveStylingLast=a),n}function ra(t,i,e){const n=e?1:2;let o=-1;if(null!==i)for(let r=0;r<i.length;r++){const s=i[r];"number"==typeof s?o=s:o===n&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Wt(t,s,!!e||i[++r]))}return void 0===t?null:t}function b1(t,i,e,n,o,r){const s=null===i;let a;for(;o>0;){const d=t[o],p=Array.isArray(d),g=p?d[1]:d,m=null===g;let b=e[o+1];b===ie&&(b=m?ue:void 0);let y=m?Uu(b,n):g===n?b:void 0;if(p&&!Ol(y)&&(y=Uu(d,n)),Ol(y)&&(a=y,s))return a;const I=t[o+1];o=s?Ei(I):fo(I)}if(null!==i){let d=r?i.residualClasses:i.residualStyles;null!=d&&(a=Uu(d,n))}return a}function Ol(t){return void 0!==t}function l(t,i,e,n){const o=L(),r=se(),s=$+t,a=o[K],d=r.firstCreatePass?function XA(t,i,e,n,o,r){const s=i.consts,d=ao(i,t,2,n,an(s,o));return bp(i,e,d,an(s,r)),null!==d.attrs&&Cl(d,d.attrs,!1),null!==d.mergedAttrs&&Cl(d,d.mergedAttrs,!0),null!==i.queries&&i.queries.elementStart(i,d),d}(s,r,o,i,e,n):r.data[s],p=w1(r,o,d,a,i,t);o[s]=p;const g=Tc(d);return _n(d,!0),Wb(a,p,d),!function gr(t){return!(32&~t.flags)}(d)&&ms()&&al(r,o,p,d),0===function CD(){return J.lFrame.elementDepthCount}()&&Ct(p,o),function MD(){J.lFrame.elementDepthCount++}(),g&&(mp(r,o,d),fp(r,d,o)),null!==n&&_p(o,d),l}function c(){let t=be();uh()?hh():(t=t.parent,_n(t,!1));const i=t;(function wD(t){return J.skipHydrationRootTNode===t})(i)&&function DD(){J.skipHydrationRootTNode=null}(),function ID(){J.lFrame.elementDepthCount--}();const e=se();return e.firstCreatePass&&(Rc(e,t),nh(t)&&e.queries.elementEnd(t)),null!=i.classesWithoutHost&&function UD(t){return!!(8&t.flags)}(i)&&gg(e,i,L(),i.classesWithoutHost,!0),null!=i.stylesWithoutHost&&function zD(t){return!!(16&t.flags)}(i)&&gg(e,i,L(),i.stylesWithoutHost,!1),c}function X(t,i,e,n){return l(t,i,e,n),c(),X}let w1=(t,i,e,n,o,r)=>(Ln(!0),rl(n,o,function nv(){return J.lFrame.currentNamespace}()));function zn(t,i,e){const n=L(),o=se(),r=t+$,s=o.firstCreatePass?function nO(t,i,e,n,o){const r=i.consts,s=an(r,n),a=ao(i,t,8,"ng-container",s);return null!==s&&Cl(a,s,!0),bp(i,e,a,an(r,o)),null!==i.queries&&i.queries.elementStart(i,a),a}(r,o,n,i,e):o.data[r];_n(s,!0);const a=x1(o,n,s,t);return n[r]=a,ms()&&al(o,n,a,s),Ct(a,n),Tc(s)&&(mp(o,n,s),fp(o,s,n)),null!=e&&_p(n,s),zn}function Gn(){let t=be();const i=se();return uh()?hh():(t=t.parent,_n(t,!1)),i.firstCreatePass&&(Rc(i,t),nh(t)&&i.queries.elementEnd(t)),Gn}let x1=(t,i,e,n)=>(Ln(!0),sp(i[K],""));function O(){return L()}const mo=void 0;var sO=["en",[["a","p"],["AM","PM"],mo],[["AM","PM"],mo,mo],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],mo,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],mo,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",mo,"{1} 'at' {0}",mo],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function rO(t){const e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let Er={};function Et(t){const i=function aO(t){return t.toLowerCase().replace(/_/g,"-")}(t);let e=T1(i);if(e)return e;const n=i.split("-")[0];if(e=T1(n),e)return e;if("en"===n)return sO;throw new B(701,!1)}function T1(t){return t in Er||(Er[t]=Ee.ng&&Ee.ng.common&&Ee.ng.common.locales&&Ee.ng.common.locales[t]),Er[t]}var De=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(De||{});const Rl="en-US";let k1=Rl,Z1=(t,i,e)=>{};function M(t,i,e,n){const o=L(),r=se(),s=be();return Cg(r,o,o[K],s,t,i,n),M}function Cg(t,i,e,n,o,r,s){const a=Tc(n),p=t.firstCreatePass&&function ay(t){return t.cleanup??=[]}(t),g=i[xe],m=function sy(t){return t[qo]??=[]}(i);let b=!0;if(3&n.type||s){const P=Nt(n,i),T=s?s(P):P,A=m.length,E=s?U=>s(he(U[n.index])):n.index;let V=null;if(!s&&a&&(V=function ZO(t,i,e,n){const o=t.cleanup;if(null!=o)for(let r=0;r<o.length-1;r+=2){const s=o[r];if(s===e&&o[r+1]===n){const a=i[qo],d=o[r+2];return a.length>d?a[d]:null}"string"==typeof s&&(r+=2)}return null}(t,i,o,n.index)),null!==V)(V.__ngLastListenerFn__||V).__ngNextListenerFn__=r,V.__ngLastListenerFn__=r,b=!1;else{r=X1(n,i,g,r),Z1(P,o,r);const U=e.listen(T,o,r);m.push(r,U),p&&p.push(o,E,A,A+1)}}else r=X1(n,i,g,r);const y=n.outputs;let I;if(b&&null!==y&&(I=y[o])){const P=I.length;if(P)for(let T=0;T<P;T+=2){const G=i[I[T]][I[T+1]].subscribe(r),te=m.length;m.push(r,G),p&&p.push(o,n.index,te,-(te+1))}}}function J1(t,i,e,n){const o=re(null);try{return On(6,i,e),!1!==e(n)}catch(r){return ul(t,r),!1}finally{On(7,i,e),re(o)}}function X1(t,i,e,n){return function o(r){if(r===Function)return n;Vs(t.componentOffset>-1?Qt(t.index,i):i,5);let a=J1(i,e,n,r),d=o.__ngNextListenerFn__;for(;d;)a=J1(i,e,d,r)&&a,d=d.__ngNextListenerFn__;return a}}function f(t=1){return function AD(t){return(J.lFrame.contextLView=function j_(t,i){for(;t>0;)i=i[Wo],t--;return i}(t,J.lFrame.contextLView))[xe]}(t)}function Hl(t,i,e,n,o,r,s){const a=L(),d=wr(a,i,e,n,o,r);return d!==ie&&jt(se(),Pe(),a,t,d,a[K],s,!1),Hl}function $n(t){return Xi(function $_(){return J.lFrame.contextLView}(),$+t)}function u(t,i=""){const e=L(),n=se(),o=t+$,r=n.firstCreatePass?ao(n,o,1,i,null):n.data[o],s=yM(n,e,r,i,t);e[o]=s,ms()&&al(n,e,s,r),_n(r,!1)}let yM=(t,i,e,n,o)=>(Ln(!0),function rp(t,i){return t.createText(i)}(i[K],n));function N(t){return k("",t,""),N}function k(t,i,e){const n=L(),o=function Ir(t,i,e,n){return ze(t,vn(),e)?i+ne(e)+n:ie}(n,t,i,e);return o!==ie&&li(n,_t(),o),k}function Be(t,i,e,n,o){const r=L(),s=wr(r,t,i,e,n,o);return s!==ie&&li(r,_t(),s),Be}function ua(t,i,e,n,o,r,s){const a=L(),d=Sr(a,t,i,e,n,o,r,s);return d!==ie&&li(a,_t(),d),ua}function ha(t,i,e,n,o,r,s,a,d){const p=L(),g=xr(p,t,i,e,n,o,r,s,a,d);return g!==ie&&li(p,_t(),g),ha}function w(t,i,e){aC(i)&&(i=i());const n=L();return ze(n,vn(),i)&&jt(se(),Pe(),n,t,i,n[K],e,!1),w}function x(t,i){const e=aC(t);return e&&t.set(i),e}function S(t,i){const e=L(),n=se(),o=be();return Cg(n,e,e[K],o,t,i),S}function wg(t,i,e,n,o){if(t=Y(t),Array.isArray(t))for(let r=0;r<t.length;r++)wg(t[r],i,e,n,o);else{const r=se(),s=L(),a=be();let d=Yi(t)?t:Y(t.provide);const p=w_(t),g=1048575&a.providerIndexes,m=a.directiveStart,b=a.providerIndexes>>20;if(Yi(t)||!t.multi){const y=new _s(p,o,R),I=xg(d,i,o?g:g+b,m);-1===I?(wh(Hc(a,s),r,d),Sg(r,t,i.length),i.push(d),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(y),s.push(y)):(e[I]=y,s[I]=y)}else{const y=xg(d,i,g+b,m),I=xg(d,i,g,g+b),T=I>=0&&e[I];if(o&&!T||!o&&!(y>=0&&e[y])){wh(Hc(a,s),r,d);const A=function yL(t,i,e,n,o){const r=new _s(t,e,R);return r.multi=[],r.index=i,r.componentProviders=0,DM(r,o,n&&!e),r}(o?bL:vL,e.length,o,n,p);!o&&T&&(e[I].providerFactory=A),Sg(r,t,i.length,0),i.push(d),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(A),s.push(A)}else Sg(r,t,y>-1?y:I,DM(e[o?I:y],p,!o&&n));!o&&n&&T&&e[I].componentProviders++}}}function Sg(t,i,e,n){const o=Yi(i),r=function ZP(t){return!!t.useClass}(i);if(o||r){const d=(r?Y(i.useClass):i).prototype.ngOnDestroy;if(d){const p=t.destroyHooks||(t.destroyHooks=[]);if(!o&&i.multi){const g=p.indexOf(e);-1===g?p.push(e,[n,d]):p[g+1].push(n,d)}else p.push(e,d)}}}function DM(t,i,e){return e&&t.componentProviders++,t.multi.push(i)-1}function xg(t,i,e,n){for(let o=e;o<n;o++)if(i[o]===t)return o;return-1}function vL(t,i,e,n){return Pg(this.multi,[])}function bL(t,i,e,n){const o=this.multi;let r;if(this.providerFactory){const s=this.providerFactory.componentProviders,a=io(e,e[H],this.providerFactory.index,n);r=a.slice(0,s),Pg(o,r);for(let d=s;d<a.length;d++)r.push(a[d])}else r=[],Pg(o,r);return r}function Pg(t,i){for(let e=0;e<t.length;e++)i.push((0,t[e])());return i}function Re(t,i=[]){return e=>{e.providersResolver=(n,o)=>function _L(t,i,e){const n=se();if(n.firstCreatePass){const o=mn(t);wg(e,n.data,n.blueprint,o,!0),wg(i,n.data,n.blueprint,o,!1)}}(n,o?o(t):t,i)}}let CL=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){const n=qu(0,e.type),o=n.length>0?wl([n],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=z({token:t,providedIn:"environment",factory:()=>new t(q(Pt))})}}return t})();function Ae(t){kt("NgStandalone"),t.getStandaloneInjector=i=>i.get(CL).getOrCreateStandaloneInjector(t)}function pa(t,i){const e=t[i];return e===ie?void 0:e}function AM(t,i,e,n,o,r,s){const a=i+e;return po(t,a,o,r)?Vn(t,a+2,s?n.call(s,o,r):n(o,r)):pa(t,a+2)}function hi(t,i){const e=se();let n;const o=t+$;e.firstCreatePass?(n=function OL(t,i){if(i)for(let e=i.length-1;e>=0;e--){const n=i[e];if(t===n.name)return n}}(i,e.pipeRegistry),e.data[o]=n,n.onDestroy&&(e.destroyHooks??=[]).push(o,n.onDestroy)):n=e.data[o];const r=n.factory||(n.factory=Zi(n.type)),a=Ft(R);try{const d=Vc(!1),p=r();return Vc(d),function Ig(t,i,e,n){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),i[e]=n}(e,L(),o,p),p}finally{Ft(a)}}function Dg(t,i,e){const n=t+$,o=L(),r=Xi(o,n);return ga(o,n)?function EM(t,i,e,n,o,r){const s=i+e;return ze(t,s,o)?Vn(t,s+1,r?n.call(r,o):n(o)):pa(t,s+1)}(o,Tt(),i,r.transform,e,r):r.transform(e)}function _o(t,i,e,n){const o=t+$,r=L(),s=Xi(r,o);return ga(r,o)?AM(r,Tt(),i,s.transform,e,n,s):s.transform(e,n)}function ga(t,i){return t[H].data[i].pure}function qn(t,i){return pl(t,i)}let JM=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"platform"})}}return t})();const iI=new j("");function va(t){return!!t&&"function"==typeof t.then}function oI(t){return!!t&&"function"==typeof t.subscribe}const Fg=new j("");let rI=(()=>{class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,n)=>{this.resolve=e,this.reject=n}),this.appInits=F(Fg,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const e=[];for(const o of this.appInits){const r=o();if(va(r))e.push(r);else if(oI(r)){const s=new Promise((a,d)=>{r.subscribe({complete:a,error:d})});e.push(s)}}const n=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{n()}).catch(o=>{this.reject(o)}),0===e.length&&n(),this.initialized=!0}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const ba=new j("");let Wn=(()=>{class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=F(_2),this.afterRenderManager=F(AC),this.zonelessEnabled=F(Qs),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new zt,this.afterTick=new zt,this.componentTypes=[],this.components=[],this.isStable=F(Si).hasPendingTasks.pipe(le(e=>!e)),this._injector=F(Pt)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let e;return new Promise(n=>{e=this.isStable.subscribe({next:o=>{o&&n()}})}).finally(()=>{e.unsubscribe()})}get injector(){return this._injector}bootstrap(e,n){const o=e instanceof Vy;if(!this._injector.get(rI).done)throw!o&&function Ii(t){const i=ae(t)||it(t)||ft(t);return null!==i&&i.standalone}(e),new B(405,!1);let s;s=o?e:this._injector.get(bl).resolveComponentFactory(e),this.componentTypes.push(s.componentType);const a=function k3(t){return t.isBoundToModule}(s)?void 0:this._injector.get(ho),p=s.create(ht.NULL,[],n||s.selector,a),g=p.location.nativeElement,m=p.injector.get(iI,null);return m?.registerApplication(g),p.onDestroy(()=>{this.detachView(p.hostView),ql(this.components,p),m?.unregisterApplication(g)}),this._loadComponent(p),p}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new B(101,!1);const e=re(null);try{this._runningTick=!0,this.synchronize()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1,re(e),this.afterTick.next()}}synchronize(){let e=null;this._injector.destroyed||(e=this._injector.get(Bp,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let n=0;for(;0!==this.dirtyFlags&&n++<10;)this.synchronizeOnce(e)}synchronizeOnce(e){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,7&this.dirtyFlags){const n=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(n);for(let{_lView:o,notifyErrorHandler:r}of this._views)O3(o,r,n,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),7&this.dirtyFlags)return}else e?.begin?.(),e?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:e})=>kc(e))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(e){const n=e;this._views.push(n),n.attachToAppRef(this)}detachView(e){const n=e;ql(this._views,n),n.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const n=this._injector.get(ba,[]);[...this._bootstrapListeners,...n].forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ql(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new B(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function ql(t,i){const e=t.indexOf(i);e>-1&&t.splice(e,1)}function O3(t,i,e,n){(e||kc(t))&&hl(t,i,e&&!n?0:1)}class L3{constructor(i,e){this.ngModuleFactory=i,this.componentFactories=e}}let lI=(()=>{class t{compileModuleSync(e){return new Xp(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const n=this.compileModuleSync(e),r=Yt(bt(e).declarations).reduce((s,a)=>{const d=ae(a);return d&&s.push(new Ks(d)),s},[]);return new L3(n,r)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),B3=(()=>{class t{constructor(){this.zone=F(fe),this.changeDetectionScheduler=F(ur),this.applicationRef=F(Wn)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Bg({ngZoneFactory:t,ignoreChangesOutsideZone:i,scheduleInRootZone:e}){return t??=()=>new fe({...Vg(),scheduleInRootZone:e}),[{provide:fe,useFactory:t},{provide:Tn,multi:!0,useFactory:()=>{const n=F(B3,{optional:!0});return()=>n.initialize()}},{provide:Tn,multi:!0,useFactory:()=>{const n=F(H3);return()=>{n.initialize()}}},!0===i?{provide:By,useValue:!0}:[],{provide:Fp,useValue:e??wv}]}function Vg(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}let H3=(()=>{class t{constructor(){this.subscription=new xt,this.initialized=!1,this.zone=F(fe),this.pendingTasks=F(Si)}initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{fe.assertNotInAngularZone(),queueMicrotask(()=>{null!==e&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{fe.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),ya=(()=>{class t{constructor(){this.appRef=F(Wn),this.taskService=F(Si),this.ngZone=F(fe),this.zonelessEnabled=F(Qs),this.disableScheduling=F(By,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new xt,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get($c):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(F(Fp,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof kh||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&5===e)return;switch(e){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 7:this.appRef.deferredDirtyFlags|=8;break;default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;const n=this.useMicrotaskScheduler?xv:Sv;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>n(()=>this.tick())):this.ngZone.runOutsideAngular(()=>n(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get($c+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(n){throw this.taskService.remove(e),n}finally{this.cleanup()}this.useMicrotaskScheduler=!0,xv(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const Ai=new j("",{providedIn:"root",factory:()=>F(Ai,ce.Optional|ce.SkipSelf)||function j3(){return typeof $localize<"u"&&$localize.locale||Rl}()}),Ql=new j("");function Zl(t){return!t.moduleRef}let Oi=null;let Ca=(()=>{class t{static{this.__NG_ELEMENT_ID__=K3}}return t})();function K3(t){return function J3(t,i,e){if(Ji(t)&&!e){const n=Qt(t.index,i);return new Hs(n,n)}return 175&t.type?new Hs(i[Le],i):null}(be(),L(),!(16&~t))}class II{constructor(){}supports(i){return Sl(i)}create(i){return new iR(i)}}const nR=(t,i)=>i;class iR{constructor(i){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=i||nR}forEachItem(i){let e;for(e=this._itHead;null!==e;e=e._next)i(e)}forEachOperation(i){let e=this._itHead,n=this._removalsHead,o=0,r=null;for(;e||n;){const s=!n||e&&e.currentIndex<SI(n,o,r)?e:n,a=SI(s,o,r),d=s.currentIndex;if(s===n)o--,n=n._nextRemoved;else if(e=e._next,null==s.previousIndex)o++;else{r||(r=[]);const p=a-o,g=d-o;if(p!=g){for(let b=0;b<p;b++){const y=b<r.length?r[b]:r[b]=0,I=y+b;g<=I&&I<p&&(r[b]=y+1)}r[s.previousIndex]=g-p}}a!==d&&i(s,a,d)}}forEachPreviousItem(i){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)i(e)}forEachAddedItem(i){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)i(e)}forEachMovedItem(i){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)i(e)}forEachRemovedItem(i){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)i(e)}forEachIdentityChange(i){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)i(e)}diff(i){if(null==i&&(i=[]),!Sl(i))throw new B(900,!1);return this.check(i)?this:null}onDestroy(){}check(i){this._reset();let o,r,s,e=this._itHead,n=!1;if(Array.isArray(i)){this.length=i.length;for(let a=0;a<this.length;a++)r=i[a],s=this._trackByFn(a,r),null!==e&&Object.is(e.trackById,s)?(n&&(e=this._verifyReinsertion(e,r,s,a)),Object.is(e.item,r)||this._addIdentityChange(e,r)):(e=this._mismatch(e,r,s,a),n=!0),e=e._next}else o=0,function wE(t,i){if(Array.isArray(t))for(let e=0;e<t.length;e++)i(t[e]);else{const e=t[Symbol.iterator]();let n;for(;!(n=e.next()).done;)i(n.value)}}(i,a=>{s=this._trackByFn(o,a),null!==e&&Object.is(e.trackById,s)?(n&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)):(e=this._mismatch(e,a,s,o),n=!0),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=i,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let i;for(i=this._previousItHead=this._itHead;null!==i;i=i._next)i._nextPrevious=i._next;for(i=this._additionsHead;null!==i;i=i._nextAdded)i.previousIndex=i.currentIndex;for(this._additionsHead=this._additionsTail=null,i=this._movesHead;null!==i;i=i._nextMoved)i.previousIndex=i.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(i,e,n,o){let r;return null===i?r=this._itTail:(r=i._prev,this._remove(i)),null!==(i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(i.item,e)||this._addIdentityChange(i,e),this._reinsertAfter(i,r,o)):null!==(i=null===this._linkedRecords?null:this._linkedRecords.get(n,o))?(Object.is(i.item,e)||this._addIdentityChange(i,e),this._moveAfter(i,r,o)):i=this._addAfter(new oR(e,n),r,o),i}_verifyReinsertion(i,e,n,o){let r=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==r?i=this._reinsertAfter(r,i._prev,o):i.currentIndex!=o&&(i.currentIndex=o,this._addToMoves(i,o)),i}_truncate(i){for(;null!==i;){const e=i._next;this._addToRemovals(this._unlink(i)),i=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(i,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(i);const o=i._prevRemoved,r=i._nextRemoved;return null===o?this._removalsHead=r:o._nextRemoved=r,null===r?this._removalsTail=o:r._prevRemoved=o,this._insertAfter(i,e,n),this._addToMoves(i,n),i}_moveAfter(i,e,n){return this._unlink(i),this._insertAfter(i,e,n),this._addToMoves(i,n),i}_addAfter(i,e,n){return this._insertAfter(i,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=i:this._additionsTail._nextAdded=i,i}_insertAfter(i,e,n){const o=null===e?this._itHead:e._next;return i._next=o,i._prev=e,null===o?this._itTail=i:o._prev=i,null===e?this._itHead=i:e._next=i,null===this._linkedRecords&&(this._linkedRecords=new wI),this._linkedRecords.put(i),i.currentIndex=n,i}_remove(i){return this._addToRemovals(this._unlink(i))}_unlink(i){null!==this._linkedRecords&&this._linkedRecords.remove(i);const e=i._prev,n=i._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,i}_addToMoves(i,e){return i.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=i:this._movesTail._nextMoved=i),i}_addToRemovals(i){return null===this._unlinkedRecords&&(this._unlinkedRecords=new wI),this._unlinkedRecords.put(i),i.currentIndex=null,i._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=i,i._prevRemoved=null):(i._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=i),i}_addIdentityChange(i,e){return i.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=i:this._identityChangesTail._nextIdentityChange=i,i}}class oR{constructor(i,e){this.item=i,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class rR{constructor(){this._head=null,this._tail=null}add(i){null===this._head?(this._head=this._tail=i,i._nextDup=null,i._prevDup=null):(this._tail._nextDup=i,i._prevDup=this._tail,i._nextDup=null,this._tail=i)}get(i,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Object.is(n.trackById,i))return n;return null}remove(i){const e=i._prevDup,n=i._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class wI{constructor(){this.map=new Map}put(i){const e=i.trackById;let n=this.map.get(e);n||(n=new rR,this.map.set(e,n)),n.add(i)}get(i,e){const o=this.map.get(i);return o?o.get(i,e):null}remove(i){const e=i.trackById;return this.map.get(e).remove(i)&&this.map.delete(e),i}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function SI(t,i,e){const n=t.previousIndex;if(null===n)return n;let o=0;return e&&n<e.length&&(o=e[n]),n+i+o}function PI(){return new qg([new II])}let qg=(()=>{class t{static{this.\u0275prov=z({token:t,providedIn:"root",factory:PI})}constructor(e){this.factories=e}static create(e,n){if(null!=n){const o=n.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>t.create(e,n||PI()),deps:[[t,new _c,new mc]]}}find(e){const n=this.factories.find(o=>o.supports(e));if(null!=n)return n;throw new B(901,!1)}}return t})();function CR(t){try{const{rootComponent:i,appProviders:e,platformProviders:n}=t,o=function Y3(t=[]){if(Oi)return Oi;const i=function _I(t=[],i){return ht.create({name:i,providers:[{provide:Zu,useValue:"platform"},{provide:Ql,useValue:new Set([()=>Oi=null])},...t]})}(t);return Oi=i,function sI(){!function Ux(t){Fm=t}(()=>{throw new B(600,!1)})}(),function vI(t){t.get(Kv,null)?.forEach(e=>e())}(i),i}(n),r=[Bg({}),{provide:ur,useExisting:ya},...e||[]];return function gI(t){const i=Zl(t)?t.r3Injector:t.moduleRef.injector,e=i.get(fe);return e.run(()=>{Zl(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();const n=i.get(Fn,null);let o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:r=>{n.handleError(r)}})}),Zl(t)){const r=()=>i.destroy(),s=t.platformInjector.get(Ql);s.add(r),i.onDestroy(()=>{o.unsubscribe(),s.delete(r)})}else{const r=()=>t.moduleRef.destroy(),s=t.platformInjector.get(Ql);s.add(r),t.moduleRef.onDestroy(()=>{ql(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(r)})}return function A3(t,i,e){try{const n=e();return va(n)?n.catch(o=>{throw i.runOutsideAngular(()=>t.handleError(o)),o}):n}catch(n){throw i.runOutsideAngular(()=>t.handleError(n)),n}}(n,e,()=>{const r=i.get(rI);return r.runInitializers(),r.donePromise.then(()=>{if(function uO(t){"string"==typeof t&&(k1=t.toLowerCase().replace(/_/g,"-"))}(i.get(Ai,Rl)||Rl),Zl(t)){const a=i.get(Wn);return void 0!==t.rootComponent&&a.bootstrap(t.rootComponent),a}return function W3(t,i){const e=t.injector.get(Wn);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(n=>e.bootstrap(n));else{if(!t.instance.ngDoBootstrap)throw new B(-403,!1);t.instance.ngDoBootstrap(e)}i.push(t)}(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}({r3Injector:new SC({providers:r,parent:o,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:o,rootComponent:i})}catch(i){return Promise.reject(i)}}function Lr(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}function Sa(t,i){kt("NgSignals");const e=function Vx(t){const i=Object.create(Hx);i.computation=t;const e=()=>{if(Tm(i),uu(i),i.value===oc)throw i.error;return i.value};return e[hn]=i,e}(t);return i?.equal&&(e[hn].equal=i.equal),e}function Qn(t){const i=re(null);try{return t()}finally{re(i)}}let KI=null;function Li(){return KI}class ZR{}const Xt=new j("");let Zg=(()=>{class t{historyGo(e){throw new Error("")}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(KR),providedIn:"platform"})}}return t})();const YR=new j("");let KR=(()=>{class t extends Zg{constructor(){super(),this._doc=F(Xt),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Li().getBaseHref(this._doc)}onPopState(e){const n=Li().getGlobalEventTarget(this._doc,"window");return n.addEventListener("popstate",e,!1),()=>n.removeEventListener("popstate",e)}onHashChange(e){const n=Li().getGlobalEventTarget(this._doc,"window");return n.addEventListener("hashchange",e,!1),()=>n.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,n,o){this._history.pushState(e,n,o)}replaceState(e,n,o){this._history.replaceState(e,n,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>new t,providedIn:"platform"})}}return t})();function Yg(t,i){if(0==t.length)return i;if(0==i.length)return t;let e=0;return t.endsWith("/")&&e++,i.startsWith("/")&&e++,2==e?t+i.substring(1):1==e?t+i:t+"/"+i}function JI(t){const i=t.match(/#|\?|$/),e=i&&i.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function pi(t){return t&&"?"!==t[0]?"?"+t:t}let bo=(()=>{class t{historyGo(e){throw new Error("")}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(e0),providedIn:"root"})}}return t})();const XI=new j("");let e0=(()=>{class t extends bo{constructor(e,n){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=n??this._platformLocation.getBaseHrefFromDOM()??F(Xt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Yg(this._baseHref,e)}path(e=!1){const n=this._platformLocation.pathname+pi(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${n}${o}`:n}pushState(e,n,o,r){const s=this.prepareExternalUrl(o+pi(r));this._platformLocation.pushState(e,n,s)}replaceState(e,n,o,r){const s=this.prepareExternalUrl(o+pi(r));this._platformLocation.replaceState(e,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(n){return new(n||t)(q(Zg),q(XI,8))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),JR=(()=>{class t extends bo{constructor(e,n){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=n&&(this._baseHref=n)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){const n=this._platformLocation.hash??"#";return n.length>0?n.substring(1):n}prepareExternalUrl(e){const n=Yg(this._baseHref,e);return n.length>0?"#"+n:n}pushState(e,n,o,r){let s=this.prepareExternalUrl(o+pi(r));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(e,n,s)}replaceState(e,n,o,r){let s=this.prepareExternalUrl(o+pi(r));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(e,n,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static{this.\u0275fac=function(n){return new(n||t)(q(Zg),q(XI,8))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})(),xa=(()=>{class t{constructor(e){this._subject=new Fe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const n=this._locationStrategy.getBaseHref();this._basePath=function tF(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(JI(t0(n))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,n=""){return this.path()==this.normalize(e+pi(n))}normalize(e){return t.stripTrailingSlash(function eF(t,i){if(!t||!i.startsWith(t))return i;const e=i.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:i}(this._basePath,t0(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,n="",o=null){this._locationStrategy.pushState(o,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+pi(n)),o)}replaceState(e,n="",o=null){this._locationStrategy.replaceState(o,"",e,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+pi(n)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(n=>{this._notifyUrlChangeListeners(n.url,n.state)}),()=>{const n=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(n,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",n){this._urlChangeListeners.forEach(o=>o(e,n))}subscribe(e,n,o){return this._subject.subscribe({next:e,error:n,complete:o})}static{this.normalizeQueryParams=pi}static{this.joinWithSlash=Yg}static{this.stripTrailingSlash=JI}static{this.\u0275fac=function(n){return new(n||t)(q(bo))}}static{this.\u0275prov=z({token:t,factory:()=>function XR(){return new xa(q(bo))}(),providedIn:"root"})}}return t})();function t0(t){return t.replace(/\/index.html$/,"")}var Ot=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Ot||{}),Ie=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Ie||{}),en=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(en||{});const Ke={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function sd(t,i){return dn(Et(t)[De.DateFormat],i)}function ad(t,i){return dn(Et(t)[De.TimeFormat],i)}function cd(t,i){return dn(Et(t)[De.DateTimeFormat],i)}function ln(t,i){const e=Et(t),n=e[De.NumberSymbols][i];if(typeof n>"u"){if(i===Ke.CurrencyDecimal)return e[De.NumberSymbols][Ke.Decimal];if(i===Ke.CurrencyGroup)return e[De.NumberSymbols][Ke.Group]}return n}function o0(t){if(!t[De.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[De.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function dn(t,i){for(let e=i;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function Jg(t){const[i,e]=t.split(":");return{hours:+i,minutes:+e}}const fF=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ld={},mF=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var gi=function(t){return t[t.Short=0]="Short",t[t.ShortGMT=1]="ShortGMT",t[t.Long=2]="Long",t[t.Extended=3]="Extended",t}(gi||{}),me=function(t){return t[t.FullYear=0]="FullYear",t[t.Month=1]="Month",t[t.Date=2]="Date",t[t.Hours=3]="Hours",t[t.Minutes=4]="Minutes",t[t.Seconds=5]="Seconds",t[t.FractionalSeconds=6]="FractionalSeconds",t[t.Day=7]="Day",t}(me||{}),_e=function(t){return t[t.DayPeriods=0]="DayPeriods",t[t.Days=1]="Days",t[t.Months=2]="Months",t[t.Eras=3]="Eras",t}(_e||{});function _F(t,i,e,n){let o=function xF(t){if(a0(t))return t;if("number"==typeof t&&!isNaN(t))return new Date(t);if("string"==typeof t){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){const[o,r=1,s=1]=t.split("-").map(a=>+a);return dd(o,r-1,s)}const e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let n;if(n=t.match(fF))return function PF(t){const i=new Date(0);let e=0,n=0;const o=t[8]?i.setUTCFullYear:i.setFullYear,r=t[8]?i.setUTCHours:i.setHours;t[9]&&(e=Number(t[9]+t[10]),n=Number(t[9]+t[11])),o.call(i,Number(t[1]),Number(t[2])-1,Number(t[3]));const s=Number(t[4]||0)-e,a=Number(t[5]||0)-n,d=Number(t[6]||0),p=Math.floor(1e3*parseFloat("0."+(t[7]||0)));return r.call(i,s,a,d,p),i}(n)}const i=new Date(t);if(!a0(i))throw new Error(`Unable to convert "${t}" into a date`);return i}(t);i=fi(e,i)||i;let a,s=[];for(;i;){if(a=mF.exec(i),!a){s.push(i);break}{s=s.concat(a.slice(1));const g=s.pop();if(!g)break;i=g}}let d=o.getTimezoneOffset();n&&(d=s0(n,d),o=function SF(t,i,e){const n=e?-1:1,o=t.getTimezoneOffset();return function wF(t,i){return(t=new Date(t.getTime())).setMinutes(t.getMinutes()+i),t}(t,n*(s0(i,o)-o))}(o,n,!0));let p="";return s.forEach(g=>{const m=function IF(t){if(ef[t])return ef[t];let i;switch(t){case"G":case"GG":case"GGG":i=Ne(_e.Eras,Ie.Abbreviated);break;case"GGGG":i=Ne(_e.Eras,Ie.Wide);break;case"GGGGG":i=Ne(_e.Eras,Ie.Narrow);break;case"y":i=Je(me.FullYear,1,0,!1,!0);break;case"yy":i=Je(me.FullYear,2,0,!0,!0);break;case"yyy":i=Je(me.FullYear,3,0,!1,!0);break;case"yyyy":i=Je(me.FullYear,4,0,!1,!0);break;case"Y":i=gd(1);break;case"YY":i=gd(2,!0);break;case"YYY":i=gd(3);break;case"YYYY":i=gd(4);break;case"M":case"L":i=Je(me.Month,1,1);break;case"MM":case"LL":i=Je(me.Month,2,1);break;case"MMM":i=Ne(_e.Months,Ie.Abbreviated);break;case"MMMM":i=Ne(_e.Months,Ie.Wide);break;case"MMMMM":i=Ne(_e.Months,Ie.Narrow);break;case"LLL":i=Ne(_e.Months,Ie.Abbreviated,Ot.Standalone);break;case"LLLL":i=Ne(_e.Months,Ie.Wide,Ot.Standalone);break;case"LLLLL":i=Ne(_e.Months,Ie.Narrow,Ot.Standalone);break;case"w":i=Xg(1);break;case"ww":i=Xg(2);break;case"W":i=Xg(1,!0);break;case"d":i=Je(me.Date,1);break;case"dd":i=Je(me.Date,2);break;case"c":case"cc":i=Je(me.Day,1);break;case"ccc":i=Ne(_e.Days,Ie.Abbreviated,Ot.Standalone);break;case"cccc":i=Ne(_e.Days,Ie.Wide,Ot.Standalone);break;case"ccccc":i=Ne(_e.Days,Ie.Narrow,Ot.Standalone);break;case"cccccc":i=Ne(_e.Days,Ie.Short,Ot.Standalone);break;case"E":case"EE":case"EEE":i=Ne(_e.Days,Ie.Abbreviated);break;case"EEEE":i=Ne(_e.Days,Ie.Wide);break;case"EEEEE":i=Ne(_e.Days,Ie.Narrow);break;case"EEEEEE":i=Ne(_e.Days,Ie.Short);break;case"a":case"aa":case"aaa":i=Ne(_e.DayPeriods,Ie.Abbreviated);break;case"aaaa":i=Ne(_e.DayPeriods,Ie.Wide);break;case"aaaaa":i=Ne(_e.DayPeriods,Ie.Narrow);break;case"b":case"bb":case"bbb":i=Ne(_e.DayPeriods,Ie.Abbreviated,Ot.Standalone,!0);break;case"bbbb":i=Ne(_e.DayPeriods,Ie.Wide,Ot.Standalone,!0);break;case"bbbbb":i=Ne(_e.DayPeriods,Ie.Narrow,Ot.Standalone,!0);break;case"B":case"BB":case"BBB":i=Ne(_e.DayPeriods,Ie.Abbreviated,Ot.Format,!0);break;case"BBBB":i=Ne(_e.DayPeriods,Ie.Wide,Ot.Format,!0);break;case"BBBBB":i=Ne(_e.DayPeriods,Ie.Narrow,Ot.Format,!0);break;case"h":i=Je(me.Hours,1,-12);break;case"hh":i=Je(me.Hours,2,-12);break;case"H":i=Je(me.Hours,1);break;case"HH":i=Je(me.Hours,2);break;case"m":i=Je(me.Minutes,1);break;case"mm":i=Je(me.Minutes,2);break;case"s":i=Je(me.Seconds,1);break;case"ss":i=Je(me.Seconds,2);break;case"S":i=Je(me.FractionalSeconds,1);break;case"SS":i=Je(me.FractionalSeconds,2);break;case"SSS":i=Je(me.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":i=hd(gi.Short);break;case"ZZZZZ":i=hd(gi.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":i=hd(gi.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":i=hd(gi.Long);break;default:return null}return ef[t]=i,i}(g);p+=m?m(o,e,d):"''"===g?"'":g.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),p}function dd(t,i,e){const n=new Date(0);return n.setFullYear(t,i,e),n.setHours(0,0,0),n}function fi(t,i){const e=function iF(t){return Et(t)[De.LocaleId]}(t);if(ld[e]??={},ld[e][i])return ld[e][i];let n="";switch(i){case"shortDate":n=sd(t,en.Short);break;case"mediumDate":n=sd(t,en.Medium);break;case"longDate":n=sd(t,en.Long);break;case"fullDate":n=sd(t,en.Full);break;case"shortTime":n=ad(t,en.Short);break;case"mediumTime":n=ad(t,en.Medium);break;case"longTime":n=ad(t,en.Long);break;case"fullTime":n=ad(t,en.Full);break;case"short":const o=fi(t,"shortTime"),r=fi(t,"shortDate");n=ud(cd(t,en.Short),[o,r]);break;case"medium":const s=fi(t,"mediumTime"),a=fi(t,"mediumDate");n=ud(cd(t,en.Medium),[s,a]);break;case"long":const d=fi(t,"longTime"),p=fi(t,"longDate");n=ud(cd(t,en.Long),[d,p]);break;case"full":const g=fi(t,"fullTime"),m=fi(t,"fullDate");n=ud(cd(t,en.Full),[g,m])}return n&&(ld[e][i]=n),n}function ud(t,i){return i&&(t=t.replace(/\{([^}]+)}/g,function(e,n){return null!=i&&n in i?i[n]:e})),t}function Mn(t,i,e="-",n,o){let r="";(t<0||o&&t<=0)&&(o?t=1-t:(t=-t,r=e));let s=String(t);for(;s.length<i;)s="0"+s;return n&&(s=s.slice(s.length-i)),r+s}function Je(t,i,e=0,n=!1,o=!1){return function(r,s){let a=function bF(t,i){switch(t){case me.FullYear:return i.getFullYear();case me.Month:return i.getMonth();case me.Date:return i.getDate();case me.Hours:return i.getHours();case me.Minutes:return i.getMinutes();case me.Seconds:return i.getSeconds();case me.FractionalSeconds:return i.getMilliseconds();case me.Day:return i.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}(t,r);if((e>0||a>-e)&&(a+=e),t===me.Hours)0===a&&-12===e&&(a=12);else if(t===me.FractionalSeconds)return function vF(t,i){return Mn(t,3).substring(0,i)}(a,i);const d=ln(s,Ke.MinusSign);return Mn(a,i,d,n,o)}}function Ne(t,i,e=Ot.Format,n=!1){return function(o,r){return function yF(t,i,e,n,o,r){switch(e){case _e.Months:return function sF(t,i,e){const n=Et(t),r=dn([n[De.MonthsFormat],n[De.MonthsStandalone]],i);return dn(r,e)}(i,o,n)[t.getMonth()];case _e.Days:return function rF(t,i,e){const n=Et(t),r=dn([n[De.DaysFormat],n[De.DaysStandalone]],i);return dn(r,e)}(i,o,n)[t.getDay()];case _e.DayPeriods:const s=t.getHours(),a=t.getMinutes();if(r){const p=function dF(t){const i=Et(t);return o0(i),(i[De.ExtraData][2]||[]).map(n=>"string"==typeof n?Jg(n):[Jg(n[0]),Jg(n[1])])}(i),g=function uF(t,i,e){const n=Et(t);o0(n);const r=dn([n[De.ExtraData][0],n[De.ExtraData][1]],i)||[];return dn(r,e)||[]}(i,o,n),m=p.findIndex(b=>{if(Array.isArray(b)){const[y,I]=b,P=s>=y.hours&&a>=y.minutes,T=s<I.hours||s===I.hours&&a<I.minutes;if(y.hours<I.hours){if(P&&T)return!0}else if(P||T)return!0}else if(b.hours===s&&b.minutes===a)return!0;return!1});if(-1!==m)return g[m]}return function oF(t,i,e){const n=Et(t),r=dn([n[De.DayPeriodsFormat],n[De.DayPeriodsStandalone]],i);return dn(r,e)}(i,o,n)[s<12?0:1];case _e.Eras:return function aF(t,i){return dn(Et(t)[De.Eras],i)}(i,n)[t.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${e}`)}}(o,r,t,i,e,n)}}function hd(t){return function(i,e,n){const o=-1*n,r=ln(e,Ke.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case gi.Short:return(o>=0?"+":"")+Mn(s,2,r)+Mn(Math.abs(o%60),2,r);case gi.ShortGMT:return"GMT"+(o>=0?"+":"")+Mn(s,1,r);case gi.Long:return"GMT"+(o>=0?"+":"")+Mn(s,2,r)+":"+Mn(Math.abs(o%60),2,r);case gi.Extended:return 0===n?"Z":(o>=0?"+":"")+Mn(s,2,r)+":"+Mn(Math.abs(o%60),2,r);default:throw new Error(`Unknown zone width "${t}"`)}}}const CF=0,pd=4;function r0(t){const i=t.getDay(),e=0===i?-3:pd-i;return dd(t.getFullYear(),t.getMonth(),t.getDate()+e)}function Xg(t,i=!1){return function(e,n){let o;if(i){const r=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+r)/7)}else{const r=r0(e),s=function MF(t){const i=dd(t,CF,1).getDay();return dd(t,0,1+(i<=pd?pd:pd+7)-i)}(r.getFullYear()),a=r.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Mn(o,t,ln(n,Ke.MinusSign))}}function gd(t,i=!1){return function(e,n){return Mn(r0(e).getFullYear(),t,ln(n,Ke.MinusSign),i)}}const ef={};function s0(t,i){t=t.replace(/:/g,"");const e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?i:e}function a0(t){return t instanceof Date&&!isNaN(t.valueOf())}function u0(t,i){i=encodeURIComponent(i);for(const e of t.split(";")){const n=e.indexOf("="),[o,r]=-1==n?[e,""]:[e.slice(0,n),e.slice(n+1)];if(o.trim()===i)return decodeURIComponent(r)}return null}const cf=/\s+/,h0=[];let lf=(()=>{class t{constructor(e,n){this._ngEl=e,this._renderer=n,this.initialClasses=h0,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(cf):h0}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(cf):e}ngDoCheck(){for(const n of this.initialClasses)this._updateState(n,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const n of e)this._updateState(n,!0);else if(null!=e)for(const n of Object.keys(e))this._updateState(n,!!e[n]);this._applyStateDiff()}_updateState(e,n){const o=this.stateMap.get(e);void 0!==o?(o.enabled!==n&&(o.changed=!0,o.enabled=n),o.touched=!0):this.stateMap.set(e,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const n=e[0],o=e[1];o.changed?(this._toggleClass(n,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),o.touched=!1}}_toggleClass(e,n){(e=e.trim()).length>0&&e.split(cf).forEach(o=>{n?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static{this.\u0275fac=function(n){return new(n||t)(R(Zt),R(ui))}}static{this.\u0275dir=ee({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0})}}return t})();class HF{constructor(i,e,n,o){this.$implicit=i,this.ngForOf=e,this.index=n,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let lt=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,n,o){this._viewContainer=e,this._template=n,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const n=this._viewContainer;e.forEachOperation((o,r,s)=>{if(null==o.previousIndex)n.createEmbeddedView(this._template,new HF(o.item,this._ngForOf,-1,-1),null===s?void 0:s);else if(null==s)n.remove(null===r?void 0:r);else if(null!==r){const a=n.get(r);n.move(a,s),g0(a,o)}});for(let o=0,r=n.length;o<r;o++){const a=n.get(o).context;a.index=o,a.count=r,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{g0(n.get(o.currentIndex),o)})}static ngTemplateContextGuard(e,n){return!0}static{this.\u0275fac=function(n){return new(n||t)(R(bn),R(di),R(qg))}}static{this.\u0275dir=ee({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return t})();function g0(t,i){t.context.$implicit=i.item}let Xe=(()=>{class t{constructor(e,n){this._viewContainer=e,this._context=new jF,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){f0("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){f0("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,n){return!0}static{this.\u0275fac=function(n){return new(n||t)(R(bn),R(di))}}static{this.\u0275dir=ee({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return t})();class jF{constructor(){this.$implicit=null,this.ngIf=null}}function f0(t,i){if(i&&!i.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${nt(i)}'.`)}const e4=new j(""),t4=new j("");let Fr=(()=>{class t{constructor(e,n,o){this.locale=e,this.defaultTimezone=n,this.defaultOptions=o}transform(e,n,o,r){if(null==e||""===e||e!=e)return null;try{return _F(e,n??this.defaultOptions?.dateFormat??"mediumDate",r||this.locale,o??this.defaultOptions?.timezone??this.defaultTimezone??void 0)}catch(s){throw function In(t,i){return new B(2100,!1)}()}}static{this.\u0275fac=function(n){return new(n||t)(R(Ai,16),R(e4,24),R(t4,24))}}static{this.\u0275pipe=Vt({name:"date",type:t,pure:!0,standalone:!0})}}return t})(),_0=(()=>{class t{transform(e){return JSON.stringify(e,null,2)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275pipe=Vt({name:"json",type:t,pure:!1,standalone:!0})}}return t})(),pt=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=jo({type:t})}static{this.\u0275inj=Qi({})}}return t})();const b0="browser";function y0(t){return"server"===t}let h4=(()=>{class t{static{this.\u0275prov=z({token:t,providedIn:"root",factory:()=>function u4(t){return t===b0}(F(ai))?new p4(F(Xt),window):new f4})}}return t})();class p4{constructor(i,e){this.document=i,this.window=e,this.offset=()=>[0,0]}setOffset(i){this.offset=Array.isArray(i)?()=>i:i}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(i){this.window.scrollTo(i[0],i[1])}scrollToAnchor(i){const e=function g4(t,i){const e=t.getElementById(i)||t.getElementsByName(i)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&"function"==typeof t.body.attachShadow){const n=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let o=n.currentNode;for(;o;){const r=o.shadowRoot;if(r){const s=r.getElementById(i)||r.querySelector(`[name="${i}"]`);if(s)return s}o=n.nextNode()}}return null}(this.document,i);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(i){this.window.history.scrollRestoration=i}scrollToElement(i){const e=i.getBoundingClientRect(),n=e.left+this.window.pageXOffset,o=e.top+this.window.pageYOffset,r=this.offset();this.window.scrollTo(n-r[0],o-r[1])}}class f4{setOffset(i){}getScrollPosition(){return[0,0]}scrollToPosition(i){}scrollToAnchor(i){}setHistoryScrollRestoration(i){}}class C0{}class z4 extends ZR{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class _f extends z4{static makeCurrent(){!function QR(t){KI??=t}(new _f)}onAndCancel(i,e,n){return i.addEventListener(e,n),()=>{i.removeEventListener(e,n)}}dispatchEvent(i,e){i.dispatchEvent(e)}remove(i){i.remove()}createElement(i,e){return(e=e||this.getDefaultDocument()).createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,e){return"window"===e?window:"document"===e?i:"body"===e?i.body:null}getBaseHref(i){const e=function G4(){return Ta=Ta||document.querySelector("base"),Ta?Ta.getAttribute("href"):null}();return null==e?null:function $4(t){return new URL(t,document.baseURI).pathname}(e)}resetBaseElement(){Ta=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return u0(document.cookie,i)}}let Ta=null,W4=(()=>{class t{build(){return new XMLHttpRequest}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();const vf=new j("");let E0=(()=>{class t{constructor(e,n){this._zone=n,this._eventNameToPlugin=new Map,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,n,o){return this._findPluginFor(n).addEventListener(e,n,o)}getZone(){return this._zone}_findPluginFor(e){let n=this._eventNameToPlugin.get(e);if(n)return n;if(n=this._plugins.find(r=>r.supports(e)),!n)throw new B(5101,!1);return this._eventNameToPlugin.set(e,n),n}static{this.\u0275fac=function(n){return new(n||t)(q(vf),q(fe))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();class A0{constructor(i){this._doc=i}}const bf="ng-app-id";let O0=(()=>{class t{constructor(e,n,o,r={}){this.doc=e,this.appId=n,this.nonce=o,this.platformId=r,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=y0(r),this.resetHostNodes()}addStyles(e){for(const n of e)1===this.changeUsageCount(n,1)&&this.onStyleAdded(n)}removeStyles(e){for(const n of e)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){const e=this.styleNodesInDOM;e&&(e.forEach(n=>n.remove()),e.clear());for(const n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const n of this.getAllStyles())this.addStyleToHost(e,n)}removeHost(e){this.hostNodes.delete(e)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(e){for(const n of this.hostNodes)this.addStyleToHost(n,e)}onStyleRemoved(e){const n=this.styleRef;n.get(e)?.elements?.forEach(o=>o.remove()),n.delete(e)}collectServerRenderedStyles(){const e=this.doc.head?.querySelectorAll(`style[${bf}="${this.appId}"]`);if(e?.length){const n=new Map;return e.forEach(o=>{null!=o.textContent&&n.set(o.textContent,o)}),n}return null}changeUsageCount(e,n){const o=this.styleRef;if(o.has(e)){const r=o.get(e);return r.usage+=n,r.usage}return o.set(e,{usage:n,elements:[]}),n}getStyleElement(e,n){const o=this.styleNodesInDOM,r=o?.get(n);if(r?.parentNode===e)return o.delete(n),r.removeAttribute(bf),r;{const s=this.doc.createElement("style");return this.nonce&&s.setAttribute("nonce",this.nonce),s.textContent=n,this.platformIsServer&&s.setAttribute(bf,this.appId),e.appendChild(s),s}}addStyleToHost(e,n){const o=this.getStyleElement(e,n),r=this.styleRef,s=r.get(n)?.elements;s?s.push(o):r.set(n,{elements:[o],usage:1})}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}static{this.\u0275fac=function(n){return new(n||t)(q(Xt),q(Ss),q(Jv,8),q(ai))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();const yf={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Cf=/%COMP%/g,K4=new j("",{providedIn:"root",factory:()=>!0});function R0(t,i){return i.map(e=>e.replace(Cf,t))}let F0=(()=>{class t{constructor(e,n,o,r,s,a,d,p=null){this.eventManager=e,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=r,this.doc=s,this.platformId=a,this.ngZone=d,this.nonce=p,this.rendererByCompId=new Map,this.platformIsServer=y0(a),this.defaultRenderer=new Mf(e,s,d,this.platformIsServer)}createRenderer(e,n){if(!e||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===pn.ShadowDom&&(n={...n,encapsulation:pn.Emulated});const o=this.getOrCreateRenderer(e,n);return o instanceof V0?o.applyToHost(e):o instanceof If&&o.applyStyles(),o}getOrCreateRenderer(e,n){const o=this.rendererByCompId;let r=o.get(n.id);if(!r){const s=this.doc,a=this.ngZone,d=this.eventManager,p=this.sharedStylesHost,g=this.removeStylesOnCompDestroy,m=this.platformIsServer;switch(n.encapsulation){case pn.Emulated:r=new V0(d,p,n,this.appId,g,s,a,m);break;case pn.ShadowDom:return new t5(d,p,e,n,s,a,this.nonce,m);default:r=new If(d,p,n,g,s,a,m)}o.set(n.id,r)}return r}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(n){return new(n||t)(q(E0),q(O0),q(Ss),q(K4),q(Xt),q(ai),q(fe),q(Jv))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();class Mf{constructor(i,e,n,o){this.eventManager=i,this.doc=e,this.ngZone=n,this.platformIsServer=o,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,e){return e?this.doc.createElementNS(yf[e]||e,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,e){(B0(i)?i.content:i).appendChild(e)}insertBefore(i,e,n){i&&(B0(i)?i.content:i).insertBefore(e,n)}removeChild(i,e){e.remove()}selectRootElement(i,e){let n="string"==typeof i?this.doc.querySelector(i):i;if(!n)throw new B(-5104,!1);return e||(n.textContent=""),n}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,e,n,o){if(o){e=o+":"+e;const r=yf[o];r?i.setAttributeNS(r,e,n):i.setAttribute(e,n)}else i.setAttribute(e,n)}removeAttribute(i,e,n){if(n){const o=yf[n];o?i.removeAttributeNS(o,e):i.removeAttribute(`${n}:${e}`)}else i.removeAttribute(e)}addClass(i,e){i.classList.add(e)}removeClass(i,e){i.classList.remove(e)}setStyle(i,e,n,o){o&(Di.DashCase|Di.Important)?i.style.setProperty(e,n,o&Di.Important?"important":""):i.style[e]=n}removeStyle(i,e,n){n&Di.DashCase?i.style.removeProperty(e):i.style[e]=""}setProperty(i,e,n){null!=i&&(i[e]=n)}setValue(i,e){i.nodeValue=e}listen(i,e,n){if("string"==typeof i&&!(i=Li().getGlobalEventTarget(this.doc,i)))throw new Error(`Unsupported event target ${i} for event ${e}`);return this.eventManager.addEventListener(i,e,this.decoratePreventDefault(n))}decoratePreventDefault(i){return e=>{if("__ngUnwrap__"===e)return i;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>i(e)):i(e))&&e.preventDefault()}}}function B0(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class t5 extends Mf{constructor(i,e,n,o,r,s,a,d){super(i,r,s,d),this.sharedStylesHost=e,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const p=R0(o.id,o.styles);for(const g of p){const m=document.createElement("style");a&&m.setAttribute("nonce",a),m.textContent=g,this.shadowRoot.appendChild(m)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,e){return super.appendChild(this.nodeOrShadowRoot(i),e)}insertBefore(i,e,n){return super.insertBefore(this.nodeOrShadowRoot(i),e,n)}removeChild(i,e){return super.removeChild(null,e)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class If extends Mf{constructor(i,e,n,o,r,s,a,d){super(i,r,s,a),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o,this.styles=d?R0(d,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class V0 extends If{constructor(i,e,n,o,r,s,a,d){const p=o+"-"+n.id;super(i,e,n,r,s,a,d,p),this.contentAttr=function J4(t){return"_ngcontent-%COMP%".replace(Cf,t)}(p),this.hostAttr=function X4(t){return"_nghost-%COMP%".replace(Cf,t)}(p)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,e){const n=super.createElement(i,e);return super.setAttribute(n,this.contentAttr,""),n}}const H0=["alt","control","meta","shift"],i5={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},o5={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};function j0(t){return{appProviders:[...h5,...t?.providers??[]],platformProviders:d5}}const d5=[{provide:ai,useValue:b0},{provide:Kv,useValue:function a5(){_f.makeCurrent()},multi:!0},{provide:Xt,useFactory:function l5(){return function V2(t){Fh=t}(document),document},deps:[]}],h5=[{provide:Zu,useValue:"root"},{provide:Fn,useFactory:function c5(){return new Fn},deps:[]},{provide:vf,useClass:(()=>{class t extends A0{constructor(e){super(e)}supports(e){return!0}addEventListener(e,n,o){return e.addEventListener(n,o,!1),()=>this.removeEventListener(e,n,o)}removeEventListener(e,n,o){return e.removeEventListener(n,o)}static{this.\u0275fac=function(n){return new(n||t)(q(Xt))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})(),multi:!0,deps:[Xt,fe,ai]},{provide:vf,useClass:(()=>{class t extends A0{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,n,o){const r=t.parseEventName(n),s=t.eventCallback(r.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Li().onAndCancel(e,r.domEventName,s))}static parseEventName(e){const n=e.toLowerCase().split("."),o=n.shift();if(0===n.length||"keydown"!==o&&"keyup"!==o)return null;const r=t._normalizeKey(n.pop());let s="",a=n.indexOf("code");if(a>-1&&(n.splice(a,1),s="code."),H0.forEach(p=>{const g=n.indexOf(p);g>-1&&(n.splice(g,1),s+=p+".")}),s+=r,0!=n.length||0===r.length)return null;const d={};return d.domEventName=o,d.fullKey=s,d}static matchEventFullKeyCode(e,n){let o=i5[e.key]||e.key,r="";return n.indexOf("code.")>-1&&(o=e.code,r="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),H0.forEach(s=>{s!==o&&(0,o5[s])(e)&&(r+=s+".")}),r+=o,r===n)}static eventCallback(e,n,o){return r=>{t.matchEventFullKeyCode(r,e)&&o.runGuarded(()=>n(r))}}static _normalizeKey(e){return"esc"===e?"escape":e}static{this.\u0275fac=function(n){return new(n||t)(q(Xt))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})(),multi:!0,deps:[Xt]},F0,O0,E0,{provide:Bp,useExisting:F0},{provide:C0,useClass:W4,deps:[]},[]];let p5=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static{this.\u0275fac=function(n){return new(n||t)(q(Xt))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function G0(t,i,e,n,o,r,s){try{var a=t[r](s),d=a.value}catch(p){return void e(p)}a.done?i(d):Promise.resolve(d).then(n,o)}function ka(t){return function(){var i=this,e=arguments;return new Promise(function(n,o){var r=t.apply(i,e);function s(d){G0(r,n,o,s,a,"next",d)}function a(d){G0(r,n,o,s,a,"throw",d)}s(void 0)})}}function wf(t){return t[t.length-1]}function $0(t){return ke(wf(t))?t.pop():void 0}function yd(t){return function _5(t){return t&&ke(t.schedule)}(wf(t))?t.pop():void 0}function Ri(t){return this instanceof Ri?(this.v=t,this):new Ri(t)}function Z0(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=function Df(t){var i="function"==typeof Symbol&&Symbol.iterator,e=i&&t[i],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(s){return new Promise(function(a,d){!function o(r,s,a,d){Promise.resolve(d).then(function(p){r({value:p,done:a})},s)}(a,d,(s=t[r](s)).done,s.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Y0=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function K0(t){return ke(t?.then)}function J0(t){return ke(t[xu])}function X0(t){return Symbol.asyncIterator&&ke(t?.[Symbol.asyncIterator])}function ew(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const tw=function G5(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function nw(t){return ke(t?.[tw])}function iw(t){return function Q0(t,i,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=e.apply(t,i||[]),r=[];return o=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function s(y){return function(I){return Promise.resolve(I).then(y,m)}}),o[Symbol.asyncIterator]=function(){return this},o;function a(y,I){n[y]&&(o[y]=function(P){return new Promise(function(T,A){r.push([y,P,T,A])>1||d(y,P)})},I&&(o[y]=I(o[y])))}function d(y,I){try{!function p(y){y.value instanceof Ri?Promise.resolve(y.value.v).then(g,m):b(r[0][2],y)}(n[y](I))}catch(P){b(r[0][3],P)}}function g(y){d("next",y)}function m(y){d("throw",y)}function b(y,I){y(I),r.shift(),r.length&&d(r[0][0],r[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:n,done:o}=yield Ri(e.read());if(o)return yield Ri(void 0);yield yield Ri(n)}}finally{e.releaseLock()}})}function ow(t){return ke(t?.getReader)}function Zn(t){if(t instanceof Qe)return t;if(null!=t){if(J0(t))return function $5(t){return new Qe(i=>{const e=t[xu]();if(ke(e.subscribe))return e.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(Y0(t))return function q5(t){return new Qe(i=>{for(let e=0;e<t.length&&!i.closed;e++)i.next(t[e]);i.complete()})}(t);if(K0(t))return function W5(t){return new Qe(i=>{t.then(e=>{i.closed||(i.next(e),i.complete())},e=>i.error(e)).then(null,Gm)})}(t);if(X0(t))return rw(t);if(nw(t))return function Q5(t){return new Qe(i=>{for(const e of t)if(i.next(e),i.closed)return;i.complete()})}(t);if(ow(t))return function Z5(t){return rw(iw(t))}(t)}throw ew(t)}function rw(t){return new Qe(i=>{(function Y5(t,i){var e,n,o,r;return function q0(t,i,e,n){return new(e||(e=Promise))(function(r,s){function a(g){try{p(n.next(g))}catch(m){s(m)}}function d(g){try{p(n.throw(g))}catch(m){s(m)}}function p(g){g.done?r(g.value):function o(r){return r instanceof e?r:new e(function(s){s(r)})}(g.value).then(a,d)}p((n=n.apply(t,i||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Z0(t);!(n=yield e.next()).done;)if(i.next(n.value),i.closed)return}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=e.return)&&(yield r.call(e))}finally{if(o)throw o.error}}i.complete()})})(t,i).catch(e=>i.error(e))})}function mi(t,i,e,n=0,o=!1){const r=i.schedule(function(){e(),o?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(r),!o)return r}function sw(t,i=0){return gt((e,n)=>{e.subscribe(tt(n,o=>mi(n,t,()=>n.next(o),i),()=>mi(n,t,()=>n.complete(),i),o=>mi(n,t,()=>n.error(o),i)))})}function aw(t,i=0){return gt((e,n)=>{n.add(t.schedule(()=>e.subscribe(n),i))})}function cw(t,i){if(!t)throw new Error("Iterable cannot be null");return new Qe(e=>{mi(e,i,()=>{const n=t[Symbol.asyncIterator]();mi(e,i,()=>{n.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function dt(t,i){return i?function nB(t,i){if(null!=t){if(J0(t))return function K5(t,i){return Zn(t).pipe(aw(i),sw(i))}(t,i);if(Y0(t))return function X5(t,i){return new Qe(e=>{let n=0;return i.schedule(function(){n===t.length?e.complete():(e.next(t[n++]),e.closed||this.schedule())})})}(t,i);if(K0(t))return function J5(t,i){return Zn(t).pipe(aw(i),sw(i))}(t,i);if(X0(t))return cw(t,i);if(nw(t))return function eB(t,i){return new Qe(e=>{let n;return mi(e,i,()=>{n=t[tw](),mi(e,i,()=>{let o,r;try{({value:o,done:r}=n.next())}catch(s){return void e.error(s)}r?e.complete():e.next(o)},0,!0)}),()=>ke(n?.return)&&n.return()})}(t,i);if(ow(t))return function tB(t,i){return cw(iw(t),i)}(t,i)}throw ew(t)}(t,i):Zn(t)}function Q(...t){return dt(t,yd(t))}function Mt(t,i,e=1/0){return ke(i)?Mt((n,o)=>le((r,s)=>i(n,r,o,s))(Zn(t(n,o))),e):("number"==typeof i&&(e=i),gt((n,o)=>function iB(t,i,e,n,o,r,s,a){const d=[];let p=0,g=0,m=!1;const b=()=>{m&&!d.length&&!p&&i.complete()},y=P=>p<n?I(P):d.push(P),I=P=>{r&&i.next(P),p++;let T=!1;Zn(e(P,g++)).subscribe(tt(i,A=>{o?.(A),r?y(A):i.next(A)},()=>{T=!0},void 0,()=>{if(T)try{for(p--;d.length&&p<n;){const A=d.shift();s?mi(i,s,()=>I(A)):I(A)}b()}catch(A){i.error(A)}}))};return t.subscribe(tt(i,y,()=>{m=!0,b()})),()=>{a?.()}}(n,o,t,e)))}function Vr(t,i){return ke(i)?Mt(t,i,1):Mt(t,1)}function _i(t,i){return gt((e,n)=>{let o=0;e.subscribe(tt(n,r=>t.call(i,r,o++)&&n.next(r)))})}function Cd(t){return gt((i,e)=>{try{i.subscribe(e)}finally{e.add(t)}})}function un(t,i){return gt((e,n)=>{let o=null,r=0,s=!1;const a=()=>s&&!o&&n.complete();e.subscribe(tt(n,d=>{o?.unsubscribe();let p=0;const g=r++;Zn(t(d,g)).subscribe(o=tt(n,m=>n.next(i?i(d,m,g,p++):m),()=>{o=null,a()}))},()=>{s=!0,a()}))})}class Md{}class Id{}class tn{constructor(i){this.normalizedNames=new Map,this.lazyUpdate=null,i?"string"==typeof i?this.lazyInit=()=>{this.headers=new Map,i.split("\n").forEach(e=>{const n=e.indexOf(":");if(n>0){const o=e.slice(0,n),r=o.toLowerCase(),s=e.slice(n+1).trim();this.maybeSetNormalizedName(o,r),this.headers.has(r)?this.headers.get(r).push(s):this.headers.set(r,[s])}})}:typeof Headers<"u"&&i instanceof Headers?(this.headers=new Map,i.forEach((e,n)=>{this.setHeaderEntries(n,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(i).forEach(([e,n])=>{this.setHeaderEntries(e,n)})}:this.headers=new Map}has(i){return this.init(),this.headers.has(i.toLowerCase())}get(i){this.init();const e=this.headers.get(i.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(i){return this.init(),this.headers.get(i.toLowerCase())||null}append(i,e){return this.clone({name:i,value:e,op:"a"})}set(i,e){return this.clone({name:i,value:e,op:"s"})}delete(i,e){return this.clone({name:i,value:e,op:"d"})}maybeSetNormalizedName(i,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,i)}init(){this.lazyInit&&(this.lazyInit instanceof tn?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(i=>this.applyUpdate(i)),this.lazyUpdate=null))}copyFrom(i){i.init(),Array.from(i.headers.keys()).forEach(e=>{this.headers.set(e,i.headers.get(e)),this.normalizedNames.set(e,i.normalizedNames.get(e))})}clone(i){const e=new tn;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof tn?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([i]),e}applyUpdate(i){const e=i.name.toLowerCase();switch(i.op){case"a":case"s":let n=i.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(i.name,e);const o=("a"===i.op?this.headers.get(e):void 0)||[];o.push(...n),this.headers.set(e,o);break;case"d":const r=i.value;if(r){let s=this.headers.get(e);if(!s)return;s=s.filter(a=>-1===r.indexOf(a)),0===s.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}else this.headers.delete(e),this.normalizedNames.delete(e)}}setHeaderEntries(i,e){const n=(Array.isArray(e)?e:[e]).map(r=>r.toString()),o=i.toLowerCase();this.headers.set(o,n),this.maybeSetNormalizedName(i,o)}forEach(i){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>i(this.normalizedNames.get(e),this.headers.get(e)))}}class oB{encodeKey(i){return lw(i)}encodeValue(i){return lw(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}}const sB=/%(\d[a-f0-9])/gi,aB={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function lw(t){return encodeURIComponent(t).replace(sB,(i,e)=>aB[e]??i)}function wd(t){return`${t}`}class Fi{constructor(i={}){if(this.updates=null,this.cloneFrom=null,this.encoder=i.encoder||new oB,i.fromString){if(i.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function rB(t,i){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{const r=o.indexOf("="),[s,a]=-1==r?[i.decodeKey(o),""]:[i.decodeKey(o.slice(0,r)),i.decodeValue(o.slice(r+1))],d=e.get(s)||[];d.push(a),e.set(s,d)}),e}(i.fromString,this.encoder)}else i.fromObject?(this.map=new Map,Object.keys(i.fromObject).forEach(e=>{const n=i.fromObject[e],o=Array.isArray(n)?n.map(wd):[wd(n)];this.map.set(e,o)})):this.map=null}has(i){return this.init(),this.map.has(i)}get(i){this.init();const e=this.map.get(i);return e?e[0]:null}getAll(i){return this.init(),this.map.get(i)||null}keys(){return this.init(),Array.from(this.map.keys())}append(i,e){return this.clone({param:i,value:e,op:"a"})}appendAll(i){const e=[];return Object.keys(i).forEach(n=>{const o=i[n];Array.isArray(o)?o.forEach(r=>{e.push({param:n,value:r,op:"a"})}):e.push({param:n,value:o,op:"a"})}),this.clone(e)}set(i,e){return this.clone({param:i,value:e,op:"s"})}delete(i,e){return this.clone({param:i,value:e,op:"d"})}toString(){return this.init(),this.keys().map(i=>{const e=this.encoder.encodeKey(i);return this.map.get(i).map(n=>e+"="+this.encoder.encodeValue(n)).join("&")}).filter(i=>""!==i).join("&")}clone(i){const e=new Fi({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(i),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(i=>this.map.set(i,this.cloneFrom.map.get(i))),this.updates.forEach(i=>{switch(i.op){case"a":case"s":const e=("a"===i.op?this.map.get(i.param):void 0)||[];e.push(wd(i.value)),this.map.set(i.param,e);break;case"d":if(void 0===i.value){this.map.delete(i.param);break}{let n=this.map.get(i.param)||[];const o=n.indexOf(wd(i.value));-1!==o&&n.splice(o,1),n.length>0?this.map.set(i.param,n):this.map.delete(i.param)}}}),this.cloneFrom=this.updates=null)}}class cB{constructor(){this.map=new Map}set(i,e){return this.map.set(i,e),this}get(i){return this.map.has(i)||this.map.set(i,i.defaultValue()),this.map.get(i)}delete(i){return this.map.delete(i),this}has(i){return this.map.has(i)}keys(){return this.map.keys()}}function dw(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function uw(t){return typeof Blob<"u"&&t instanceof Blob}function hw(t){return typeof FormData<"u"&&t instanceof FormData}class Ea{constructor(i,e,n,o){let r;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=i.toUpperCase(),function lB(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==n?n:null,r=o):r=n,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new tn,this.context??=new cB,this.params){const s=this.params.toString();if(0===s.length)this.urlWithParams=e;else{const a=e.indexOf("?");this.urlWithParams=e+(-1===a?"?":a<e.length-1?"&":"")+s}}else this.params=new Fi,this.urlWithParams=e}serializeBody(){return null===this.body?null:"string"==typeof this.body||dw(this.body)||uw(this.body)||hw(this.body)||function dB(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)?this.body:this.body instanceof Fi?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||hw(this.body)?null:uw(this.body)?this.body.type||null:dw(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Fi?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(i={}){const e=i.method||this.method,n=i.url||this.url,o=i.responseType||this.responseType,r=i.transferCache??this.transferCache,s=void 0!==i.body?i.body:this.body,a=i.withCredentials??this.withCredentials,d=i.reportProgress??this.reportProgress;let p=i.headers||this.headers,g=i.params||this.params;const m=i.context??this.context;return void 0!==i.setHeaders&&(p=Object.keys(i.setHeaders).reduce((b,y)=>b.set(y,i.setHeaders[y]),p)),i.setParams&&(g=Object.keys(i.setParams).reduce((b,y)=>b.set(y,i.setParams[y]),g)),new Ea(e,n,s,{params:g,headers:p,context:m,reportProgress:d,responseType:o,withCredentials:a,transferCache:r})}}var Bi=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Bi||{});class Tf{constructor(i,e=200,n="OK"){this.headers=i.headers||new tn,this.status=void 0!==i.status?i.status:e,this.statusText=i.statusText||n,this.url=i.url||null,this.ok=this.status>=200&&this.status<300}}class Sd extends Tf{constructor(i={}){super(i),this.type=Bi.ResponseHeader}clone(i={}){return new Sd({headers:i.headers||this.headers,status:void 0!==i.status?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}}class Co extends Tf{constructor(i={}){super(i),this.type=Bi.Response,this.body=void 0!==i.body?i.body:null}clone(i={}){return new Co({body:void 0!==i.body?i.body:this.body,headers:i.headers||this.headers,status:void 0!==i.status?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}}class Hr extends Tf{constructor(i){super(i,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${i.url||"(unknown url)"}`:`Http failure response for ${i.url||"(unknown url)"}: ${i.status} ${i.statusText}`,this.error=i.error||null}}function kf(t,i){return{body:i,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}let Ve=(()=>{class t{constructor(e){this.handler=e}request(e,n,o={}){let r;if(e instanceof Ea)r=e;else{let d,p;d=o.headers instanceof tn?o.headers:new tn(o.headers),o.params&&(p=o.params instanceof Fi?o.params:new Fi({fromObject:o.params})),r=new Ea(e,n,void 0!==o.body?o.body:null,{headers:d,context:o.context,params:p,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}const s=Q(r).pipe(Vr(d=>this.handler.handle(d)));if(e instanceof Ea||"events"===o.observe)return s;const a=s.pipe(_i(d=>d instanceof Co));switch(o.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return a.pipe(le(d=>{if(null!==d.body&&!(d.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return d.body}));case"blob":return a.pipe(le(d=>{if(null!==d.body&&!(d.body instanceof Blob))throw new Error("Response is not a Blob.");return d.body}));case"text":return a.pipe(le(d=>{if(null!==d.body&&"string"!=typeof d.body)throw new Error("Response is not a string.");return d.body}));default:return a.pipe(le(d=>d.body))}case"response":return a;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,n={}){return this.request("DELETE",e,n)}get(e,n={}){return this.request("GET",e,n)}head(e,n={}){return this.request("HEAD",e,n)}jsonp(e,n){return this.request("JSONP",e,{params:(new Fi).append(n,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,n={}){return this.request("OPTIONS",e,n)}patch(e,n,o={}){return this.request("PATCH",e,kf(o,n))}post(e,n,o={}){return this.request("POST",e,kf(o,n))}put(e,n,o={}){return this.request("PUT",e,kf(o,n))}static{this.\u0275fac=function(n){return new(n||t)(q(Md))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();const pB=/^\)\]\}',?\n/;function gw(t){if(t.url)return t.url;const i="X-Request-URL".toLocaleLowerCase();return t.headers.get(i)}let Ef=(()=>{class t{constructor(){this.fetchImpl=F(fB,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e)),this.ngZone=F(fe)}handle(e){return new Qe(n=>{const o=new AbortController;return this.doRequest(e,o.signal,n).then(Af,r=>n.error(new Hr({error:r}))),()=>o.abort()})}doRequest(e,n,o){var r=this;return ka(function*(){const s=r.createRequestInit(e);let a;try{const I=r.ngZone.runOutsideAngular(()=>r.fetchImpl(e.urlWithParams,{signal:n,...s}));(function mB(t){t.then(Af,Af)})(I),o.next({type:Bi.Sent}),a=yield I}catch(I){return void o.error(new Hr({error:I,status:I.status??0,statusText:I.statusText,url:e.urlWithParams,headers:I.headers}))}const d=new tn(a.headers),p=a.statusText,g=gw(a)??e.urlWithParams;let m=a.status,b=null;if(e.reportProgress&&o.next(new Sd({headers:d,status:m,statusText:p,url:g})),a.body){const I=a.headers.get("content-length"),P=[],T=a.body.getReader();let E,V,A=0;const U=typeof Zone<"u"&&Zone.current;yield r.ngZone.runOutsideAngular(ka(function*(){for(;;){const{done:te,value:Te}=yield T.read();if(te)break;if(P.push(Te),A+=Te.length,e.reportProgress){V="text"===e.responseType?(V??"")+(E??=new TextDecoder).decode(Te,{stream:!0}):void 0;const bi=()=>o.next({type:Bi.DownloadProgress,total:I?+I:void 0,loaded:A,partialText:V});U?U.run(bi):bi()}}}));const G=r.concatChunks(P,A);try{const te=a.headers.get("Content-Type")??"";b=r.parseBody(e,G,te)}catch(te){return void o.error(new Hr({error:te,headers:new tn(a.headers),status:a.status,statusText:a.statusText,url:gw(a)??e.urlWithParams}))}}0===m&&(m=b?200:0),m>=200&&m<300?(o.next(new Co({body:b,headers:d,status:m,statusText:p,url:g})),o.complete()):o.error(new Hr({error:b,headers:d,status:m,statusText:p,url:g}))})()}parseBody(e,n,o){switch(e.responseType){case"json":const r=(new TextDecoder).decode(n).replace(pB,"");return""===r?null:JSON.parse(r);case"text":return(new TextDecoder).decode(n);case"blob":return new Blob([n],{type:o});case"arraybuffer":return n.buffer}}createRequestInit(e){const n={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((r,s)=>n[r]=s.join(",")),e.headers.has("Accept")||(n.Accept="application/json, text/plain, */*"),!e.headers.has("Content-Type")){const r=e.detectContentTypeHeader();null!==r&&(n["Content-Type"]=r)}return{body:e.serializeBody(),method:e.method,headers:n,credentials:o}}concatChunks(e,n){const o=new Uint8Array(n);let r=0;for(const s of e)o.set(s,r),r+=s.length;return o}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();class fB{}function Af(){}function fw(t,i){return i(t)}const Aa=new j(""),mw=new j(""),_w=new j("",{providedIn:"root",factory:()=>!0});let vw=(()=>{class t extends Md{constructor(e,n){super(),this.backend=e,this.injector=n,this.chain=null,this.pendingTasks=F(Si),this.contributeToStability=F(_w)}handle(e){if(null===this.chain){const n=Array.from(new Set([...this.injector.get(Aa),...this.injector.get(mw,[])]));this.chain=n.reduceRight((o,r)=>function vB(t,i,e){return(n,o)=>kn(e,()=>i(n,r=>t(r,o)))}(o,r,this.injector),fw)}if(this.contributeToStability){const n=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(Cd(()=>this.pendingTasks.remove(n)))}return this.chain(e,n=>this.backend.handle(n))}static{this.\u0275fac=function(n){return new(n||t)(q(Id),q(Pt))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();const SB=/^\)\]\}',?\n/;let yw=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new B(-2800,!1);const n=this.xhrFactory;return(n.\u0275loadImpl?dt(n.\u0275loadImpl()):Q(null)).pipe(un(()=>new Qe(r=>{const s=n.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((P,T)=>s.setRequestHeader(P,T.join(","))),e.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const P=e.detectContentTypeHeader();null!==P&&s.setRequestHeader("Content-Type",P)}if(e.responseType){const P=e.responseType.toLowerCase();s.responseType="json"!==P?P:"text"}const a=e.serializeBody();let d=null;const p=()=>{if(null!==d)return d;const P=s.statusText||"OK",T=new tn(s.getAllResponseHeaders()),A=function xB(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(s)||e.url;return d=new Sd({headers:T,status:s.status,statusText:P,url:A}),d},g=()=>{let{headers:P,status:T,statusText:A,url:E}=p(),V=null;204!==T&&(V=typeof s.response>"u"?s.responseText:s.response),0===T&&(T=V?200:0);let U=T>=200&&T<300;if("json"===e.responseType&&"string"==typeof V){const G=V;V=V.replace(SB,"");try{V=""!==V?JSON.parse(V):null}catch(te){V=G,U&&(U=!1,V={error:te,text:V})}}U?(r.next(new Co({body:V,headers:P,status:T,statusText:A,url:E||void 0})),r.complete()):r.error(new Hr({error:V,headers:P,status:T,statusText:A,url:E||void 0}))},m=P=>{const{url:T}=p(),A=new Hr({error:P,status:s.status||0,statusText:s.statusText||"Unknown Error",url:T||void 0});r.error(A)};let b=!1;const y=P=>{b||(r.next(p()),b=!0);let T={type:Bi.DownloadProgress,loaded:P.loaded};P.lengthComputable&&(T.total=P.total),"text"===e.responseType&&s.responseText&&(T.partialText=s.responseText),r.next(T)},I=P=>{let T={type:Bi.UploadProgress,loaded:P.loaded};P.lengthComputable&&(T.total=P.total),r.next(T)};return s.addEventListener("load",g),s.addEventListener("error",m),s.addEventListener("timeout",m),s.addEventListener("abort",m),e.reportProgress&&(s.addEventListener("progress",y),null!==a&&s.upload&&s.upload.addEventListener("progress",I)),s.send(a),r.next({type:Bi.Sent}),()=>{s.removeEventListener("error",m),s.removeEventListener("abort",m),s.removeEventListener("load",g),s.removeEventListener("timeout",m),e.reportProgress&&(s.removeEventListener("progress",y),null!==a&&s.upload&&s.upload.removeEventListener("progress",I)),s.readyState!==s.DONE&&s.abort()}})))}static{this.\u0275fac=function(n){return new(n||t)(q(C0))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();const Of=new j(""),Cw=new j("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Mw=new j("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Iw{}let NB=(()=>{class t{constructor(e,n,o){this.doc=e,this.platform=n,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=u0(e,this.cookieName),this.lastCookieString=e),this.lastToken}static{this.\u0275fac=function(n){return new(n||t)(q(Xt),q(ai),q(Cw))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();function TB(t,i){const e=t.url.toLowerCase();if(!F(Of)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return i(t);const n=F(Iw).getToken(),o=F(Mw);return null!=n&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,n)})),i(t)}var Vi=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(Vi||{});const{isArray:UB}=Array,{getPrototypeOf:zB,prototype:GB,keys:$B}=Object;function Ew(t){if(1===t.length){const i=t[0];if(UB(i))return{args:i,keys:null};if(function qB(t){return t&&"object"==typeof t&&zB(t)===GB}(i)){const e=$B(i);return{args:e.map(n=>i[n]),keys:e}}}return{args:t,keys:null}}const{isArray:WB}=Array;function Aw(t){return le(i=>function QB(t,i){return WB(i)?t(...i):t(i)}(t,i))}function Ow(t,i){return t.reduce((e,n,o)=>(e[n]=i[o],e),{})}function Lf(...t){const i=yd(t),e=$0(t),{args:n,keys:o}=Ew(t);if(0===n.length)return dt([],i);const r=new Qe(function ZB(t,i,e=Wi){return n=>{Lw(i,()=>{const{length:o}=t,r=new Array(o);let s=o,a=o;for(let d=0;d<o;d++)Lw(i,()=>{const p=dt(t[d],i);let g=!1;p.subscribe(tt(n,m=>{r[d]=m,g||(g=!0,a--),a||n.next(e(r.slice()))},()=>{--s||n.complete()}))},n)},n)}}(n,i,o?s=>Ow(o,s):Wi));return e?r.pipe(Aw(e)):r}function Lw(t,i,e){t?mi(e,t,i):i()}const Pd=_u(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Oa(t=1/0){return Mt(Wi,t)}function Rf(...t){return function YB(){return Oa(1)}()(dt(t,yd(t)))}function Rw(t){return new Qe(i=>{Zn(t()).subscribe(i)})}function Dd(t,i){const e=ke(t)?t:()=>t,n=o=>o.error(e());return new Qe(i?o=>i.schedule(n,0,o):n)}const Yn=new Qe(t=>t.complete());function Ff(){return gt((t,i)=>{let e=null;t._refCount++;const n=tt(i,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const o=t._connection,r=e;e=null,o&&(!r||o===r)&&o.unsubscribe(),i.unsubscribe()});t.subscribe(n),n.closed||(e=t.connect())})}class Fw extends Qe{constructor(i,e){super(),this.source=i,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Qm(i)&&(this.lift=i.lift)}_subscribe(i){return this.getSubject().subscribe(i)}getSubject(){const i=this._subject;return(!i||i.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:i}=this;this._subject=this._connection=null,i?.unsubscribe()}connect(){let i=this._connection;if(!i){i=this._connection=new xt;const e=this.getSubject();i.add(this.source.subscribe(tt(e,void 0,()=>{this._teardown(),e.complete()},n=>{this._teardown(),e.error(n)},()=>this._teardown()))),i.closed&&(this._connection=null,i=xt.EMPTY)}return i}refCount(){return Ff()(this)}}function jr(t){return t<=0?()=>Yn:gt((i,e)=>{let n=0;i.subscribe(tt(e,o=>{++n<=t&&(e.next(o),t<=n&&e.complete())}))})}function Nd(t){return gt((i,e)=>{let n=!1;i.subscribe(tt(e,o=>{n=!0,e.next(o)},()=>{n||e.next(t),e.complete()}))})}function Bw(t=XB){return gt((i,e)=>{let n=!1;i.subscribe(tt(e,o=>{n=!0,e.next(o)},()=>n?e.complete():e.error(t())))})}function XB(){return new Pd}function Io(t,i){const e=arguments.length>=2;return n=>n.pipe(t?_i((o,r)=>t(o,r,n)):Wi,jr(1),e?Nd(i):Bw(()=>new Pd))}function Lt(t,i,e){const n=ke(t)||i||e?{next:t,error:i,complete:e}:t;return n?gt((o,r)=>{var s;null===(s=n.subscribe)||void 0===s||s.call(n);let a=!0;o.subscribe(tt(r,d=>{var p;null===(p=n.next)||void 0===p||p.call(n,d),r.next(d)},()=>{var d;a=!1,null===(d=n.complete)||void 0===d||d.call(n),r.complete()},d=>{var p;a=!1,null===(p=n.error)||void 0===p||p.call(n,d),r.error(d)},()=>{var d,p;a&&(null===(d=n.unsubscribe)||void 0===d||d.call(n)),null===(p=n.finalize)||void 0===p||p.call(n)}))}):Wi}function wo(t){return gt((i,e)=>{let r,n=null,o=!1;n=i.subscribe(tt(e,void 0,void 0,s=>{r=Zn(t(s,wo(t)(i))),n?(n.unsubscribe(),n=null,r.subscribe(e)):o=!0})),o&&(n.unsubscribe(),n=null,r.subscribe(e))})}function Bf(t){return t<=0?()=>Yn:gt((i,e)=>{let n=[];i.subscribe(tt(e,o=>{n.push(o),t<n.length&&n.shift()},()=>{for(const o of n)e.next(o);e.complete()},void 0,()=>{n=null}))})}const oe="primary",La=Symbol("RouteTitle");class rV{constructor(i){this.params=i||{}}has(i){return Object.prototype.hasOwnProperty.call(this.params,i)}get(i){if(this.has(i)){const e=this.params[i];return Array.isArray(e)?e[0]:e}return null}getAll(i){if(this.has(i)){const e=this.params[i];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Ur(t){return new rV(t)}function sV(t,i,e){const n=e.path.split("/");if(n.length>t.length||"full"===e.pathMatch&&(i.hasChildren()||n.length<t.length))return null;const o={};for(let r=0;r<n.length;r++){const s=n[r],a=t[r];if(":"===s[0])o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,n.length),posParams:o}}function Kn(t,i){const e=t?Vf(t):void 0,n=i?Vf(i):void 0;if(!e||!n||e.length!=n.length)return!1;let o;for(let r=0;r<e.length;r++)if(o=e[r],!Vw(t[o],i[o]))return!1;return!0}function Vf(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function Vw(t,i){if(Array.isArray(t)&&Array.isArray(i)){if(t.length!==i.length)return!1;const e=[...t].sort(),n=[...i].sort();return e.every((o,r)=>n[r]===o)}return t===i}function Hw(t){return t.length>0?t[t.length-1]:null}function Hi(t){return function jB(t){return!!t&&(t instanceof Qe||ke(t.lift)&&ke(t.subscribe))}(t)?t:va(t)?dt(Promise.resolve(t)):Q(t)}const cV={exact:function zw(t,i,e){if(!xo(t.segments,i.segments)||!Td(t.segments,i.segments,e)||t.numberOfChildren!==i.numberOfChildren)return!1;for(const n in i.children)if(!t.children[n]||!zw(t.children[n],i.children[n],e))return!1;return!0},subset:Gw},jw={exact:function lV(t,i){return Kn(t,i)},subset:function dV(t,i){return Object.keys(i).length<=Object.keys(t).length&&Object.keys(i).every(e=>Vw(t[e],i[e]))},ignored:()=>!0};function Uw(t,i,e){return cV[e.paths](t.root,i.root,e.matrixParams)&&jw[e.queryParams](t.queryParams,i.queryParams)&&!("exact"===e.fragment&&t.fragment!==i.fragment)}function Gw(t,i,e){return $w(t,i,i.segments,e)}function $w(t,i,e,n){if(t.segments.length>e.length){const o=t.segments.slice(0,e.length);return!(!xo(o,e)||i.hasChildren()||!Td(o,e,n))}if(t.segments.length===e.length){if(!xo(t.segments,e)||!Td(t.segments,e,n))return!1;for(const o in i.children)if(!t.children[o]||!Gw(t.children[o],i.children[o],n))return!1;return!0}{const o=e.slice(0,t.segments.length),r=e.slice(t.segments.length);return!!(xo(t.segments,o)&&Td(t.segments,o,n)&&t.children[oe])&&$w(t.children[oe],i,r,n)}}function Td(t,i,e){return i.every((n,o)=>jw[e](t[o].parameters,n.parameters))}class So{constructor(i=new Me([],{}),e={},n=null){this.root=i,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap??=Ur(this.queryParams),this._queryParamMap}toString(){return pV.serialize(this)}}class Me{constructor(i,e){this.segments=i,this.children=e,this.parent=null,Object.values(e).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ed(this)}}class Ra{constructor(i,e){this.path=i,this.parameters=e}get parameterMap(){return this._parameterMap??=Ur(this.parameters),this._parameterMap}toString(){return Qw(this)}}function xo(t,i){return t.length===i.length&&t.every((e,n)=>e.path===i[n].path)}let zr=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>new kd,providedIn:"root"})}}return t})();class kd{parse(i){const e=new wV(i);return new So(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(i){const e=`/${Fa(i.root,!0)}`,n=function mV(t){const i=Object.entries(t).map(([e,n])=>Array.isArray(n)?n.map(o=>`${Ad(e)}=${Ad(o)}`).join("&"):`${Ad(e)}=${Ad(n)}`).filter(e=>e);return i.length?`?${i.join("&")}`:""}(i.queryParams);return`${e}${n}${"string"==typeof i.fragment?`#${function gV(t){return encodeURI(t)}(i.fragment)}`:""}`}}const pV=new kd;function Ed(t){return t.segments.map(i=>Qw(i)).join("/")}function Fa(t,i){if(!t.hasChildren())return Ed(t);if(i){const e=t.children[oe]?Fa(t.children[oe],!1):"",n=[];return Object.entries(t.children).forEach(([o,r])=>{o!==oe&&n.push(`${o}:${Fa(r,!1)}`)}),n.length>0?`${e}(${n.join("//")})`:e}{const e=function hV(t,i){let e=[];return Object.entries(t.children).forEach(([n,o])=>{n===oe&&(e=e.concat(i(o,n)))}),Object.entries(t.children).forEach(([n,o])=>{n!==oe&&(e=e.concat(i(o,n)))}),e}(t,(n,o)=>o===oe?[Fa(t.children[oe],!1)]:[`${o}:${Fa(n,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[oe]?`${Ed(t)}/${e[0]}`:`${Ed(t)}/(${e.join("//")})`}}function qw(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ad(t){return qw(t).replace(/%3B/gi,";")}function Hf(t){return qw(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Od(t){return decodeURIComponent(t)}function Ww(t){return Od(t.replace(/\+/g,"%20"))}function Qw(t){return`${Hf(t.path)}${function fV(t){return Object.entries(t).map(([i,e])=>`;${Hf(i)}=${Hf(e)}`).join("")}(t.parameters)}`}const _V=/^[^\/()?;#]+/;function jf(t){const i=t.match(_V);return i?i[0]:""}const vV=/^[^\/()?;=#]+/,yV=/^[^=?&#]+/,MV=/^[^&#]+/;class wV{constructor(i){this.url=i,this.remaining=i}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Me([],{}):new Me([],this.parseChildren())}parseQueryParams(){const i={};if(this.consumeOptional("?"))do{this.parseQueryParam(i)}while(this.consumeOptional("&"));return i}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const i=[];for(this.peekStartsWith("(")||i.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),i.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(i.length>0||Object.keys(e).length>0)&&(n[oe]=new Me(i,e)),n}parseSegment(){const i=jf(this.remaining);if(""===i&&this.peekStartsWith(";"))throw new B(4009,!1);return this.capture(i),new Ra(Od(i),this.parseMatrixParams())}parseMatrixParams(){const i={};for(;this.consumeOptional(";");)this.parseParam(i);return i}parseParam(i){const e=function bV(t){const i=t.match(vV);return i?i[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const o=jf(this.remaining);o&&(n=o,this.capture(n))}i[Od(e)]=Od(n)}parseQueryParam(i){const e=function CV(t){const i=t.match(yV);return i?i[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const s=function IV(t){const i=t.match(MV);return i?i[0]:""}(this.remaining);s&&(n=s,this.capture(n))}const o=Ww(e),r=Ww(n);if(i.hasOwnProperty(o)){let s=i[o];Array.isArray(s)||(s=[s],i[o]=s),s.push(r)}else i[o]=r}parseParens(i){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=jf(this.remaining),o=this.remaining[n.length];if("/"!==o&&")"!==o&&";"!==o)throw new B(4010,!1);let r;n.indexOf(":")>-1?(r=n.slice(0,n.indexOf(":")),this.capture(r),this.capture(":")):i&&(r=oe);const s=this.parseChildren();e[r]=1===Object.keys(s).length?s[oe]:new Me([],s),this.consumeOptional("//")}return e}peekStartsWith(i){return this.remaining.startsWith(i)}consumeOptional(i){return!!this.peekStartsWith(i)&&(this.remaining=this.remaining.substring(i.length),!0)}capture(i){if(!this.consumeOptional(i))throw new B(4011,!1)}}function Zw(t){return t.segments.length>0?new Me([],{[oe]:t}):t}function Yw(t){const i={};for(const[n,o]of Object.entries(t.children)){const r=Yw(o);if(n===oe&&0===r.segments.length&&r.hasChildren())for(const[s,a]of Object.entries(r.children))i[s]=a;else(r.segments.length>0||r.hasChildren())&&(i[n]=r)}return function SV(t){if(1===t.numberOfChildren&&t.children[oe]){const i=t.children[oe];return new Me(t.segments.concat(i.segments),i.children)}return t}(new Me(t.segments,i))}function Po(t){return t instanceof So}function Kw(t){let i;const o=Zw(function e(r){const s={};for(const d of r.children){const p=e(d);s[d.outlet]=p}const a=new Me(r.url,s);return r===t&&(i=a),a}(t.root));return i??o}function Jw(t,i,e,n){let o=t;for(;o.parent;)o=o.parent;if(0===i.length)return Uf(o,o,o,e,n);const r=function PV(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new eS(!0,0,t);let i=0,e=!1;const n=t.reduce((o,r,s)=>{if("object"==typeof r&&null!=r){if(r.outlets){const a={};return Object.entries(r.outlets).forEach(([d,p])=>{a[d]="string"==typeof p?p.split("/"):p}),[...o,{outlets:a}]}if(r.segmentPath)return[...o,r.segmentPath]}return"string"!=typeof r?[...o,r]:0===s?(r.split("/").forEach((a,d)=>{0==d&&"."===a||(0==d&&""===a?e=!0:".."===a?i++:""!=a&&o.push(a))}),o):[...o,r]},[]);return new eS(e,i,n)}(i);if(r.toRoot())return Uf(o,o,new Me([],{}),e,n);const s=function DV(t,i,e){if(t.isAbsolute)return new Rd(i,!0,0);if(!e)return new Rd(i,!1,NaN);if(null===e.parent)return new Rd(e,!0,0);const n=Ld(t.commands[0])?0:1;return function NV(t,i,e){let n=t,o=i,r=e;for(;r>o;){if(r-=o,n=n.parent,!n)throw new B(4005,!1);o=n.segments.length}return new Rd(n,!1,o-r)}(e,e.segments.length-1+n,t.numberOfDoubleDots)}(r,o,t),a=s.processChildren?Va(s.segmentGroup,s.index,r.commands):tS(s.segmentGroup,s.index,r.commands);return Uf(o,s.segmentGroup,a,e,n)}function Ld(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Ba(t){return"object"==typeof t&&null!=t&&t.outlets}function Uf(t,i,e,n,o){let s,r={};n&&Object.entries(n).forEach(([d,p])=>{r[d]=Array.isArray(p)?p.map(g=>`${g}`):`${p}`}),s=t===i?e:Xw(t,i,e);const a=Zw(Yw(s));return new So(a,r,o)}function Xw(t,i,e){const n={};return Object.entries(t.children).forEach(([o,r])=>{n[o]=r===i?e:Xw(r,i,e)}),new Me(t.segments,n)}class eS{constructor(i,e,n){if(this.isAbsolute=i,this.numberOfDoubleDots=e,this.commands=n,i&&n.length>0&&Ld(n[0]))throw new B(4003,!1);const o=n.find(Ba);if(o&&o!==Hw(n))throw new B(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Rd{constructor(i,e,n){this.segmentGroup=i,this.processChildren=e,this.index=n}}function tS(t,i,e){if(t??=new Me([],{}),0===t.segments.length&&t.hasChildren())return Va(t,i,e);const n=function kV(t,i,e){let n=0,o=i;const r={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(n>=e.length)return r;const s=t.segments[o],a=e[n];if(Ba(a))break;const d=`${a}`,p=n<e.length-1?e[n+1]:null;if(o>0&&void 0===d)break;if(d&&p&&"object"==typeof p&&void 0===p.outlets){if(!iS(d,p,s))return r;n+=2}else{if(!iS(d,{},s))return r;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}(t,i,e),o=e.slice(n.commandIndex);if(n.match&&n.pathIndex<t.segments.length){const r=new Me(t.segments.slice(0,n.pathIndex),{});return r.children[oe]=new Me(t.segments.slice(n.pathIndex),t.children),Va(r,0,o)}return n.match&&0===o.length?new Me(t.segments,{}):n.match&&!t.hasChildren()?zf(t,i,e):n.match?Va(t,0,o):zf(t,i,e)}function Va(t,i,e){if(0===e.length)return new Me(t.segments,{});{const n=function TV(t){return Ba(t[0])?t[0].outlets:{[oe]:t}}(e),o={};if(Object.keys(n).some(r=>r!==oe)&&t.children[oe]&&1===t.numberOfChildren&&0===t.children[oe].segments.length){const r=Va(t.children[oe],i,e);return new Me(t.segments,r.children)}return Object.entries(n).forEach(([r,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(o[r]=tS(t.children[r],i,s))}),Object.entries(t.children).forEach(([r,s])=>{void 0===n[r]&&(o[r]=s)}),new Me(t.segments,o)}}function zf(t,i,e){const n=t.segments.slice(0,i);let o=0;for(;o<e.length;){const r=e[o];if(Ba(r)){const d=EV(r.outlets);return new Me(n,d)}if(0===o&&Ld(e[0])){n.push(new Ra(t.segments[i].path,nS(e[0]))),o++;continue}const s=Ba(r)?r.outlets[oe]:`${r}`,a=o<e.length-1?e[o+1]:null;s&&a&&Ld(a)?(n.push(new Ra(s,nS(a))),o+=2):(n.push(new Ra(s,{})),o++)}return new Me(n,{})}function EV(t){const i={};return Object.entries(t).forEach(([e,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(i[e]=zf(new Me([],{}),0,n))}),i}function nS(t){const i={};return Object.entries(t).forEach(([e,n])=>i[e]=`${n}`),i}function iS(t,i,e){return t==e.path&&Kn(i,e.parameters)}const Ha="imperative";var de=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(de||{});class Jn{constructor(i,e){this.id=i,this.url=e}}class Fd extends Jn{constructor(i,e,n="imperative",o=null){super(i,e),this.type=de.NavigationStart,this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class vi extends Jn{constructor(i,e,n){super(i,e),this.urlAfterRedirects=n,this.type=de.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var nn=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(nn||{}),Bd=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(Bd||{});class Do extends Jn{constructor(i,e,n,o){super(i,e),this.reason=n,this.code=o,this.type=de.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Gr extends Jn{constructor(i,e,n,o){super(i,e),this.reason=n,this.code=o,this.type=de.NavigationSkipped}}class Gf extends Jn{constructor(i,e,n,o){super(i,e),this.error=n,this.target=o,this.type=de.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class oS extends Jn{constructor(i,e,n,o){super(i,e),this.urlAfterRedirects=n,this.state=o,this.type=de.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class AV extends Jn{constructor(i,e,n,o){super(i,e),this.urlAfterRedirects=n,this.state=o,this.type=de.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class OV extends Jn{constructor(i,e,n,o,r){super(i,e),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=r,this.type=de.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class LV extends Jn{constructor(i,e,n,o){super(i,e),this.urlAfterRedirects=n,this.state=o,this.type=de.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class RV extends Jn{constructor(i,e,n,o){super(i,e),this.urlAfterRedirects=n,this.state=o,this.type=de.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class FV{constructor(i){this.route=i,this.type=de.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class BV{constructor(i){this.route=i,this.type=de.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class VV{constructor(i){this.snapshot=i,this.type=de.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class HV{constructor(i){this.snapshot=i,this.type=de.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jV{constructor(i){this.snapshot=i,this.type=de.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UV{constructor(i){this.snapshot=i,this.type=de.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class rS{constructor(i,e,n){this.routerEvent=i,this.position=e,this.anchor=n,this.type=de.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class $f{}class Vd{constructor(i,e){this.url=i,this.navigationBehaviorOptions=e}}function wn(t){return t.outlet||oe}function ja(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let i=t.parent;i;i=i.parent){const e=i.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class QV{get injector(){return ja(this.route?.snapshot)??this.rootInjector}set injector(i){}constructor(i){this.rootInjector=i,this.outlet=null,this.route=null,this.children=new Ua(this.rootInjector),this.attachRef=null}}let Ua=(()=>{class t{constructor(e){this.rootInjector=e,this.contexts=new Map}onChildOutletCreated(e,n){const o=this.getOrCreateContext(e);o.outlet=n,this.contexts.set(e,o)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new QV(this.rootInjector),this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}static{this.\u0275fac=function(n){return new(n||t)(q(Pt))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();class sS{constructor(i){this._root=i}get root(){return this._root.value}parent(i){const e=this.pathFromRoot(i);return e.length>1?e[e.length-2]:null}children(i){const e=qf(i,this._root);return e?e.children.map(n=>n.value):[]}firstChild(i){const e=qf(i,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(i){const e=Wf(i,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==i)}pathFromRoot(i){return Wf(i,this._root).map(e=>e.value)}}function qf(t,i){if(t===i.value)return i;for(const e of i.children){const n=qf(t,e);if(n)return n}return null}function Wf(t,i){if(t===i.value)return[i];for(const e of i.children){const n=Wf(t,e);if(n.length)return n.unshift(i),n}return[]}class Sn{constructor(i,e){this.value=i,this.children=e}toString(){return`TreeNode(${this.value})`}}function $r(t){const i={};return t&&t.children.forEach(e=>i[e.value.outlet]=e),i}class aS extends sS{constructor(i,e){super(i),this.snapshot=e,Qf(this,i)}toString(){return this.snapshot.toString()}}function cS(t){const i=function ZV(t){const r=new jd([],{},{},"",{},oe,t,null,{});return new lS("",new Sn(r,[]))}(t),e=new Gt([new Ra("",{})]),n=new Gt({}),o=new Gt({}),r=new Gt({}),s=new Gt(""),a=new qr(e,n,r,s,o,oe,t,i.root);return a.snapshot=i.root,new aS(new Sn(a,[]),i)}class qr{constructor(i,e,n,o,r,s,a,d){this.urlSubject=i,this.paramsSubject=e,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=r,this.outlet=s,this.component=a,this._futureSnapshot=d,this.title=this.dataSubject?.pipe(le(p=>p[La]))??Q(void 0),this.url=i,this.params=e,this.queryParams=n,this.fragment=o,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(le(i=>Ur(i))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(le(i=>Ur(i))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Hd(t,i,e="emptyOnly"){let n;const{routeConfig:o}=t;return n=null===i||"always"!==e&&""!==o?.path&&(i.component||i.routeConfig?.loadComponent)?{params:{...t.params},data:{...t.data},resolve:{...t.data,...t._resolvedData??{}}}:{params:{...i.params,...t.params},data:{...i.data,...t.data},resolve:{...t.data,...i.data,...o?.data,...t._resolvedData}},o&&uS(o)&&(n.resolve[La]=o.title),n}class jd{get title(){return this.data?.[La]}constructor(i,e,n,o,r,s,a,d,p){this.url=i,this.params=e,this.queryParams=n,this.fragment=o,this.data=r,this.outlet=s,this.component=a,this.routeConfig=d,this._resolve=p}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ur(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ur(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class lS extends sS{constructor(i,e){super(e),this.url=i,Qf(this,e)}toString(){return dS(this._root)}}function Qf(t,i){i.value._routerState=t,i.children.forEach(e=>Qf(t,e))}function dS(t){const i=t.children.length>0?` { ${t.children.map(dS).join(", ")} } `:"";return`${t.value}${i}`}function Zf(t){if(t.snapshot){const i=t.snapshot,e=t._futureSnapshot;t.snapshot=e,Kn(i.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),i.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),Kn(i.params,e.params)||t.paramsSubject.next(e.params),function aV(t,i){if(t.length!==i.length)return!1;for(let e=0;e<t.length;++e)if(!Kn(t[e],i[e]))return!1;return!0}(i.url,e.url)||t.urlSubject.next(e.url),Kn(i.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Yf(t,i){const e=Kn(t.params,i.params)&&function uV(t,i){return xo(t,i)&&t.every((e,n)=>Kn(e.parameters,i[n].parameters))}(t.url,i.url);return e&&!(!t.parent!=!i.parent)&&(!t.parent||Yf(t.parent,i.parent))}function uS(t){return"string"==typeof t.title||null===t.title}let Ud=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=oe,this.activateEvents=new Fe,this.deactivateEvents=new Fe,this.attachEvents=new Fe,this.detachEvents=new Fe,this.parentContexts=F(Ua),this.location=F(bn),this.changeDetector=F(Ca),this.inputBinder=F(zd,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(e){if(e.name){const{firstChange:n,previousValue:o}=e.name;if(n)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new B(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new B(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new B(4012,!1);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,n){this.activated=e,this._activatedRoute=n,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,n){if(this.isActivated)throw new B(4013,!1);this._activatedRoute=e;const o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,d=new Kf(e,a,o.injector);this.activated=o.createComponent(s,{index:o.length,injector:d,environmentInjector:n}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=ee({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[sn]})}}return t})();class Kf{__ngOutletInjector(i){return new Kf(this.route,this.childContexts,i)}constructor(i,e,n){this.route=i,this.childContexts=e,this.parent=n}get(i,e){return i===qr?this.route:i===Ua?this.childContexts:this.parent.get(i,e)}}const zd=new j("");let hS=(()=>{class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){const{activatedRoute:n}=e,o=Lf([n.queryParams,n.params,n.data]).pipe(un(([r,s,a],d)=>(a={...r,...s,...a},0===d?Q(a):Promise.resolve(a)))).subscribe(r=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==n||null===n.component)return void this.unsubscribeFromRouteData(e);const s=function WR(t){const i=ae(t);if(!i)return null;const e=new Ks(i);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return i.standalone},get isSignal(){return i.signals}}}(n.component);if(s)for(const{templateName:a}of s.inputs)e.activatedComponentRef.setInput(a,r[a]);else this.unsubscribeFromRouteData(e)});this.outletDataSubscriptions.set(e,o)}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();function za(t,i,e){if(e&&t.shouldReuseRoute(i.value,e.value.snapshot)){const n=e.value;n._futureSnapshot=i.value;const o=function KV(t,i,e){return i.children.map(n=>{for(const o of e.children)if(t.shouldReuseRoute(n.value,o.value.snapshot))return za(t,n,o);return za(t,n)})}(t,i,e);return new Sn(n,o)}{if(t.shouldAttach(i.value)){const r=t.retrieve(i.value);if(null!==r){const s=r.route;return s.value._futureSnapshot=i.value,s.children=i.children.map(a=>za(t,a)),s}}const n=function JV(t){return new qr(new Gt(t.url),new Gt(t.params),new Gt(t.queryParams),new Gt(t.fragment),new Gt(t.data),t.outlet,t.component,t)}(i.value),o=i.children.map(r=>za(t,r));return new Sn(n,o)}}class Jf{constructor(i,e){this.redirectTo=i,this.navigationBehaviorOptions=e}}const pS="ngNavigationCancelingError";function Gd(t,i){const{redirectTo:e,navigationBehaviorOptions:n}=Po(i)?{redirectTo:i,navigationBehaviorOptions:void 0}:i,o=gS(!1,nn.Redirect);return o.url=e,o.navigationBehaviorOptions=n,o}function gS(t,i){const e=new Error(`NavigationCancelingError: ${t||""}`);return e[pS]=!0,e.cancellationCode=i,e}function fS(t){return!!t&&t[pS]}class t6{constructor(i,e,n,o,r){this.routeReuseStrategy=i,this.futureState=e,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=r}activate(i){const e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,i),Zf(this.futureState.root),this.activateChildRoutes(e,n,i)}deactivateChildRoutes(i,e,n){const o=$r(e);i.children.forEach(r=>{const s=r.value.outlet;this.deactivateRoutes(r,o[s],n),delete o[s]}),Object.values(o).forEach(r=>{this.deactivateRouteAndItsChildren(r,n)})}deactivateRoutes(i,e,n){const o=i.value,r=e?e.value:null;if(o===r)if(o.component){const s=n.getContext(o.outlet);s&&this.deactivateChildRoutes(i,e,s.children)}else this.deactivateChildRoutes(i,e,n);else r&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(i,e){i.value.component&&this.routeReuseStrategy.shouldDetach(i.value.snapshot)?this.detachAndStoreRouteSubtree(i,e):this.deactivateRouteAndOutlet(i,e)}detachAndStoreRouteSubtree(i,e){const n=e.getContext(i.value.outlet),o=n&&i.value.component?n.children:e,r=$r(i);for(const s of Object.values(r))this.deactivateRouteAndItsChildren(s,o);if(n&&n.outlet){const s=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(i.value.snapshot,{componentRef:s,route:i,contexts:a})}}deactivateRouteAndOutlet(i,e){const n=e.getContext(i.value.outlet),o=n&&i.value.component?n.children:e,r=$r(i);for(const s of Object.values(r))this.deactivateRouteAndItsChildren(s,o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(i,e,n){const o=$r(e);i.children.forEach(r=>{this.activateRoutes(r,o[r.value.outlet],n),this.forwardEvent(new UV(r.value.snapshot))}),i.children.length&&this.forwardEvent(new HV(i.value.snapshot))}activateRoutes(i,e,n){const o=i.value,r=e?e.value:null;if(Zf(o),o===r)if(o.component){const s=n.getOrCreateContext(o.outlet);this.activateChildRoutes(i,e,s.children)}else this.activateChildRoutes(i,e,n);else if(o.component){const s=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),Zf(a.route.value),this.activateChildRoutes(i,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(i,null,s.children)}else this.activateChildRoutes(i,null,n)}}class mS{constructor(i){this.path=i,this.route=this.path[this.path.length-1]}}class $d{constructor(i,e){this.component=i,this.route=e}}function n6(t,i,e){const n=t._root;return Ga(n,i?i._root:null,e,[n.value])}function Wr(t,i){const e=Symbol(),n=i.get(t,e);return n===e?"function"!=typeof t||function hP(t){return null!==uc(t)}(t)?i.get(t):t:n}function Ga(t,i,e,n,o={canDeactivateChecks:[],canActivateChecks:[]}){const r=$r(i);return t.children.forEach(s=>{(function o6(t,i,e,n,o={canDeactivateChecks:[],canActivateChecks:[]}){const r=t.value,s=i?i.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&r.routeConfig===s.routeConfig){const d=function r6(t,i,e){if("function"==typeof e)return e(t,i);switch(e){case"pathParamsChange":return!xo(t.url,i.url);case"pathParamsOrQueryParamsChange":return!xo(t.url,i.url)||!Kn(t.queryParams,i.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Yf(t,i)||!Kn(t.queryParams,i.queryParams);default:return!Yf(t,i)}}(s,r,r.routeConfig.runGuardsAndResolvers);d?o.canActivateChecks.push(new mS(n)):(r.data=s.data,r._resolvedData=s._resolvedData),Ga(t,i,r.component?a?a.children:null:e,n,o),d&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new $d(a.outlet.component,s))}else s&&$a(i,a,o),o.canActivateChecks.push(new mS(n)),Ga(t,null,r.component?a?a.children:null:e,n,o)})(s,r[s.value.outlet],e,n.concat([s.value]),o),delete r[s.value.outlet]}),Object.entries(r).forEach(([s,a])=>$a(a,e.getContext(s),o)),o}function $a(t,i,e){const n=$r(t),o=t.value;Object.entries(n).forEach(([r,s])=>{$a(s,o.component?i?i.children.getContext(r):null:i,e)}),e.canDeactivateChecks.push(new $d(o.component&&i&&i.outlet&&i.outlet.isActivated?i.outlet.component:null,o))}function qa(t){return"function"==typeof t}function _S(t){return t instanceof Pd||"EmptyError"===t?.name}const qd=Symbol("INITIAL_VALUE");function Qr(){return un(t=>Lf(t.map(i=>i.pipe(jr(1),function JB(...t){const i=yd(t);return gt((e,n)=>{(i?Rf(t,e,i):Rf(t,e)).subscribe(n)})}(qd)))).pipe(le(i=>{for(const e of i)if(!0!==e){if(e===qd)return qd;if(!1===e||h6(e))return e}return!0}),_i(i=>i!==qd),jr(1)))}function h6(t){return Po(t)||t instanceof Jf}function vS(t){return function nP(...t){return $m(t)}(Lt(i=>{if("boolean"!=typeof i)throw Gd(0,i)}),le(i=>!0===i))}class Xf{constructor(i){this.segmentGroup=i||null}}class Wd extends Error{constructor(i){super(),this.urlTree=i}}function Zr(t){return Dd(new Xf(t))}class S6{constructor(i,e){this.urlSerializer=i,this.urlTree=e}lineralizeSegments(i,e){let n=[],o=e.root;for(;;){if(n=n.concat(o.segments),0===o.numberOfChildren)return Q(n);if(o.numberOfChildren>1||!o.children[oe])return Dd(new B(4e3,!1));o=o.children[oe]}}applyRedirectCommands(i,e,n,o,r){if("string"!=typeof e){const a=e,{queryParams:d,fragment:p,routeConfig:g,url:m,outlet:b,params:y,data:I,title:P}=o,T=kn(r,()=>a({params:y,data:I,queryParams:d,fragment:p,routeConfig:g,url:m,outlet:b,title:P}));if(T instanceof So)throw new Wd(T);e=T}const s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),i,n);if("/"===e[0])throw new Wd(s);return s}applyRedirectCreateUrlTree(i,e,n,o){const r=this.createSegmentGroup(i,e.root,n,o);return new So(r,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(i,e){const n={};return Object.entries(i).forEach(([o,r])=>{if("string"==typeof r&&":"===r[0]){const a=r.substring(1);n[o]=e[a]}else n[o]=r}),n}createSegmentGroup(i,e,n,o){const r=this.createSegments(i,e.segments,n,o);let s={};return Object.entries(e.children).forEach(([a,d])=>{s[a]=this.createSegmentGroup(i,d,n,o)}),new Me(r,s)}createSegments(i,e,n,o){return e.map(r=>":"===r.path[0]?this.findPosParam(i,r,o):this.findOrReturn(r,n))}findPosParam(i,e,n){const o=n[e.path.substring(1)];if(!o)throw new B(4001,!1);return o}findOrReturn(i,e){let n=0;for(const o of e){if(o.path===i.path)return e.splice(n),o;n++}return i}}const em={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function x6(t,i,e,n,o){const r=bS(t,i,e);return r.matched?(n=function zV(t,i){return t.providers&&!t._injector&&(t._injector=wl(t.providers,i,`Route: ${t.path}`)),t._injector??i}(i,n),function M6(t,i,e,n){const o=i.canMatch;return o&&0!==o.length?Q(o.map(s=>{const a=Wr(s,t);return Hi(function u6(t){return t&&qa(t.canMatch)}(a)?a.canMatch(i,e):kn(t,()=>a(i,e)))})).pipe(Qr(),vS()):Q(!0)}(n,i,e).pipe(le(s=>!0===s?r:{...em}))):Q(r)}function bS(t,i,e){if("**"===i.path)return function P6(t){return{matched:!0,parameters:t.length>0?Hw(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}(e);if(""===i.path)return"full"===i.pathMatch&&(t.hasChildren()||e.length>0)?{...em}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const o=(i.matcher||sV)(e,t,i);if(!o)return{...em};const r={};Object.entries(o.posParams??{}).forEach(([a,d])=>{r[a]=d.path});const s=o.consumed.length>0?{...r,...o.consumed[o.consumed.length-1].parameters}:r;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function yS(t,i,e,n){return e.length>0&&function T6(t,i,e){return e.some(n=>Qd(t,i,n)&&wn(n)!==oe)}(t,e,n)?{segmentGroup:new Me(i,N6(n,new Me(e,t.children))),slicedSegments:[]}:0===e.length&&function k6(t,i,e){return e.some(n=>Qd(t,i,n))}(t,e,n)?{segmentGroup:new Me(t.segments,D6(t,e,n,t.children)),slicedSegments:e}:{segmentGroup:new Me(t.segments,t.children),slicedSegments:e}}function D6(t,i,e,n){const o={};for(const r of e)if(Qd(t,i,r)&&!n[wn(r)]){const s=new Me([],{});o[wn(r)]=s}return{...n,...o}}function N6(t,i){const e={};e[oe]=i;for(const n of t)if(""===n.path&&wn(n)!==oe){const o=new Me([],{});e[wn(n)]=o}return e}function Qd(t,i,e){return(!(t.hasChildren()||i.length>0)||"full"!==e.pathMatch)&&""===e.path}class A6{}class R6{constructor(i,e,n,o,r,s,a){this.injector=i,this.configLoader=e,this.rootComponentType=n,this.config=o,this.urlTree=r,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new S6(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(i){return new B(4002,`'${i.segmentGroup}'`)}recognize(){const i=yS(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(i).pipe(le(({children:e,rootSnapshot:n})=>{const o=new Sn(n,e),r=new lS("",o),s=function xV(t,i,e=null,n=null){return Jw(Kw(t),i,e,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(s),{state:r,tree:s}}))}match(i){const e=new jd([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),oe,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,i,oe,e).pipe(le(n=>({children:n,rootSnapshot:e})),wo(n=>{if(n instanceof Wd)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof Xf?this.noMatchError(n):n}))}processSegmentGroup(i,e,n,o,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(i,e,n,r):this.processSegment(i,e,n,n.segments,o,!0,r).pipe(le(s=>s instanceof Sn?[s]:[]))}processChildren(i,e,n,o){const r=[];for(const s of Object.keys(n.children))"primary"===s?r.unshift(s):r.push(s);return dt(r).pipe(Vr(s=>{const a=n.children[s],d=function WV(t,i){const e=t.filter(n=>wn(n)===i);return e.push(...t.filter(n=>wn(n)!==i)),e}(e,s);return this.processSegmentGroup(i,d,a,s,o)}),function tV(t,i){return gt(function eV(t,i,e,n,o){return(r,s)=>{let a=e,d=i,p=0;r.subscribe(tt(s,g=>{const m=p++;d=a?t(d,g,m):(a=!0,g),n&&s.next(d)},o&&(()=>{a&&s.next(d),s.complete()})))}}(t,i,arguments.length>=2,!0))}((s,a)=>(s.push(...a),s)),Nd(null),function nV(t,i){const e=arguments.length>=2;return n=>n.pipe(t?_i((o,r)=>t(o,r,n)):Wi,Bf(1),e?Nd(i):Bw(()=>new Pd))}(),Mt(s=>{if(null===s)return Zr(n);const a=CS(s);return function F6(t){t.sort((i,e)=>i.value.outlet===oe?-1:e.value.outlet===oe?1:i.value.outlet.localeCompare(e.value.outlet))}(a),Q(a)}))}processSegment(i,e,n,o,r,s,a){return dt(e).pipe(Vr(d=>this.processSegmentAgainstRoute(d._injector??i,e,d,n,o,r,s,a).pipe(wo(p=>{if(p instanceof Xf)return Q(null);throw p}))),Io(d=>!!d),wo(d=>{if(_S(d))return function E6(t,i,e){return 0===i.length&&!t.children[e]}(n,o,r)?Q(new A6):Zr(n);throw d}))}processSegmentAgainstRoute(i,e,n,o,r,s,a,d){return wn(n)===s||s!==oe&&Qd(o,r,n)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(i,o,n,r,s,d):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(i,o,e,n,r,s,d):Zr(o):Zr(o)}expandSegmentAgainstRouteUsingRedirect(i,e,n,o,r,s,a){const{matched:d,parameters:p,consumedSegments:g,positionalParamSegments:m,remainingSegments:b}=bS(e,o,r);if(!d)return Zr(e);"string"==typeof o.redirectTo&&"/"===o.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const y=new jd(r,p,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MS(o),wn(o),o.component??o._loadedComponent??null,o,IS(o)),I=Hd(y,a,this.paramsInheritanceStrategy);y.params=Object.freeze(I.params),y.data=Object.freeze(I.data);const P=this.applyRedirects.applyRedirectCommands(g,o.redirectTo,m,y,i);return this.applyRedirects.lineralizeSegments(o,P).pipe(Mt(T=>this.processSegment(i,n,e,T.concat(b),s,!1,a)))}matchSegmentAgainstRoute(i,e,n,o,r,s){const a=x6(e,n,o,i);return"**"===n.path&&(e.children={}),a.pipe(un(d=>d.matched?this.getChildConfig(i=n._injector??i,n,o).pipe(un(({routes:p})=>{const g=n._loadedInjector??i,{parameters:m,consumedSegments:b,remainingSegments:y}=d,I=new jd(b,m,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MS(n),wn(n),n.component??n._loadedComponent??null,n,IS(n)),P=Hd(I,s,this.paramsInheritanceStrategy);I.params=Object.freeze(P.params),I.data=Object.freeze(P.data);const{segmentGroup:T,slicedSegments:A}=yS(e,b,y,p);if(0===A.length&&T.hasChildren())return this.processChildren(g,p,T,I).pipe(le(V=>new Sn(I,V)));if(0===p.length&&0===A.length)return Q(new Sn(I,[]));const E=wn(n)===r;return this.processSegment(g,p,T,A,E?oe:r,!0,I).pipe(le(V=>new Sn(I,V instanceof Sn?[V]:[])))})):Zr(e)))}getChildConfig(i,e,n){return e.children?Q({routes:e.children,injector:i}):e.loadChildren?void 0!==e._loadedRoutes?Q({routes:e._loadedRoutes,injector:e._loadedInjector}):function C6(t,i,e,n){const o=i.canLoad;return void 0===o||0===o.length?Q(!0):Q(o.map(s=>{const a=Wr(s,t);return Hi(function a6(t){return t&&qa(t.canLoad)}(a)?a.canLoad(i,e):kn(t,()=>a(i,e)))})).pipe(Qr(),vS())}(i,e,n).pipe(Mt(o=>o?this.configLoader.loadChildren(i,e).pipe(Lt(r=>{e._loadedRoutes=r.routes,e._loadedInjector=r.injector})):function w6(){return Dd(gS(!1,nn.GuardRejected))}())):Q({routes:[],injector:i})}}function B6(t){const i=t.value.routeConfig;return i&&""===i.path}function CS(t){const i=[],e=new Set;for(const n of t){if(!B6(n)){i.push(n);continue}const o=i.find(r=>n.value.routeConfig===r.value.routeConfig);void 0!==o?(o.children.push(...n.children),e.add(o)):i.push(n)}for(const n of e){const o=CS(n.children);i.push(new Sn(n.value,o))}return i.filter(n=>!e.has(n))}function MS(t){return t.data||{}}function IS(t){return t.resolve||{}}function wS(t){const i=t.children.map(e=>wS(e)).flat();return[t,...i]}function tm(t){return un(i=>{const e=t(i);return e?dt(e).pipe(le(()=>i)):Q(i)})}let SS=(()=>{class t{buildTitle(e){let n,o=e.root;for(;void 0!==o;)n=this.getResolvedTitleForRoute(o)??n,o=o.children.find(r=>r.outlet===oe);return n}getResolvedTitleForRoute(e){return e.data[La]}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(G6),providedIn:"root"})}}return t})(),G6=(()=>{class t extends SS{constructor(e){super(),this.title=e}updateTitle(e){const n=this.buildTitle(e);void 0!==n&&this.title.setTitle(n)}static{this.\u0275fac=function(n){return new(n||t)(q(p5))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const Yr=new j("",{providedIn:"root",factory:()=>({})});let xS=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["ng-component"]],standalone:!0,features:[Ae],decls:1,vars:0,template:function(n,o){1&n&&X(0,"router-outlet")},dependencies:[Ud],encapsulation:2})}}return t})();function nm(t){const i=t.children&&t.children.map(nm),e=i?{...t,children:i}:{...t};return!e.component&&!e.loadComponent&&(i||e.loadChildren)&&e.outlet&&e.outlet!==oe&&(e.component=xS),e}const Kr=new j("");let im=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=F(lI)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Q(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const n=Hi(e.loadComponent()).pipe(le(PS),Lt(r=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=r}),Cd(()=>{this.componentLoaders.delete(e)})),o=new Fw(n,()=>new zt).pipe(Ff());return this.componentLoaders.set(e,o),o}loadChildren(e,n){if(this.childrenLoaders.get(n))return this.childrenLoaders.get(n);if(n._loadedRoutes)return Q({routes:n._loadedRoutes,injector:n._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(n);const r=function $6(t,i,e,n){return Hi(t.loadChildren()).pipe(le(PS),Mt(o=>o instanceof wC||Array.isArray(o)?Q(o):dt(i.compileModuleAsync(o))),le(o=>{n&&n(t);let r,s,a=!1;return Array.isArray(o)?(s=o,!0):(r=o.create(e).injector,s=r.get(Kr,[],{optional:!0,self:!0}).flat()),{routes:s.map(nm),injector:r}}))}(n,this.compiler,e,this.onLoadEndListener).pipe(Cd(()=>{this.childrenLoaders.delete(n)})),s=new Fw(r,()=>new zt).pipe(Ff());return this.childrenLoaders.set(n,s),s}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function PS(t){return function q6(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let om=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(W6),providedIn:"root"})}}return t})(),W6=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const DS=new j(""),NS=new j("");function Q6(t,i,e){const n=t.get(NS),o=t.get(Xt);return t.get(fe).runOutsideAngular(()=>{if(!o.startViewTransition||n.skipNextTransition)return n.skipNextTransition=!1,new Promise(p=>setTimeout(p));let r;const s=new Promise(p=>{r=p}),a=o.startViewTransition(()=>(r(),function Z6(t){return new Promise(i=>{Tl({read:()=>setTimeout(i)},{injector:t})})}(t))),{onViewTransitionCreated:d}=n;return d&&kn(t,()=>d({transition:a,from:i,to:e})),s})}const TS=new j("");let Zd=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new zt,this.transitionAbortSubject=new zt,this.configLoader=F(im),this.environmentInjector=F(Pt),this.urlSerializer=F(zr),this.rootContexts=F(Ua),this.location=F(xa),this.inputBindingEnabled=null!==F(zd,{optional:!0}),this.titleStrategy=F(SS),this.options=F(Yr,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=F(om),this.createViewTransition=F(DS,{optional:!0}),this.navigationErrorHandler=F(TS,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Q(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new BV(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new FV(o))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const n=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:n})}setupNavigations(e,n,o){return this.transitions=new Gt({id:0,currentUrlTree:n,currentRawUrl:n,extractedUrl:this.urlHandlingStrategy.extract(n),urlAfterRedirects:this.urlHandlingStrategy.extract(n),rawUrl:n,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Ha,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(_i(r=>0!==r.id),le(r=>({...r,extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),un(r=>{let s=!1,a=!1;return Q(r).pipe(un(d=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",nn.SupersededByNewNavigation),Yn;this.currentTransition=r,this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,targetBrowserUrl:"string"==typeof d.extras.browserUrl?this.urlSerializer.parse(d.extras.browserUrl):d.extras.browserUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const p=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!p&&"reload"!==(d.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const m="";return this.events.next(new Gr(d.id,this.urlSerializer.serialize(d.rawUrl),m,Bd.IgnoredSameUrlNavigation)),d.resolve(!1),Yn}if(this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return Q(d).pipe(un(m=>{const b=this.transitions?.getValue();return this.events.next(new Fd(m.id,this.urlSerializer.serialize(m.extractedUrl),m.source,m.restoredState)),b!==this.transitions?.getValue()?Yn:Promise.resolve(m)}),function V6(t,i,e,n,o,r){return Mt(s=>function O6(t,i,e,n,o,r,s="emptyOnly"){return new R6(t,i,e,n,o,s,r).recognize()}(t,i,e,n,s.extractedUrl,o,r).pipe(le(({state:a,tree:d})=>({...s,targetSnapshot:a,urlAfterRedirects:d}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Lt(m=>{r.targetSnapshot=m.targetSnapshot,r.urlAfterRedirects=m.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:m.urlAfterRedirects};const b=new oS(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(b)}));if(p&&this.urlHandlingStrategy.shouldProcessUrl(d.currentRawUrl)){const{id:m,extractedUrl:b,source:y,restoredState:I,extras:P}=d,T=new Fd(m,this.urlSerializer.serialize(b),y,I);this.events.next(T);const A=cS(this.rootComponentType).snapshot;return this.currentTransition=r={...d,targetSnapshot:A,urlAfterRedirects:b,extras:{...P,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=b,Q(r)}{const m="";return this.events.next(new Gr(d.id,this.urlSerializer.serialize(d.extractedUrl),m,Bd.IgnoredByUrlHandlingStrategy)),d.resolve(!1),Yn}}),Lt(d=>{const p=new AV(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}),le(d=>(this.currentTransition=r={...d,guards:n6(d.targetSnapshot,d.currentSnapshot,this.rootContexts)},r)),function p6(t,i){return Mt(e=>{const{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:r,canDeactivateChecks:s}}=e;return 0===s.length&&0===r.length?Q({...e,guardsResult:!0}):function g6(t,i,e,n){return dt(t).pipe(Mt(o=>function y6(t,i,e,n,o){const r=i&&i.routeConfig?i.routeConfig.canDeactivate:null;return r&&0!==r.length?Q(r.map(a=>{const d=ja(i)??o,p=Wr(a,d);return Hi(function d6(t){return t&&qa(t.canDeactivate)}(p)?p.canDeactivate(t,i,e,n):kn(d,()=>p(t,i,e,n))).pipe(Io())})).pipe(Qr()):Q(!0)}(o.component,o.route,e,i,n)),Io(o=>!0!==o,!0))}(s,n,o,t).pipe(Mt(a=>a&&function s6(t){return"boolean"==typeof t}(a)?function f6(t,i,e,n){return dt(i).pipe(Vr(o=>Rf(function _6(t,i){return null!==t&&i&&i(new VV(t)),Q(!0)}(o.route.parent,n),function m6(t,i){return null!==t&&i&&i(new jV(t)),Q(!0)}(o.route,n),function b6(t,i,e){const n=i[i.length-1],r=i.slice(0,i.length-1).reverse().map(s=>function i6(t){const i=t.routeConfig?t.routeConfig.canActivateChild:null;return i&&0!==i.length?{node:t,guards:i}:null}(s)).filter(s=>null!==s).map(s=>Rw(()=>Q(s.guards.map(d=>{const p=ja(s.node)??e,g=Wr(d,p);return Hi(function l6(t){return t&&qa(t.canActivateChild)}(g)?g.canActivateChild(n,t):kn(p,()=>g(n,t))).pipe(Io())})).pipe(Qr())));return Q(r).pipe(Qr())}(t,o.path,e),function v6(t,i,e){const n=i.routeConfig?i.routeConfig.canActivate:null;if(!n||0===n.length)return Q(!0);const o=n.map(r=>Rw(()=>{const s=ja(i)??e,a=Wr(r,s);return Hi(function c6(t){return t&&qa(t.canActivate)}(a)?a.canActivate(i,t):kn(s,()=>a(i,t))).pipe(Io())}));return Q(o).pipe(Qr())}(t,o.route,e))),Io(o=>!0!==o,!0))}(n,r,t,i):Q(a)),le(a=>({...e,guardsResult:a})))})}(this.environmentInjector,d=>this.events.next(d)),Lt(d=>{if(r.guardsResult=d.guardsResult,d.guardsResult&&"boolean"!=typeof d.guardsResult)throw Gd(0,d.guardsResult);const p=new OV(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(p)}),_i(d=>!!d.guardsResult||(this.cancelNavigationTransition(d,"",nn.GuardRejected),!1)),tm(d=>{if(d.guards.canActivateChecks.length)return Q(d).pipe(Lt(p=>{const g=new LV(p.id,this.urlSerializer.serialize(p.extractedUrl),this.urlSerializer.serialize(p.urlAfterRedirects),p.targetSnapshot);this.events.next(g)}),un(p=>{let g=!1;return Q(p).pipe(function H6(t,i){return Mt(e=>{const{targetSnapshot:n,guards:{canActivateChecks:o}}=e;if(!o.length)return Q(e);const r=new Set(o.map(d=>d.route)),s=new Set;for(const d of r)if(!s.has(d))for(const p of wS(d))s.add(p);let a=0;return dt(s).pipe(Vr(d=>r.has(d)?function j6(t,i,e,n){const o=t.routeConfig,r=t._resolve;return void 0!==o?.title&&!uS(o)&&(r[La]=o.title),function U6(t,i,e,n){const o=Vf(t);if(0===o.length)return Q({});const r={};return dt(o).pipe(Mt(s=>function z6(t,i,e,n){const o=ja(i)??n,r=Wr(t,o);return Hi(r.resolve?r.resolve(i,e):kn(o,()=>r(i,e)))}(t[s],i,e,n).pipe(Io(),Lt(a=>{if(a instanceof Jf)throw Gd(new kd,a);r[s]=a}))),Bf(1),function iV(t){return le(()=>t)}(r),wo(s=>_S(s)?Yn:Dd(s)))}(r,t,i,n).pipe(le(s=>(t._resolvedData=s,t.data=Hd(t,t.parent,e).resolve,null)))}(d,n,t,i):(d.data=Hd(d,d.parent,t).resolve,Q(void 0))),Lt(()=>a++),Bf(1),Mt(d=>a===s.size?Q(e):Yn))})}(this.paramsInheritanceStrategy,this.environmentInjector),Lt({next:()=>g=!0,complete:()=>{g||this.cancelNavigationTransition(p,"",nn.NoDataFromResolver)}}))}),Lt(p=>{const g=new RV(p.id,this.urlSerializer.serialize(p.extractedUrl),this.urlSerializer.serialize(p.urlAfterRedirects),p.targetSnapshot);this.events.next(g)}))}),tm(d=>{const p=g=>{const m=[];g.routeConfig?.loadComponent&&!g.routeConfig._loadedComponent&&m.push(this.configLoader.loadComponent(g.routeConfig).pipe(Lt(b=>{g.component=b}),le(()=>{})));for(const b of g.children)m.push(...p(b));return m};return Lf(p(d.targetSnapshot.root)).pipe(Nd(null),jr(1))}),tm(()=>this.afterPreactivation()),un(()=>{const{currentSnapshot:d,targetSnapshot:p}=r,g=this.createViewTransition?.(this.environmentInjector,d.root,p.root);return g?dt(g).pipe(le(()=>r)):Q(r)}),le(d=>{const p=function YV(t,i,e){const n=za(t,i._root,e?e._root:void 0);return new aS(n,i)}(e.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return this.currentTransition=r={...d,targetRouterState:p},this.currentNavigation.targetRouterState=p,r}),Lt(()=>{this.events.next(new $f)}),((t,i,e,n)=>le(o=>(new t6(i,o.targetRouterState,o.currentRouterState,e,n).activate(t),o)))(this.rootContexts,e.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),jr(1),Lt({next:d=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vi(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects))),this.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{s=!0}}),function oV(t){return gt((i,e)=>{Zn(t).subscribe(tt(e,()=>e.complete(),yu)),!e.closed&&i.subscribe(e)})}(this.transitionAbortSubject.pipe(Lt(d=>{throw d}))),Cd(()=>{!s&&!a&&this.cancelNavigationTransition(r,"",nn.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),wo(d=>{if(a=!0,fS(d))this.events.next(new Do(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode)),function XV(t){return fS(t)&&Po(t.url)}(d)?this.events.next(new Vd(d.url,d.navigationBehaviorOptions)):r.resolve(!1);else{const p=new Gf(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);try{const g=kn(this.environmentInjector,()=>this.navigationErrorHandler?.(p));if(g instanceof Jf){const{message:m,cancellationCode:b}=Gd(0,g);this.events.next(new Do(r.id,this.urlSerializer.serialize(r.extractedUrl),m,b)),this.events.next(new Vd(g.redirectTo,g.navigationBehaviorOptions))}else{this.events.next(p);const m=e.errorHandler(d);r.resolve(!!m)}}catch(g){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(g)}}return Yn}))}))}cancelNavigationTransition(e,n,o){const r=new Do(e.id,this.urlSerializer.serialize(e.extractedUrl),n,o);this.events.next(r),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),n=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==n?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Y6(t){return t!==Ha}let K6=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(X6),providedIn:"root"})}}return t})();class J6{shouldDetach(i){return!1}store(i,e){}shouldAttach(i){return!1}retrieve(i){return null}shouldReuseRoute(i,e){return i.routeConfig===e.routeConfig}}let X6=(()=>{class t extends J6{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),kS=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:()=>F(e8),providedIn:"root"})}}return t})(),e8=(()=>{class t extends kS{constructor(){super(...arguments),this.location=F(xa),this.urlSerializer=F(zr),this.options=F(Yr,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=F(om),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new So,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=cS(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(n=>{"popstate"===n.type&&e(n.url,n.state)})}handleRouterEvent(e,n){if(e instanceof Fd)this.stateMemento=this.createStateMemento();else if(e instanceof Gr)this.rawUrlTree=n.initialUrl;else if(e instanceof oS){if("eager"===this.urlUpdateStrategy&&!n.extras.skipLocationChange){const o=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl);this.setBrowserUrl(n.targetBrowserUrl??o,n)}}else e instanceof $f?(this.currentUrlTree=n.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(n.finalUrl,n.initialUrl),this.routerState=n.targetRouterState,"deferred"===this.urlUpdateStrategy&&!n.extras.skipLocationChange&&this.setBrowserUrl(n.targetBrowserUrl??this.rawUrlTree,n)):e instanceof Do&&(e.code===nn.GuardRejected||e.code===nn.NoDataFromResolver)?this.restoreHistory(n):e instanceof Gf?this.restoreHistory(n,!0):e instanceof vi&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,n){const o=e instanceof So?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||n.extras.replaceUrl){const s={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId)};this.location.replaceState(o,"",s)}else{const r={...n.extras.state,...this.generateNgRouterState(n.id,this.browserPageId+1)};this.location.go(o,"",r)}}restoreHistory(e,n=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-this.browserPageId;0!==r?this.location.historyGo(r):this.currentUrlTree===e.finalUrl&&0===r&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(n&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,n){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:n}:{navigationId:e}}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Wa=function(t){return t[t.COMPLETE=0]="COMPLETE",t[t.FAILED=1]="FAILED",t[t.REDIRECTING=2]="REDIRECTING",t}(Wa||{});function ES(t,i){t.events.pipe(_i(e=>e instanceof vi||e instanceof Do||e instanceof Gf||e instanceof Gr),le(e=>e instanceof vi||e instanceof Gr?Wa.COMPLETE:e instanceof Do&&(e.code===nn.Redirect||e.code===nn.SupersededByNewNavigation)?Wa.REDIRECTING:Wa.FAILED),_i(e=>e!==Wa.REDIRECTING),jr(1)).subscribe(()=>{i()})}function t8(t){throw t}const n8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},i8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let xn=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=F(JM),this.stateManager=F(kS),this.options=F(Yr,{optional:!0})||{},this.pendingTasks=F(Si),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=F(Zd),this.urlSerializer=F(zr),this.location=F(xa),this.urlHandlingStrategy=F(om),this._events=new zt,this.errorHandler=this.options.errorHandler||t8,this.navigated=!1,this.routeReuseStrategy=F(K6),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=F(Kr,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!F(zd,{optional:!0}),this.eventsSubscription=new xt,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const e=this.navigationTransitions.events.subscribe(n=>{try{const o=this.navigationTransitions.currentTransition,r=this.navigationTransitions.currentNavigation;if(null!==o&&null!==r)if(this.stateManager.handleRouterEvent(n,r),n instanceof Do&&n.code!==nn.Redirect&&n.code!==nn.SupersededByNewNavigation)this.navigated=!0;else if(n instanceof vi)this.navigated=!0;else if(n instanceof Vd){const s=n.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(n.url,o.currentRawUrl),d={browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||"eager"===this.urlUpdateStrategy||Y6(o.source),...s};this.scheduleNavigation(a,Ha,null,d,{resolve:o.resolve,reject:o.reject,promise:o.promise})}(function r8(t){return!(t instanceof $f||t instanceof Vd)})(n)&&this._events.next(n)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ha,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,n)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",n)},0)})}navigateToSyncWithBrowser(e,n,o){const r={replaceUrl:!0},s=o?.navigationId?o:null;if(o){const d={...o};delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(r.state=d)}const a=this.parseUrl(e);this.scheduleNavigation(a,n,s,r)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(nm),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,n={}){const{relativeTo:o,queryParams:r,fragment:s,queryParamsHandling:a,preserveFragment:d}=n,p=d?this.currentUrlTree.fragment:s;let m,g=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":g={...this.currentUrlTree.queryParams,...r};break;case"preserve":g=this.currentUrlTree.queryParams;break;default:g=r||null}null!==g&&(g=this.removeEmptyProps(g));try{m=Kw(o?o.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof e[0]||"/"!==e[0][0])&&(e=[]),m=this.currentUrlTree.root}return Jw(m,e,g,p??null)}navigateByUrl(e,n={skipLocationChange:!1}){const o=Po(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(r,Ha,null,n)}navigate(e,n={skipLocationChange:!1}){return function o8(t){for(let i=0;i<t.length;i++)if(null==t[i])throw new B(4008,!1)}(e),this.navigateByUrl(this.createUrlTree(e,n),n)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,n){let o;if(o=!0===n?{...n8}:!1===n?{...i8}:n,Po(e))return Uw(this.currentUrlTree,e,o);const r=this.parseUrl(e);return Uw(this.currentUrlTree,r,o)}removeEmptyProps(e){return Object.entries(e).reduce((n,[o,r])=>(null!=r&&(n[o]=r),n),{})}scheduleNavigation(e,n,o,r,s){if(this.disposed)return Promise.resolve(!1);let a,d,p;s?(a=s.resolve,d=s.reject,p=s.promise):p=new Promise((m,b)=>{a=m,d=b});const g=this.pendingTasks.add();return ES(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(g))}),this.navigationTransitions.handleNavigationRequest({source:n,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:r,resolve:a,reject:d,promise:p,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),p.catch(m=>Promise.reject(m))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),Yd=(()=>{class t{constructor(e,n,o,r,s,a){this.router=e,this.route=n,this.tabIndexAttribute=o,this.renderer=r,this.el=s,this.locationStrategy=a,this.href=null,this.onChanges=new zt,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1,this.routerLinkInput=null;const d=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===d||"area"===d,this.isAnchorElement?this.subscription=e.events.subscribe(p=>{p instanceof vi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(e){null==e?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Po(e)||Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,n,o,r,s){const a=this.urlTree;return!!(null===a||this.isAnchorElement&&(0!==e||n||o||r||s||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(a,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const e=this.urlTree;this.href=null!==e&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;const n=null===this.href?null:function Ib(t,i,e){return function wN(t,i){return"src"===i&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===i&&("base"===t||"link"===t)?Mb:As}(i,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(e,n){const o=this.renderer,r=this.el.nativeElement;null!==n?o.setAttribute(r,e,n):o.removeAttribute(r,e)}get urlTree(){return null===this.routerLinkInput?null:Po(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static{this.\u0275fac=function(n){return new(n||t)(R(xn),R(qr),function ys(t){return function QD(t,i){if("class"===i)return t.classes;if("style"===i)return t.styles;const e=t.attrs;if(e){const n=e.length;let o=0;for(;o<n;){const r=e[o];if(h_(r))break;if(0===r)o+=2;else if("number"==typeof r)for(o++;o<n&&"string"==typeof e[o];)o++;else{if(r===i)return e[o+1];o+=2}}}return null}(be(),t)}("tabindex"),R(ui),R(Zt),R(bo))}}static{this.\u0275dir=ee({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,o){1&n&&M("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&n&&Hn("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Lr],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Lr],replaceUrl:[2,"replaceUrl","replaceUrl",Lr],routerLink:"routerLink"},standalone:!0,features:[IC,sn]})}}return t})();class AS{}let c8=(()=>{class t{constructor(e,n,o,r,s){this.router=e,this.injector=o,this.preloadingStrategy=r,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(_i(e=>e instanceof vi),Vr(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,n){const o=[];for(const r of n){r.providers&&!r._injector&&(r._injector=wl(r.providers,e,`Route: ${r.path}`));const s=r._injector??e,a=r._loadedInjector??s;(r.loadChildren&&!r._loadedRoutes&&void 0===r.canLoad||r.loadComponent&&!r._loadedComponent)&&o.push(this.preloadConfig(s,r)),(r.children||r._loadedRoutes)&&o.push(this.processRoutes(a,r.children??r._loadedRoutes))}return dt(o).pipe(Oa())}preloadConfig(e,n){return this.preloadingStrategy.preload(n,()=>{let o;o=n.loadChildren&&void 0===n.canLoad?this.loader.loadChildren(e,n):Q(null);const r=o.pipe(Mt(s=>null===s?Q(void 0):(n._loadedRoutes=s.routes,n._loadedInjector=s.injector,this.processRoutes(s.injector??e,s.routes))));return n.loadComponent&&!n._loadedComponent?dt([r,this.loader.loadComponent(n)]).pipe(Oa()):r})}static{this.\u0275fac=function(n){return new(n||t)(q(xn),q(lI),q(Pt),q(AS),q(im))}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();const rm=new j("");let OS=(()=>{class t{constructor(e,n,o,r,s={}){this.urlSerializer=e,this.transitions=n,this.viewportScroller=o,this.zone=r,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Fd?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof vi?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof Gr&&e.code===Bd.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof rS&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,n){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new rS(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,n))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static{this.\u0275fac=function(n){!function Zb(){throw new Error("invalid")}()}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac})}}return t})();function LS(t){return t.routerState.root}function Xn(t,i){return{\u0275kind:t,\u0275providers:i}}function RS(){const t=F(ht);return i=>{const e=t.get(Wn);if(i!==e.components[0])return;const n=t.get(xn),o=t.get(FS);1===t.get(sm)&&n.initialNavigation(),t.get(BS,null,ce.Optional)?.setUpPreloading(),t.get(rm,null,ce.Optional)?.init(),n.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const FS=new j("",{factory:()=>new zt}),sm=new j("",{providedIn:"root",factory:()=>1}),BS=new j("");function p8(t){return Xn(0,[{provide:BS,useExisting:c8},{provide:AS,useExisting:t}])}function f8(t){return Xn(9,[{provide:DS,useValue:Q6},{provide:NS,useValue:{skipNextTransition:!!t?.skipInitialTransition,...t}}])}const VS=new j("ROUTER_FORROOT_GUARD"),m8=[xa,{provide:zr,useClass:kd},xn,Ua,{provide:qr,useFactory:LS,deps:[xn]},im,[]];let _8=(()=>{class t{constructor(e){}static forRoot(e,n){return{ngModule:t,providers:[m8,[],{provide:Kr,multi:!0,useValue:e},{provide:VS,useFactory:C8,deps:[[xn,new mc,new _c]]},{provide:Yr,useValue:n||{}},n?.useHash?{provide:bo,useClass:JR}:{provide:bo,useClass:e0},{provide:rm,useFactory:()=>{const t=F(h4),i=F(fe),e=F(Yr),n=F(Zd),o=F(zr);return e.scrollOffset&&t.setOffset(e.scrollOffset),new OS(o,n,t,i,e)}},n?.preloadingStrategy?p8(n.preloadingStrategy).\u0275providers:[],n?.initialNavigation?M8(n):[],n?.bindToComponentInputs?Xn(8,[hS,{provide:zd,useExisting:hS}]).\u0275providers:[],n?.enableViewTransitions?f8().\u0275providers:[],[{provide:HS,useFactory:RS},{provide:ba,multi:!0,useExisting:HS}]]}}static forChild(e){return{ngModule:t,providers:[{provide:Kr,multi:!0,useValue:e}]}}static{this.\u0275fac=function(n){return new(n||t)(q(VS,8))}}static{this.\u0275mod=jo({type:t})}static{this.\u0275inj=Qi({})}}return t})();function C8(t){return"guarded"}function M8(t){return["disabled"===t.initialNavigation?Xn(3,[{provide:Fg,multi:!0,useFactory:()=>{const i=F(xn);return()=>{i.setUpLocationChangeListener()}}},{provide:sm,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Xn(2,[{provide:sm,useValue:0},{provide:Fg,multi:!0,deps:[ht],useFactory:i=>{const e=i.get(YR,Promise.resolve());return()=>e.then(()=>new Promise(n=>{const o=i.get(xn),r=i.get(FS);ES(o,()=>{n(!0)}),i.get(Zd).afterPreactivation=()=>(n(!0),r.closed?Q(void 0):r),o.initialNavigation()}))}}]).\u0275providers:[]]}const HS=new j("");let w8=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-root"]],standalone:!0,features:[Ae],decls:1,vars:0,template:function(n,o){1&n&&X(0,"router-outlet")},dependencies:[Ud]})}}return t})();function Pn(...t){const i=$0(t),{args:e,keys:n}=Ew(t),o=new Qe(r=>{const{length:s}=e;if(!s)return void r.complete();const a=new Array(s);let d=s,p=s;for(let g=0;g<s;g++){let m=!1;Zn(e[g]).subscribe(tt(r,b=>{m||(m=!0,p--),a[g]=b},()=>d--,void 0,()=>{(!d||!m)&&(p||r.next(n?Ow(n,a):a),r.complete())}))}});return i?o.pipe(Aw(i)):o}let jS=(()=>{class t{constructor(e,n){this._renderer=e,this._elementRef=n,this.onChange=o=>{},this.onTouched=()=>{}}setProperty(e,n){this._renderer.setProperty(this._elementRef.nativeElement,e,n)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static{this.\u0275fac=function(n){return new(n||t)(R(ui),R(Zt))}}static{this.\u0275dir=ee({type:t})}}return t})(),No=(()=>{class t extends jS{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,features:[ye]})}}return t})();const ei=new j(""),S8={provide:ei,useExisting:Se(()=>Jr),multi:!0};let Jr=(()=>{class t extends No{writeValue(e){this.setProperty("checked",e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,o){1&n&&M("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},features:[Re([S8]),ye]})}}return t})();const x8={provide:ei,useExisting:Se(()=>qe),multi:!0},D8=new j("");let qe=(()=>{class t extends jS{constructor(e,n,o){super(e,n),this._compositionMode=o,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function P8(){const t=Li()?Li().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static{this.\u0275fac=function(n){return new(n||t)(R(ui),R(Zt),R(D8,8))}}static{this.\u0275dir=ee({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){1&n&&M("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},features:[Re([x8]),ye]})}}return t})();function ji(t){return null==t||("string"==typeof t||Array.isArray(t))&&0===t.length}const It=new j(""),Ui=new j("");function $S(t){return ji(t.value)?{required:!0}:null}function Kd(t){return null}function KS(t){return null!=t}function JS(t){return va(t)?dt(t):t}function XS(t){let i={};return t.forEach(e=>{i=null!=e?{...i,...e}:i}),0===Object.keys(i).length?null:i}function ex(t,i){return i.map(e=>e(t))}function tx(t){return t.map(i=>function T8(t){return!t.validate}(i)?i:e=>i.validate(e))}function am(t){return null!=t?function nx(t){if(!t)return null;const i=t.filter(KS);return 0==i.length?null:function(e){return XS(ex(e,i))}}(tx(t)):null}function cm(t){return null!=t?function ix(t){if(!t)return null;const i=t.filter(KS);return 0==i.length?null:function(e){return Pn(ex(e,i).map(JS)).pipe(le(XS))}}(tx(t)):null}function ox(t,i){return null===t?[i]:Array.isArray(t)?[...t,i]:[t,i]}function lm(t){return t?Array.isArray(t)?t:[t]:[]}function Jd(t,i){return Array.isArray(t)?t.includes(i):t===i}function ax(t,i){const e=lm(i);return lm(t).forEach(o=>{Jd(e,o)||e.push(o)}),e}function cx(t,i){return lm(i).filter(e=>!Jd(t,e))}class lx{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(i){this._rawValidators=i||[],this._composedValidatorFn=am(this._rawValidators)}_setAsyncValidators(i){this._rawAsyncValidators=i||[],this._composedAsyncValidatorFn=cm(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(i){this._onDestroyCallbacks.push(i)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(i=>i()),this._onDestroyCallbacks=[]}reset(i=void 0){this.control&&this.control.reset(i)}hasError(i,e){return!!this.control&&this.control.hasError(i,e)}getError(i,e){return this.control?this.control.getError(i,e):null}}class Rt extends lx{get formDirective(){return null}get path(){return null}}class zi extends lx{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class dx{constructor(i){this._cd=i}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let We=(()=>{class t extends dx{constructor(e){super(e)}static{this.\u0275fac=function(n){return new(n||t)(R(zi,2))}}static{this.\u0275dir=ee({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){2&n&&Ce("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},features:[ye]})}}return t})(),dm=(()=>{class t extends dx{constructor(e){super(e)}static{this.\u0275fac=function(n){return new(n||t)(R(Rt,10))}}static{this.\u0275dir=ee({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,o){2&n&&Ce("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},features:[ye]})}}return t})();const Qa="VALID",eu="INVALID",Xr="PENDING",Za="DISABLED";class es{}class hx extends es{constructor(i,e){super(),this.value=i,this.source=e}}class pm extends es{constructor(i,e){super(),this.pristine=i,this.source=e}}class gm extends es{constructor(i,e){super(),this.touched=i,this.source=e}}class tu extends es{constructor(i,e){super(),this.status=i,this.source=e}}function fm(t){return(nu(t)?t.validators:t)||null}function mm(t,i){return(nu(i)?i.asyncValidators:t)||null}function nu(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class _m{constructor(i,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Sa(()=>this.statusReactive()),this.statusReactive=hr(void 0),this._pristine=Sa(()=>this.pristineReactive()),this.pristineReactive=hr(!0),this._touched=Sa(()=>this.touchedReactive()),this.touchedReactive=hr(!1),this._events=new zt,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(i),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(i){this._rawValidators=this._composedValidatorFn=i}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(i){this._rawAsyncValidators=this._composedAsyncValidatorFn=i}get parent(){return this._parent}get status(){return Qn(this.statusReactive)}set status(i){Qn(()=>this.statusReactive.set(i))}get valid(){return this.status===Qa}get invalid(){return this.status===eu}get pending(){return this.status==Xr}get disabled(){return this.status===Za}get enabled(){return this.status!==Za}get pristine(){return Qn(this.pristineReactive)}set pristine(i){Qn(()=>this.pristineReactive.set(i))}get dirty(){return!this.pristine}get touched(){return Qn(this.touchedReactive)}set touched(i){Qn(()=>this.touchedReactive.set(i))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(i){this._assignValidators(i)}setAsyncValidators(i){this._assignAsyncValidators(i)}addValidators(i){this.setValidators(ax(i,this._rawValidators))}addAsyncValidators(i){this.setAsyncValidators(ax(i,this._rawAsyncValidators))}removeValidators(i){this.setValidators(cx(i,this._rawValidators))}removeAsyncValidators(i){this.setAsyncValidators(cx(i,this._rawAsyncValidators))}hasValidator(i){return Jd(this._rawValidators,i)}hasAsyncValidator(i){return Jd(this._rawAsyncValidators,i)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(i={}){const e=!1===this.touched;this.touched=!0;const n=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsTouched({...i,sourceControl:n}),e&&!1!==i.emitEvent&&this._events.next(new gm(!0,n))}markAllAsTouched(i={}){this.markAsTouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(i))}markAsUntouched(i={}){const e=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const n=i.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:n})}),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,n),e&&!1!==i.emitEvent&&this._events.next(new gm(!1,n))}markAsDirty(i={}){const e=!0===this.pristine;this.pristine=!1;const n=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsDirty({...i,sourceControl:n}),e&&!1!==i.emitEvent&&this._events.next(new pm(!1,n))}markAsPristine(i={}){const e=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const n=i.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:i.emitEvent})}),this._parent&&!i.onlySelf&&this._parent._updatePristine(i,n),e&&!1!==i.emitEvent&&this._events.next(new pm(!0,n))}markAsPending(i={}){this.status=Xr;const e=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new tu(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.markAsPending({...i,sourceControl:e})}disable(i={}){const e=this._parentMarkedDirty(i.onlySelf);this.status=Za,this.errors=null,this._forEachChild(o=>{o.disable({...i,onlySelf:!0})}),this._updateValue();const n=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new hx(this.value,n)),this._events.next(new tu(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...i,skipPristineCheck:e},this),this._onDisabledChange.forEach(o=>o(!0))}enable(i={}){const e=this._parentMarkedDirty(i.onlySelf);this.status=Qa,this._forEachChild(n=>{n.enable({...i,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent}),this._updateAncestors({...i,skipPristineCheck:e},this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(i,e){this._parent&&!i.onlySelf&&(this._parent.updateValueAndValidity(i),i.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(i){this._parent=i}getRawValue(){return this.value}updateValueAndValidity(i={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Qa||this.status===Xr)&&this._runAsyncValidator(n,i.emitEvent)}const e=i.sourceControl??this;!1!==i.emitEvent&&(this._events.next(new hx(this.value,e)),this._events.next(new tu(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.updateValueAndValidity({...i,sourceControl:e})}_updateTreeValidity(i={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(i)),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Za:Qa}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(i,e){if(this.asyncValidator){this.status=Xr,this._hasOwnPendingAsyncValidator={emitEvent:!1!==e};const n=JS(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:i})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const i=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,i}return!1}setErrors(i,e={}){this.errors=i,this._updateControlsErrors(!1!==e.emitEvent,this,e.shouldHaveEmitted)}get(i){let e=i;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((n,o)=>n&&n._find(o),this)}getError(i,e){const n=e?this.get(e):this;return n&&n.errors?n.errors[i]:null}hasError(i,e){return!!this.getError(i,e)}get root(){let i=this;for(;i._parent;)i=i._parent;return i}_updateControlsErrors(i,e,n){this.status=this._calculateStatus(),i&&this.statusChanges.emit(this.status),(i||n)&&this._events.next(new tu(this.status,e)),this._parent&&this._parent._updateControlsErrors(i,e,n)}_initObservables(){this.valueChanges=new Fe,this.statusChanges=new Fe}_calculateStatus(){return this._allControlsDisabled()?Za:this.errors?eu:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Xr)?Xr:this._anyControlsHaveStatus(eu)?eu:Qa}_anyControlsHaveStatus(i){return this._anyControls(e=>e.status===i)}_anyControlsDirty(){return this._anyControls(i=>i.dirty)}_anyControlsTouched(){return this._anyControls(i=>i.touched)}_updatePristine(i,e){const n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!i.onlySelf&&this._parent._updatePristine(i,e),o&&this._events.next(new pm(this.pristine,e))}_updateTouched(i={},e){this.touched=this._anyControlsTouched(),this._events.next(new gm(this.touched,e)),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,e)}_registerOnCollectionChange(i){this._onCollectionChange=i}_setUpdateStrategy(i){nu(i)&&null!=i.updateOn&&(this._updateOn=i.updateOn)}_parentMarkedDirty(i){return!i&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(i){return null}_assignValidators(i){this._rawValidators=Array.isArray(i)?i.slice():i,this._composedValidatorFn=function F8(t){return Array.isArray(t)?am(t):t||null}(this._rawValidators)}_assignAsyncValidators(i){this._rawAsyncValidators=Array.isArray(i)?i.slice():i,this._composedAsyncValidatorFn=function B8(t){return Array.isArray(t)?cm(t):t||null}(this._rawAsyncValidators)}}class vm extends _m{constructor(i,e,n){super(fm(e),mm(n,e)),this.controls=i,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(i,e){return this.controls[i]?this.controls[i]:(this.controls[i]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(i,e,n={}){this.registerControl(i,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(i,e={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(i,e,n={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],e&&this.registerControl(i,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(i){return this.controls.hasOwnProperty(i)&&this.controls[i].enabled}setValue(i,e={}){(function gx(t,i,e){t._forEachChild((n,o)=>{if(void 0===e[o])throw new B(1002,"")})})(this,0,i),Object.keys(i).forEach(n=>{(function px(t,i,e){const n=t.controls;if(!(i?Object.keys(n):n).length)throw new B(1e3,"");if(!n[e])throw new B(1001,"")})(this,!0,n),this.controls[n].setValue(i[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(i,e={}){null!=i&&(Object.keys(i).forEach(n=>{const o=this.controls[n];o&&o.patchValue(i[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(i={},e={}){this._forEachChild((n,o)=>{n.reset(i?i[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(i,e,n)=>(i[n]=e.getRawValue(),i))}_syncPendingControls(){let i=this._reduceChildren(!1,(e,n)=>!!n._syncPendingControls()||e);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){Object.keys(this.controls).forEach(e=>{const n=this.controls[e];n&&i(n,e)})}_setUpControls(){this._forEachChild(i=>{i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(i){for(const[e,n]of Object.entries(this.controls))if(this.contains(e)&&i(n))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,n,o)=>((n.enabled||this.disabled)&&(e[o]=n.value),e))}_reduceChildren(i,e){let n=i;return this._forEachChild((o,r)=>{n=e(n,o,r)}),n}_allControlsDisabled(){for(const i of Object.keys(this.controls))if(this.controls[i].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(i){return this.controls.hasOwnProperty(i)?this.controls[i]:null}}const ts=new j("CallSetDisabledState",{providedIn:"root",factory:()=>iu}),iu="always";function Ya(t,i,e=iu){bm(t,i),i.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&i.valueAccessor.setDisabledState?.(t.disabled),function j8(t,i){i.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&fx(t,i)})}(t,i),function z8(t,i){const e=(n,o)=>{i.valueAccessor.writeValue(n),o&&i.viewToModelUpdate(n)};t.registerOnChange(e),i._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,i),function U8(t,i){i.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&fx(t,i),"submit"!==t.updateOn&&t.markAsTouched()})}(t,i),function H8(t,i){if(i.valueAccessor.setDisabledState){const e=n=>{i.valueAccessor.setDisabledState(n)};t.registerOnDisabledChange(e),i._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,i)}function su(t,i){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(i)})}function bm(t,i){const e=function rx(t){return t._rawValidators}(t);null!==i.validator?t.setValidators(ox(e,i.validator)):"function"==typeof e&&t.setValidators([e]);const n=function sx(t){return t._rawAsyncValidators}(t);null!==i.asyncValidator?t.setAsyncValidators(ox(n,i.asyncValidator)):"function"==typeof n&&t.setAsyncValidators([n]);const o=()=>t.updateValueAndValidity();su(i._rawValidators,o),su(i._rawAsyncValidators,o)}function fx(t,i){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),i.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}const Q8={provide:Rt,useExisting:Se(()=>Ja)},Ka=Promise.resolve();let Ja=(()=>{class t extends Rt{get submitted(){return Qn(this.submittedReactive)}constructor(e,n,o){super(),this.callSetDisabledState=o,this._submitted=Sa(()=>this.submittedReactive()),this.submittedReactive=hr(!1),this._directives=new Set,this.ngSubmit=new Fe,this.form=new vm({},am(e),cm(n))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Ka.then(()=>{const n=this._findContainer(e.path);e.control=n.registerControl(e.name,e.control),Ya(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Ka.then(()=>{const n=this._findContainer(e.path);n&&n.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Ka.then(()=>{const n=this._findContainer(e.path),o=new vm({});(function mx(t,i){bm(t,i)})(o,e),n.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Ka.then(()=>{const n=this._findContainer(e.path);n&&n.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,n){Ka.then(()=>{this.form.get(e.path).setValue(n)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),function _x(t,i){t._syncPendingControls(),i.forEach(e=>{const n=e.control;"submit"===n.updateOn&&n._pendingChange&&(e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static{this.\u0275fac=function(n){return new(n||t)(R(It,10),R(Ui,10),R(ts,8))}}static{this.\u0275dir=ee({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,o){1&n&&M("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Re([Q8]),ye]})}}return t})();function vx(t,i){const e=t.indexOf(i);e>-1&&t.splice(e,1)}function bx(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const yx=class extends _m{constructor(i=null,e,n){super(fm(e),mm(n,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(i),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),nu(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=bx(i)?i.value:i)}setValue(i,e={}){this.value=this._pendingValue=i,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(i,e={}){this.setValue(i,e)}reset(i=this.defaultValue,e={}){this._applyFormState(i),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(i){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(i){this._onChange.push(i)}_unregisterOnChange(i){vx(this._onChange,i)}registerOnDisabledChange(i){this._onDisabledChange.push(i)}_unregisterOnDisabledChange(i){vx(this._onDisabledChange,i)}_forEachChild(i){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(i){bx(i)?(this.value=this._pendingValue=i.value,i.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=i}},K8={provide:zi,useExisting:Se(()=>He)},Ix=Promise.resolve();let He=(()=>{class t extends zi{constructor(e,n,o,r,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this.control=new yx,this._registered=!1,this.name="",this.update=new Fe,this._parent=e,this._setValidators(n),this._setAsyncValidators(o),this.valueAccessor=function Mm(t,i){if(!i)return null;let e,n,o;return Array.isArray(i),i.forEach(r=>{r.constructor===qe?e=r:function q8(t){return Object.getPrototypeOf(t.constructor)===No}(r)?n=r:o=r}),o||n||e||null}(0,r)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const n=e.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),function Cm(t,i){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(i,e.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Ya(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){Ix.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const n=e.isDisabled.currentValue,o=0!==n&&Lr(n);Ix.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function ou(t,i){return[...i.path,t]}(e,this._parent):[e]}static{this.\u0275fac=function(n){return new(n||t)(R(Rt,9),R(It,10),R(Ui,10),R(ei,10),R(Ca,8),R(ts,8))}}static{this.\u0275dir=ee({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Re([K8]),ye,sn]})}}return t})(),Im=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=ee({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return t})();const J8={provide:ei,useExisting:Se(()=>on),multi:!0};let on=(()=>{class t extends No{writeValue(e){this.setProperty("value",e??"")}registerOnChange(e){this.onChange=n=>{e(""==n?null:parseFloat(n))}}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,o){1&n&&M("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},features:[Re([J8]),ye]})}}return t})();const X8={provide:ei,useExisting:Se(()=>cu),multi:!0};let eH=(()=>{class t{constructor(){this._accessors=[]}add(e,n){this._accessors.push([e,n])}remove(e){for(let n=this._accessors.length-1;n>=0;--n)if(this._accessors[n][1]===e)return void this._accessors.splice(n,1)}select(e){this._accessors.forEach(n=>{this._isSameGroup(n,e)&&n[1]!==e&&n[1].fireUncheck(e.value)})}_isSameGroup(e,n){return!!e[0].control&&e[0]._parent===n._control._parent&&e[1].name===n.name}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})(),cu=(()=>{class t extends No{constructor(e,n,o,r){super(e,n),this._registry=o,this._injector=r,this.setDisabledStateFired=!1,this.onChange=()=>{},this.callSetDisabledState=F(ts,{optional:!0})??iu}ngOnInit(){this._control=this._injector.get(zi),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||"whenDisabledForLegacyCode"===this.callSetDisabledState)&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}static{this.\u0275fac=function(n){return new(n||t)(R(ui),R(Zt),R(eH),R(ht))}}static{this.\u0275dir=ee({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(n,o){1&n&&M("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[Re([X8]),ye]})}}return t})();const aH={provide:ei,useExisting:Se(()=>vt),multi:!0};function Nx(t,i){return null==t?`${i}`:(i&&"object"==typeof i&&(i="Object"),`${t}: ${i}`.slice(0,50))}let vt=(()=>{class t extends No{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const o=Nx(this._getOptionId(e),e);this.setProperty("value",o)}registerOnChange(e){this.onChange=n=>{this.value=this._getOptionValue(n),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),e))return n;return null}_getOptionValue(e){const n=function cH(t){return t.split(":")[0]}(e);return this._optionMap.has(n)?this._optionMap.get(n):e}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,o){1&n&&M("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},features:[Re([aH]),ye]})}}return t})(),wt=(()=>{class t{constructor(e,n,o){this._element=e,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(Nx(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(n){return new(n||t)(R(Zt),R(ui),R(vt,9))}}static{this.\u0275dir=ee({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return t})();const lH={provide:ei,useExisting:Se(()=>lu),multi:!0};function Tx(t,i){return null==t?`${i}`:("string"==typeof i&&(i=`'${i}'`),i&&"object"==typeof i&&(i="Object"),`${t}: ${i}`.slice(0,50))}let lu=(()=>{class t extends No{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let n;if(this.value=e,Array.isArray(e)){const o=e.map(r=>this._getOptionId(r));n=(r,s)=>{r._setSelected(o.indexOf(s.toString())>-1)}}else n=(o,r)=>{o._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(e){this.onChange=n=>{const o=[],r=n.selectedOptions;if(void 0!==r){const s=r;for(let a=0;a<s.length;a++){const p=this._getOptionValue(s[a].value);o.push(p)}}else{const s=n.options;for(let a=0;a<s.length;a++){const d=s[a];if(d.selected){const p=this._getOptionValue(d.value);o.push(p)}}}this.value=o,e(o)}}_registerOption(e){const n=(this._idCounter++).toString();return this._optionMap.set(n,e),n}_getOptionId(e){for(const n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,e))return n;return null}_getOptionValue(e){const n=function dH(t){return t.split(":")[0]}(e);return this._optionMap.has(n)?this._optionMap.get(n)._value:e}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,o){1&n&&M("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},features:[Re([lH]),ye]})}}return t})(),St=(()=>{class t{constructor(e,n,o){this._element=e,this._renderer=n,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(Tx(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Tx(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(n){return new(n||t)(R(Zt),R(ui),R(lu,9))}}static{this.\u0275dir=ee({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return t})();function Ex(t){return"number"==typeof t?t:parseFloat(t)}let To=(()=>{class t{constructor(){this._validator=Kd}ngOnChanges(e){if(this.inputName in e){const n=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(n),this._validator=this._enabled?this.createValidator(n):Kd,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return null!=e}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=ee({type:t,features:[sn]})}}return t})();const uH={provide:It,useExisting:Se(()=>du),multi:!0};let du=(()=>{class t extends To{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=e=>Ex(e),this.createValidator=e=>function GS(t){return i=>{if(ji(i.value)||ji(t))return null;const e=parseFloat(i.value);return!isNaN(e)&&e>t?{max:{max:t,actual:i.value}}:null}}(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Hn("max",o._enabled?o.max:null)},inputs:{max:"max"},features:[Re([uH]),ye]})}}return t})();const hH={provide:It,useExisting:Se(()=>Gi),multi:!0};let Gi=(()=>{class t extends To{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=e=>Ex(e),this.createValidator=e=>function zS(t){return i=>{if(ji(i.value)||ji(t))return null;const e=parseFloat(i.value);return!isNaN(e)&&e<t?{min:{min:t,actual:i.value}}:null}}(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Hn("min",o._enabled?o.min:null)},inputs:{min:"min"},features:[Re([hH]),ye]})}}return t})();const pH={provide:It,useExisting:Se(()=>Dn),multi:!0};let Dn=(()=>{class t extends To{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=Lr,this.createValidator=e=>$S}enabled(e){return e}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,o){2&n&&Hn("required",o._enabled?"":null)},inputs:{required:"required"},features:[Re([pH]),ye]})}}return t})();const _H={provide:It,useExisting:Se(()=>Pm),multi:!0};let Pm=(()=>{class t extends To{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=e=>function kx(t){return"number"==typeof t?t:parseInt(t,10)}(e),this.createValidator=e=>function ZS(t){return i=>function US(t){return null!=t&&"number"==typeof t.length}(i.value)&&i.value.length>t?{maxlength:{requiredLength:t,actualLength:i.value.length}}:null}(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Hn("maxlength",o._enabled?o.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Re([_H]),ye]})}}return t})();const vH={provide:It,useExisting:Se(()=>Dm),multi:!0};let Dm=(()=>{class t extends To{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=e=>e,this.createValidator=e=>function YS(t){if(!t)return Kd;let i,e;return"string"==typeof t?(e="","^"!==t.charAt(0)&&(e+="^"),e+=t,"$"!==t.charAt(t.length-1)&&(e+="$"),i=new RegExp(e)):(e=t.toString(),i=t),n=>{if(ji(n.value))return null;const o=n.value;return i.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=ut(t)))(o||t)}})()}static{this.\u0275dir=ee({type:t,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Hn("pattern",o._enabled?o.pattern:null)},inputs:{pattern:"pattern"},features:[Re([vH]),ye]})}}return t})(),bH=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=jo({type:t})}static{this.\u0275inj=Qi({})}}return t})(),et=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:ts,useValue:e.callSetDisabledState??iu}]}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=jo({type:t})}static{this.\u0275inj=Qi({imports:[bH]})}}return t})(),CH=(()=>{class t{constructor(e){this.http=e,this.username="",this.password=""}login(){this.http.post("http://localhost:3000/api/auth/login",{username:this.username,password:this.password}).subscribe({next:e=>{const o=e.email,r=e.role,s=e.token,a=e.branches,d=e.originLocIds,p=e.branchNames,g=e.GSTIN,m=e.GSTIN_ID;localStorage.setItem("username",e.username),localStorage.setItem("email",o),r&&localStorage.setItem("role",r),s&&localStorage.setItem("token",s),g&&localStorage.setItem("GSTIN",g),null!=m&&localStorage.setItem("GSTIN_ID",String(m)),Array.isArray(p)?localStorage.setItem("branches",JSON.stringify(p)):Array.isArray(a)&&localStorage.setItem("branches",JSON.stringify(a)),Array.isArray(d)&&localStorage.setItem("originLocIds",JSON.stringify(d)),localStorage.setItem("branch","All Branches"),localStorage.setItem("originLocId","all"),console.log("\u2705 Login successful for user:",localStorage.getItem("companyType")),this.http.get("http://localhost:3000/api/branches").subscribe({next:b=>{window.location.href=b&&0!==b.length?"/home/dashboard":"/home/Branches"},error:()=>{window.location.href="/home/Branches"}})},error:e=>{console.error(e),alert("Invalid credentials")}})}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-login"]],standalone:!0,features:[Ae],decls:8,vars:2,consts:[[1,"login-container"],[3,"ngSubmit"],["type","text","placeholder","Username","name","username","required","",3,"ngModelChange","ngModel"],["type","password","placeholder","Password","name","password","required","",3,"ngModelChange","ngModel"],["type","submit"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Login"),c(),l(3,"form",1),M("ngSubmit",function(){return o.login()}),l(4,"input",2),S("ngModelChange",function(s){return x(o.username,s)||(o.username=s),s}),c(),l(5,"input",3),S("ngModelChange",function(s){return x(o.password,s)||(o.password=s),s}),c(),l(6,"button",4),u(7,"Login"),c()()()),2&n&&(h(4),w("ngModel",o.username),h(),w("ngModel",o.password))},dependencies:[pt,et,Im,qe,We,dm,Dn,He,Ja],styles:[".login-container[_ngcontent-%COMP%]{width:300px;margin:100px auto;padding:20px;border:1px solid #ddd;border-radius:10px;text-align:center}.login-container[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:90%;margin:10px 0;padding:8px}.login-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:10px;background:#1976d2;color:#fff;border:none;cursor:pointer}"]})}}return t})(),Xa=(()=>{class t{constructor(){this.branchSubject=new Gt(localStorage.getItem("branch")||"All Branches"),this.branch$=this.branchSubject.asObservable()}get currentBranch(){return this.branchSubject.value}setBranch(e){e!==this.branchSubject.value&&(this.branchSubject.next(e),localStorage.setItem("branch",e))}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=z({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function MH(t,i){if(1&t&&(l(0,"option",24),u(1),c()),2&t){const e=i.$implicit;C("value",e.id),h(),N(e.name)}}function IH(t,i){1&t&&(l(0,"ul",25)(1,"li")(2,"a",26),u(3,"View Shipments"),c()(),l(4,"li")(5,"a",27),u(6,"Stocks"),c()(),l(7,"li")(8,"a",28),u(9,"Manifest"),c()(),l(10,"li")(11,"a",29),u(12,"Branch Vehicles"),c()(),l(13,"li")(14,"a",30),u(15,"Delivered/Pre-Invoice"),c()(),l(16,"li")(17,"a",31),u(18,"Invoiced"),c()()())}function wH(t,i){1&t&&(l(0,"ul",25)(1,"li")(2,"a",33),u(3,"Clients"),c()(),l(4,"li")(5,"a",34),u(6,"Guests"),c()(),l(7,"li")(8,"a",35),u(9,"Branches"),c()(),l(10,"li")(11,"a",36),u(12,"Hubs"),c()(),l(13,"li")(14,"a",37),u(15,"Transport Partners"),c()(),l(16,"li")(17,"a",38),u(18,"Payments"),c()(),l(19,"li")(20,"a",39),u(21,"Running cost"),c()(),l(22,"li")(23,"a",40),u(24,"Packages"),c()(),l(25,"li")(26,"a",41),u(27,"Products"),c()(),l(28,"li")(29,"a",42),u(30,"Roles Settings"),c()()())}function SH(t,i){if(1&t){const e=O();zn(0),l(1,"li",11),M("click",function(){return _(e),v(f().toggleMenu("admin"))}),l(2,"span"),X(3,"i",32),u(4," Admin"),c(),X(5,"i",13),c(),D(6,wH,31,0,"ul",14),Gn()}if(2&t){const e=f();h(6),C("ngIf",e.showAdmin)}}function xH(t,i){1&t&&(l(0,"li",43)(1,"span"),X(2,"i",32),u(3," Admin (No privileges)"),c()())}function PH(t,i){1&t&&(l(0,"ul",25)(1,"li")(2,"a",44),u(3,"Configuration"),c()(),l(4,"li")(5,"a",45),u(6,"Logs"),c()(),l(7,"li")(8,"a",46),u(9,"Locations"),c()()())}function DH(t,i){1&t&&(l(0,"ul",25)(1,"li")(2,"a",47),u(3,"My Profile"),c()(),l(4,"li")(5,"a",48),u(6,"Change Password"),c()(),l(7,"li")(8,"a",49),u(9,"Roles"),c()()())}function NH(t,i){if(1&t){const e=O();l(0,"div",50)(1,"div",51)(2,"h3"),u(3,"Log out?"),c(),l(4,"p"),u(5,"Are you sure you want to end this session?"),c(),l(6,"div",52)(7,"button",53),M("click",function(){return _(e),v(f().closeLogoutModal())}),u(8,"Cancel"),c(),l(9,"button",54),M("click",function(){return _(e),v(f().confirmLogout())}),u(10,"Log out"),c()()()()}}let TH=(()=>{class t{constructor(e,n){this.http=e,this.branchService=n,this.username=localStorage.getItem("username"),this.email=localStorage.getItem("email"),this.role=localStorage.getItem("role"),this.isAdmin="admin"===String(localStorage.getItem("role")||"").toLowerCase(),this.showShipments=!1,this.showAdmin=!1,this.showSettings=!1,this.showProfile=!1,this.branchOptions=[],this.selectedoriginLocId=localStorage.getItem("originLocId")||"",this.selectedBranchName=localStorage.getItem("branch")||"",this.showLogoutModal=!1}ngOnInit(){if(this.isAdmin&&this.username)return this.http.get(`http://localhost:3000/api/branches/by-user/${this.username}`).subscribe(e=>{const n=(e||[]).map(o=>({id:String(o?._id||""),name:String(o?.branchName||"")})).filter(o=>o.name);this.branchOptions=[{id:"all",name:"All Branches"},{id:"all-hubs",name:"All Hubs"},...n.filter(o=>"All Branches"!==o.name&&"All Hubs"!==o.name)],this.syncSelectedBranch()}),this.selectedBranchName||(this.selectedBranchName="All Branches",this.selectedoriginLocId="all",localStorage.setItem("branch",this.selectedBranchName),localStorage.setItem("originLocId",this.selectedoriginLocId)),void this.branchService.setBranch(this.selectedBranchName);try{const e=JSON.parse(localStorage.getItem("branches")||"[]"),n=JSON.parse(localStorage.getItem("originLocIds")||"[]");if(Array.isArray(e)&&Array.isArray(n)&&e.length===n.length){const o=e.map((r,s)=>({id:String(n[s]||""),name:String(r||"")}));this.branchOptions=[{id:"all",name:"All Branches"},{id:"all-hubs",name:"All Hubs"},...o.filter(r=>r.name&&"All Branches"!==r.name&&"All Hubs"!==r.name)]}else if(Array.isArray(e)){const o=e.map(r=>({id:String(r||""),name:String(r||"")}));this.branchOptions=[{id:"all",name:"All Branches"},{id:"all-hubs",name:"All Hubs"},...o.filter(r=>r.name&&"All Branches"!==r.name&&"All Hubs"!==r.name)]}}catch{this.branchOptions=[]}this.syncSelectedBranch(),!this.selectedBranchName&&this.branchOptions.length&&(this.selectedoriginLocId=this.branchOptions[0].id,this.selectedBranchName=this.branchOptions[0].name,localStorage.setItem("branch",this.selectedBranchName),localStorage.setItem("originLocId",this.selectedoriginLocId))}toggleMenu(e){"shipments"===e&&(this.showShipments=!this.showShipments),"admin"===e&&this.isAdmin&&(this.showAdmin=!this.showAdmin),"settings"===e&&(this.showSettings=!this.showSettings),"profile"===e&&(this.showProfile=!this.showProfile)}syncSelectedBranch(){if(this.branchOptions.length){if("all-hubs"===this.selectedoriginLocId||"All Hubs"===this.selectedBranchName)return this.selectedoriginLocId="all-hubs",void(this.selectedBranchName="All Hubs");if("all"===this.selectedoriginLocId||"All Branches"===this.selectedBranchName)return this.selectedoriginLocId="all",void(this.selectedBranchName="All Branches");if(this.selectedoriginLocId){const e=this.branchOptions.find(n=>n.id===this.selectedoriginLocId);if(e)return void(this.selectedBranchName=e.name)}if(this.selectedBranchName){const e=this.branchOptions.find(n=>n.name===this.selectedBranchName);if(e)return void(this.selectedoriginLocId=e.id)}this.selectedoriginLocId=this.branchOptions[0].id,this.selectedBranchName=this.branchOptions[0].name}}onBranchChange(e){const n=String(e.target.value||""),o="all"===n,r="all-hubs"===n,s=this.branchOptions.find(p=>p.id===n),a=o?"All Branches":r?"All Hubs":s?.name||n;this.selectedoriginLocId=n,this.selectedBranchName=a,localStorage.setItem("branch",a),localStorage.setItem("originLocId",n),this.branchService.setBranch(a),window.location.href.includes("/shipments")&&window.location.reload()}openLogoutModal(){this.showLogoutModal=!0}closeLogoutModal(){this.showLogoutModal=!1}confirmLogout(){this.showLogoutModal=!1,this.performLogout()}performLogout(){this.http.post("http://localhost:3000/api/auth/logout",{}).subscribe({next:()=>{localStorage.clear(),window.location.href="/"},error:()=>{localStorage.clear(),window.location.href="/"}})}static{this.\u0275fac=function(n){return new(n||t)(R(Ve),R(Xa))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-home"]],standalone:!0,features:[Ae],decls:49,vars:11,consts:[["noAdminMenu",""],[1,"container"],[1,"sidebar"],[1,"welcome"],[1,"fas","fa-user-circle"],[3,"ngModelChange","change","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["routerLink","dashboard"],[1,"fas","fa-tachometer-alt"],["routerLink","new-shipment"],[1,"fas","fa-plus-circle"],[1,"menu-item",3,"click"],[1,"fas","fa-truck"],[1,"fas","fa-caret-down"],["class","submenu",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"fas","fa-cog"],[1,"fas","fa-id-badge"],["routerLink","notifications"],[1,"fas","fa-bell"],[3,"click"],[1,"fas","fa-sign-out-alt"],[1,"content"],["class","modal-overlay",4,"ngIf"],[3,"value"],[1,"submenu"],["routerLink","shipments"],["routerLink","Stocks"],["routerLink","Manifest"],["routerLink","BranchVehicles"],["routerLink","Delivered"],["routerLink","Invoiced"],[1,"fas","fa-user-shield"],["routerLink","Clients"],["routerLink","Guests"],["routerLink","Branches"],["routerLink","Hubs"],["routerLink","Tpartners"],["routerLink","Payments"],["routerLink","Categories"],["routerLink","Pkgs"],["routerLink","Products"],["routerLink","RoleSettings"],[1,"menu-item",2,"opacity","0.55","cursor","not-allowed"],["routerLink","Configuration"],["routerLink","Logs"],["routerLink","Locations"],["routerLink","profile"],["routerLink","changePass"],["routerLink","roles"],[1,"modal-overlay"],[1,"modal-card"],[1,"modal-actions"],["type","button",1,"btn","ghost",3,"click"],["type","button",1,"btn","danger",3,"click"]],template:function(n,o){if(1&n){const r=O();l(0,"div",1)(1,"aside",2)(2,"div",3)(3,"h3"),X(4,"i",4),u(5),c(),l(6,"select",5),S("ngModelChange",function(a){return _(r),x(o.selectedoriginLocId,a)||(o.selectedoriginLocId=a),v(a)}),M("change",function(a){return _(r),v(o.onBranchChange(a))}),D(7,MH,2,2,"option",6),c()(),l(8,"ul")(9,"li")(10,"a",7),X(11,"i",8),u(12," Dashboard"),c()(),l(13,"li")(14,"a",9),X(15,"i",10),u(16," New Shipment"),c()(),l(17,"li",11),M("click",function(){return _(r),v(o.toggleMenu("shipments"))}),l(18,"span"),X(19,"i",12),u(20," Shipments"),c(),X(21,"i",13),c(),D(22,IH,19,0,"ul",14)(23,SH,7,1,"ng-container",15)(24,xH,4,0,"ng-template",null,0,qn),l(26,"li",11),M("click",function(){return _(r),v(o.toggleMenu("settings"))}),l(27,"span"),X(28,"i",16),u(29," Settings"),c(),X(30,"i",13),c(),D(31,PH,10,0,"ul",14),l(32,"li",11),M("click",function(){return _(r),v(o.toggleMenu("profile"))}),l(33,"span"),X(34,"i",17),u(35," Profile"),c(),X(36,"i",13),c(),D(37,DH,10,0,"ul",14),l(38,"li")(39,"a",18),X(40,"i",19),u(41," Notifications"),c()(),l(42,"li")(43,"a",20),M("click",function(){return _(r),v(o.openLogoutModal())}),X(44,"i",21),u(45," Logout"),c()()()(),l(46,"main",22),X(47,"router-outlet"),c()(),D(48,NH,11,0,"div",23)}if(2&n){const r=$n(25);h(5),Be(" Welcome, ",o.username,", ",o.email,""),h(),w("ngModel",o.selectedoriginLocId),C("disabled",!o.isAdmin&&o.branchOptions.length<=1),h(),C("ngForOf",o.branchOptions),h(15),C("ngIf",o.showShipments),h(),C("ngIf",o.isAdmin)("ngIfElse",r),h(8),C("ngIf",o.showSettings),h(6),C("ngIf",o.showProfile),h(11),C("ngIf",o.showLogoutModal)}},dependencies:[Ud,Yd,Xe,lt,et,wt,St,vt,We,He],styles:[".container[_ngcontent-%COMP%]{display:flex;min-height:100vh}.sidebar[_ngcontent-%COMP%]{flex:0 0 clamp(220px,20vw,280px);background:#2c3e50;color:#fff;padding:20px;height:100vh;overflow-y:auto}.content[_ngcontent-%COMP%]{flex:1 1 auto;min-width:0;overflow-x:hidden;font-size:clamp(13px,1.15vw,16px)}.content[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;table-layout:fixed;max-width:100%}.content[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{word-break:break-word;overflow-wrap:anywhere}.sidebar[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:10px;cursor:pointer;display:flex;align-items:center;justify-content:space-between}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;display:flex;align-items:center;gap:8px}.sidebar[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#34495e}.submenu[_ngcontent-%COMP%]{background:#34495e;margin-left:10px;padding-left:10px}.submenu[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px;font-size:14px}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a8c;display:flex;align-items:center;justify-content:center;z-index:2000}.modal-card[_ngcontent-%COMP%]{background:#fff;color:#0f172a;border-radius:12px;padding:20px;width:min(360px,90vw);box-shadow:0 20px 40px #0f172a33}.modal-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;font-size:18px}.modal-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 16px;color:#475569;font-size:14px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.btn[_ngcontent-%COMP%]{border:none;border-radius:8px;padding:8px 14px;cursor:pointer}.btn.ghost[_ngcontent-%COMP%]{background:#e2e8f0;color:#0f172a}.btn.danger[_ngcontent-%COMP%]{background:#ef4444;color:#fff}"]})}}return t})(),kH=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-dashboard"]],standalone:!0,features:[Ae],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Dashboard"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function EH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.hubName)}}function AH(t,i){if(1&t){const e=O();l(0,"div",43)(1,"div",44)(2,"span"),u(3,"Hub"),c(),l(4,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.selectedAllHubId,o)||(r.selectedAllHubId=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onAllHubsSelect(o.selectedAllHubId))}),l(5,"option",33),u(6,"Select hub"),c(),D(7,EH,2,2,"option",34),c()()()}if(2&t){const e=f();h(4),w("ngModel",e.selectedAllHubId),h(3),C("ngForOf",e.getAllHubsOptions())}}function OH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f(2);C("value",e.clientName),h(),k(" ",n.formatClientOption(e)," ")}}function LH(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"span",26),u(3,"Saved clients"),c(),l(4,"button",31),M("click",function(){return _(e),v(f().openClientModal())}),u(5,"+ New Client/Edit Client"),c()(),l(6,"label"),u(7,"Sender Name "),l(8,"input",64),S("ngModelChange",function(o){_(e);const r=f();return x(r.consignor,o)||(r.consignor=o),v(o)}),M("ngModelChange",function(){_(e);const o=f();return v(o.onConsignorSelect(o.consignor))}),c(),l(9,"datalist",65),D(10,OH,2,2,"option",34),c()()()}if(2&t){const e=f();h(8),w("ngModel",e.consignor),h(2),C("ngForOf",e.clientList)}}function RH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f(2);C("value",e.guestName),h(),k(" ",n.formatGuestOption(e)," ")}}function FH(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"span",26),u(3,"Guest senders"),c(),l(4,"button",31),M("click",function(){return _(e),v(f().openGuestModal())}),u(5,"+ New Guest"),c()(),l(6,"label"),u(7,"Guest Sender "),l(8,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.consignor,o)||(r.consignor=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onConsignorGuestSelect(o.consignor))}),D(9,RH,2,2,"option",34),c()()()}if(2&t){const e=f();h(8),w("ngModel",e.consignor),h(),C("ngForOf",e.guestList)}}function BH(t,i){if(1&t){const e=O();l(0,"div",25)(1,"span",26),u(2,"Selected client"),c(),l(3,"button",31),M("click",function(){return _(e),v(f(2).openPickupEditClient())}),u(4,"+ Edit address"),c()()}}function VH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=i.index,o=f(3);C("value","consignor:"+n),h(),k(" Consignor: ",o.formatLocation(e)," ")}}function HH(t,i){if(1&t&&(l(0,"optgroup",70),D(1,VH,2,2,"option",34),c()),2&t){const e=f(2);h(),C("ngForOf",e.getPickupConsignorLocations())}}function jH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=i.index,o=f(3);C("value","billing:"+n),h(),k(" Billing: ",o.formatLocation(e)," ")}}function UH(t,i){if(1&t&&(l(0,"optgroup",71),D(1,jH,2,2,"option",34),c()),2&t){const e=f(2);h(),C("ngForOf",e.getPickupBillingLocations())}}function zH(t,i){if(1&t){const e=O();l(0,"div",24),D(1,BH,5,0,"div",66),l(2,"label"),u(3,"Pickup Point "),l(4,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.pickupSource,o)||(r.pickupSource=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onPickupSourceSelect(o.pickupSource))}),l(5,"option",67),u(6),c(),D(7,HH,2,1,"optgroup",68)(8,UH,2,1,"optgroup",69),c()()()}if(2&t){const e=f();h(),C("ngIf",e.getPickupSourceClientId()),h(3),w("ngModel",e.pickupSource),h(2),k("Branch - ",e.pickupName||e.branch||"-",""),h(),C("ngIf",e.getPickupConsignorLocations().length),h(),C("ngIf",e.getPickupBillingLocations().length)}}function GH(t,i){if(1&t&&(l(0,"div")(1,"div",36)(2,"span",37),u(3,"Branch"),c(),l(4,"span",38),u(5),c()(),l(6,"div",36)(7,"span",37),u(8,"Pickup Address"),c(),l(9,"span",38),u(10),c()(),l(11,"div",36)(12,"span",37),u(13,"Pickup Phone"),c(),l(14,"span",38),u(15),c()(),l(16,"div",36)(17,"span",37),u(18,"Pickup Pincode"),c(),l(19,"span",38),u(20),c()()()),2&t){const e=f();h(5),N(e.pickupName||e.branch||"-"),h(5),N(e.pickupAddress||"-"),h(5),N(e.pickupPhone||"-"),h(5),N(e.pickupPincode||"-")}}function $H(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f(2);C("value",e.clientName),h(),k(" ",n.formatClientOption(e)," ")}}function qH(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"span",26),u(3,"Saved clients"),c(),l(4,"button",31),M("click",function(){return _(e),v(f().openClientModal())}),u(5,"+ New Client/Edit Client"),c()(),l(6,"label"),u(7,"Receiver Name "),l(8,"input",72),S("ngModelChange",function(o){_(e);const r=f();return x(r.consignee,o)||(r.consignee=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onConsigneeSelect(o.consignee))}),c(),l(9,"datalist",73),D(10,$H,2,2,"option",34),c()()()}if(2&t){const e=f();h(8),w("ngModel",e.consignee),h(2),C("ngForOf",e.clientList)}}function WH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f(2);C("value",e.guestName),h(),k(" ",n.formatGuestOption(e)," ")}}function QH(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"span",26),u(3,"Guest receivers"),c(),l(4,"button",31),M("click",function(){return _(e),v(f().openGuestModal())}),u(5,"+ New Guest"),c()(),l(6,"label"),u(7,"Guest Receiver "),l(8,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.consignee,o)||(r.consignee=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onConsigneeGuestSelect(o.consignee))}),D(9,WH,2,2,"option",34),c()()()}if(2&t){const e=f();h(8),w("ngModel",e.consignee),h(),C("ngForOf",e.guestList)}}function ZH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f();C("value",e.clientName),h(),k(" ",n.formatClientOption(e)," ")}}function YH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=i.index,o=f();C("value",n),h(),k(" ",o.formatLocation(e)," ")}}function KH(t,i){1&t&&(l(0,"option"),u(1,"To Pay with account credit"),c())}function JH(t,i){1&t&&(l(0,"option"),u(1,"Account Credit"),c())}function XH(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value","client:"+e._id),h(),k(" ",e.clientName," ")}}function e7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value","hub:"+e._id),h(),k(" ",e.hubName," ")}}function t7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value",i.index),h(),k(" ",e.label," ")}}function n7(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"span",26),u(3,"Saved clients"),c(),l(4,"button",31),M("click",function(){return _(e),v(f().openClientModal())}),u(5,"+ New Client/Edit Client"),c()(),l(6,"label"),u(7,"Billing Name "),l(8,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.billingSource,o)||(r.billingSource=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onBillingSourceSelect(o.billingSource))}),l(9,"option",33),u(10,"Select client or hub"),c(),l(11,"optgroup",74),D(12,XH,2,2,"option",34),c(),l(13,"optgroup",75),D(14,e7,2,2,"option",34),c()()(),l(15,"label"),u(16,"Billing Address "),l(17,"select",35),S("ngModelChange",function(o){_(e);const r=f();return x(r.billingLocationIndex,o)||(r.billingLocationIndex=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onBillingAddressSelect(o.billingLocationIndex))}),l(18,"option",33),u(19,"Select address"),c(),D(20,t7,2,2,"option",34),c()(),l(21,"div",36)(22,"span",37),u(23,"GSTIN"),c(),l(24,"span",38),u(25),c()(),l(26,"div",36)(27,"span",37),u(28,"Phone"),c(),l(29,"span",38),u(30),c()()()}if(2&t){const e=f();h(8),w("ngModel",e.billingSource),h(4),C("ngForOf",e.clientList),h(2),C("ngForOf",e.getAvailableHubs()),h(3),w("ngModel",e.billingLocationIndex),C("disabled",!e.billingSource),h(3),C("ngForOf",e.billingAddressOptions),h(5),N(e.billingGSTIN||"-"),h(5),N(e.billingPhone||"-")}}function i7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=i.index,o=f(2);C("value",n),h(),k(" ",o.formatLocation(e)," ")}}function o7(t,i){if(1&t){const e=O();l(0,"div",24)(1,"label"),u(2,"Consignor Address "),l(3,"select",32),S("ngModelChange",function(o){_(e);const r=f();return x(r.billingLocationIndex,o)||(r.billingLocationIndex=o),v(o)}),M("change",function(){_(e);const o=f();return v(o.onBillingLocationSelect(o.billingLocationIndex))}),l(4,"option",33),u(5,"Primary address"),c(),D(6,i7,2,2,"option",34),c()()()}if(2&t){const e=f();h(3),w("ngModel",e.billingLocationIndex),h(3),C("ngForOf",e.getConsignorLocations())}}function r7(t,i){1&t&&(l(0,"div",76),u(1," Using guest consignor details "),c())}function s7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value",e.productName),h(),Be(" ",e.hsnNum," - ",e.productName," ")}}function a7(t,i){if(1&t&&(l(0,"span",98),u(1),c()),2&t){const e=f().$implicit,n=f(3);h(),k(" Suggested: ",n.getSuggestedRate(e)," ")}}function c7(t,i){if(1&t){const e=O();l(0,"div",92)(1,"div",93)(2,"select",32),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.type,o)||(r.type=o),v(o)}),M("change",function(){const o=_(e).$implicit;return v(f(3).onProductTypeChange(o))}),D(3,s7,2,3,"option",34),c(),l(4,"input",94),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.amount,o)||(r.amount=o),v(o)}),M("ngModelChange",function(){return _(e),v(f(3).scheduleQuote())}),c(),l(5,"button",79),M("click",function(){const o=_(e).index,r=f().index,s=f().index;return v(f().deleteProduct(s,r,o))}),u(6,"\u30d0\x07"),c()(),l(7,"div",95)(8,"input",96),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.ratePer,o)||(r.ratePer=o),v(o)}),M("ngModelChange",function(){return _(e),v(f(3).scheduleQuote())}),c(),D(9,a7,2,1,"span",97),c()()}if(2&t){const e=i.$implicit,n=f(3);h(2),w("ngModel",e.type),h(),C("ngForOf",n.productList),h(),w("ngModel",e.amount),h(4),w("ngModel",e.ratePer),h(),C("ngIf",null!==n.getSuggestedRate(e))}}function l7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit;C("value",e.pkgName),h(),N(e.pkgName)}}function d7(t,i){if(1&t){const e=O();l(0,"div",93)(1,"select",99),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.type,o)||(r.type=o),v(o)}),D(2,l7,2,2,"option",34),c(),l(3,"input",94),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.amount,o)||(r.amount=o),v(o)}),M("ngModelChange",function(){return _(e),v(f(3).scheduleQuote())}),c(),l(4,"button",79),M("click",function(){const o=_(e).index,r=f().index,s=f().index;return v(f().deletePackage(s,r,o))}),u(5,"\u30d0\x07"),c()()}if(2&t){const e=i.$implicit,n=f(3);h(),w("ngModel",e.type),h(),C("ngForOf",n.pkgList),h(),w("ngModel",e.amount)}}function u7(t,i){if(1&t){const e=O();l(0,"div",84)(1,"div",78)(2,"div")(3,"div",2),u(4),c()(),l(5,"button",79),M("click",function(){const o=_(e).index,r=f().index;return v(f().deleteInvoice(r,o))}),u(6,"\u30d0\x07"),c()(),l(7,"div",80)(8,"input",85),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.number,o)||(r.number=o),v(o)}),c(),l(9,"input",86),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.value,o)||(r.value=o),v(o)}),M("ngModelChange",function(){return _(e),v(f(2).scheduleQuote())}),c()(),l(10,"div",87)(11,"div",88)(12,"div",89),u(13,"Products"),c(),l(14,"button",31),M("click",function(){return _(e),v(f(2).openProductModal())}),u(15,"+ New Product"),c()(),D(16,c7,10,5,"div",90),l(17,"button",31),M("click",function(){const o=_(e).index,r=f().index;return v(f().addProduct(r,o))}),u(18,"+ Product"),c()(),l(19,"div",87)(20,"div",89),u(21,"Packages"),c(),D(22,d7,6,3,"div",91),l(23,"button",31),M("click",function(){const o=_(e).index,r=f().index;return v(f().addPackage(r,o))}),u(24,"+ Package"),c()()()}if(2&t){const e=i.$implicit,n=i.index;h(4),k("Invoice ",n+1,""),h(4),w("ngModel",e.number),h(),w("ngModel",e.value),h(7),C("ngForOf",e.products),h(6),C("ngForOf",e.packages)}}function h7(t,i){if(1&t){const e=O();l(0,"div",77)(1,"div",78)(2,"div",2),u(3),c(),l(4,"button",79),M("click",function(){const o=_(e).index;return v(f().deleteEwaybill(o))}),u(5,"\u30d0\x07"),c()(),l(6,"div",80)(7,"input",81),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.number,o)||(r.number=o),v(o)}),c(),l(8,"input",6),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.date,o)||(r.date=o),v(o)}),c()(),D(9,u7,25,5,"div",82),l(10,"button",83),M("click",function(){const o=_(e).index;return v(f().addInvoice(o))}),u(11,"+ Invoice"),c()()}if(2&t){const e=i.$implicit,n=i.index;h(3),k("E-Waybill ",n+1,""),h(4),w("ngModel",e.number),h(),w("ngModel",e.date),h(),C("ngForOf",e.invoices)}}function p7(t,i){if(1&t){const e=O();l(0,"div",100)(1,"div",101)(2,"div",102)(3,"h3"),u(4,"Final Amount is 0"),c(),l(5,"button",79),M("click",function(){return _(e),v(f().cancelFinalAmountSave())}),u(6,"x"),c()(),l(7,"p",76),u(8,"Do you want to continue saving?"),c(),l(9,"div",103)(10,"button",20),M("click",function(){return _(e),v(f().cancelFinalAmountSave())}),u(11,"Cancel"),c(),l(12,"button",20),M("click",function(){return _(e),v(f().confirmFinalAmountSave())}),u(13,"Continue"),c()()()()}}function g7(t,i){if(1&t){const e=O();l(0,"div",107)(1,"div",108)(2,"strong"),u(3),c(),l(4,"span"),u(5),c(),l(6,"span"),u(7),c()(),l(8,"div",109)(9,"label",110)(10,"input",28),M("change",function(o){return v(_(e).$implicit.action=o.target.checked?"suggest":"override")}),c(),l(11,"span",29),X(12,"span",30),c()()()()}if(2&t){const e=i.$implicit;h(3),N(e.productName),h(2),k("Suggested: ",null==e.suggestedRate?"-":e.suggestedRate,""),h(2),k("Entered: ",e.enteredRate,""),h(3),C("checked","suggest"===e.action)}}function f7(t,i){if(1&t){const e=O();l(0,"div",100)(1,"div",101)(2,"div",102)(3,"h3"),u(4,"Override Suggested Rates"),c(),l(5,"button",79),M("click",function(){return _(e),v(f().showRateOverrideModal=!1)}),u(6,"x"),c()(),l(7,"p",76),u(8),c(),l(9,"div",104)(10,"div",105)(11,"span"),u(12,"Products"),c(),l(13,"span"),u(14,"Save as new suggested"),c()(),D(15,g7,13,4,"div",106),c(),l(16,"div",103)(17,"button",20),M("click",function(){return _(e),v(f().confirmRateOverride())}),u(18,"OK"),c()()()()}if(2&t){const e=f();h(8),k("GSTIN ID: ",e.getPricingGstinId(),""),h(7),C("ngForOf",e.rateOverrides)}}function m7(t,i){if(1&t){const e=O();l(0,"div",117)(1,"input",118),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pickupLocationId,o)||(r.pickupLocationId=o),v(o)}),c(),l(2,"input",119),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveryLocationId,o)||(r.deliveryLocationId=o),v(o)}),c(),l(3,"input",120),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerNum,o)||(r.rate.ratePerNum=o),v(o)}),c(),l(4,"input",121),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerVolume,o)||(r.rate.ratePerVolume=o),v(o)}),c(),l(5,"input",122),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerKg,o)||(r.rate.ratePerKg=o),v(o)}),c(),l(6,"button",114),M("click",function(){const o=_(e).index;return v(f(2).removeProductRateRow(o))}),u(7,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.pickupLocationId),h(),w("ngModel",e.deliveryLocationId),h(),w("ngModel",e.rate.ratePerNum),h(),w("ngModel",e.rate.ratePerVolume),h(),w("ngModel",e.rate.ratePerKg)}}function _7(t,i){if(1&t&&X(0,"option",123),2&t){const e=i.$implicit;C("value",e.id)("label",e.label)}}function v7(t,i){if(1&t){const e=O();l(0,"div",100)(1,"div",111)(2,"div",102)(3,"h3"),u(4,"Add Product"),c(),l(5,"button",112),M("click",function(){return _(e),v(f().closeProductModal())}),u(6,"x"),c()(),l(7,"label"),u(8,"HSN Number* "),l(9,"input",99),S("ngModelChange",function(o){_(e);const r=f();return x(r.newProduct.hsnNum,o)||(r.newProduct.hsnNum=o),v(o)}),c()(),l(10,"label"),u(11,"Product Name* "),l(12,"input",99),S("ngModelChange",function(o){_(e);const r=f();return x(r.newProduct.productName,o)||(r.newProduct.productName=o),v(o)}),c()(),l(13,"h4"),u(14,"Rates by Route"),c(),D(15,m7,8,5,"div",113),l(16,"button",114),M("click",function(){return _(e),v(f().addProductRateRow())}),u(17,"+ Add Rate"),c(),l(18,"datalist",115),D(19,_7,1,2,"option",116),c(),l(20,"div",103)(21,"button",20),M("click",function(){return _(e),v(f().saveNewProduct())}),u(22,"Save"),c(),l(23,"button",20),M("click",function(){return _(e),v(f().closeProductModal())}),u(24,"Cancel"),c()()()()}if(2&t){const e=f();h(9),w("ngModel",e.newProduct.hsnNum),h(3),w("ngModel",e.newProduct.productName),h(3),C("ngForOf",e.newProduct.rates),h(4),C("ngForOf",e.rateAddressOptions)}}function b7(t,i){if(1&t){const e=O();l(0,"div",125)(1,"button",20),M("click",function(){return _(e),v(f(2).setClientModalTab("add"))}),u(2,"New Client"),c(),l(3,"button",20),M("click",function(){return _(e),v(f(2).setClientModalTab("edit"))}),u(4,"Edit Client"),c()()}if(2&t){const e=f(2);h(),Ce("active","add"===e.clientModalTab),h(2),Ce("active","edit"===e.clientModalTab)}}function y7(t,i){if(1&t){const e=O();l(0,"div",117)(1,"input",131),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.address,o)||(r.address=o),v(o)}),c(),l(2,"input",127),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.city,o)||(r.city=o),v(o)}),c(),l(3,"input",128),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.state,o)||(r.state=o),v(o)}),c(),l(4,"input",129),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pinCode,o)||(r.pinCode=o),v(o)}),c(),l(5,"button",31),M("click",function(){const o=_(e).index;return v(f(3).removeDeliveryLocation(o))}),u(6,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.address),h(),w("ngModel",e.city),h(),w("ngModel",e.state),h(),w("ngModel",e.pinCode)}}function C7(t,i){if(1&t&&(l(0,"div",132),u(1),c()),2&t){const e=f(3);h(),N(e.clientError)}}function M7(t,i){if(1&t){const e=O();l(0,"div")(1,"label"),u(2,"Name* "),l(3,"input",99),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.clientName,o)||(r.newClient.clientName=o),v(o)}),c()(),l(4,"label"),u(5,"GSTIN* "),l(6,"input",99),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.GSTIN,o)||(r.newClient.GSTIN=o),v(o)}),c()(),l(7,"label"),u(8,"Phone* "),l(9,"input",99),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.phoneNum,o)||(r.newClient.phoneNum=o),v(o)}),c()(),l(10,"label"),u(11,"Branch* "),l(12,"input",13),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.branch,o)||(r.newClient.branch=o),v(o)}),c()(),l(13,"label"),u(14,"Address* "),l(15,"textarea",99),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.address,o)||(r.newClient.address=o),v(o)}),c()(),l(16,"div",126)(17,"input",127),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.city,o)||(r.newClient.city=o),v(o)}),c(),l(18,"input",128),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.state,o)||(r.newClient.state=o),v(o)}),c(),l(19,"input",129),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.newClient.pinCode,o)||(r.newClient.pinCode=o),v(o)}),c()(),l(20,"h4"),u(21,"Delivery Locations"),c(),D(22,y7,7,4,"div",113),l(23,"button",31),M("click",function(){return _(e),v(f(2).addDeliveryLocation())}),u(24,"+ Add Delivery Location"),c(),D(25,C7,2,1,"div",130),l(26,"div",103)(27,"button",20),M("click",function(){return _(e),v(f(2).saveNewClient())}),u(28,"Save"),c(),l(29,"button",20),M("click",function(){return _(e),v(f(2).closeModals())}),u(30,"Cancel"),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.newClient.clientName),h(3),w("ngModel",e.newClient.GSTIN),h(3),w("ngModel",e.newClient.phoneNum),h(3),w("ngModel",e.newClient.branch),h(3),w("ngModel",e.newClient.address),h(2),w("ngModel",e.newClient.city),h(),w("ngModel",e.newClient.state),h(),w("ngModel",e.newClient.pinCode),h(3),C("ngForOf",e.newClient.deliveryLocations),h(3),C("ngIf",e.clientError)}}function I7(t,i){if(1&t&&(l(0,"option",63),u(1),c()),2&t){const e=i.$implicit,n=f(3);C("value",e._id),h(),N(n.formatClientOption(e))}}function w7(t,i){if(1&t){const e=O();l(0,"div",117)(1,"input",131),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.address,o)||(r.address=o),v(o)}),c(),l(2,"input",127),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.city,o)||(r.city=o),v(o)}),c(),l(3,"input",128),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.state,o)||(r.state=o),v(o)}),c(),l(4,"input",129),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pinCode,o)||(r.pinCode=o),v(o)}),c(),l(5,"button",31),M("click",function(){const o=_(e).index;return v(f(4).removeEditDeliveryLocation(o))}),u(6,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.address),h(),w("ngModel",e.city),h(),w("ngModel",e.state),h(),w("ngModel",e.pinCode)}}function S7(t,i){if(1&t){const e=O();l(0,"div")(1,"label"),u(2,"Name "),X(3,"input",134),c(),l(4,"label"),u(5,"GSTIN "),X(6,"input",134),c(),l(7,"label"),u(8,"Phone "),X(9,"input",134),c(),l(10,"label"),u(11,"Branch "),X(12,"input",134),c(),l(13,"label"),u(14,"Address "),X(15,"textarea",134),c(),l(16,"h4"),u(17,"Delivery Locations"),c(),D(18,w7,7,4,"div",113),l(19,"button",31),M("click",function(){return _(e),v(f(3).addEditDeliveryLocation())}),u(20,"+ Add Delivery Location"),c()()}if(2&t){const e=f(3);h(3),C("ngModel",e.editClient.clientName),h(3),C("ngModel",e.editClient.GSTIN),h(3),C("ngModel",e.editClient.phoneNum),h(3),C("ngModel",e.editClient.branch),h(3),C("ngModel",e.editClient.address),h(3),C("ngForOf",e.editClient.deliveryLocations)}}function x7(t,i){if(1&t&&(l(0,"div",132),u(1),c()),2&t){const e=f(3);h(),N(e.editClientError)}}function P7(t,i){if(1&t){const e=O();l(0,"div")(1,"label"),u(2,"Select Client "),l(3,"select",32),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.selectedEditClientId,o)||(r.selectedEditClientId=o),v(o)}),M("change",function(){_(e);const o=f(2);return v(o.onEditClientSelect(o.selectedEditClientId))}),l(4,"option",33),u(5,"Select..."),c(),D(6,I7,2,2,"option",34),c()(),D(7,S7,21,6,"div",23)(8,x7,2,1,"div",130),l(9,"div",103)(10,"button",133),M("click",function(){return _(e),v(f(2).saveEditedClient())}),u(11,"Save"),c(),l(12,"button",20),M("click",function(){return _(e),v(f(2).closeModals())}),u(13,"Cancel"),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.selectedEditClientId),h(3),C("ngForOf",e.editableClientList),h(),C("ngIf",null==e.editClient?null:e.editClient._id),h(),C("ngIf",e.editClientError),h(2),C("disabled",!e.selectedEditClientId)}}function D7(t,i){if(1&t){const e=O();l(0,"div",100)(1,"div",101)(2,"div",102)(3,"h3"),u(4),c(),l(5,"button",79),M("click",function(){return _(e),v(f().closeModals())}),u(6,"?\x07"),c()(),D(7,b7,5,4,"div",124)(8,M7,31,10,"div",23)(9,P7,14,5,"div",23),c()()}if(2&t){const e=f();h(4),N(e.showClientAddTab?"Add Client":"Edit Address"),h(3),C("ngIf",e.showClientAddTab),h(),C("ngIf",e.showClientAddTab&&"add"===e.clientModalTab),h(),C("ngIf","edit"===e.clientModalTab)}}function N7(t,i){if(1&t&&(l(0,"div",132),u(1),c()),2&t){const e=f(2);h(),N(e.guestError)}}function T7(t,i){if(1&t){const e=O();l(0,"div",100)(1,"div",101)(2,"div",102)(3,"h3"),u(4,"Add Guest"),c(),l(5,"button",79),M("click",function(){return _(e),v(f().closeModals())}),u(6,"\u30d0\x07"),c()(),l(7,"label"),u(8,"Name* "),l(9,"input",99),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.guestName,o)||(r.newGuest.guestName=o),v(o)}),c()(),l(10,"label"),u(11,"Phone* "),l(12,"input",99),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.phoneNum,o)||(r.newGuest.phoneNum=o),v(o)}),c()(),l(13,"label"),u(14,"Discount % "),l(15,"input",52),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.perDis,o)||(r.newGuest.perDis=o),v(o)}),c()(),l(16,"label"),u(17,"Address* "),l(18,"textarea",99),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.address,o)||(r.newGuest.address=o),v(o)}),c()(),l(19,"div",126)(20,"input",127),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.city,o)||(r.newGuest.city=o),v(o)}),c(),l(21,"input",128),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.state,o)||(r.newGuest.state=o),v(o)}),c(),l(22,"input",129),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.pinCode,o)||(r.newGuest.pinCode=o),v(o)}),c()(),D(23,N7,2,1,"div",130),l(24,"div",103)(25,"button",20),M("click",function(){return _(e),v(f().saveNewGuest())}),u(26,"Save"),c(),l(27,"button",20),M("click",function(){return _(e),v(f().closeModals())}),u(28,"Cancel"),c()()()()}if(2&t){const e=f();h(9),w("ngModel",e.newGuest.guestName),h(3),w("ngModel",e.newGuest.phoneNum),h(3),w("ngModel",e.newGuest.perDis),h(3),w("ngModel",e.newGuest.address),h(2),w("ngModel",e.newGuest.city),h(),w("ngModel",e.newGuest.state),h(),w("ngModel",e.newGuest.pinCode),h(),C("ngIf",e.guestError)}}let k7=(()=>{class t{constructor(e){this.http=e,this.DRAFT_PREFIX="newShipmentDraft",this.showClientModal=!1,this.showGuestModal=!1,this.showProductModal=!1,this.clientError="",this.guestError="",this.productError="",this.clientModalTab="add",this.showClientAddTab=!0,this.editClientError="",this.newClient={clientName:"",address:"",city:"",state:"",pinCode:"",GSTIN:"",phoneNum:"",perDis:0,creditType:"no-credit",products:[],deliveryLocations:[{address:"",city:"",state:"",pinCode:""}],status:"active",branch:"",originLocId:""},this.editableClientList=[],this.selectedEditClientId="",this.editClient={_id:"",clientName:"",GSTIN:"",phoneNum:"",address:"",city:"",state:"",pinCode:"",branch:"",deliveryLocations:[]},this.newGuest={guestName:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",perDis:0},this.newProduct={hsnNum:"",productName:"",status:"active",originLocId:"",rates:[{pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}}]},this.billingType="consignor",this.billingName="",this.billingAddress="",this.billingGSTIN="",this.billingPhone="",this.billingLocationIndex="",this.billingLocationId=null,this.billingPreviousSender="",this.billingClientId=null,this.billingSource="",this.billingAddressOptions=[],this.clientList=[],this.rateAddressClients=[],this.guestList=[],this.pkgList=[],this.productList=[],this.rateAddressOptions=[],this.rateAddressLabelById=new Map,this.pickupType="branch",this.pickupName="",this.pickupAddress="",this.pickupPhone="",this.pickupPincode="",this.pickupLocationIndex="",this.pickupLocationId=null,this.pickupPreviousSender="",this.pickupSource="branch",this.deliveryType="different",this.deliveryTypeName="",this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.deliveryPincode="",this.deliveryLocationIndex="",this.deliveryLocationId=null,this.deliveryPreviousReceiver="",this.lastConsigneeName="",this.deliveryID=null,this.deliveryBranch="",this.deliveryHub="",this.deliveryHubLocationIndex="",this.consignorTab="consignor",this.consigneeTab="consignee",this.username="",this.isAdmin="admin"===String(localStorage.getItem("role")||"").toLowerCase(),this.branch=localStorage.getItem("branch")||"All Branches",this.selectedConsignorId=null,this.consignorId=null,this.consigneeId=null,this.consignmentNumber="nil",this.date=(new Date).toISOString().split("T")[0],this.consignor="",this.consignorGST="",this.consignorAddress="",this.consignorPhone="",this.consignee="",this.consigneeGST="",this.consigneeAddress="",this.consigneePhone="",this.paymentMode="To Pay",this.rateUnit="box",this.allowAccountCredit=!1,this.allowReceiverCredit=!1,this.externalRefId="",this.suggestedRates={},this.isQuoteLoading=!1,this.quoteTimer=null,this.quoteRequestId=0,this.showRateOverrideModal=!1,this.suggestionRequestKey="",this.suggestionRetryHandle=null,this.suggestionMaxRetries=2,this.branchDetails=null,this.branches=[],this.hubs=[],this.selectedAllHubId="",this.rateOverrides=[],this.ewaybills=[{number:"",date:this.date,invoices:[{number:"",value:0,packages:[{type:"",amount:0}],products:[{type:"",amount:1,ratePer:0,instock:1,intransitstock:0,deliveredstock:0}]}]}],this.charges={odc:0,unloading:0,docket:0,other:0,ccc:0,consignorDiscount:0},this.applyConsignorDiscount=!0,this.maxConsignorDiscount=0,this.finalAmount=0,this.initialPaid=0,this.showFinalAmountModal=!1,this.shipmentStatus="Pending",this.shipmentStatusDetails="",this.isSaving=!1,this.pendingPricingUpdates=[],this.retryPricingAfterSave=!1,this.onStorageChange=n=>{"branch"===n.key&&n.newValue&&this.handleBranchChange(n.newValue,n.oldValue||this.branch)}}ngOnInit(){typeof window>"u"||(this.username=localStorage.getItem("username")||"",this.branch=localStorage.getItem("branch")||"All Branches",this.newClient.branch=this.branch,this.newClient.originLocId=localStorage.getItem("originLocId")||"all",this.deliveryBranch=this.branch,this.loadDraft(this.branch),this.getCurrentConsignmentNumber(),this.loadLists(),this.loadBranchDetails(),this.loadHubDetails(),this.branchCheckInterval=setInterval(()=>{const e=localStorage.getItem("branch")||"All Branches";e!==this.branch&&this.handleBranchChange(e,this.branch)},1e3),window.addEventListener("storage",this.onStorageChange))}ngOnDestroy(){this.branchCheckInterval&&clearInterval(this.branchCheckInterval),window.removeEventListener("storage",this.onStorageChange)}onBeforeUnload(){this.saveDraft(this.branch)}handleBranchChange(e,n){n&&this.saveDraft(n),this.branch=e||"All Branches","All Hubs"!==this.branch&&(this.selectedAllHubId=""),this.newClient.branch=this.branch,this.newClient.originLocId=localStorage.getItem("originLocId")||"all",this.editClient.branch=this.branch,"branch"===this.deliveryType&&(this.deliveryBranch=this.branch),"hub"===this.deliveryType&&(this.deliveryHub=""),this.loadDraft(this.branch),this.getCurrentConsignmentNumber(),this.loadLists(),this.loadBranchDetails(),this.loadHubDetails()}draftKey(e){return`${this.DRAFT_PREFIX}:${e||"All Branches"}`}saveDraft(e){if(typeof window>"u")return;const n=this.draftKey(e),o={billingType:this.billingType,billingName:this.billingName,billingAddress:this.billingAddress,billingGSTIN:this.billingGSTIN,billingPhone:this.billingPhone,billingLocationId:this.billingLocationId,billingPreviousSender:this.billingPreviousSender,billingClientId:this.billingClientId,billingSource:this.billingSource,pickupType:this.pickupType,pickupName:this.pickupName,pickupAddress:this.pickupAddress,pickupPhone:this.pickupPhone,pickupPincode:this.pickupPincode,pickupLocationId:this.pickupLocationId,pickupPreviousSender:this.pickupPreviousSender,pickupSource:this.pickupSource,deliveryType:this.deliveryType,deliveryTypeName:this.getDeliveryTypeForSave(),deliveryBranch:this.deliveryBranch,deliveryHub:this.deliveryHub,deliveryID:this.deliveryID,deliveryName:this.deliveryName,deliveryAddress:this.deliveryAddress,deliveryPhone:this.deliveryPhone,deliveryPincode:this.deliveryPincode,deliveryHubLocationIndex:this.deliveryHubLocationIndex,deliveryLocationId:this.deliveryLocationId,deliveryPreviousReceiver:this.deliveryPreviousReceiver,consignorTab:this.consignorTab,consigneeTab:this.consigneeTab,consignor:this.consignor,consignorGST:this.consignorGST,consignorAddress:this.consignorAddress,consignorPhone:this.consignorPhone,consignorId:this.consignorId,consignee:this.consignee,consigneeGST:this.consigneeGST,consigneeAddress:this.consigneeAddress,consigneePhone:this.consigneePhone,consigneeId:this.consigneeId,paymentMode:this.paymentMode,rateUnit:this.rateUnit,externalRefId:this.externalRefId,ewaybills:this.ewaybills,charges:this.charges,applyConsignorDiscount:this.applyConsignorDiscount,finalAmount:this.finalAmount,initialPaid:this.initialPaid,selectedConsignorId:this.selectedConsignorId,consignmentNumber:this.consignmentNumber,date:this.date};localStorage.setItem(n,JSON.stringify(o))}loadDraft(e){if(typeof window>"u")return;const n=localStorage.getItem(this.draftKey(e));if(n)try{const o=JSON.parse(n);Object.assign(this,{billingType:o.billingType??this.billingType,billingName:o.billingName??this.billingName,billingAddress:o.billingAddress??this.billingAddress,billingGSTIN:o.billingGSTIN??this.billingGSTIN,billingPhone:o.billingPhone??this.billingPhone,billingLocationId:o.billingLocationId??this.billingLocationId,billingPreviousSender:o.billingPreviousSender??this.billingPreviousSender,billingClientId:o.billingClientId??this.billingClientId,billingSource:o.billingSource??this.billingSource,pickupType:o.pickupType??this.pickupType,pickupName:o.pickupName??this.pickupName,pickupAddress:o.pickupAddress??this.pickupAddress,pickupPhone:o.pickupPhone??this.pickupPhone,pickupPincode:o.pickupPincode??this.pickupPincode,pickupLocationId:o.pickupLocationId??this.pickupLocationId,pickupPreviousSender:o.pickupPreviousSender??this.pickupPreviousSender,pickupSource:o.pickupSource??this.pickupSource,deliveryType:o.deliveryType??this.deliveryType,deliveryTypeName:o.deliveryTypeName??this.deliveryTypeName,deliveryBranch:o.deliveryBranch??this.deliveryBranch,deliveryHub:o.deliveryHub??this.deliveryHub,deliveryID:o.deliveryID??this.deliveryID,deliveryName:o.deliveryName??this.deliveryName,deliveryAddress:o.deliveryAddress??this.deliveryAddress,deliveryPhone:o.deliveryPhone??this.deliveryPhone,deliveryPincode:o.deliveryPincode??this.deliveryPincode,deliveryHubLocationIndex:o.deliveryHubLocationIndex??this.deliveryHubLocationIndex,deliveryLocationId:o.deliveryLocationId??this.deliveryLocationId,deliveryPreviousReceiver:o.deliveryPreviousReceiver??this.deliveryPreviousReceiver,consignorTab:o.consignorTab??this.consignorTab,consigneeTab:o.consigneeTab??this.consigneeTab,consignor:o.consignor??this.consignor,consignorGST:o.consignorGST??this.consignorGST,consignorAddress:o.consignorAddress??this.consignorAddress,consignorPhone:o.consignorPhone??this.consignorPhone,consignorId:o.consignorId??this.consignorId,consignee:o.consignee??this.consignee,consigneeGST:o.consigneeGST??this.consigneeGST,consigneeAddress:o.consigneeAddress??this.consigneeAddress,consigneePhone:o.consigneePhone??this.consigneePhone,consigneeId:o.consigneeId??this.consigneeId,paymentMode:o.paymentMode??this.paymentMode,rateUnit:o.rateUnit??this.rateUnit,externalRefId:o.externalRefId??this.externalRefId,ewaybills:o.ewaybills??this.ewaybills,charges:o.charges??this.charges,applyConsignorDiscount:o.applyConsignorDiscount??this.applyConsignorDiscount,finalAmount:o.finalAmount??this.finalAmount,initialPaid:o.initialPaid??this.initialPaid,selectedConsignorId:o.selectedConsignorId??null,consignmentNumber:o.consignmentNumber??this.consignmentNumber,date:o.date??this.date}),"consignor-primary"===this.pickupSource&&(this.pickupSource="consignor:0"),"different"===this.billingType&&this.billingSource&&(this.onBillingSourceSelect(this.billingSource,!0),""!==this.billingLocationIndex&&this.onBillingAddressSelect(this.billingLocationIndex,!0)),this.onPaymentModeChange(),this.updatePickupFromBranch(),"branch"===this.deliveryType?this.updateDeliveryFromBranch():"hub"===this.deliveryType?this.updateDeliveryFromHub():"consignee"===this.deliveryType&&this.updateDeliveryFromConsignee(),this.scheduleQuote()}catch{}}clearDraft(e){localStorage.removeItem(this.draftKey(e))}loadLists(){const e=localStorage.getItem("originLocId")||"all",n="all-hubs"===e?"all":e;this.http.get(`http://localhost:3000/api/clients/clientslist?originLocId=${encodeURIComponent(e)}`).subscribe(a=>{this.clientList=a,this.rebuildRateAddressOptions(),this.syncConsignorDiscount(),this.updatePaymentModeAvailability()}),this.http.get("http://localhost:3000/api/clients/clientslist?originLocId=all").subscribe(a=>{this.rateAddressClients=a||[],this.rebuildRateAddressOptions()}),this.http.get("http://localhost:3000/api/guests/guestslist").subscribe(a=>this.guestList=a),this.http.get("http://localhost:3000/api/pkgs/pkglist").subscribe(a=>this.pkgList=a);const o=localStorage.getItem("branch")||"",r=this.getOriginFilterFromoriginLocId(e),s={branch:o};r?(s.originType=r.originType,s.originLocId=r.originLocId):s.originLocId=n,this.http.get("http://localhost:3000/api/products/productlist",{params:s}).subscribe(a=>this.productList=a)}getOriginFilterFromoriginLocId(e){if(!e)return null;const n=String(e).trim().toLowerCase();if(!n||"all"===n)return null;if("all-hubs"===n){const r=this.normalizeHubId(localStorage.getItem("hubId"));return r?{originType:"hub",originLocId:r}:null}const o=this.normalizeHubId(e);return o?{originType:"branch",originLocId:o}:null}normalizeHubId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}loadHubDetails(){this.http.get("http://localhost:3000/api/hubs").subscribe({next:e=>{this.hubs=e||[],this.rebuildRateAddressOptions(),"hub"===this.deliveryType&&this.updateDeliveryFromHub()},error:()=>{this.hubs=[]}})}addEwaybill(){this.ewaybills.push({number:"",date:this.date,invoices:[]}),this.scheduleQuote()}deleteEwaybill(e){this.ewaybills.splice(e,1),this.scheduleQuote()}addInvoice(e){this.ewaybills[e].invoices.push({number:"",value:0,packages:[],products:[]}),this.scheduleQuote()}deleteInvoice(e,n){this.ewaybills[e].invoices.splice(n,1),this.scheduleQuote()}addPackage(e,n){this.ewaybills[e].invoices[n].packages.push({type:"",amount:0}),this.scheduleQuote()}deletePackage(e,n,o){this.ewaybills[e].invoices[n].packages.splice(o,1),this.scheduleQuote()}addProduct(e,n){this.ewaybills[e].invoices[n].products.push({type:"",amount:1,ratePer:0,instock:1,intransitstock:0,deliveredstock:0}),this.scheduleQuote()}deleteProduct(e,n,o){this.ewaybills[e].invoices[n].products.splice(o,1),this.scheduleQuote()}scheduleQuote(){this.quoteTimer&&clearTimeout(this.quoteTimer),this.quoteTimer=setTimeout(()=>this.requestQuote(),200)}requestQuote(){const e=++this.quoteRequestId;this.isQuoteLoading=!0,this.http.post("http://localhost:3000/api/newshipments/quote",{ewaybills:this.ewaybills,charges:this.charges,applyConsignorDiscount:this.applyConsignorDiscount}).subscribe({next:o=>{e===this.quoteRequestId&&(this.finalAmount=Number(o?.finalAmount)||0,this.isQuoteLoading=!1)},error:()=>{e===this.quoteRequestId&&(this.isQuoteLoading=!1)}})}resetForm(){this.billingType="consignor",this.billingName="",this.billingAddress="",this.billingGSTIN="",this.billingPhone="",this.billingLocationIndex="",this.billingLocationId=null,this.billingPreviousSender="",this.billingClientId=null,this.billingSource="",this.billingAddressOptions=[],this.pickupType="branch",this.pickupName="",this.pickupAddress="",this.pickupPhone="",this.pickupPincode="",this.pickupLocationIndex="",this.pickupLocationId=null,this.pickupPreviousSender="",this.pickupSource="branch",this.deliveryType="different",this.deliveryTypeName="",this.deliveryBranch="",this.deliveryHub="",this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.deliveryPincode="",this.deliveryLocationIndex="",this.deliveryLocationId=null,this.deliveryPreviousReceiver="",this.deliveryID=null,this.deliveryHubLocationIndex="",this.consignorTab="consignor",this.consigneeTab="consignee",this.selectedConsignorId=null,this.consignor="",this.consignorGST="",this.consignorAddress="",this.consignorPhone="",this.consignorId=null,this.consignee="",this.consigneeGST="",this.consigneeAddress="",this.consigneePhone="",this.consigneeId=null,this.paymentMode="To Pay",this.rateUnit="box",this.allowAccountCredit=!1,this.allowReceiverCredit=!1,this.externalRefId="",this.ewaybills=[{number:"",date:this.date,invoices:[{number:"",value:0,packages:[{type:"",amount:0}],products:[{type:"",amount:1,ratePer:0,instock:1,intransitstock:0,deliveredstock:0}]}]}],this.charges={odc:0,unloading:0,docket:0,other:0,ccc:0,consignorDiscount:0},this.applyConsignorDiscount=!0,this.maxConsignorDiscount=0,this.finalAmount=0,this.initialPaid=0,this.suggestedRates={},this.saveDraft(this.branch),this.scheduleQuote(),this.updatePickupFromBranch()}getCurrentConsignmentNumber(){const e=localStorage.getItem("originLocId")||"all";if(this.branch&&"All Branches"!==this.branch&&"all"!==e){if("All Hubs"===this.branch||"all-hubs"===e){const n=String(this.selectedAllHubId||"").trim();return n?void this.http.get(`http://localhost:3000/api/newshipments/nextConsignment?username=${encodeURIComponent(this.username)}&originLocId=${encodeURIComponent(n)}&originType=hub`).subscribe({next:o=>{this.consignmentNumber=o.nextNumber.toString(),localStorage.setItem("consignmentNumber",this.consignmentNumber)},error:o=>console.error("Error fetching consignment number",o)}):void(this.consignmentNumber="nil")}this.http.get(`http://localhost:3000/api/newshipments/nextConsignment?username=${encodeURIComponent(this.username)}&originLocId=${encodeURIComponent(e)}&originType=branch`).subscribe({next:n=>{this.consignmentNumber=n.nextNumber.toString(),localStorage.setItem("consignmentNumber",this.consignmentNumber)},error:n=>console.error("Error fetching consignment number",n)})}else this.consignmentNumber="nil"}saveShipment(){if(!this.isSaving&&this.ensureProductAmounts()){if(0===Number(this.finalAmount||0))return void(this.showFinalAmountModal=!0);this.beginSaveFlow()}}confirmFinalAmountSave(){this.showFinalAmountModal=!1,this.beginSaveFlow()}cancelFinalAmountSave(){this.showFinalAmountModal=!1}beginSaveFlow(){const e=localStorage.getItem("branch")||"",n=localStorage.getItem("originLocId")||"all";if("All Hubs"===e||"all-hubs"===n)return this.rateOverrides=[],this.showRateOverrideModal=!1,void this.performSave();const r=this.collectRateOverrides();if(r.length)return this.rateOverrides=r,void(this.showRateOverrideModal=!0);this.performSave()}performSave(){this.isSaving=!0,this.shipmentStatus="Pending";const e=localStorage.getItem("branch")||"";let n=localStorage.getItem("originLocId")||"all";const o="All Hubs"===e||"all-hubs"===n;let r=n,s=n;if(o){const p=this.getSelectedAllHub();if(!p)return this.isSaving=!1,void alert("Select at least one hub before saving.");if(n=String(p?._id||"").trim(),r=n,s=n,!r)return this.isSaving=!1,void alert("Selected hub is invalid.")}const a=s&&"all"!==s?`$$${s}`:"",d={username:localStorage.getItem("username"),branch:e,currentLocationId:s,shipmentStatus:this.shipmentStatus,shipmentStatusDetails:a,consignmentNumber:this.consignmentNumber,date:this.date,paymentMode:this.paymentMode,externalRefId:this.externalRefId,consignorTab:this.consignorTab,consignor:this.consignor,consignorGST:this.consignorGST,consignorAddress:this.consignorAddress,consignorPhone:this.consignorPhone,consignorId:this.consignorId,consigneeTab:this.consigneeTab,consignee:this.consignee,consigneeGST:this.consigneeGST,consigneeAddress:this.consigneeAddress,consigneePhone:this.consigneePhone,consigneeId:this.consigneeId,originLocId:r,billingType:this.billingType,billingName:this.billingName,billingGSTIN:this.billingGSTIN,billingAddress:this.billingAddress,billingPhone:this.billingPhone,billingLocationId:this.billingLocationId,billingClientId:this.billingClientId,pickupType:this.pickupType,pickupName:this.pickupName,pickupAddress:this.pickupAddress,pickupPhone:this.pickupPhone,pickupPincode:this.pickupPincode,pickupLocationId:this.pickupLocationId,deliveryType:this.getDeliveryTypeForSave(),deliveryID:this.deliveryID,deliveryName:this.deliveryName,deliveryAddress:this.deliveryAddress,deliveryPhone:this.deliveryPhone,deliveryPincode:this.deliveryPincode,deliveryLocationId:this.deliveryLocationId,ewaybills:this.ewaybills,charges:this.charges,applyConsignorDiscount:this.applyConsignorDiscount,finalAmount:this.finalAmount,initialPaid:this.initialPaid};o&&(d.allHubs=!0,d.originLocId=n),"guest"===this.consignorTab&&(d.consignorGST="GUEST"),"guest"===this.consigneeTab&&(d.consigneeGST="GUEST"),"consignor"===this.billingType&&(d.billingName=this.consignor,d.billingAddress=this.consignorAddress,d.billingGSTIN=this.consignorGST,d.billingPhone=this.consignorPhone,d.billingClientId=this.consignorId),"branch"===this.pickupType&&(d.pickupName=this.pickupName,d.pickupAddress=this.pickupAddress,d.pickupPhone=this.pickupPhone),"consignee"===this.deliveryType&&(d.deliveryName=this.consignee,d.deliveryAddress=this.consigneeAddress,d.deliveryPhone=this.consigneePhone),"All Branches"!==d.branch?(d.ewaybills=this.sanitizeEwaybills(d.ewaybills),this.http.post("http://localhost:3000/api/newshipments/add?summary=true",d,{headers:{"Content-Type":"application/json"}}).subscribe({next:()=>{alert(`Shipment ${this.consignmentNumber} saved successfully!`),this.retryPricingAfterSave&&this.pendingPricingUpdates.length&&this.updateClientPricing(this.pendingPricingUpdates).subscribe({next:()=>{this.pendingPricingUpdates=[],this.retryPricingAfterSave=!1},error:()=>{this.pendingPricingUpdates=[],this.retryPricingAfterSave=!1}}),this.getCurrentConsignmentNumber(),this.resetForm(),this.clearDraft(this.branch),this.isSaving=!1},error:p=>{const g=p?.error?.message||p?.message||"Bad Request";g.includes("E11000")?(alert("Consignment number already used. Refreshing number and please try again."),this.getCurrentConsignmentNumber()):alert("Error: "+g),this.isSaving=!1}})):(alert("Please select a branch before saving."),this.isSaving=!1)}collectRateOverrides(){const e=[];if(!this.selectedConsignorId)return e;for(const n of this.ewaybills)for(const o of n.invoices||[])for(const r of o.products||[]){const s=String(r.type||"").trim();if(!s)continue;const a=this.suggestedRates[s],d=Number(r.ratePer)||0;if(null!=r.ratePer&&""!==String(r.ratePer).trim()&&0!==d&&(null==a||d!==Number(a))){const g=this.productList.find(b=>b.productName===s),m=null==a?null:Number(a);e.push({productName:s,hsnNum:g?.hsnNum,enteredRate:d,suggestedRate:m,action:"override"})}}return e}confirmRateOverride(){this.showRateOverrideModal=!1;const e=this.rateOverrides.filter(n=>"suggest"===n.action);e.length?(this.ensureRouteLocationIds(),this.pendingPricingUpdates=e.map(n=>({productName:n.productName,hsnNum:n.hsnNum,enteredRate:n.enteredRate})),this.retryPricingAfterSave=!1,this.updateClientPricing(this.pendingPricingUpdates).subscribe({next:()=>{this.pendingPricingUpdates=[],this.retryPricingAfterSave=!1,this.performSave()},error:()=>{this.retryPricingAfterSave=!0,this.performSave()}})):this.performSave()}updateClientPricing(e){const n=this.getClientIdForPricing();if(!n)return Q(void 0);this.ensureRouteLocationIds();const o=String(this.pickupLocationId||"").trim(),r=String(this.deliveryLocationId||"").trim(),s=new Map;e.forEach(p=>{s.set(p.productName,{productName:p.productName,hsnNum:p.hsnNum,ratePer:p.enteredRate})});const a={consignmentNumber:String(this.consignmentNumber||"").trim(),rateUnit:this.rateUnit,updates:Array.from(s.values())},d=(p,g)=>this.http.post(`http://localhost:3000/api/clients/${n}/pricing`,{pickupLocationId:p,deliveryLocationId:g,...a});return o&&r||"branch"!==this.pickupType&&"branch"!==this.deliveryType?d(o,r):this.http.get("http://localhost:3000/api/branches").pipe(un(p=>{const g=p||[],m=this.branchDetails||g.find(T=>T.branchName===this.branch)||null,b=o||this.getSelectedBranchAddressId(m)||"",y=this.deliveryBranch||this.branch,I=g.find(T=>T.branchName===y)||(this.branchDetails?.branchName===y?this.branchDetails:null),P=r||this.getSelectedBranchAddressId(I)||"";return d(b,P)}))}ensureRouteLocationIds(){if(!this.pickupLocationId)if("branch"===this.pickupType){const e=this.branchDetails||(this.branches||[]).find(n=>n.branchName===this.branch)||null;this.pickupLocationId=this.getSelectedBranchAddressId(e)}else if(this.pickupSource.startsWith("consignor:")){const e=this.getPickupConsignorLocations(),n=e[Number(this.pickupLocationIndex)];this.pickupLocationId=this.getLocationId(n)||this.getLocationId(e[0])||null}else if(this.pickupSource.startsWith("billing:")){const e=this.getPickupBillingLocations(),n=e[Number(this.pickupLocationIndex)];this.pickupLocationId=this.getLocationId(n)||this.getLocationId(e[0])||null}else if(this.pickupSource.startsWith("different:")){const e=this.getPickupDifferentLocations(),n=e[Number(this.pickupLocationIndex)];this.pickupLocationId=this.getLocationId(n)||this.getLocationId(e[0])||null}else if("consignor"===this.pickupType){const e=this.getPickupConsignorLocations(),n=e[Number(this.pickupLocationIndex)];this.pickupLocationId=this.getLocationId(n)||this.getLocationId(e[0])||null}else if("different"===this.pickupType){const e=this.getPickupDifferentLocations(),n=e[Number(this.pickupLocationIndex)];this.pickupLocationId=this.getLocationId(n)||this.getLocationId(e[0])||null}if(!this.deliveryLocationId)if("branch"===this.deliveryType){const e=this.deliveryBranch||this.branch,o=(this.branches||[]).find(r=>r.branchName===e)||(this.branchDetails?.branchName===e?this.branchDetails:null);this.deliveryLocationId=this.getSelectedBranchAddressId(o)}else if("different"===this.deliveryType){const e=this.getClientLocationsByName(this.deliveryPreviousReceiver),n=this.getLocationById(e,this.deliveryLocationId);this.deliveryLocationId=this.getLocationId(n)||this.deliveryLocationId||null}else if("hub"===this.deliveryType){const n=this.getSelectedHubAddresses()[Number(this.deliveryHubLocationIndex)];this.deliveryLocationId=this.getLocationId(n)}else{const e=this.getConsigneeLocations(),n=this.getLocationById(e,this.deliveryLocationId),o=e[Number(this.deliveryLocationIndex)];this.deliveryLocationId=this.getLocationId(n)||this.getLocationId(o)||this.getLocationId(e[0])||null}}sanitizeEwaybills(e){return(e||[]).map(n=>({...n,invoices:(n.invoices||[]).map(o=>({...o,packages:(o.packages||[]).filter(r=>r?.type&&Number(r?.amount)>0),products:(o.products||[]).filter(r=>r?.type&&Number(r?.amount)>0)}))}))}ensureProductAmounts(){let e=!1;for(const n of this.ewaybills){let o=!1;for(const r of n.invoices||[]){if(!(r.products||[]).filter(a=>String(a?.type||"").trim()&&Number(a?.amount)>0).length)return alert("Please add at least one product to each invoice."),!1;for(const a of r.products||[]){const d=String(a?.type||"").trim(),p=Number(a?.amount||0);if(d||p){if(!d)return alert("Please select a product type for all products."),!1;if(p<=0)return alert("Please enter a quantity greater than 0 for all products."),!1;o=!0,e=!0,(!a.instock||a.instock<=0)&&(a.instock=p)}}}if(!o)return alert("Please add at least one product to each e-waybill."),!1}return!!e||(alert("Please add at least one product before saving."),!1)}hasValidProduct(){for(const e of this.ewaybills)for(const n of e.invoices||[])for(const o of n.products||[]){const r=String(o?.type||"").trim(),s=Number(o?.amount||0);if(r&&s>0)return!0}return!1}setPincodeIfEmpty(e,n){const o=String(n||"").trim();if(o){if("pickup"===e){if(this.pickupPincode)return;this.pickupPincode=o}else{if(this.deliveryPincode)return;this.deliveryPincode=o}this.onRouteChange()}}getClientLocationsByName(e){const n=this.clientList.find(o=>o.clientName===e);return Array.isArray(n?.deliveryLocations)?n.deliveryLocations:[]}normalizeClientName(e){return String(e||"").trim().toLowerCase()}getPickupDifferentClients(){const e=new Set;if("consignor"===this.consignorTab){const n=this.normalizeClientName(this.consignor);n&&e.add(n)}if("consignee"===this.consigneeTab){const n=this.normalizeClientName(this.consignee);n&&e.add(n)}return(this.clientList||[]).filter(n=>{const o=this.normalizeClientName(n?.clientName);return o&&!e.has(o)})}getPickupDifferentLocations(){const e=this.clientList.find(o=>o.clientName===this.pickupPreviousSender);if(!e)return[];const n=Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[];return n.length?n:e?.address?[{address:e.address,city:e.city,state:e.state,pinCode:e.pinCode}]:[]}getDeliveryDifferentClients(){return this.getPickupDifferentClients()}getDeliverySelectedClientLocations(){const e=this.clientList.find(o=>o.clientName===this.deliveryPreviousReceiver);if(!e)return[];const n=Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[];return n.length?n:e?.address?[{address:e.address,city:e.city,state:e.state,pinCode:e.pinCode}]:[]}getBillingConsignorClient(){return"consignor"===this.billingType?"consignor"!==this.consignorTab?null:this.clientList.find(e=>e.clientName===this.consignor)||null:this.billingClientId?this.clientList.find(e=>String(e?._id)===String(this.billingClientId))||null:this.billingPreviousSender&&this.clientList.find(e=>e.clientName===this.billingPreviousSender)||null}getConsignorLocations(){return this.getClientLocationsByName(this.consignor)}getBillingConsignorLocations(){const e=this.getBillingConsignorClient();return Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[]}getPickupConsignorLocations(){return"consignor"!==this.consignorTab?[]:this.getConsignorLocations()}getPickupBillingLocations(){if("different"!==this.billingType)return[];const e=this.getBillingSourceEntity(this.billingSource);if(!e)return[];if("client"===e.kind){const n=Array.isArray(e.entity?.deliveryLocations)?e.entity.deliveryLocations:[];return n.length?n:e.entity?.address?[{address:e.entity.address,city:e.entity.city,state:e.entity.state,pinCode:e.entity.pinCode}]:[]}return"hub"===e.kind?[{_id:e.entity?._id,address:e.entity?.address,city:e.entity?.city,state:e.entity?.state,pinCode:e.entity?.pinCode}]:[]}getPickupSourceClientId(){if(this.pickupSource.startsWith("consignor:")){const e=this.clientList.find(n=>n.clientName===this.consignor);return e?._id?String(e._id):null}if(this.pickupSource.startsWith("billing:")){const e=this.getBillingSourceEntity(this.billingSource);if("client"===e?.kind&&e.entity?._id)return String(e.entity._id)}return null}getConsigneeLocations(){return this.getClientLocationsByName(this.consignee)}formatLocation(e){return[e?.address||e?.location,e?.city,e?.state,this.getLocationPin(e)].filter(Boolean).join(", ")}getLocationPin(e){return String(e?.pinCode??e?.pincode??e?.pin??"").trim()}getLocationId(e){const n=e?.delivery_id||e?._id||e?.id;return n?String(n):null}getPrimaryLocationId(e){return Array.isArray(e)&&e.length?this.getLocationId(e[0]):null}getLocationById(e,n){return n&&Array.isArray(e)&&e.find(o=>this.getLocationId(o)===n)||null}getClientPinByName(e){const n=this.clientList.find(s=>s.clientName===e),o=String(n?.pinCode??n?.pincode??n?.pin??"").trim();if(o)return o;const r=Array.isArray(n?.deliveryLocations)?n.deliveryLocations:[];return this.getLocationPin(r[0])}getGuestPinByName(e){const n=this.guestList.find(o=>o.guestName===e);return String(n?.pinCode??n?.pincode??"").trim()}updatePickupFromConsignor(){const e=this.getBillingConsignorClient();if(!e)return;this.pickupName=e.clientName||"",this.pickupPhone=e.phoneNum||"";const n=Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[],o=n[0];this.pickupAddress=o?this.formatLocation(o):e.address||"";const r=o?this.getLocationPin(o):this.getClientPinByName(e.clientName);r&&(this.pickupPincode=r,this.onRouteChange()),this.pickupLocationId=o?this.getLocationId(o):null,this.pickupLocationIndex="",(!this.pickupSource||"branch"===this.pickupSource||"consignor-guest"===this.pickupSource)&&(this.pickupSource=n.length?"consignor:0":"branch")}updateBillingFromConsignor(){if("guest"===this.consignorTab){const r=this.guestList.find(s=>s.guestName===this.consignor);if(!r)return;return this.billingName=r.guestName||"",this.billingGSTIN="GUEST",this.billingPhone=r.phoneNum||"",this.billingAddress=r.address||"",this.billingLocationId=null,this.billingLocationIndex="",this.billingClientId=null,void this.updatePaymentModeAvailability()}const e=this.clientList.find(r=>r.clientName===this.consignor);if(!e)return;this.billingName=e.clientName||"",this.billingGSTIN=e.GSTIN||"",this.billingPhone=e.phoneNum||"";const o=(Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[])[0];this.billingAddress=o?this.formatLocation(o):e.address||"",this.billingLocationId=o?this.getLocationId(o):null,this.billingLocationIndex="",this.billingClientId=e._id||null,this.updatePaymentModeAvailability(),this.refreshPricingSuggestions()}updateDeliveryFromConsignee(){if("guest"===this.consigneeTab){const s=this.guestList.find(a=>a.guestName===this.consignee);if(!s)return;return this.deliveryAddress=s.address||"",this.deliveryPincode=String(s?.pinCode??s?.pincode??"").trim(),this.deliveryLocationId=null,this.deliveryLocationIndex="",this.deliveryID=s._id||null,this.onRouteChange(),void this.updateReceiverCreditAvailability()}const e=this.clientList.find(s=>s.clientName===this.consignee);if(!e)return;const o=(Array.isArray(e?.deliveryLocations)?e.deliveryLocations:[])[0];this.deliveryAddress=o?this.formatLocation(o):e.address||"";const r=o?this.getLocationPin(o):this.getClientPinByName(e.clientName);r&&(this.deliveryPincode=r,this.onRouteChange()),this.deliveryLocationId=o?this.getLocationId(o):null,this.deliveryLocationIndex="",this.deliveryID=e._id||null,this.updateReceiverCreditAvailability()}setPickupType(e){this.pickupType=e,"branch"!==e?"consignor"!==e?this.pickupPreviousSender&&this.onPickupPreviousSenderSelect(this.pickupPreviousSender):this.updatePickupFromConsignor():this.updatePickupFromBranch()}activatePickupPrimary(){this.pickupSource="branch",this.setPickupType("branch")}onPickupSourceSelect(e){if(this.pickupSource=e,"branch"!==e){if("consignor-guest"===e)return this.setPickupType("consignor"),void this.updatePickupFromConsignor();if(e.startsWith("consignor:")){const n=e.split(":")[1]||"";return this.setPickupType("consignor"),this.pickupLocationIndex=n,void this.onPickupLocationSelect(n)}if(e.startsWith("billing:")){const n=e.split(":")[1]||"";this.setPickupType("consignor"),this.pickupLocationIndex=n,this.onPickupBillingLocationSelect(n)}}else this.setPickupType("branch")}setBillingType(e){if(this.billingType=e,"consignor"===e)return this.updateBillingFromConsignor(),void("consignor"===this.pickupType&&this.pickupSource.startsWith("consignor:")&&this.updatePickupFromConsignor());this.billingSource="",this.billingAddressOptions=[],this.billingLocationIndex="",this.billingLocationId=null,this.billingPreviousSender="",this.billingClientId=null,this.billingName="",this.billingGSTIN="",this.billingPhone="",this.billingAddress="",this.updatePaymentModeAvailability()}onDeliverySelfPickupToggle(e){if(e?.target?.checked)return this.deliveryType="branch",this.deliveryTypeName="Customer Self Pickup",this.deliveryBranch=this.branch||"",this.deliveryHub="",this.deliveryPreviousReceiver="",this.deliveryLocationIndex="",this.deliveryLocationId=null,this.deliveryID=null,this.updateDeliveryFromBranch(),void this.updateReceiverCreditAvailability();this.deliveryType="different",this.deliveryTypeName="Out for delivery too",this.deliveryBranch="",this.deliveryHub="",this.deliveryPreviousReceiver="",this.deliveryLocationIndex="",this.deliveryLocationId=null,this.deliveryID=null,this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.deliveryPincode="",this.onRouteChange(),this.updateReceiverCreditAvailability()}setDeliveryType(e){if(this.deliveryType=e,"branch"===e)return this.deliveryBranch||(this.deliveryBranch=this.branch),this.deliveryHubLocationIndex="",void this.updateDeliveryFromBranch();if("hub"!==e)"consignee"!==e?this.deliveryPreviousReceiver&&this.onDeliveryPreviousReceiverSelect(this.deliveryPreviousReceiver):this.updateDeliveryFromConsignee();else{if(this.deliveryHubLocationIndex="",!this.deliveryHub){const n=this.getAvailableHubs();1===n.length&&(this.deliveryHub=n[0].hubName)}this.updateDeliveryFromHub()}}setDeliveryPickupTab(){"branch"===this.deliveryType||"hub"===this.deliveryType||(this.deliveryType="branch",this.deliveryBranch||(this.deliveryBranch=this.branch),this.deliveryHubLocationIndex="",this.updateDeliveryFromBranch())}onDeliveryBranchSelect(e){this.deliveryBranch=e,this.updateDeliveryFromBranch()}onDeliveryHubSelect(e){this.deliveryHub=e,this.updateDeliveryFromHub()}onDeliveryPickupSelect(e){if(!e)return;const[n,o]=e.split(":");if("hub"===n)return this.deliveryType="hub",this.deliveryHub=o||"",this.deliveryHubLocationIndex="",void this.updateDeliveryFromHub();"branch"===n&&(this.deliveryType="branch",this.deliveryBranch=o||"",this.deliveryHubLocationIndex="",this.updateDeliveryFromBranch())}onHubDeliveryAddressSelect(e){if(""===e)return;this.deliveryHubLocationIndex=e;const n=this.getSelectedHub();if(!n)return;const r=this.getSelectedHubAddresses()[Number(e)];r&&(this.deliveryAddress=this.formatLocation(r),this.deliveryPincode=String(this.getLocationPin(r)||n.pinCode||"").trim(),this.deliveryLocationId=this.getLocationId(r),this.onRouteChange())}getDeliveryTypeForSave(){return"branch"===this.deliveryType||"hub"===this.deliveryType?"Customer self pick up":"different"===this.deliveryType?"Out for Delivery":this.deliveryType}getBillingSourceEntity(e){if(!e)return null;const[n,o]=e.split(":");if("client"===n){const r=this.clientList.find(s=>String(s?._id)===String(o))||null;return r?{kind:"client",entity:r}:null}if("hub"===n){const r=(this.hubs||[]).find(s=>String(s?._id)===String(o))||null;return r?{kind:"hub",entity:r}:null}return null}buildBillingAddressOptions(e){const n=[],o=this.getBillingSourceEntity(e);if(!o)return n;if("client"===o.kind){if((Array.isArray(o.entity?.deliveryLocations)?o.entity.deliveryLocations:[]).forEach(s=>{const a=this.formatLocation(s),d=this.getLocationId(s);a&&n.push({label:a,locationId:d,address:a})}),!n.length&&o.entity?.address){const s=String(o.entity.address||"").trim();s&&n.push({label:s,locationId:null,address:s})}return n}if("hub"===o.kind){const r=this.formatHubAddress(o.entity);r&&n.push({label:r,locationId:o.entity?._id?String(o.entity._id):null,address:r})}return n}onBillingSourceSelect(e,n=!1){this.billingSource=e;const o=this.getBillingSourceEntity(e);if(this.billingAddressOptions=this.buildBillingAddressOptions(e),n||(this.billingLocationIndex="",this.billingLocationId=null,this.billingPreviousSender="",this.billingClientId=null,this.billingName="",this.billingGSTIN="",this.billingPhone="",this.billingAddress="",this.updatePaymentModeAvailability()),o){if("client"===o.kind)return this.billingName=o.entity.clientName||"",this.billingGSTIN=o.entity.GSTIN||"",this.billingPhone=o.entity.phoneNum||"",this.billingClientId=o.entity._id||null,this.billingPreviousSender=o.entity.clientName||"",void this.updatePaymentModeAvailability();"hub"===o.kind&&(this.billingName=o.entity.hubName||"",this.billingGSTIN="",this.billingPhone=o.entity.phoneNum||"",this.billingClientId=o.entity._id||null,this.billingPreviousSender=o.entity.hubName||"",this.updatePaymentModeAvailability())}}onBillingAddressSelect(e,n=!1){this.billingLocationIndex=e;const o=this.billingAddressOptions[Number(e)];o&&(this.billingAddress=o.address||"",this.billingLocationId=o.locationId,n||this.refreshPricingSuggestions())}onBillingLocationSelect(e){this.billingLocationIndex=e;const o=this.getConsignorLocations()[Number(e)];o&&(this.billingAddress=this.formatLocation(o),this.billingLocationId=this.getLocationId(o),this.refreshPricingSuggestions(),"consignor"===this.pickupType&&this.pickupSource.startsWith("consignor:")&&this.updatePickupFromConsignor())}onBillingPreviousSenderSelect(e){const n=this.clientList.find(s=>s.clientName===e);if(!n)return;this.billingName=n.clientName||"",this.billingGSTIN=n.GSTIN||"",this.billingPhone=n.phoneNum||"";const r=(Array.isArray(n.deliveryLocations)?n.deliveryLocations:[])[0];this.billingAddress=r?this.formatLocation(r):n.address||"",this.billingLocationId=r?this.getLocationId(r):null,this.billingClientId=n._id||null,this.billingLocationIndex="",this.updatePaymentModeAvailability(),this.refreshPricingSuggestions(),"consignor"===this.pickupType&&this.pickupSource.startsWith("consignor:")&&this.updatePickupFromConsignor()}onPickupLocationSelect(e){this.pickupLocationIndex=e;const o=this.getBillingConsignorLocations()[Number(e)];if(!o)return;const r=this.getBillingConsignorClient();r&&(this.pickupName=r.clientName||"",this.pickupPhone=r.phoneNum||""),this.pickupAddress=this.formatLocation(o),this.pickupPincode=this.getLocationPin(o),this.pickupLocationId=this.getLocationId(o),this.pickupSource=`consignor:${e}`,this.onRouteChange()}onPickupBillingLocationSelect(e){this.pickupLocationIndex=e;const o=this.getPickupBillingLocations()[Number(e)];if(!o)return;const r=this.getBillingSourceEntity(this.billingSource);"client"===r?.kind?(this.pickupName=r.entity.clientName||"",this.pickupPhone=r.entity.phoneNum||""):"hub"===r?.kind&&(this.pickupName=r.entity.hubName||"",this.pickupPhone=r.entity.phoneNum||""),this.pickupAddress=this.formatLocation(o),this.pickupPincode=this.getLocationPin(o),this.pickupLocationId=this.getLocationId(o),this.pickupSource=`billing:${e}`,this.onRouteChange()}openPickupEditClient(){const e=this.getPickupSourceClientId();e&&this.openClientModalForEdit(e)}onPickupPreviousSenderSelect(e){const n=this.clientList.find(a=>a.clientName===e);if(!n)return;this.pickupName=n.clientName||"",this.pickupPhone=n.phoneNum||"";const r=(Array.isArray(n.deliveryLocations)?n.deliveryLocations:[])[0];this.pickupAddress=r?this.formatLocation(r):n.address||"",this.pickupPincode=r?this.getLocationPin(r):"",this.pickupLocationId=r?this.getLocationId(r):null;const s=this.getPickupDifferentLocations();this.pickupLocationIndex=s.length?"0":"",this.pickupSource=s.length?"different:0":this.pickupSource,this.onRouteChange()}onPickupDifferentLocationSelect(e){this.pickupLocationIndex=e;const o=this.getPickupDifferentLocations()[Number(e)];if(!o)return;const r=this.clientList.find(s=>s.clientName===this.pickupPreviousSender);r&&(this.pickupName=r.clientName||"",this.pickupPhone=r.phoneNum||""),this.pickupAddress=this.formatLocation(o),this.pickupPincode=this.getLocationPin(o),this.pickupLocationId=this.getLocationId(o),this.pickupSource=`different:${e}`,this.onRouteChange()}onDeliveryLocationSelect(e){this.deliveryLocationIndex=e;const o=this.getConsigneeLocations()[Number(e)];if(!o)return;this.deliveryAddress=this.formatLocation(o),this.deliveryPincode=this.getLocationPin(o),this.deliveryLocationId=this.getLocationId(o);const r=this.clientList.find(s=>s.clientName===this.consignee);this.deliveryID=r?._id||this.deliveryID,this.onRouteChange()}onDeliveryPreviousReceiverSelect(e){const n=this.clientList.find(a=>a.clientName===e);if(!n)return;this.deliveryType="different",this.deliveryName=n.clientName||"",this.deliveryPhone=n.phoneNum||"";const r=(Array.isArray(n.deliveryLocations)?n.deliveryLocations:[])[0];this.deliveryAddress=r?this.formatLocation(r):n.address||"",this.deliveryPincode=r?this.getLocationPin(r):"",this.deliveryLocationId=r?this.getLocationId(r):null;const s=this.getDeliverySelectedClientLocations();this.deliveryLocationIndex=s.length?"0":"",this.deliveryID=n._id||null,this.onRouteChange(),this.updateReceiverCreditAvailability()}onDeliverySelectedLocationSelect(e){this.deliveryLocationIndex=e;const o=this.getDeliverySelectedClientLocations()[Number(e)];if(!o)return;const r=this.clientList.find(s=>s.clientName===this.deliveryPreviousReceiver);r&&(this.deliveryName=r.clientName||"",this.deliveryPhone=r.phoneNum||"",this.deliveryID=r._id||null),this.deliveryAddress=this.formatLocation(o),this.deliveryPincode=this.getLocationPin(o),this.deliveryLocationId=this.getLocationId(o),this.deliveryType="different",this.onRouteChange(),this.updateReceiverCreditAvailability()}onConsignorSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.consignorGST=n.GSTIN,this.consignorAddress=n.address,this.consignorPhone=n.phoneNum,this.maxConsignorDiscount=Number(n.perDis)||0,this.charges.consignorDiscount=this.maxConsignorDiscount,this.selectedConsignorId=n._id,this.consignorId=n._id,"consignor"===this.pickupType&&this.updatePickupFromConsignor(),"consignor"===this.billingType?this.updateBillingFromConsignor():this.billingLocationId=null,this.billingLocationIndex="",this.pickupLocationIndex="",this.refreshPricingSuggestions()),this.updatePaymentModeAvailability()}onConsigneeSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.consigneeGST=n.GSTIN,this.consigneeAddress=n.address,this.consigneePhone=n.phoneNum,this.consigneeId=n._id,(!this.deliveryPreviousReceiver||this.deliveryPreviousReceiver===this.lastConsigneeName)&&(this.deliveryPreviousReceiver=e,this.onDeliveryPreviousReceiverSelect(this.deliveryPreviousReceiver)),"consignee"===this.deliveryType&&this.updateDeliveryFromConsignee(),this.deliveryLocationIndex=""),this.lastConsigneeName=e||"",this.updateReceiverCreditAvailability()}onConsignorGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.consignorGST="GUEST",this.consignorAddress=n.address,this.consignorPhone=n.phoneNum,this.charges.consignorDiscount=0,this.maxConsignorDiscount=0,this.selectedConsignorId=null,this.consignorId=n._id||null,"consignor"===this.pickupType&&this.updatePickupFromConsignor(),"consignor"===this.billingType?this.updateBillingFromConsignor():(this.billingLocationId=null,this.billingLocationIndex=""),this.pickupLocationIndex="",this.suggestedRates={}),this.updatePaymentModeAvailability()}syncConsignorDiscount(){const e=(this.consignor||"").trim();if(!e||"consignor"!==this.consignorTab)return;const n=this.clientList.find(o=>o.clientName===e);this.maxConsignorDiscount=Number(n?.perDis)||0,this.charges.consignorDiscount=this.maxConsignorDiscount}onConsignorDiscountChange(e){const n=Number(e),o=Math.max(0,Math.min(Number.isFinite(n)?n:0,this.maxConsignorDiscount));this.charges.consignorDiscount=o,this.scheduleQuote()}onRateUnitChange(){this.refreshPricingSuggestions()}onPaymentModeChange(){this.isToPayMode()?this.shipmentStatus="To Pay":"To Pay"===this.shipmentStatus&&(this.shipmentStatus="Pending")}onRouteChange(){this.refreshPricingSuggestions()}onProductTypeChange(e){const n=this.getSuggestedRate(e);null!==n&&(null!=e.ratePer&&""!==String(e.ratePer).trim()&&0!==Number(e.ratePer)||(e.ratePer=n,this.scheduleQuote()))}onConsigneeGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.consigneeGST="GUEST",this.consigneeAddress=n.address,this.consigneePhone=n.phoneNum,this.consigneeId=n._id||null,this.deliveryPreviousReceiver===this.lastConsigneeName&&(this.deliveryPreviousReceiver=""),"consignee"===this.deliveryType&&this.updateDeliveryFromConsignee(),this.deliveryLocationIndex=""),this.lastConsigneeName="",this.updateReceiverCreditAvailability()}onPackageList(e){this.pkgList.find(n=>n.pkgName===e)}onProductList(e){this.productList.find(n=>n.productName===e)}formatClientOption(e){return`${e?.GSTIN||"-"} | ${e?.clientName||"-"} | ${e?.address||"-"}`}formatGuestOption(e){return`- | ${e?.guestName||"-"} | ${e?.address||"-"}`}formatBranchAddress(e){return e?[e.address,e.city,e.state,e.pinCode].filter(Boolean).join(", "):""}getSelectedBranchAddressId(e){const o=(Array.isArray(e?.addresses)?e.addresses:[])[0]||null;return o?this.getLocationId(o):e?._id?String(e._id):null}formatHubAddress(e){return e?[e.address,e.city,e.state,e.pinCode].filter(Boolean).join(", "):""}getSelectedHub(){const e=String(this.deliveryHub||"").trim();return e&&(this.hubs||[]).find(n=>n.hubName===e)||null}getSelectedHubAddresses(){const e=this.getSelectedHub();if(!e)return[];const n=[];return e.address&&n.push({address:e.address,city:e.city,state:e.state,pinCode:e.pinCode}),(Array.isArray(e.deliveryAddresses)?e.deliveryAddresses:[]).forEach(r=>{r&&n.push({...r,location:r.location})}),n}updatePickupFromBranch(){if(!this.branchDetails||"All Branches"===this.branch)return this.pickupType="branch",this.pickupName="",this.pickupAddress="",this.pickupPhone="",this.pickupPincode="",this.pickupLocationIndex="",this.pickupLocationId=null,void(this.pickupSource="branch");this.pickupType="branch",this.pickupName=this.branchDetails.branchName||this.branch,this.pickupAddress=this.formatBranchAddress(this.branchDetails),this.pickupPhone=this.branchDetails.phoneNum||"",this.pickupPincode=String(this.branchDetails.pinCode||"").trim(),this.pickupLocationIndex="",this.pickupLocationId=this.getSelectedBranchAddressId(this.branchDetails),this.pickupSource="branch",this.onRouteChange()}updateDeliveryFromBranch(){const e=String(this.deliveryBranch||this.branch||"").trim();if(!e)return this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.deliveryPincode="",this.deliveryLocationIndex="",void(this.deliveryLocationId=null);const o=(this.branches||[]).find(r=>r.branchName===e)||(this.branchDetails?.branchName===e?this.branchDetails:null);o&&(this.deliveryID=o._id||null,this.deliveryBranch=o.branchName||e,this.deliveryName=o.branchName||e,this.deliveryAddress=this.formatBranchAddress(o),this.deliveryPhone=o.phoneNum||"",this.deliveryPincode=String(o.pinCode||"").trim(),this.deliveryLocationIndex="",this.deliveryLocationId=this.getSelectedBranchAddressId(o),this.onRouteChange())}updateDeliveryFromHub(){const e=String(this.deliveryHub||"").trim();if(!e)return this.deliveryID=null,this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.deliveryPincode="",this.deliveryHubLocationIndex="",this.deliveryLocationIndex="",void(this.deliveryLocationId=null);const n=this.getSelectedHub();if(!n)return;this.deliveryID=n._id||null,this.deliveryName=n.hubName||e;const o=this.getSelectedHubAddresses();!this.deliveryHubLocationIndex&&o.length&&(this.deliveryHubLocationIndex="0");const r=o[Number(this.deliveryHubLocationIndex)];this.deliveryAddress=r?this.formatLocation(r):n.address||"",this.deliveryPhone=n.phoneNum||"",this.deliveryPincode=String(this.getLocationPin(r)||n.pinCode||"").trim(),this.deliveryLocationIndex="",this.deliveryLocationId=this.getLocationId(r),this.onRouteChange()}getAvailableHubs(){const e=this.hubs||[],n=this.isAdmin?[]:this.getAssignedoriginLocIds(),o=this.isAdmin?e:n.length?e.filter(r=>n.includes(String(r?.originLocId||"").trim())):[];if(this.branch&&"All Branches"!==this.branch&&"All Hubs"!==this.branch){const r=String(localStorage.getItem("originLocId")||"").trim();return o.filter(s=>String(s?.branch||"")===this.branch||r&&String(s?.originLocId||"")===r)}return o}getSelectedAllHub(){const e=String(this.selectedAllHubId||"").trim();return e&&(this.hubs||[]).find(n=>String(n?._id||"")===e)||null}onAllHubsSelect(e){this.selectedAllHubId=e,this.getCurrentConsignmentNumber()}getAllHubsOptions(){if(this.isAdmin)return this.hubs||[];const e=this.getAssignedoriginLocIds();return e.length?(this.hubs||[]).filter(n=>e.includes(String(n?.originLocId||"").trim())):[]}get isAllHubsSelectionRequired(){return"All Hubs"===this.branch&&!String(this.selectedAllHubId||"").trim()}getAssignedoriginLocIds(){try{const e=JSON.parse(localStorage.getItem("originLocIds")||"[]");return Array.isArray(e)?e.map(n=>String(n||"").trim()).filter(n=>n):[]}catch{return[]}}loadBranchDetails(){this.http.get("http://localhost:3000/api/branches").subscribe({next:e=>{this.branches=e||[],this.rebuildRateAddressOptions(),this.branchDetails=this.branches.find(r=>r.branchName===this.branch)||null;const n=localStorage.getItem("originLocId")||"all",o=this.branchDetails?._id?String(this.branchDetails._id):"";this.branch&&"All Branches"!==this.branch&&o&&("all"===n||!n)&&(localStorage.setItem("originLocId",o),this.newClient.originLocId=o,this.getCurrentConsignmentNumber(),this.loadLists()),this.updatePickupFromBranch(),"branch"===this.deliveryType&&this.updateDeliveryFromBranch()},error:()=>{this.branches=[],this.branchDetails=null,this.rebuildRateAddressOptions(),this.updatePickupFromBranch()}})}rebuildRateAddressOptions(){const e=[];(this.branches||[]).forEach(n=>{const o=Array.isArray(n?.addresses)?n.addresses:[];if(o.forEach(r=>{const s=String(r?._id||"").trim();if(!s)return;const a=[r.address,r.city,r.state,r.pinCode].filter(Boolean),d=`Branch: ${n?.branchName||""} - ${a.join(", ")}`;e.push({id:s,label:d})}),!o.length&&n?._id){const r=[n.address,n.city,n.state,n.pinCode].filter(Boolean),s=`Branch: ${n?.branchName||""} - ${r.join(", ")}`.trim();e.push({id:String(n._id),label:s})}}),(this.hubs||[]).forEach(n=>{(Array.isArray(n?.deliveryAddresses)?n.deliveryAddresses:[]).forEach(r=>{const s=String(r?._id||"").trim();if(!s)return;const a=`Hub: ${n?.hubName||""} - ${r?.location||""}`.trim();e.push({id:s,label:a})})}),(this.rateAddressClients||this.clientList||[]).forEach(n=>{(Array.isArray(n?.deliveryLocations)?n.deliveryLocations:[]).forEach(r=>{const s=String(r?.delivery_id||r?._id||"").trim();if(!s)return;const a=[r.address,r.city,r.state,r.pinCode].filter(Boolean),d=`Client: ${n?.clientName||""} - ${a.join(", ")}`;e.push({id:s,label:d})})}),this.rateAddressOptions=e,this.rateAddressLabelById=new Map(e.map(n=>[n.id,n.label]))}updatePaymentModeAvailability(){const e=String(this.billingClientId||"").trim(),n=e?this.clientList.find(r=>String(r?._id)===e):null,o=String(n?.creditType||"").toLowerCase();this.allowAccountCredit="credit"===o||"credit allowed"===o,this.paymentMode=this.allowAccountCredit?"Account Credit":"To Pay",this.onPaymentModeChange(),this.updateReceiverCreditAvailability()}isPaymentModeEnabled(){return!!String(this.billingClientId||"").trim()}getReceiverCreditClient(){if("consignee"===this.consigneeTab){if(this.consigneeId)return this.clientList.find(e=>String(e?._id)===String(this.consigneeId))||null;if(this.consignee)return this.clientList.find(e=>e.clientName===this.consignee)||null}return this.deliveryPreviousReceiver?this.clientList.find(e=>e.clientName===this.deliveryPreviousReceiver)||null:this.deliveryID&&this.clientList.find(e=>String(e?._id)===String(this.deliveryID))||null}updateReceiverCreditAvailability(){const e=this.getReceiverCreditClient(),n=String(e?.creditType||"").toLowerCase();this.allowReceiverCredit="credit"===n||"credit allowed"===n,!this.allowReceiverCredit&&"To Pay with account credit"===this.paymentMode&&(this.paymentMode="To Pay",this.onPaymentModeChange())}isToPayMode(e=null){const n=String(e??this.paymentMode);return"To Pay"===n||"To Pay with account credit"===n}getSuggestedRate(e){const n=String(e?.type||"").trim();if(!n)return null;const o=this.suggestedRates[n];return null==o?null:Number(o)||0}buildSuggestionKey(e){return[e||"",localStorage.getItem("originLocId")||this.branch||"",String(this.pickupLocationId||"").trim(),String(this.deliveryLocationId||"").trim(),this.rateUnit||""].join("|")}loadPricingSuggestions(e,n,o=0){const r=localStorage.getItem("originLocId")||"all";if(!r||"all"===r||!e||n!==this.suggestionRequestKey)return;const s=this.branch||"",a=e?`originLocId=${encodeURIComponent(r)}&branch=${encodeURIComponent(s)}&clientId=${e}`:`originLocId=${encodeURIComponent(r)}&branch=${encodeURIComponent(s)}`,d=[`pickupLocationId=${encodeURIComponent(this.pickupLocationId||"")}`,`deliveryLocationId=${encodeURIComponent(this.deliveryLocationId||"")}`,`rateUnit=${encodeURIComponent(this.rateUnit)}`].join("&");this.http.get(`http://localhost:3000/api/pricing/suggestions?${a}&${d}`).subscribe({next:p=>{n===this.suggestionRequestKey&&(p?.pricing&&(this.productList=p.pricing,this.suggestedRates={},p.pricing.forEach(g=>{null!=g?.suggestedRate&&(this.suggestedRates[g.productName]=Number(g.suggestedRate)||0)})),this.suggestionRetryHandle&&(clearTimeout(this.suggestionRetryHandle),this.suggestionRetryHandle=null))},error:()=>{if(n!==this.suggestionRequestKey||o>=this.suggestionMaxRetries)return;const p=500*(o+1);this.suggestionRetryHandle&&clearTimeout(this.suggestionRetryHandle),this.suggestionRetryHandle=setTimeout(()=>{this.suggestionRetryHandle=null,this.loadPricingSuggestions(e,n,o+1)},p)}})}getClientIdByLocationId(e){return e&&this.clientList.find(o=>Array.isArray(o?.deliveryLocations)&&o.deliveryLocations.some(r=>this.getLocationId(r)===e))?._id||null}getClientIdForPricing(){return this.getClientIdByLocationId(this.billingLocationId)||(this.billingClientId?this.billingClientId:this.selectedConsignorId)}getPricingGstinId(){const e=this.getClientIdForPricing(),o=(this.clientList.find(s=>s?._id===e)?.GSTIN||"").trim();return o||(String(this.billingGSTIN||"").trim()||"-")}refreshPricingSuggestions(){if(this.shouldSuppressPricingSuggestions())return this.suggestedRates={},this.suggestionRequestKey="",void(this.suggestionRetryHandle&&(clearTimeout(this.suggestionRetryHandle),this.suggestionRetryHandle=null));const e=this.getClientIdForPricing();if(!e)return this.suggestedRates={},this.suggestionRequestKey="",void(this.suggestionRetryHandle&&(clearTimeout(this.suggestionRetryHandle),this.suggestionRetryHandle=null));const n=this.buildSuggestionKey(e);this.suggestionRequestKey=n,this.suggestionRetryHandle&&(clearTimeout(this.suggestionRetryHandle),this.suggestionRetryHandle=null),this.loadPricingSuggestions(e,n,0)}shouldSuppressPricingSuggestions(){if("guest"===this.consignorTab)return!0;const e=String(localStorage.getItem("originLocId")||"").trim(),n=String(this.branch||"").trim().toLowerCase();return!!("all-hubs"===e||"all hubs"===n||this.billingSource&&this.billingSource.startsWith("hub:"))}openClientModal(){this.branch&&"All Branches"!==this.branch?(this.showClientAddTab=!0,this.clientModalTab="add",this.newClient={clientName:"",address:"",city:"",state:"",pinCode:"",GSTIN:"",phoneNum:"",perDis:0,creditType:"no-credit",products:[],deliveryLocations:[{address:"",city:"",state:"",pinCode:""}],status:"active",branch:this.branch,originLocId:localStorage.getItem("originLocId")||"all"},this.clientError="",this.editClientError="",this.selectedEditClientId="",this.showClientModal=!0):alert("Select a branch before adding a client.")}openClientModalForEdit(e){this.branch&&"All Branches"!==this.branch?e&&(this.showClientAddTab=!1,this.clientModalTab="edit",this.clientError="",this.editClientError="",this.selectedEditClientId=e,this.showClientModal=!0,this.loadEditableClients(e)):alert("Select a branch before editing a client.")}setClientModalTab(e,n){this.clientModalTab=e,"edit"===e&&this.loadEditableClients(n)}loadEditableClients(e){const n=localStorage.getItem("originLocId")||"all";!n||"all"===n||this.http.get(`http://localhost:3000/api/clients?originLocId=${encodeURIComponent(n)}`).subscribe({next:o=>{this.editableClientList=o||[],e&&(this.selectedEditClientId=e,this.onEditClientSelect(e))},error:()=>{this.editableClientList=[]}})}onEditClientSelect(e){const n=this.editableClientList.find(o=>o._id===e);n&&(this.editClient={_id:n._id,clientName:n.clientName||"",GSTIN:n.GSTIN||"",phoneNum:n.phoneNum||"",address:n.address||"",city:n.city||"",state:n.state||"",pinCode:n.pinCode||"",branch:n.branch||"",deliveryLocations:Array.isArray(n.deliveryLocations)?n.deliveryLocations.map(o=>({address:o.address||"",city:o.city||"",state:o.state||"",pinCode:o.pinCode||""})):[]},this.editClient.deliveryLocations.length||(this.editClient.deliveryLocations=[{address:"",city:"",state:"",pinCode:""}]),this.editClientError="")}addEditDeliveryLocation(){Array.isArray(this.editClient.deliveryLocations)||(this.editClient.deliveryLocations=[]),this.editClient.deliveryLocations.push({address:"",city:"",state:"",pinCode:""})}removeEditDeliveryLocation(e){this.editClient.deliveryLocations.splice(e,1)}openGuestModal(){this.newGuest={guestName:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",perDis:0},this.guestError="",this.showGuestModal=!0}openProductModal(){const e=localStorage.getItem("originLocId")||"all";e&&"all"!==e?(this.productError="",this.newProduct={hsnNum:"",productName:"",status:"active",originLocId:e,rates:[{pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}}]},this.showProductModal=!0):alert("Select a specific branch before adding a product.")}closeProductModal(){this.showProductModal=!1}addProductRateRow(){Array.isArray(this.newProduct.rates)||(this.newProduct.rates=[]),this.newProduct.rates.push({pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}})}removeProductRateRow(e){Array.isArray(this.newProduct.rates)&&this.newProduct.rates.splice(e,1)}saveNewProduct(){this.productError="";const e=localStorage.getItem("originLocId")||"all";if(!e||"all"===e)return void(this.productError="Select a specific branch before adding a product.");if(!this.newProduct.hsnNum||!this.newProduct.productName)return void(this.productError="Please enter HSN number and product name.");const n=s=>/^[a-f\d]{24}$/i.test(String(s||"").trim()),r=(Array.isArray(this.newProduct.rates)?this.newProduct.rates:[]).filter(s=>{const a=String(s?.pickupLocationId||"").trim(),d=String(s?.deliveryLocationId||"").trim(),p=Number(s?.rate?.ratePerNum||0),g=Number(s?.rate?.ratePerVolume||0),m=Number(s?.rate?.ratePerKg||0),b=p>0||g>0||m>0;return n(a)&&n(d)&&b});this.newProduct.rates=r,this.newProduct.originLocId=e,this.http.post("http://localhost:3000/api/products/add",this.newProduct,{headers:{"Content-Type":"application/json"}}).subscribe({next:()=>{this.closeProductModal(),this.loadLists()},error:s=>{this.productError=s?.error?.message||"Failed to save product."}})}saveNewClient(){if(this.clientError="",!(this.newClient.clientName&&this.newClient.address&&this.newClient.GSTIN&&this.newClient.phoneNum&&this.newClient.branch))return void(this.clientError="Please fill required fields (name, address, GSTIN, phone, branch).");const e="All Hubs"===this.newClient.branch||"all-hubs"===this.newClient.originLocId;if(this.newClient.originLocId=localStorage.getItem("originLocId")||"all","All Hubs"===this.newClient.branch||"all-hubs"===this.newClient.originLocId){const o=this.getSelectedAllHub();if(!o)return void(this.clientError="Select a hub before adding a client.");this.newClient.originLocId=String(o?._id||"").trim(),this.newClient.branch=String(o?.hubName||"").trim()||this.newClient.branch}if("All Branches"===this.newClient.branch||"all"===this.newClient.originLocId)return void(this.clientError="Select a specific branch before adding a client.");const n=e?{...this.newClient,products:[]}:this.newClient;this.http.post("http://localhost:3000/api/clients/add",n).subscribe({next:o=>{this.clientList=[o,...this.clientList],this.consignor=o.clientName,this.onConsignorSelect(this.consignor),this.showClientModal=!1},error:o=>{this.clientError=o?.error?.message||"Failed to save client."}})}saveEditedClient(){if(this.editClientError="",!this.selectedEditClientId)return void(this.editClientError="Select a client to edit.");const e={deliveryLocations:(this.editClient.deliveryLocations||[]).filter(n=>n?.address)};this.http.put(`http://localhost:3000/api/clients/${this.selectedEditClientId}`,e).subscribe({next:()=>{this.showClientModal=!1},error:n=>{this.editClientError=n?.error?.message||"Failed to update client."}})}saveNewGuest(){this.guestError="",this.newGuest.guestName&&this.newGuest.address&&this.newGuest.phoneNum?this.http.post("http://localhost:3000/api/guests/add",this.newGuest).subscribe({next:e=>{this.guestList=[e,...this.guestList],"guest"===this.consignorTab&&(this.consignor=e.guestName,this.onConsignorGuestSelect(this.consignor)),this.showGuestModal=!1},error:e=>{this.guestError=e?.error?.message||"Failed to save guest."}}):this.guestError="Please fill required fields (name, address, phone)."}closeModals(){this.showClientModal=!1,this.showGuestModal=!1}addClientProduct(){this.newClient.products.push({hsnNum:"",productName:"",ratePerNum:0,ratePerVolume:0,ratePerKg:0})}removeClientProduct(e){this.newClient.products.splice(e,1)}addDeliveryLocation(){this.newClient.deliveryLocations.push({address:"",city:"",state:"",pinCode:""})}removeDeliveryLocation(e){this.newClient.deliveryLocations.splice(e,1)}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-new-shipment"]],hostBindings:function(n,o){1&n&&M("beforeunload",function(){return o.onBeforeUnload()},0,Db)},standalone:!0,features:[Ae],decls:233,vars:63,consts:[[1,"page-shell"],[1,"page-header"],[1,"eyebrow"],[1,"subhead"],[1,"meta-stack"],[1,"chip-field"],["type","date",3,"ngModelChange","ngModel"],[1,"layout"],[1,"col"],[1,"card"],[1,"card-head"],["class","head-actions",4,"ngIf"],[1,"grid-2"],["readonly","",3,"ngModelChange","ngModel"],["placeholder","Optional reference ID",3,"ngModelChange","ngModel"],[1,"pill"],[1,"grid-2","party-grid"],[1,"panel"],[1,"panel-head"],[1,"tab-buttons"],[3,"click"],["class","panel-body",4,"ngIf"],[1,"panel","soft"],[4,"ngIf"],[1,"panel-body"],[1,"inline-actions"],[1,"muted"],[1,"toggle-inline"],["type","checkbox",3,"change","checked"],[1,"toggle-track"],[1,"toggle-thumb"],[1,"tiny-btn",3,"click"],[3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"ngModelChange","change","ngModel","disabled"],[1,"field-display"],[1,"label"],[1,"value"],[1,"tab-buttons","ghost"],[1,"panel","soft","span-2"],[1,"grid-2","payment-grid"],["class","muted small-text",4,"ngIf"],[1,"head-actions"],[1,"rate-unit"],["value","box"],["value","cm3"],["value","kg"],[1,"tiny-btn","primary","black",3,"click"],["class","ewaybill",4,"ngFor","ngForOf"],[1,"inline-actions",2,"margin-top","8px"],[1,"charges-grid"],["type","number",3,"ngModelChange","ngModel"],[1,"discount-label"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"discount-row"],["type","number","placeholder","% Discount",3,"ngModelChange","change","ngModel","disabled"],[1,"action-bar"],[1,"summary"],[1,"action-buttons"],[1,"ghost",3,"click"],[1,"ghost",3,"click","disabled"],["class","modal-backdrop",4,"ngIf"],[3,"value"],["type","search","list","consignor-client-list",3,"ngModelChange","ngModel"],["id","consignor-client-list"],["class","inline-actions",4,"ngIf"],["value","branch"],["label","Consignor",4,"ngIf"],["label","Billing",4,"ngIf"],["label","Consignor"],["label","Billing"],["type","search","list","consignee-client-list",3,"ngModelChange","change","ngModel"],["id","consignee-client-list"],["label","Clients"],["label","Hubs"],[1,"muted","small-text"],[1,"ewaybill"],[1,"line-header"],[1,"icon-btn",3,"click"],[1,"grid-3","compact"],["placeholder","Customer Eway-bill No",3,"ngModelChange","ngModel"],["class","invoice-block",4,"ngFor","ngForOf"],[1,"tiny-btn","primary","ghost",3,"click"],[1,"invoice-block"],["placeholder","Customer INV No",3,"ngModelChange","ngModel"],["type","number","placeholder","Value",3,"ngModelChange","ngModel"],[1,"subsection"],[1,"subsection-head"],[1,"subsection-title"],["class","product-row",4,"ngFor","ngForOf"],["class","compact-row",4,"ngFor","ngForOf"],[1,"product-row"],[1,"compact-row"],["type","number","placeholder","Qty",3,"ngModelChange","ngModel"],[1,"rate-inline"],["type","number","placeholder","Rate / Unit",1,"rate-input",3,"ngModelChange","ngModel"],["class","suggested-rate",4,"ngIf"],[1,"suggested-rate"],[3,"ngModelChange","ngModel"],[1,"modal-backdrop"],[1,"modal"],[1,"modal-head"],[1,"modal-actions"],[1,"override-list"],[1,"override-head"],["class","override-item",4,"ngFor","ngForOf"],[1,"override-item"],[1,"override-meta"],[1,"override-action"],[1,"toggle"],[1,"modal","product-modal"],["type","button",1,"icon-btn",3,"click"],["class","inline-fields",4,"ngFor","ngForOf"],["type","button",1,"tiny-btn",3,"click"],["id","rate-addresses"],[3,"value","label",4,"ngFor","ngForOf"],[1,"inline-fields"],["placeholder","Pickup Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["placeholder","Delivery Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / Box",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / cmA3",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / Kg",3,"ngModelChange","ngModel"],[3,"value","label"],["class","tab-buttons","style","margin-bottom: 12px;",4,"ngIf"],[1,"tab-buttons",2,"margin-bottom","12px"],[1,"grid-3"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","PIN",3,"ngModelChange","ngModel"],["class","error",4,"ngIf"],["placeholder","Delivery Address",1,"flex-1",3,"ngModelChange","ngModel"],[1,"error"],[3,"click","disabled"],["readonly","",3,"ngModel"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"header",1)(2,"div")(3,"p",2),u(4,"Operations"),c(),l(5,"h1"),u(6,"New Shipment"),c(),l(7,"p",3),u(8,"Create and save a shipment with consignor/consignee, items, and charges."),c()(),l(9,"div",4)(10,"div",5)(11,"span"),u(12,"Branch"),c(),l(13,"strong"),u(14),c()(),l(15,"div",5)(16,"span"),u(17,"Consignment No."),c(),l(18,"strong"),u(19),c()(),l(20,"div",5)(21,"span"),u(22,"Date"),c(),l(23,"input",6),S("ngModelChange",function(s){return x(o.date,s)||(o.date=s),s}),c()()()(),l(24,"div",7)(25,"div",8)(26,"div",9)(27,"div",10)(28,"div")(29,"p",2),u(30,"Shipment"),c(),l(31,"h3"),u(32,"Shipment Details"),c()(),D(33,AH,8,2,"div",11),c(),l(34,"div",12)(35,"label"),u(36,"Consignment Number* "),l(37,"input",13),S("ngModelChange",function(s){return x(o.consignmentNumber,s)||(o.consignmentNumber=s),s}),c()(),l(38,"label"),u(39,"External Ref ID "),l(40,"input",14),S("ngModelChange",function(s){return x(o.externalRefId,s)||(o.externalRefId=s),s}),c()()()(),l(41,"div",9)(42,"div",10)(43,"div")(44,"p",2),u(45,"Parties"),c(),l(46,"h3"),u(47,"Sender & Receiver"),c()(),l(48,"div",15),u(49,"Branch scoped"),c()(),l(50,"div",16)(51,"div",17)(52,"div",18)(53,"h4"),u(54,"Consignor (Sender)"),c(),l(55,"div",19)(56,"button",20),M("click",function(){return o.consignorTab="consignor"}),u(57,"Client"),c(),l(58,"button",20),M("click",function(){return o.consignorTab="guest"}),u(59,"Guest"),c()()(),D(60,LH,11,2,"div",21)(61,FH,10,2,"div",21),l(62,"div",22),X(63,"div",18),D(64,zH,9,5,"div",21)(65,GH,21,4,"div",23),c()(),l(66,"div",17)(67,"div",18)(68,"h4"),u(69,"Consignee (Receiver)"),c(),l(70,"div",19)(71,"button",20),M("click",function(){return o.consigneeTab="consignee"}),u(72,"Client"),c(),l(73,"button",20),M("click",function(){return o.consigneeTab="guest"}),u(74,"Guest"),c()()(),D(75,qH,11,2,"div",21)(76,QH,10,2,"div",21),l(77,"div",22)(78,"div",24)(79,"div",25)(80,"span",26),u(81,"Delivery Point"),c(),l(82,"label",27)(83,"input",28),M("change",function(s){return o.onDeliverySelfPickupToggle(s)}),c(),l(84,"span",29),X(85,"span",30),c(),l(86,"span"),u(87),c()()(),l(88,"div",25)(89,"button",31),M("click",function(){return o.openClientModal()}),u(90,"+ New Client/Edit Client"),c()(),l(91,"label"),u(92,"Client Name "),l(93,"select",32),S("ngModelChange",function(s){return x(o.deliveryPreviousReceiver,s)||(o.deliveryPreviousReceiver=s),s}),M("change",function(){return o.onDeliveryPreviousReceiverSelect(o.deliveryPreviousReceiver)}),l(94,"option",33),u(95,"Select client"),c(),D(96,ZH,2,2,"option",34),c()(),l(97,"label"),u(98,"Delivery Address "),l(99,"select",35),S("ngModelChange",function(s){return x(o.deliveryLocationIndex,s)||(o.deliveryLocationIndex=s),s}),M("change",function(){return o.onDeliverySelectedLocationSelect(o.deliveryLocationIndex)}),l(100,"option",33),u(101,"Select address"),c(),D(102,YH,2,2,"option",34),c()()(),l(103,"div",36)(104,"span",37),u(105,"Delivery Pincode"),c(),l(106,"span",38),u(107),c()()()()()(),l(108,"div",9)(109,"div",10)(110,"div")(111,"p",2),u(112,"Addresses"),c(),l(113,"h3"),u(114,"Billing"),c()()(),l(115,"div",12)(116,"div",22)(117,"div",18)(118,"h4"),u(119,"Billing"),c(),l(120,"div",39)(121,"button",20),M("click",function(){return o.setBillingType("consignor")}),u(122,"Use Consignor"),c(),l(123,"button",20),M("click",function(){return o.setBillingType("different")}),u(124,"Different"),c()(),l(125,"div",40)(126,"div",24)(127,"div",41)(128,"label"),u(129,"Payment Mode "),l(130,"select",35),S("ngModelChange",function(s){return x(o.paymentMode,s)||(o.paymentMode=s),s}),M("change",function(){return o.onPaymentModeChange()}),l(131,"option"),u(132,"To Pay"),c(),D(133,KH,2,0,"option",23)(134,JH,2,0,"option",23),l(135,"option"),u(136,"Paid"),c()()()()()()(),D(137,n7,31,8,"div",21)(138,o7,7,2,"div",21)(139,r7,2,0,"div",42),c()()()(),l(140,"div",8)(141,"div",9)(142,"div",10)(143,"div")(144,"p",2),u(145,"Items"),c(),l(146,"h3"),u(147,"E-Waybills & Invoices"),c()(),l(148,"div",43)(149,"div",44)(150,"span"),u(151,"Rate Unit"),c(),l(152,"select",32),S("ngModelChange",function(s){return x(o.rateUnit,s)||(o.rateUnit=s),s}),M("change",function(){return o.onRateUnitChange()}),l(153,"option",45),u(154,"Rate / Box"),c(),l(155,"option",46),u(156,"Rate / cmA3"),c(),l(157,"option",47),u(158,"Rate / Kg"),c()()(),l(159,"button",48),M("click",function(){return o.addEwaybill()}),u(160,"+ E-Waybill"),c()()(),D(161,h7,12,4,"div",49),l(162,"div",50)(163,"span",26),u(164,"Need another e-waybill?"),c(),l(165,"button",48),M("click",function(){return o.addEwaybill()}),u(166,"+ E-Waybill"),c()()(),l(167,"div",9)(168,"div",10)(169,"div")(170,"p",2),u(171,"Money"),c(),l(172,"h3"),u(173,"Charges & Payment"),c()()(),l(174,"div",51)(175,"label"),u(176,"ODC "),l(177,"input",52),S("ngModelChange",function(s){return x(o.charges.odc,s)||(o.charges.odc=s),s}),M("ngModelChange",function(){return o.scheduleQuote()}),c()(),l(178,"label"),u(179,"Unloading "),l(180,"input",52),S("ngModelChange",function(s){return x(o.charges.unloading,s)||(o.charges.unloading=s),s}),M("ngModelChange",function(){return o.scheduleQuote()}),c()(),l(181,"label"),u(182,"Docket "),l(183,"input",52),S("ngModelChange",function(s){return x(o.charges.docket,s)||(o.charges.docket=s),s}),M("ngModelChange",function(){return o.scheduleQuote()}),c()(),l(184,"label"),u(185,"Other "),l(186,"input",52),S("ngModelChange",function(s){return x(o.charges.other,s)||(o.charges.other=s),s}),M("ngModelChange",function(){return o.scheduleQuote()}),c()(),l(187,"label"),u(188,"CCC "),l(189,"input",52),S("ngModelChange",function(s){return x(o.charges.ccc,s)||(o.charges.ccc=s),s}),M("ngModelChange",function(){return o.scheduleQuote()}),c()(),l(190,"label")(191,"div",53)(192,"span"),u(193,"Discount (Consignor)"),c(),l(194,"label",27)(195,"input",54),S("ngModelChange",function(s){return x(o.applyConsignorDiscount,s)||(o.applyConsignorDiscount=s),s}),M("change",function(){return o.scheduleQuote()}),c(),l(196,"span",29),X(197,"span",30),c()()(),l(198,"div",55)(199,"input",56),S("ngModelChange",function(s){return x(o.charges.consignorDiscount,s)||(o.charges.consignorDiscount=s),s}),M("change",function(){return o.onConsignorDiscountChange(o.charges.consignorDiscount)}),c()()(),l(200,"label"),u(201,"Initial Paid "),l(202,"input",52),S("ngModelChange",function(s){return x(o.initialPaid,s)||(o.initialPaid=s),s}),c()(),l(203,"label"),u(204,"Final Amount "),l(205,"input",52),S("ngModelChange",function(s){return x(o.finalAmount,s)||(o.finalAmount=s),s}),c()()()()()(),l(206,"div",57)(207,"div",58)(208,"div")(209,"span",2),u(210,"Consignment"),c(),l(211,"strong"),u(212),c()(),l(213,"div")(214,"span",2),u(215,"Branch"),c(),l(216,"strong"),u(217),c()(),l(218,"div")(219,"span",2),u(220,"Final Amount"),c(),l(221,"strong"),u(222),c()()(),l(223,"div",59)(224,"button",60),M("click",function(){return o.resetForm()}),u(225,"Reset"),c(),l(226,"button",61),M("click",function(){return o.saveShipment()}),u(227),c()()()(),D(228,p7,14,0,"div",62)(229,f7,19,2,"div",62)(230,v7,25,4,"div",62)(231,D7,10,4,"div",62)(232,T7,29,8,"div",62)),2&n&&(Ce("all-hubs-lock",o.isAllHubsSelectionRequired),h(14),N(o.branch||"All Branches"),h(5),N(o.consignmentNumber),h(4),w("ngModel",o.date),h(10),C("ngIf","All Hubs"===o.branch),h(4),w("ngModel",o.consignmentNumber),h(3),w("ngModel",o.externalRefId),h(16),Ce("active","consignor"===o.consignorTab),h(2),Ce("active","guest"===o.consignorTab),h(2),C("ngIf","consignor"===o.consignorTab),h(),C("ngIf","guest"===o.consignorTab),h(3),C("ngIf","different"!==o.pickupType),h(),C("ngIf","branch"===o.pickupType),h(6),Ce("active","consignee"===o.consigneeTab),h(2),Ce("active","guest"===o.consigneeTab),h(2),C("ngIf","consignee"===o.consigneeTab),h(),C("ngIf","guest"===o.consigneeTab),h(7),C("checked","branch"===o.deliveryType),h(4),N("branch"===o.deliveryType?"Customer Self Pickup":"Out for delivery too"),h(6),w("ngModel",o.deliveryPreviousReceiver),h(3),C("ngForOf",o.clientList),h(3),w("ngModel",o.deliveryLocationIndex),C("disabled",!o.deliveryPreviousReceiver),h(3),C("ngForOf",o.getDeliverySelectedClientLocations()),h(5),N(o.deliveryPincode||"-"),h(14),Ce("active","consignor"===o.billingType),h(2),Ce("active","different"===o.billingType),h(7),w("ngModel",o.paymentMode),C("disabled",!o.isPaymentModeEnabled()),h(3),C("ngIf",o.allowReceiverCredit),h(),C("ngIf",o.allowAccountCredit),h(3),C("ngIf","different"===o.billingType),h(),C("ngIf","consignor"===o.billingType&&"consignor"===o.consignorTab),h(),C("ngIf","consignor"===o.billingType&&"guest"===o.consignorTab),h(13),w("ngModel",o.rateUnit),h(9),C("ngForOf",o.ewaybills),h(16),w("ngModel",o.charges.odc),h(3),w("ngModel",o.charges.unloading),h(3),w("ngModel",o.charges.docket),h(3),w("ngModel",o.charges.other),h(3),w("ngModel",o.charges.ccc),h(6),w("ngModel",o.applyConsignorDiscount),h(4),w("ngModel",o.charges.consignorDiscount),C("disabled",!o.applyConsignorDiscount),h(3),w("ngModel",o.initialPaid),h(3),w("ngModel",o.finalAmount),h(7),N(o.consignmentNumber),h(5),N(o.branch),h(5),N(o.finalAmount||0),h(4),C("disabled",o.isSaving||!o.hasValidProduct()),h(),k(" ",o.isSaving?"Saving...":"Save"," "),h(),C("ngIf",o.showFinalAmountModal),h(),C("ngIf",o.showRateOverrideModal),h(),C("ngIf",o.showProductModal),h(),C("ngIf",o.showClientModal),h(),C("ngIf",o.showGuestModal))},dependencies:[pt,lt,Xe,et,wt,St,qe,on,Jr,vt,We,He],styles:["[_ngcontent-%COMP%]:root{--bg: #f6f8fb;--card: #ffffff;--border: #e5e7eb;--text: #000000;--muted: #000000;--primary: #2563eb;--primary-strong: #1e3a8a}.page-shell[_ngcontent-%COMP%]{max-width:1280px;margin:0 auto 72px;padding:24px;background:var(--bg);color:var(--text)}.all-hubs-lock[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{pointer-events:none;opacity:.6}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-start;margin-bottom:16px}.eyebrow[_ngcontent-%COMP%]{margin:0;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}h1[_ngcontent-%COMP%]{margin:4px 0;font-size:26px}.subhead[_ngcontent-%COMP%]{margin:0;color:var(--muted);font-size:14px}.meta-stack[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.chip-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:10px 12px;background:#eef2ff;border:1px solid #e0e7ff;border-radius:10px;min-width:160px}.chip-field[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:var(--muted)}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;align-items:start}.card[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 4px 16px #0f172a0d}.card-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px}.head-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.rate-unit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-size:12px;font-weight:600;color:var(--muted)}.rate-unit[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.pill[_ngcontent-%COMP%]{padding:6px 10px;border-radius:20px;background:#e0f2fe;color:#0ea5e9;font-weight:600;font-size:12px;white-space:nowrap}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.payment-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.span-2[_ngcontent-%COMP%]{grid-column:1 / -1}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:13px;color:#1f2937}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;color:var(--text);background:#fff}textarea[_ngcontent-%COMP%]{min-height:70px;resize:vertical}.tab-buttons[_ngcontent-%COMP%]{display:inline-flex;background:#e5e7eb;border-radius:8px;padding:4px;gap:4px}.tab-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:transparent;padding:6px 12px;border-radius:6px;cursor:pointer;color:var(--muted);font-weight:600}.tab-buttons[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#fff;color:var(--primary-strong);box-shadow:0 2px 8px #0f172a1f}.tab-buttons.ghost[_ngcontent-%COMP%]{background:#f8fafc}.party-grid[_ngcontent-%COMP%]{gap:12px}.panel[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:12px;background:#fff;display:flex;flex-direction:column;gap:8px}.panel.soft[_ngcontent-%COMP%]{background:#f8fafc}.panel-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:10px;align-items:center}.panel-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.field-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600;font-size:13px;color:#1f2937}.field-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--muted)}.field-display[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--text)}.inline-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.muted[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text)}.small-text[_ngcontent-%COMP%]{font-size:12px}.tiny-btn[_ngcontent-%COMP%]{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:600}.tiny-btn.primary[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-color:var(--primary)}.tiny-btn.primary.black[_ngcontent-%COMP%]{background:#000;border-color:#000;color:#fff}.tiny-btn.primary.ghost[_ngcontent-%COMP%]{background:#eef2ff;color:var(--primary-strong)}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--border);width:28px;height:28px;border-radius:6px;cursor:pointer;color:var(--muted)}.ewaybill[_ngcontent-%COMP%]{border:1px dashed var(--border);border-radius:12px;padding:12px;margin-bottom:12px;background:#f8fafc}.invoice-block[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;margin-top:10px;display:flex;flex-direction:column;gap:10px}.line-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:space-between;flex-wrap:wrap}.grid-3.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.compact-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 110px auto;gap:8px;align-items:center}.subsection[_ngcontent-%COMP%]{margin-top:8px;border:1px dashed var(--border);border-radius:10px;padding:10px;background:#fff}.subsection-title[_ngcontent-%COMP%]{font-weight:600;color:var(--muted);margin-bottom:8px}.subsection-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}.subsection-head[_ngcontent-%COMP%]   .subsection-title[_ngcontent-%COMP%]{margin-bottom:0}.charges-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-top:12px}.discount-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px}.discount-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.toggle-inline[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--muted)}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;pointer-events:none}.toggle-inline[_ngcontent-%COMP%]   .toggle-track[_ngcontent-%COMP%]{position:relative;width:38px;height:20px;background:#e5e7eb;border-radius:999px;display:inline-flex;align-items:center;padding:2px;box-sizing:border-box;transition:background .2s ease}.toggle-inline[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 1px 2px #00000026;transform:translate(0);transition:transform .2s ease}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]{background:#22c55e}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(18px)}.action-bar[_ngcontent-%COMP%]{position:sticky;bottom:0;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 16px;background:#fffffff2;border:1px solid var(--border);border-radius:12px;box-shadow:0 -4px 16px #0f172a14;margin-top:12px}.summary[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}button.primary[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border:1px solid var(--primary);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}button.ghost[_ngcontent-%COMP%]{background:#f8fafc;color:var(--text);border:1px solid var(--border);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000059;display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px}.modal[_ngcontent-%COMP%], .product-modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;width:min(520px,100%);box-shadow:0 10px 40px #00000029;display:flex;flex-direction:column;gap:10px;max-height:90vh;overflow-y:auto}.product-modal[_ngcontent-%COMP%]   .modal-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.product-modal[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}.product-modal[_ngcontent-%COMP%]   .icon-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #e5e7eb;width:28px;height:28px;border-radius:6px;cursor:pointer;color:#6b7280}.product-modal[_ngcontent-%COMP%]   .inline-fields[_ngcontent-%COMP%]{display:flex;gap:8px;flex:1;min-width:260px;flex-wrap:wrap}.product-modal[_ngcontent-%COMP%]   .tiny-btn[_ngcontent-%COMP%]{background:#f8fafc;color:#111827;border:1px solid #e5e7eb;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600}.modal-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.modal[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;min-height:70px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}.error[_ngcontent-%COMP%]{color:#b91c1c;font-size:12px}.override-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.override-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;font-weight:700;color:var(--muted);padding-bottom:4px;border-bottom:1px solid var(--border)}.override-item[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;font-size:13px}.override-meta[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;flex:1 1 260px}.override-action[_ngcontent-%COMP%]{min-width:200px}.toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:12px;color:var(--muted)}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;pointer-events:none}.toggle-track[_ngcontent-%COMP%]{position:relative;width:38px;height:20px;background:#e5e7eb;border-radius:999px;display:inline-flex;align-items:center;padding:2px;box-sizing:border-box;transition:background .2s ease}.toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 1px 2px #00000026;transform:translate(0);transition:transform .2s ease}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]{background:#22c55e}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(18px)}.inline-fields[_ngcontent-%COMP%]{display:flex;gap:8px;flex:1;min-width:260px}.inline-fields[_ngcontent-%COMP%]   .flex-1[_ngcontent-%COMP%]{flex:1;min-width:160px}.product-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.rate-input[_ngcontent-%COMP%]{max-width:160px}.rate-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.suggested-rate[_ngcontent-%COMP%]{color:#16a34a;font-size:12px;font-weight:600}@media (max-width: 1080px){.layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 720px){.grid-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.grid-3[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.meta-stack[_ngcontent-%COMP%], .action-bar[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 520px){.grid-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.inline-fields[_ngcontent-%COMP%]{flex-direction:column}.compact-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})();function E7(t,i){if(1&t&&(l(0,"option",21),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.hubName)}}function A7(t,i){if(1&t){const e=O();l(0,"select",19),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.selectedHubFilterId,o)||(r.selectedHubFilterId=o),v(o)}),M("ngModelChange",function(o){return _(e),v(f(2).onHubFilterChange(o))}),D(1,E7,2,2,"option",20),c()}if(2&t){const e=f(2);w("ngModel",e.selectedHubFilterId),h(),C("ngForOf",e.getAllHubsFilterOptions())}}function O7(t,i){if(1&t){const e=O();l(0,"tr",22),M("click",function(){const o=_(e).$implicit;return v(f(2).openShipmentDetails(o))}),l(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td"),u(12),c(),l(13,"td"),u(14),c()()}if(2&t){const e=i.$implicit,n=f(2);h(2),N(e.consignmentNumber),h(2),N(e.shipmentStatus),h(2),N(e.branch),h(2),N(n.getCurrentBranchDisplay(e)),h(2),N(e.consignor),h(2),N(e.deliveryAddress),h(2),N(n.getInvoiceAmountTotal(e.invoices))}}function L7(t,i){if(1&t){const e=O();l(0,"div")(1,"div",6)(2,"input",7),S("ngModelChange",function(o){_(e);const r=f();return x(r.searchText,o)||(r.searchText=o),v(o)}),M("input",function(){return _(e),v(f().applyFilters())}),c(),l(3,"input",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterDate,o)||(r.filterDate=o),v(o)}),M("change",function(){return _(e),v(f().applyFilters())}),c(),l(4,"select",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterStatus,o)||(r.filterStatus=o),v(o)}),M("change",function(){return _(e),v(f().applyFilters())}),l(5,"option",10),u(6,"All Status"),c(),l(7,"option",11),u(8,"Pending"),c(),l(9,"option",12),u(10,"Manifested"),c(),l(11,"option",13),u(12,"Delivered"),c()(),D(13,A7,2,2,"select",14),l(14,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterConsignor,o)||(r.filterConsignor=o),v(o)}),M("input",function(){return _(e),v(f().applyFilters())}),c()(),l(15,"div",16)(16,"table",17)(17,"thead")(18,"tr")(19,"th"),u(20,"Consignment No."),c(),l(21,"th"),u(22,"Status"),c(),l(23,"th"),u(24,"Branch"),c(),l(25,"th"),u(26,"Current Branch"),c(),l(27,"th"),u(28,"Consignor"),c(),l(29,"th"),u(30,"Delivery Address"),c(),l(31,"th"),u(32,"No. of Products"),c()()(),l(33,"tbody"),D(34,O7,15,7,"tr",18),c()()()()}if(2&t){const e=f();h(2),w("ngModel",e.searchText),h(),w("ngModel",e.filterDate),h(),w("ngModel",e.filterStatus),h(9),C("ngIf","all-hubs"===e.originLocId),h(),w("ngModel",e.filterConsignor),h(20),C("ngForOf",e.filteredShipments)}}function R7(t,i){if(1&t){const e=O();l(0,"button",26),M("click",function(){return _(e),v(f(2).openReturnModal())}),u(1,"Return"),c()}}function F7(t,i){if(1&t&&(l(0,"option",21),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.hubName)}}function B7(t,i){if(1&t){const e=O();l(0,"select",19),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.selectedHubFilterId,o)||(r.selectedHubFilterId=o),v(o)}),M("ngModelChange",function(o){return _(e),v(f(2).onHubFilterChange(o))}),D(1,F7,2,2,"option",20),c()}if(2&t){const e=f(2);w("ngModel",e.selectedHubFilterId),h(),C("ngForOf",e.getAllHubsFilterOptions())}}function V7(t,i){if(1&t){const e=O();l(0,"tr",22),M("click",function(){const o=_(e).$implicit;return v(f(2).openShipmentDetails(o))}),l(1,"td")(2,"input",27),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r._returnSelected,o)||(r._returnSelected=o),v(o)}),M("click",function(o){return _(e),v(o.stopPropagation())}),c()(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td"),u(12),c(),l(13,"td"),u(14),c(),l(15,"td"),u(16),c()()}if(2&t){const e=i.$implicit,n=f(2);h(2),w("ngModel",e._returnSelected),C("disabled",n.isCancelled(e)),h(2),N(e.consignmentNumber),h(2),N(e.branch),h(2),N(n.getCurrentBranchDisplay(e)),h(2),N(e.consignor),h(2),N(e.shipmentStatus),h(2),N(e.deliveryAddress),h(2),N(n.getInvoiceAmountTotal(e.invoices))}}function H7(t,i){if(1&t){const e=O();l(0,"div")(1,"div",23),D(2,R7,2,0,"button",24),c(),l(3,"div",6)(4,"input",7),S("ngModelChange",function(o){_(e);const r=f();return x(r.searchText,o)||(r.searchText=o),v(o)}),M("input",function(){return _(e),v(f().applyFilters())}),c(),l(5,"input",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterDate,o)||(r.filterDate=o),v(o)}),M("change",function(){return _(e),v(f().applyFilters())}),c(),l(6,"select",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterStatus,o)||(r.filterStatus=o),v(o)}),M("change",function(){return _(e),v(f().applyFilters())}),l(7,"option",10),u(8,"All Status"),c(),l(9,"option",11),u(10,"Pending"),c(),l(11,"option",12),u(12,"Manifested"),c(),l(13,"option",13),u(14,"Delivered"),c()(),D(15,B7,2,2,"select",14),l(16,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.filterConsignor,o)||(r.filterConsignor=o),v(o)}),M("input",function(){return _(e),v(f().applyFilters())}),c()(),l(17,"div",16)(18,"table",17)(19,"thead")(20,"tr")(21,"th")(22,"input",25),M("change",function(o){return _(e),v(f().toggleAllReceived(o))}),c()(),l(23,"th"),u(24,"Consignment No."),c(),l(25,"th"),u(26,"Branch"),c(),l(27,"th"),u(28,"Current Branch"),c(),l(29,"th"),u(30,"Consignor"),c(),l(31,"th"),u(32,"Status"),c(),l(33,"th"),u(34,"Delivery Address"),c(),l(35,"th"),u(36,"No. of Products"),c()()(),l(37,"tbody"),D(38,V7,17,9,"tr",18),c()()()()}if(2&t){const e=f();h(2),C("ngIf",e.hasSelectedReceived()),h(2),w("ngModel",e.searchText),h(),w("ngModel",e.filterDate),h(),w("ngModel",e.filterStatus),h(9),C("ngIf","all-hubs"===e.originLocId),h(),w("ngModel",e.filterConsignor),h(22),C("ngForOf",e.filteredReceived)}}function j7(t,i){if(1&t){const e=O();l(0,"input",42),S("ngModelChange",function(o){_(e);const r=f().$implicit;return x(r.returnFinalAmount,o)||(r.returnFinalAmount=o),v(o)}),c()}2&t&&w("ngModel",f().$implicit.returnFinalAmount)}function U7(t,i){if(1&t&&(l(0,"li")(1,"span",40)(2,"span"),u(3),c(),D(4,j7,1,1,"input",41),c()()),2&t){const e=i.$implicit,n=f(2);h(3),Be("",e.consignmentNumber," - ",e.consignor,""),h(),C("ngIf",n.showReturnFinalAmount)}}function z7(t,i){if(1&t){const e=O();l(0,"div",28)(1,"div",29)(2,"button",30),M("click",function(){return _(e),v(f().closeReturnModal())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Confirm Return"),c(),l(6,"p"),u(7,"Mark the selected consignments as returned?"),c(),l(8,"label",31)(9,"span"),u(10,"Customer side return and paid by the customer"),c(),l(11,"span",32)(12,"input",33),S("ngModelChange",function(o){_(e);const r=f();return x(r.showReturnFinalAmount,o)||(r.showReturnFinalAmount=o),v(o)}),c(),l(13,"span",34),X(14,"span",35),c()()(),l(15,"ul",36),D(16,U7,5,3,"li",37),c(),l(17,"div",38)(18,"button",39),M("click",function(){return _(e),v(f().closeReturnModal())}),u(19,"Cancel"),c(),l(20,"button",26),M("click",function(){return _(e),v(f().returnSelected())}),u(21,"Return"),c()()()()}if(2&t){const e=f();h(12),w("ngModel",e.showReturnFinalAmount),h(4),C("ngForOf",e.getSelectedReceived())}}function G7(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f(3);h(),k("",e.selectedShipmentManifestNumber," \u2014 ")}}function $7(t,i){if(1&t&&(l(0,"p")(1,"strong"),u(2,"Manifest:"),c(),l(3,"a",51),D(4,G7,2,1,"span",3),u(5),c()()),2&t){const e=f(2);h(3),C("href",e.getManifestUrl(e.selectedShipmentManifestId),As),h(),C("ngIf",e.selectedShipmentManifestNumber),h(),k(" ",e.selectedShipmentManifestId," ")}}function q7(t,i){if(1&t&&(l(0,"li")(1,"span",55),u(2),c(),l(3,"span",56),u(4),c(),l(5,"span",56),u(6),c()()),2&t){const e=i.$implicit;h(2),N(e.type),h(2),k("In Stock: ",e.instock,""),h(2),k("Total: ",e.amount,"")}}function W7(t,i){if(1&t&&(l(0,"div",52)(1,"div",53),u(2),c(),l(3,"ul",54),D(4,q7,7,3,"li",37),c()()),2&t){const e=i.$implicit;h(2),k("Invoice #",e.number,""),h(2),C("ngForOf",e.products)}}function Q7(t,i){if(1&t){const e=O();l(0,"div",43)(1,"div",44)(2,"button",30),M("click",function(){return _(e),v(f().closeShipmentDetails())}),u(3,"\xd7"),c(),l(4,"div",45)(5,"div")(6,"h2"),u(7,"Shipment Details"),c(),l(8,"p",46),u(9),c()(),l(10,"span",47),u(11),c()(),l(12,"div",48)(13,"p")(14,"strong"),u(15,"Shipment ID:"),c(),u(16),c(),l(17,"p")(18,"strong"),u(19,"Consignment No.:"),c(),u(20),c(),l(21,"p")(22,"strong"),u(23,"Status:"),c(),u(24),c(),l(25,"p")(26,"strong"),u(27,"Status Details:"),c(),u(28),c(),D(29,$7,6,3,"p",3),l(30,"p")(31,"strong"),u(32,"Branch:"),c(),u(33),c(),l(34,"p")(35,"strong"),u(36,"Current Branch:"),c(),u(37),c(),l(38,"p")(39,"strong"),u(40,"Current Vehicle No.:"),c(),u(41),c(),l(42,"p")(43,"strong"),u(44,"Current Vehicle Owner Type:"),c(),u(45),c(),l(46,"p")(47,"strong"),u(48,"Current Vehicle Owner ID:"),c(),u(49),c(),l(50,"p")(51,"strong"),u(52,"Consignor:"),c(),u(53),c(),l(54,"p")(55,"strong"),u(56,"Consignor GST:"),c(),u(57),c(),l(58,"p")(59,"strong"),u(60,"Consignor Phone:"),c(),u(61),c(),l(62,"p")(63,"strong"),u(64,"Consignor Address:"),c(),u(65),c(),l(66,"p")(67,"strong"),u(68,"Consignee:"),c(),u(69),c(),l(70,"p")(71,"strong"),u(72,"Consignee GST:"),c(),u(73),c(),l(74,"p")(75,"strong"),u(76,"Consignee Phone:"),c(),u(77),c(),l(78,"p")(79,"strong"),u(80,"Consignee Address:"),c(),u(81),c(),l(82,"p")(83,"strong"),u(84,"Payment Mode:"),c(),u(85),c(),l(86,"p")(87,"strong"),u(88,"External Ref ID:"),c(),u(89),c(),l(90,"p")(91,"strong"),u(92,"Billing Type:"),c(),u(93),c(),l(94,"p")(95,"strong"),u(96,"Billing Name:"),c(),u(97),c(),l(98,"p")(99,"strong"),u(100,"Billing GSTIN:"),c(),u(101),c(),l(102,"p")(103,"strong"),u(104,"Billing Phone:"),c(),u(105),c(),l(106,"p")(107,"strong"),u(108,"Billing Address:"),c(),u(109),c(),l(110,"p")(111,"strong"),u(112,"Pickup Type:"),c(),u(113),c(),l(114,"p")(115,"strong"),u(116,"Pickup Name:"),c(),u(117),c(),l(118,"p")(119,"strong"),u(120,"Pickup Phone:"),c(),u(121),c(),l(122,"p")(123,"strong"),u(124,"Pickup Address:"),c(),u(125),c(),l(126,"p")(127,"strong"),u(128,"Pickup Pincode:"),c(),u(129),c(),l(130,"p")(131,"strong"),u(132,"Delivery Type:"),c(),u(133),c(),l(134,"p")(135,"strong"),u(136,"Delivery To:"),c(),u(137),c(),l(138,"p")(139,"strong"),u(140,"Delivery Phone:"),c(),u(141),c(),l(142,"p")(143,"strong"),u(144,"Delivery Address:"),c(),u(145),c(),l(146,"p")(147,"strong"),u(148,"Delivery Pincode:"),c(),u(149),c(),l(150,"p")(151,"strong"),u(152,"Date:"),c(),u(153),hi(154,"date"),c(),l(155,"p")(156,"strong"),u(157,"Final Amount:"),c(),u(158),c(),l(159,"p")(160,"strong"),u(161,"Charges - ODC:"),c(),u(162),c(),l(163,"p")(164,"strong"),u(165,"Charges - Unloading:"),c(),u(166),c(),l(167,"p")(168,"strong"),u(169,"Charges - Docket:"),c(),u(170),c(),l(171,"p")(172,"strong"),u(173,"Charges - Other:"),c(),u(174),c(),l(175,"p")(176,"strong"),u(177,"Charges - CCC:"),c(),u(178),c(),l(179,"p")(180,"strong"),u(181,"Charges - Consignor Discount:"),c(),u(182),c(),l(183,"p")(184,"strong"),u(185,"Products in stock:"),c(),u(186),c(),l(187,"p")(188,"strong"),u(189,"No. of Products:"),c(),u(190),c()(),l(191,"h3"),u(192,"Products"),c(),l(193,"div",49),D(194,W7,5,2,"div",50),c()()()}if(2&t){const e=f();h(9),k("Consignment ",e.selectedShipment.consignmentNumber,""),h(2),N(e.selectedShipment.shipmentStatus),h(5),k(" ",e.selectedShipment._id,""),h(4),k(" ",e.selectedShipment.consignmentNumber,""),h(4),k(" ",e.selectedShipment.shipmentStatus,""),h(4),k(" ",e.selectedShipment.shipmentStatusDetails,""),h(),C("ngIf",e.selectedShipmentManifestId),h(4),k(" ",e.getOriginBranchDisplay(e.selectedShipment),""),h(4),k(" ",e.getCurrentBranchDisplay(e.selectedShipment),""),h(4),k(" ",e.selectedShipment.currentVehicleNo,""),h(4),k(" ",e.selectedShipment.currentVehicleOwnerType,""),h(4),k(" ",e.selectedShipment.currentVehicleOwnerId,""),h(4),k(" ",e.selectedShipment.consignor,""),h(4),k(" ",e.selectedShipment.consignorGST,""),h(4),k(" ",e.selectedShipment.consignorPhone,""),h(4),k(" ",e.selectedShipment.consignorAddress,""),h(4),k(" ",e.selectedShipment.consignee,""),h(4),k(" ",e.selectedShipment.consigneeGST,""),h(4),k(" ",e.selectedShipment.consigneePhone,""),h(4),k(" ",e.selectedShipment.consigneeAddress,""),h(4),k(" ",e.selectedShipment.paymentMode,""),h(4),k(" ",e.selectedShipment.externalRefId,""),h(4),k(" ",e.selectedShipment.billingType,""),h(4),k(" ",e.selectedShipment.billingName,""),h(4),k(" ",e.selectedShipment.billingGSTIN,""),h(4),k(" ",e.selectedShipment.billingPhone,""),h(4),k(" ",e.selectedShipment.billingAddress,""),h(4),k(" ",e.selectedShipment.pickupType,""),h(4),k(" ",e.selectedShipment.pickupName,""),h(4),k(" ",e.selectedShipment.pickupPhone,""),h(4),k(" ",e.selectedShipment.pickupAddress,""),h(4),k(" ",e.selectedShipment.pickupPincode,""),h(4),k(" ",e.selectedShipment.deliveryType,""),h(4),k(" ",e.getDeliveryDisplayName(e.selectedShipment),""),h(4),k(" ",e.selectedShipment.deliveryPhone,""),h(4),k(" ",e.selectedShipment.deliveryAddress,""),h(4),k(" ",e.selectedShipment.deliveryPincode,""),h(4),k(" ",_o(154,48,e.selectedShipment.date,"short"),""),h(5),k(" ",e.selectedShipment.finalAmount,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.odc,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.unloading,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.docket,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.other,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.ccc,""),h(4),k(" ",null==e.selectedShipment||null==e.selectedShipment.charges?null:e.selectedShipment.charges.consignorDiscount,""),h(4),k(" ",e.getInStockAmountTotal(e.selectedShipment.invoices),""),h(4),k(" ",e.getInvoiceAmountTotal(e.selectedShipment.invoices),""),h(4),C("ngForOf",e.selectedShipment.invoices)}}let Z7=(()=>{class t{constructor(e){this.http=e,this.shipments=[],this.filteredShipments=[],this.receivedShipments=[],this.filteredReceived=[],this.branches=[],this.hubs=[],this.originLocId=localStorage.getItem("originLocId")||"all",this.selectedHubFilterId=null,this.selectedHubFilterName="",this.clientList=[],this.guestList=[],this.email="",this.searchText="",this.filterDate="",this.filterStatus="",this.filterConsignor="",this.activeTab="all",this.selectedShipment=null,this.selectedShipmentManifestId=null,this.selectedShipmentManifestNumber=null,this.showReturnModal=!1,this.showReturnFinalAmount=!1}ngOnInit(){this.email=localStorage.getItem("email")||"",this.loadShipments(),this.loadReceivedShipments(),this.loadBranches(),this.loadHubs(),this.loadClients(),this.loadGuests()}loadShipments(){const e=localStorage.getItem("originLocId")||"all",n={username:localStorage.getItem("username")||""},o=this.getSelectedOrigin();o?(n.originType=o.originType,n.originLocId=o.originLocId):n.originLocId="all-hubs"===e?"all":e,this.http.get("http://localhost:3000/api/newshipments",{params:n}).subscribe({next:r=>{const s=(r||[]).map(a=>({...a,branch:this.getOriginBranchDisplay(a),invoices:this.flattenInvoices(a.ewaybills||a.invoices||[])}));this.shipments=s,this.filteredShipments=s},error:r=>console.error("Error loading shipments:",r)})}loadReceivedShipments(){this.http.get("http://localhost:3000/api/newshipments",{params:{username:localStorage.getItem("username")||"",originLocId:"all"}}).subscribe({next:e=>{const n=(e||[]).map(o=>({...o,branch:this.getOriginBranchDisplay(o),invoices:this.flattenInvoices(o.ewaybills||o.invoices||[])}));this.receivedShipments=n,this.applyFilters()},error:e=>console.error("Error loading received shipments:",e)})}loadBranches(){this.http.get("http://localhost:3000/api/branches").subscribe({next:e=>{this.branches=e||[]},error:e=>console.error("Error loading branches:",e)})}loadHubs(){this.http.get("http://localhost:3000/api/hubs").subscribe({next:e=>{this.hubs=e||[]},error:e=>console.error("Error loading hubs:",e)})}loadClients(){this.email&&this.http.get(`http://localhost:3000/api/clients/clientslist?emailId=${this.email}`).subscribe({next:e=>{this.clientList=e||[]},error:e=>console.error("Error loading clients:",e)})}loadGuests(){this.email&&this.http.get(`http://localhost:3000/api/guests/guestslist?emailId=${this.email}`).subscribe({next:e=>{this.guestList=e||[]},error:e=>console.error("Error loading guests:",e)})}flattenInvoices(e){return(e||[]).flatMap(n=>n.invoices||[])}getProductTotal(e,n){return e?e.reduce((o,r)=>{const s=r.products?.reduce((a,d)=>a+Number(d[n]||0),0)||0;return o+Number(s||0)},0):0}getInStockAmountTotal(e){return this.getProductTotal(e,"instock")}getInvoiceAmountTotal(e){let n=0;return(e||[]).forEach(o=>{(o.products||[]).forEach(r=>{n+=Number(r.amount||0)})}),n}applyFilters(){this.originLocId=localStorage.getItem("originLocId")||"all";const e=String(this.originLocId||"").trim(),n=this.normalizeId(this.selectedHubFilterId),o="all-hubs"===e;if(o&&!n){const d=this.normalizeId(localStorage.getItem("hubId")),p=String(localStorage.getItem("hubName")||"").trim();if(d){const g=(this.hubs||[]).find(m=>this.normalizeId(m?._id)===d);this.selectedHubFilterId=d,this.selectedHubFilterName=String(g?.hubName||p||"").trim()}else{const g=this.getAllHubsFilterOptions(),m=this.normalizeId(g?.[0]?._id);this.selectedHubFilterId=m||null,this.selectedHubFilterName=String(g?.[0]?.hubName||"").trim()}}const r=this.normalizeId(this.selectedHubFilterId);if(r&&!this.selectedHubFilterName){const d=(this.hubs||[]).find(p=>this.normalizeId(p?._id)===r);this.selectedHubFilterName=String(d?.hubName||"").trim()}const s=this.selectedHubFilterName,a=String(localStorage.getItem("branch")||"").trim();this.filteredShipments=this.shipments.filter(d=>{const p=!this.searchText||d.consignmentNumber?.toLowerCase().includes(this.searchText.toLowerCase())||d.consignor?.toLowerCase().includes(this.searchText.toLowerCase()),g=!this.filterDate||new Date(d.date).toDateString()===new Date(this.filterDate).toDateString(),m=!this.filterStatus||d.shipmentStatus===this.filterStatus,b=!this.filterConsignor||d.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()),y=!o||r&&this.matchesHubFilterForShipment(d,r,s),I=(()=>{const P=this.getOriginId(d),T=String(d?.branch||"").trim();if(!e||"all"===e)return!0;if("all-hubs"===e){if(!r)return!1;const te=String(s||"").trim().toLowerCase(),Te=T.toLowerCase();return P===r||te&&(Te===te||this.matchesBranchLabel(T,s))}const A=this.normalizeId(e),E=(this.branches||[]).find(te=>this.normalizeId(te?._id)===A),V=String(E?.branchName||a||"").trim(),U=V.toLowerCase(),G=T.toLowerCase();return P===A||U&&(G===U||this.matchesBranchLabel(T,V))})();return p&&g&&m&&b&&y&&I}),this.filteredReceived=this.receivedShipments.filter(d=>{const g=!this.searchText||d.consignmentNumber?.toLowerCase().includes(this.searchText.toLowerCase())||d.consignor?.toLowerCase().includes(this.searchText.toLowerCase()),m=!this.filterDate||new Date(d.date).toDateString()===new Date(this.filterDate).toDateString(),b=!this.filterStatus||d.shipmentStatus===this.filterStatus,y=!this.filterConsignor||d.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase());return g&&m&&b&&y})}getAllHubsFilterOptions(){return this.hubs||[]}onHubFilterChange(e){this.selectedHubFilterId=e;const n=(this.hubs||[]).find(o=>this.normalizeId(o?._id)===this.normalizeId(e));this.selectedHubFilterName=String(n?.hubName||"").trim(),e&&(localStorage.setItem("hubId",String(e)),localStorage.setItem("hubName",this.selectedHubFilterName)),this.applyFilters()}matchesHubIdOrName(e,n,o,r){if(!o)return!1;const s=this.normalizeId(e),a=String(n||"").trim();if(s&&s===o)return!0;if(!r||!a)return!1;const p=r.toLowerCase();return a.toLowerCase()===p||this.matchesBranchLabel(a,r)}matchesHubFilterForShipment(e,n,o){const r=this.normalizeId(e?.currentLocationId||e?.currentBranch),s=String(e?.currentBranch||"").trim(),a=this.getOriginId(e),d=String(e?.branch||"").trim();return this.matchesHubIdOrName(r,s,n,o)||this.matchesHubIdOrName(a,d,n,o)}matchesBranchLabel(e,n){const o=String(e||"").trim().toLowerCase(),r=String(n||"").trim().toLowerCase();if(!o||!r)return!1;if(r===o||r.startsWith(`${o}-`))return!0;const s=r.split("-")[0].trim();return!!s&&s===o}hasSelectedReceived(){return(this.filteredReceived||[]).some(e=>e._returnSelected)}getSelectedReceived(){return(this.filteredReceived||[]).filter(e=>e._returnSelected)}toggleAllReceived(e){const n=e.target.checked;(this.filteredReceived||[]).forEach(o=>{this.isCancelled(o)||(o._returnSelected=n)})}openReturnModal(){this.hasSelectedReceived()&&(this.getSelectedReceived().forEach(e=>{(null==e.returnFinalAmount||""===e.returnFinalAmount)&&(e.returnFinalAmount=e.finalAmount??"")}),this.showReturnModal=!0,this.showReturnFinalAmount=!1)}closeReturnModal(){this.showReturnModal=!1,this.showReturnFinalAmount=!1}returnSelected(){const e=(this.filteredReceived||[]).filter(n=>n._returnSelected);e.length&&(e.forEach(n=>{this.showReturnFinalAmount?this.createCustomerReturnConsignment(n):this.createBranchReturnConsignment(n),(new Date).toISOString(),localStorage.getItem("username");const s=localStorage.getItem("branch")||"",a=s?`/${s}`:"",d={...n,shipmentStatus:"Returned",shipmentStatusDetails:a};this.showReturnFinalAmount&&(d.finalAmount=n.returnFinalAmount??n.finalAmount),this.http.post("http://localhost:3000/api/newshipments/updateConsignment",{updatedConsignment:d}).subscribe({next:()=>{this.loadReceivedShipments()},error:p=>{console.error("Error returning consignment:",p)}})}),e.forEach(n=>n._returnSelected=!1),this.showReturnModal=!1)}isDelivered(e){return String(e?.shipmentStatus||"").toLowerCase().includes("delivered")}isCancelled(e){const n=String(e?.shipmentStatus||"").toLowerCase();return"cancelled"===n||"returned"===n}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}getSelectedOrigin(){const e=this.originLocId||localStorage.getItem("originLocId")||"all";if(!e||"all"===e)return null;if("all-hubs"===e){const o=this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId"));return o?{originType:"hub",originLocId:o}:null}const n=this.normalizeId(e);return n?{originType:"branch",originLocId:n}:null}getOriginId(e){return e?this.normalizeId(e?.originLocId||e?.originLocId||e?.originLocId||e?.branch):""}getCurrentBranchDisplay(e){const n=this.normalizeId(e?.currentLocationId||e?.currentBranch);if(!n)return"-";const o=(this.branches||[]).find(s=>this.normalizeId(s?._id)===n);if(o?.branchName)return o.branchName;const r=(this.hubs||[]).find(s=>this.normalizeId(s?._id)===n);return r?.hubName?r.hubName:n}getOriginBranchDisplay(e){const n=this.getOriginId(e);if(!n)return"-";const o=(this.branches||[]).find(s=>this.normalizeId(s?._id)===n);if(o?.branchName)return o.branchName;const r=(this.hubs||[]).find(s=>this.normalizeId(s?._id)===n);return r?.hubName?r.hubName:n}firstNonEmpty(...e){for(const n of e){if(null==n)continue;const o=String(n).trim();if(o)return o}return"-"}resolveClientByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.clientList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.clientName||"").trim().toLowerCase()===r)||null}resolveGuestByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.guestList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.guestName||"").trim().toLowerCase()===r)||null}resolveBranchByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.branches||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.branchName||"").trim().toLowerCase()===r)||null}resolveHubByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.hubs||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.hubName||"").trim().toLowerCase()===r)||null}resolveClientLocation(e,n){if(!e)return null;const o=this.normalizeId(n),r=e?.deliveryLocations||[];return o?r.find(s=>this.normalizeId(s?.delivery_id)===o)||null:r[0]||null}enrichShipmentDetails(e){const n={...e},o="guest"===e?.consignorTab?this.resolveGuestByIdOrName(e?.consignorId,e?.consignor):this.resolveClientByIdOrName(e?.consignorId,e?.consignor),r="guest"===e?.consigneeTab?this.resolveGuestByIdOrName(e?.consigneeId,e?.consignee):this.resolveClientByIdOrName(e?.consigneeId,e?.consignee);if(n.consignor=this.firstNonEmpty(n.consignor,o?.clientName,o?.guestName),n.consignorGST=this.firstNonEmpty(n.consignorGST,o?.GSTIN,"guest"===e?.consignorTab?"GUEST":""),n.consignorPhone=this.firstNonEmpty(n.consignorPhone,o?.phoneNum),n.consignorAddress=this.firstNonEmpty(n.consignorAddress,o?.address),n.consignee=this.firstNonEmpty(n.consignee,r?.clientName,r?.guestName),n.consigneeGST=this.firstNonEmpty(n.consigneeGST,r?.GSTIN,"guest"===e?.consigneeTab?"GUEST":""),n.consigneePhone=this.firstNonEmpty(n.consigneePhone,r?.phoneNum),n.consigneeAddress=this.firstNonEmpty(n.consigneeAddress,r?.address),"consignor"===e?.billingType)n.billingName=this.firstNonEmpty(n.billingName,n.consignor),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,n.consignorGST),n.billingPhone=this.firstNonEmpty(n.billingPhone,n.consignorPhone),n.billingAddress=this.firstNonEmpty(n.billingAddress,n.consignorAddress);else{const a=this.resolveClientByIdOrName(e?.billingClientId,e?.billingName);n.billingName=this.firstNonEmpty(n.billingName,a?.clientName),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,a?.GSTIN),n.billingPhone=this.firstNonEmpty(n.billingPhone,a?.phoneNum),n.billingAddress=this.firstNonEmpty(n.billingAddress,a?.address)}if("branch"===e?.pickupType){const a=this.resolveBranchByIdOrName(e?.pickupLocationId,e?.pickupName)||this.resolveBranchByIdOrName(null,e?.branch);n.pickupName=this.firstNonEmpty(n.pickupName,a?.branchName),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,a?.address),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,a?.phoneNum),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,a?.pinCode)}else"consignor"===e?.pickupType&&(n.pickupName=this.firstNonEmpty(n.pickupName,n.consignor),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,n.consignorAddress),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,n.consignorPhone),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,o?.pinCode));if("Customer self pick up"===e?.deliveryType||"branch"===e?.deliveryType||"hub"===e?.deliveryType){const a=this.resolveBranchByIdOrName(e?.deliveryID,e?.deliveryName),d=a?null:this.resolveHubByIdOrName(e?.deliveryID,e?.deliveryName);n.deliveryName=this.firstNonEmpty(n.deliveryName,a?.branchName,d?.hubName),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,a?.address,d?.address),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,a?.phoneNum,d?.phoneNum),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,a?.pinCode,d?.pinCode)}else{const a=this.resolveClientByIdOrName(e?.deliveryID,e?.deliveryName),d=this.resolveGuestByIdOrName(e?.deliveryID,e?.deliveryName),p=this.resolveClientLocation(a,e?.deliveryLocationId);n.deliveryName=this.firstNonEmpty(n.deliveryName,a?.clientName,d?.guestName,n.consignee),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,p?.address,a?.address,d?.address,n.consigneeAddress),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,a?.phoneNum,d?.phoneNum,n.consigneePhone),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,p?.pinCode,a?.pinCode,d?.pinCode)}return n}getDeliveryDisplayName(e){const n=String(e?.deliveryName||"").trim();if(n)return n;const o=this.normalizeId(e?.deliveryID);if(!o)return"-";const r=(this.branches||[]).find(d=>this.normalizeId(d?._id)===o);if(r?.branchName)return r.branchName;const s=(this.clientList||[]).find(d=>this.normalizeId(d?._id)===o);if(s?.clientName)return s.clientName;const a=(this.guestList||[]).find(d=>this.normalizeId(d?._id)===o);return a?.guestName?a.guestName:o}getReturnBranchName(e){const n=String(this.getDeliveryDisplayName(e)||"").trim();if(n&&"-"!==n)return n;const o=this.normalizeId(localStorage.getItem("originLocId"));if(o&&"all"!==o){const r=(this.branches||[]).find(s=>this.normalizeId(s?._id)===o);if(r?.branchName)return r.branchName}return String(e?.branch||"").trim()}getOriginBranchName(e){return String(e?.branch||"").trim()}getReturnEwaybills(e){const n=Array.isArray(e?.ewaybills)?e.ewaybills:[];if(n.length)return n;const o=Array.isArray(e?.invoices)?e.invoices:[];return o.length?[{invoices:o}]:[]}getoriginLocIdByName(e){return(this.branches||[]).find(o=>String(o?.branchName||"").toLowerCase()===e.toLowerCase())?._id||null}buildReturnPayload(e,n){const o=(new Date).toISOString(),r=localStorage.getItem("username")||"",s={type:e.pickupType,id:e.pickupLocationId??null,name:e.pickupName,address:e.pickupAddress,phone:e.pickupPhone,pincode:e.pickupPincode,locationId:e.pickupLocationId,clientId:e.pickupClientId},a={type:e.deliveryType,id:e.deliveryID,name:e.deliveryName,address:e.deliveryAddress,phone:e.deliveryPhone,pincode:e.deliveryPincode,locationId:e.deliveryLocationId},d=n.swapAddresses?a:s,p=n.swapAddresses?s:a,m=n.swapAddresses&&("Customer self pick up"===p.type||"branch"===p.type||"hub"===p.type)&&this.getoriginLocIdByName(String(p.name||""))||p.id,b=n.branchName||e.branch||localStorage.getItem("branch")||"",y=b?`/${b}`:"",I={username:r,branch:n.branchName||e.branch,originLocId:this.getOriginId(e)||this.getoriginLocIdByName(String(n.branchName||e.branch||""))||e.originLocId,shipmentStatus:"Pending",shipmentStatusDetails:y,consignmentNumber:n.consignmentNumber,date:o,paymentMode:e.paymentMode,externalRefId:e.externalRefId,consignorTab:e.consignorTab,consignor:e.consignor,consignorGST:e.consignorGST,consignorAddress:e.consignorAddress,consignorPhone:e.consignorPhone,consignorId:e.consignorId,consigneeTab:e.consigneeTab,consignee:e.consignee,consigneeGST:e.consigneeGST,consigneeAddress:e.consigneeAddress,consigneePhone:e.consigneePhone,consigneeId:e.consigneeId,billingType:e.billingType,billingName:e.billingName,billingGSTIN:e.billingGSTIN,billingAddress:e.billingAddress,billingPhone:e.billingPhone,billingLocationId:e.billingLocationId,billingClientId:e.billingClientId,pickupType:d.type,pickupName:d.name,pickupAddress:d.address,pickupPhone:d.phone,pickupPincode:d.pincode,pickupLocationId:d.locationId,deliveryType:p.type,deliveryID:m,deliveryName:p.name,deliveryAddress:p.address,deliveryPhone:p.phone,deliveryPincode:p.pincode,deliveryLocationId:p.locationId,ewaybills:this.getReturnEwaybills(e),charges:e.charges,finalAmount:n.finalAmount};if(n.deliveryBranchName){const P=this.resolveBranchByIdOrName(null,n.deliveryBranchName);I.deliveryType="Customer self pick up",I.deliveryID=P?._id||I.deliveryID,I.deliveryName=P?.branchName||n.deliveryBranchName,I.deliveryAddress=P?.address||I.deliveryAddress,I.deliveryPhone=P?.phoneNum||I.deliveryPhone,I.deliveryPincode=P?.pinCode||I.deliveryPincode,I.deliveryLocationId=null}return I}createBranchReturnConsignment(e){const n=this.getReturnBranchName(e),o=this.getOriginBranchName(e),r=o||n||String(localStorage.getItem("branch")||"").trim(),a=this.buildReturnPayload(e,{consignmentNumber:`${e.consignmentNumber}/${r}/R`,branchName:n||e.branch,finalAmount:e.finalAmount??0,swapAddresses:!1,deliveryBranchName:o||e.branch});this.http.post("http://localhost:3000/api/newshipments/add?summary=true",a,{headers:{"Content-Type":"application/json"}}).subscribe({error:d=>console.error("Error creating return consignment:",d)})}createCustomerReturnConsignment(e){const n=this.getReturnBranchName(e);if(!n||"All Branches"===n)return void console.error("Missing branch for return consignment number");const o=localStorage.getItem("username")||"";this.http.get(`http://localhost:3000/api/newshipments/nextConsignment?username=${encodeURIComponent(o)}&originLocId=${encodeURIComponent(this.getoriginLocIdByName(n)||"")}&branch=${encodeURIComponent(n)}`).subscribe({next:r=>{const s=this.buildReturnPayload(e,{consignmentNumber:String(r.nextNumber||""),branchName:n,finalAmount:e.returnFinalAmount??e.finalAmount??0,swapAddresses:!0,deliveryBranchName:this.getOriginBranchName(e)});this.http.post("http://localhost:3000/api/newshipments/add?summary=true",s,{headers:{"Content-Type":"application/json"}}).subscribe({error:a=>console.error("Error creating return consignment:",a)})},error:r=>console.error("Error fetching next consignment number:",r)})}openShipmentDetails(e){const n=this.enrichShipmentDetails(e);this.selectedShipment=n,this.selectedShipmentManifestId=null,this.selectedShipmentManifestNumber=null,this.loadManifestForShipment(n?.consignmentNumber)}closeShipmentDetails(){this.selectedShipment=null,this.selectedShipmentManifestId=null,this.selectedShipmentManifestNumber=null}loadManifestForShipment(e){const n=String(e||"").trim();if(!n)return this.selectedShipmentManifestId=null,void(this.selectedShipmentManifestNumber=null);this.http.get("http://localhost:3000/api/manifests",{params:{consignmentNumber:n}}).subscribe({next:o=>{const r=Array.isArray(o)&&o.length?o[0]:null;this.selectedShipmentManifestId=r?._id?String(r._id):null,this.selectedShipmentManifestNumber=r?.manifestNumber||null},error:()=>{this.selectedShipmentManifestId=null,this.selectedShipmentManifestNumber=null}})}getManifestUrl(e){const n=String(e||"").trim();return n?`/manifests/${n}`:"#"}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-view-shipments"]],standalone:!0,features:[Ae],decls:12,vars:8,consts:[[1,"shipments-container"],[1,"tabs"],["type","button",3,"click"],[4,"ngIf"],["class","modal return-modal",4,"ngIf"],["class","modal details-modal",4,"ngIf"],[1,"filters"],["type","text","placeholder","Search by consignment no. or consignor",3,"ngModelChange","input","ngModel"],["type","date",3,"ngModelChange","change","ngModel"],[3,"ngModelChange","change","ngModel"],["value",""],["value","Pending"],["value","Manifested"],["value","Delivered"],[3,"ngModel","ngModelChange",4,"ngIf"],["type","text","placeholder","Filter by consignor",3,"ngModelChange","input","ngModel"],[1,"table-wrapper"],[1,"shipments-table"],[3,"click",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"click"],[1,"actions-bar"],["type","button","class","return-btn",3,"click",4,"ngIf"],["type","checkbox",3,"change"],["type","button",1,"return-btn",3,"click"],["type","checkbox",3,"ngModelChange","click","ngModel","disabled"],[1,"modal","return-modal"],[1,"modal-content","return-content"],["type","button",1,"details-close",3,"click"],[1,"return-toggle"],[1,"toggle"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"toggle-track"],[1,"toggle-thumb"],[1,"return-list"],[4,"ngFor","ngForOf"],[1,"return-actions"],["type","button",1,"ghost",3,"click"],[1,"return-line"],["type","number","min","0","placeholder","Final amount",3,"ngModel","ngModelChange",4,"ngIf"],["type","number","min","0","placeholder","Final amount",3,"ngModelChange","ngModel"],[1,"modal","details-modal"],[1,"modal-content","details-content"],[1,"details-header"],[1,"details-sub"],[1,"details-status"],[1,"shipment-details","details-grid"],[1,"details-products"],["class","details-invoice",4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"],[1,"details-invoice"],[1,"details-invoice-title"],[1,"details-product-list"],[1,"product-name"],[1,"product-meta"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"View Shipments"),c(),l(3,"div",1)(4,"button",2),M("click",function(){return o.activeTab="all"}),u(5,"All Shipments"),c(),l(6,"button",2),M("click",function(){return o.activeTab="received"}),u(7,"Received Shipments"),c()(),D(8,L7,35,6,"div",3)(9,H7,39,7,"div",3),c(),D(10,z7,22,2,"div",4)(11,Q7,195,51,"div",5)),2&n&&(h(4),Ce("active","all"===o.activeTab),h(2),Ce("active","received"===o.activeTab),h(2),C("ngIf","all"===o.activeTab),h(),C("ngIf","received"===o.activeTab),h(),C("ngIf",o.showReturnModal),h(),C("ngIf",o.selectedShipment))},dependencies:[pt,lt,Xe,Fr,et,wt,St,qe,on,Jr,vt,We,Gi,He],styles:["[_nghost-%COMP%]{--page-bg: #f6f8fb;--card: #ffffff;--border: #e5e7eb;--text: #0f172a;--muted: #6b7280;--primary: #2563eb;--primary-strong: #1e3a8a}.shipments-container[_ngcontent-%COMP%]{padding:20px;color:var(--text);max-width:100%;box-sizing:border-box;overflow-x:hidden;min-width:0}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;color:var(--text);flex:1 1 190px;min-width:0}.tabs[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:15px}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:999px;border:1px solid var(--border);background:#fff;color:var(--text);cursor:pointer}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-color:var(--primary)}.actions-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:15px}.return-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:10px;border:none;background:#ef4444;color:#fff;cursor:pointer;font-weight:600}.table-wrapper[_ngcontent-%COMP%]{width:100%;overflow-x:auto;max-width:100%;box-sizing:border-box}.shipments-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;table-layout:auto;min-width:0;font-size:12px}.shipments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .shipments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--border);padding:8px;text-align:left;vertical-align:top;word-break:break-word;overflow-wrap:anywhere;white-space:normal;min-width:0}.shipments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600;white-space:nowrap}.shipments-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc;cursor:pointer}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:500px;max-height:80vh;overflow-y:auto;border-radius:8px;position:relative}.close[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;font-size:24px;cursor:pointer}.details-modal[_ngcontent-%COMP%]{background:#0f172a8c}.details-content[_ngcontent-%COMP%]{background:var(--page-bg);color:var(--text);width:min(860px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--border);box-shadow:0 18px 40px #0f172a33}.details-close[_ngcontent-%COMP%]{position:absolute;right:18px;top:12px;background:transparent;border:none;font-size:24px;cursor:pointer;color:var(--muted)}.details-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.details-sub[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--muted);font-size:13px}.details-status[_ngcontent-%COMP%]{background:#e0f2fe;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:16px}.details-products[_ngcontent-%COMP%]{display:grid;gap:12px}.details-invoice[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}.details-invoice-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:8px}.details-product-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:8px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;border-bottom:1px solid var(--border);padding-bottom:6px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.product-name[_ngcontent-%COMP%]{font-weight:600}.product-meta[_ngcontent-%COMP%]{color:var(--muted);font-size:13px}.return-modal[_ngcontent-%COMP%]{background:#0f172a8c}.return-content[_ngcontent-%COMP%]{width:min(420px,90vw);border-radius:12px;border:1px solid var(--border)}.return-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:6px 0 10px}.return-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:18px}.return-list[_ngcontent-%COMP%]{margin:8px 0 0;padding-left:18px;max-height:160px;overflow-y:auto;color:var(--muted)}.return-line[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.return-line[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:140px;padding:6px 8px;border:1px solid var(--border);border-radius:8px}.return-toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 4px;color:var(--muted)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-flex;align-items:center}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;inset:0;opacity:0;cursor:pointer}.toggle-track[_ngcontent-%COMP%]{width:40px;height:22px;background:#e5e7eb;border-radius:999px;display:inline-flex;align-items:center;padding:2px;transition:background .2s ease}.toggle-thumb[_ngcontent-%COMP%]{width:18px;height:18px;background:#fff;border-radius:999px;box-shadow:0 1px 3px #0f172a33;transform:translate(0);transition:transform .2s ease}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]{background:#16a34a}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(18px)}@media (max-width: 700px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .return-btn[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}.shipments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .shipments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:7px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .return-btn[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.shipments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .shipments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .return-btn[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}.shipments-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .shipments-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;font-size:11px}}"]})}}return t})(),Y7=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-admin"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Admin"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})(),K7=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-settings"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Settings"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function J7(t,i){1&t&&X(0,"img",19),2&t&&C("src",f().profile.photo,As)}function X7(t,i){1&t&&(l(0,"span"),u(1,"No Photo"),c())}function ej(t,i){if(1&t){const e=O();l(0,"div",20)(1,"h3"),u(2,"Standard Pricing"),c(),l(3,"div",21)(4,"label"),u(5,"Price per box (\u20b9) "),l(6,"input",22),S("ngModelChange",function(o){_(e);const r=f();return x(r.profile.pricePerNumber,o)||(r.profile.pricePerNumber=o),v(o)}),c()(),X(7,"br"),l(8,"label"),u(9,"Price per Kilogram (\u20b9) "),l(10,"input",22),S("ngModelChange",function(o){_(e);const r=f();return x(r.profile.pricePerKg,o)||(r.profile.pricePerKg=o),v(o)}),c()(),X(11,"br"),l(12,"label"),u(13,"Price per Area (cm\xb3 / sq units) (\u20b9) "),l(14,"input",22),S("ngModelChange",function(o){_(e);const r=f();return x(r.profile.pricePerArea,o)||(r.profile.pricePerArea=o),v(o)}),c()()()()}if(2&t){const e=f();h(6),w("ngModel",e.profile.pricePerNumber),h(4),w("ngModel",e.profile.pricePerKg),h(4),w("ngModel",e.profile.pricePerArea)}}function tj(t,i){if(1&t){const e=O();l(0,"button",23),M("click",function(){return _(e),v(f().backfillBusinessType())}),u(1,"Backfill Business Type"),c()}}function nj(t,i){if(1&t){const e=O();l(0,"button",23),M("click",function(){return _(e),v(f().clearProfile())}),u(1,"Clear"),c()}}let ij=(()=>{class t{constructor(e){this.http=e,this.profile={name:"",photo:"",address:"",company:"",mobile:"",email:"",role:"",businessType:"",pricePerNumber:0,pricePerKg:0,pricePerArea:0}}ngOnInit(){this.loadProfile()}isAdmin(){return"admin"===String(this.profile?.role||localStorage.getItem("role")||"").toLowerCase()}loadProfile(){const e=localStorage.getItem("email"),n=localStorage.getItem("username");this.http.get(`http://localhost:3000/api/profile?user=${n}&email=${e}`).subscribe({next:o=>{this.profile=o[0]||this.profile,this.profile?.businessType&&localStorage.setItem("companyType",String(this.profile.businessType)),console.log("Profile loaded:",this.profile)},error:o=>console.error("Error loading products:",o)})}onFileSelected(e){const n=e.target.files[0];if(n){const o=new FileReader;o.onload=()=>{this.profile.photo=o.result},o.readAsDataURL(n)}}saveProfile(){const e=this.profile?.email||localStorage.getItem("email")||"",n=this.profile?.username||localStorage.getItem("username")||"",o={...this.profile,email:e,username:n};console.log("Sending profile data:",o),this.http.post("http://localhost:3000/api/profile/save",o,{headers:{"Content-Type":"application/json"}}).subscribe({next:r=>{console.log("Profile saved",r),r&&(this.profile=r),this.profile?.businessType&&localStorage.setItem("companyType",String(this.profile.businessType)),this.loadProfile()},error:r=>{console.error("Error saving profile:",r),alert("Error: "+r.error.message)}})}backfillBusinessType(){window.confirm("Backfill business type for all profiles?")&&this.http.post("http://localhost:3000/api/profile/migrateBusinessType",{}).subscribe({next:n=>{console.log("Profile businessType backfilled",n),alert("Business type backfilled for profiles."),this.loadProfile()},error:n=>{console.error("Error backfilling businessType:",n),alert("Error: "+(n.error?.message||"Backfill failed"))}})}clearProfile(){this.profile={name:"",address:"",company:"",mobile:"",role:"",photo:"",businessType:""},console.log("Profile cleared locally.")}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-profile"]],standalone:!0,features:[Ae],decls:59,vars:23,consts:[[1,"profile-container"],[1,"profile-main"],[1,"photo-section"],[1,"photo-frame"],["alt","Profile Photo",3,"src",4,"ngIf"],[4,"ngIf"],["type","file",3,"change","disabled"],[1,"form-section"],[1,"form-row"],["placeholder","Enter address",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Enter company name",3,"ngModelChange","ngModel","disabled"],["type","text","placeholder","Enter mobile number",3,"ngModelChange","ngModel","disabled"],["type","radio","value","5",3,"ngModelChange","ngModel","disabled"],["type","radio","value","12",3,"ngModelChange","ngModel","disabled"],["type","radio","value","18",3,"ngModelChange","ngModel","disabled"],["class","pricing-section",4,"ngIf"],[1,"button-section"],[3,"click","disabled"],[3,"click",4,"ngIf"],["alt","Profile Photo",3,"src"],[1,"pricing-section"],[1,"grid-3"],["type","number","placeholder","\u20b9",3,"ngModelChange","ngModel"],[3,"click"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),D(4,J7,1,1,"img",4)(5,X7,2,0,"span",5),c(),l(6,"input",6),M("change",function(s){return o.onFileSelected(s)}),c()(),l(7,"div",7)(8,"div",8)(9,"label"),u(10,"Name:"),c(),l(11,"span"),u(12),c()(),l(13,"div",8)(14,"label"),u(15,"Address:"),c(),l(16,"textarea",9),S("ngModelChange",function(s){return x(o.profile.address,s)||(o.profile.address=s),s}),c()(),l(17,"div",8)(18,"label"),u(19,"Company Name:"),c(),l(20,"input",10),S("ngModelChange",function(s){return x(o.profile.company,s)||(o.profile.company=s),s}),c()(),l(21,"div",8)(22,"label"),u(23,"Mobile Number:"),c(),l(24,"input",11),S("ngModelChange",function(s){return x(o.profile.mobile,s)||(o.profile.mobile=s),s}),c()(),l(25,"div",8)(26,"label"),u(27,"Email:"),c(),l(28,"span"),u(29),c()(),l(30,"div",8)(31,"label"),u(32,"GSTIN:"),c(),l(33,"span"),u(34),c()(),l(35,"div",8)(36,"label"),u(37,"Role:"),c(),l(38,"span"),u(39),c()()()(),l(40,"div",8)(41,"label"),u(42,"Type of Business:"),c(),l(43,"div")(44,"label")(45,"input",12),S("ngModelChange",function(s){return x(o.profile.businessType,s)||(o.profile.businessType=s),s}),c(),u(46," Goods Transport Agency (GTA) - 5% "),c(),l(47,"label")(48,"input",13),S("ngModelChange",function(s){return x(o.profile.businessType,s)||(o.profile.businessType=s),s}),c(),u(49," Parcel - 12% "),c(),l(50,"label")(51,"input",14),S("ngModelChange",function(s){return x(o.profile.businessType,s)||(o.profile.businessType=s),s}),c(),u(52," Courier - 18% "),c()()(),D(53,ej,15,3,"div",15),l(54,"div",16)(55,"button",17),M("click",function(){return o.saveProfile()}),u(56,"Save"),c(),D(57,tj,2,0,"button",18)(58,nj,2,0,"button",18),c()()),2&n&&(h(4),C("ngIf",o.profile.photo),h(),C("ngIf",!o.profile.photo),h(),C("disabled",!o.isAdmin()),h(6),N(o.profile.name),h(4),w("ngModel",o.profile.address),C("disabled",!o.isAdmin()),h(4),w("ngModel",o.profile.company),C("disabled",!o.isAdmin()),h(4),w("ngModel",o.profile.mobile),C("disabled",!o.isAdmin()),h(5),N(o.profile.email),h(5),N(o.profile.gstin),h(5),N(o.profile.role),h(6),w("ngModel",o.profile.businessType),C("disabled",!o.isAdmin()),h(3),w("ngModel",o.profile.businessType),C("disabled",!o.isAdmin()),h(3),w("ngModel",o.profile.businessType),C("disabled",!o.isAdmin()),h(2),C("ngIf",o.isAdmin()),h(2),C("disabled",!o.isAdmin()),h(2),C("ngIf",o.isAdmin()),h(),C("ngIf",o.isAdmin()))},dependencies:[pt,Xe,et,qe,on,cu,We,He],styles:[".profile-container[_ngcontent-%COMP%]{max-width:900px;margin:auto;background:#f9f9f9;padding:20px;border-radius:10px;display:flex;flex-direction:column;gap:20px}.profile-main[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:flex-start}.photo-section[_ngcontent-%COMP%]{flex:1;text-align:center}.photo-frame[_ngcontent-%COMP%]{width:150px;height:150px;border:2px solid #ccc;border-radius:50%;margin:auto;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#eee}.photo-frame[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.photo-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:10px}.form-section[_ngcontent-%COMP%]{flex:2;display:grid;grid-template-columns:1fr 2fr;gap:15px 20px}.form-row[_ngcontent-%COMP%]{display:contents}.form-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;align-self:center}.form-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:8px;border-radius:5px;border:1px solid #ccc;width:100%}.button-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:15px}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background:#2c3e50;color:#fff}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background:#e74c3c;color:#fff}"]})}}return t})();function oj(t,i){if(1&t&&(l(0,"option",25),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e.id),h(),N(e.label)}}function rj(t,i){if(1&t){const e=O();l(0,"button",28),M("click",function(){_(e);const o=f().index;return v(f(2).removeVehicle(o))}),u(1,"dY-`\u0192?1,?"),c()}}function sj(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.vehicleNo,o)||(r.vehicleNo=o),v(o)}),c(),l(2,"input",23),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.driverPhone,o)||(r.driverPhone=o),v(o)}),c(),l(3,"span"),u(4),c(),l(5,"select",24),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.currentLocationId,o)||(r.currentLocationId=o),v(o)}),l(6,"option",25),u(7,"Use this branch"),c(),D(8,oj,2,2,"option",26),c(),D(9,rj,2,0,"button",27),c()}if(2&t){const e=i.$implicit,n=f(2);h(),w("ngModel",e.vehicleNo),h(),w("ngModel",e.driverPhone),h(2),N(e.vehicleStatus||"online"),h(),w("ngModel",e.currentLocationId),h(),C("ngValue",""),h(2),C("ngForOf",n.getAddBranchOptions()),h(),C("ngIf",n.newBranch.vehicles.length>1)}}function aj(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"span",7),M("click",function(){return _(e),v(f().closeAddBranchPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Add Branch"),c(),l(6,"div",8)(7,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.branchName,o)||(r.newBranch.branchName=o),v(o)}),M("ngModelChange",function(){return _(e),v(f().handleHeadingBranchChange())}),c(),l(8,"input",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.prefix,o)||(r.newBranch.prefix=o),v(o)}),c(),l(9,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.address,o)||(r.newBranch.address=o),v(o)}),c(),l(10,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.city,o)||(r.newBranch.city=o),v(o)}),c(),l(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.state,o)||(r.newBranch.state=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.pinCode,o)||(r.newBranch.pinCode=o),v(o)}),c(),l(13,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.newBranch.phoneNum,o)||(r.newBranch.phoneNum=o),v(o)}),c(),l(14,"div",16)(15,"label",17),u(16,"Vehicles & Drivers"),c(),D(17,sj,10,7,"div",18),l(18,"button",19),M("click",function(){return _(e),v(f().addVehicle())}),u(19,"+ Add Vehicle"),c()(),l(20,"button",20),M("click",function(){return _(e),v(f().addBranch())}),u(21,"+ Add Branch"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.newBranch.branchName),h(),w("ngModel",e.newBranch.prefix),h(),w("ngModel",e.newBranch.address),h(),w("ngModel",e.newBranch.city),h(),w("ngModel",e.newBranch.state),h(),w("ngModel",e.newBranch.pinCode),h(),w("ngModel",e.newBranch.phoneNum),h(4),C("ngForOf",e.newBranch.vehicles)}}function cj(t,i){if(1&t&&(l(0,"option",25),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e.id),h(),N(e.label)}}function lj(t,i){if(1&t){const e=O();l(0,"button",28),M("click",function(){_(e);const o=f().index;return v(f(2).removeVehicleEdit(o))}),u(1,"dY-`\u0192?1,?"),c()}}function dj(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.vehicleNo,o)||(r.vehicleNo=o),v(o)}),c(),l(2,"input",23),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.driverPhone,o)||(r.driverPhone=o),v(o)}),c(),l(3,"button",29),M("click",function(){const o=_(e).$implicit;return v(f(2).toggleEditVehicleStatus(o))}),u(4),c(),l(5,"div",30)(6,"label"),u(7,"Current Branch"),c(),l(8,"select",24),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.currentLocationId,o)||(r.currentLocationId=o),v(o)}),D(9,cj,2,2,"option",26),c()(),D(10,lj,2,0,"button",27),c()}if(2&t){const e=i.$implicit,n=f(2);h(),w("ngModel",e.vehicleNo),h(),w("ngModel",e.driverPhone),h(2),k(" ","offline"===(e.vehicleStatus||"online")?"offline":"online"," "),h(4),w("ngModel",e.currentLocationId),h(),C("ngForOf",n.getEditBranchOptions(e.currentLocationId)),h(),C("ngIf",n.editingBranch.vehicles.length>1)}}function uj(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"span",7),M("click",function(){return _(e),v(f().closeEditBranchPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Edit Branch"),c(),l(6,"div",8)(7,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.branchName,o)||(r.editingBranch.branchName=o),v(o)}),c(),l(8,"input",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.prefix,o)||(r.editingBranch.prefix=o),v(o)}),c(),l(9,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.address,o)||(r.editingBranch.address=o),v(o)}),c(),l(10,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.city,o)||(r.editingBranch.city=o),v(o)}),c(),l(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.state,o)||(r.editingBranch.state=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.pinCode,o)||(r.editingBranch.pinCode=o),v(o)}),c(),l(13,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingBranch.phoneNum,o)||(r.editingBranch.phoneNum=o),v(o)}),c(),l(14,"div",16)(15,"label",17),u(16,"Vehicles & Drivers"),c(),D(17,dj,11,6,"div",18),l(18,"button",19),M("click",function(){return _(e),v(f().addVehicleEdit())}),u(19,"+ Vehicle"),c()(),l(20,"button",20),M("click",function(){return _(e),v(f().saveEdit())}),u(21,"Save"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.editingBranch.branchName),h(),w("ngModel",e.editingBranch.prefix),h(),w("ngModel",e.editingBranch.address),h(),w("ngModel",e.editingBranch.city),h(),w("ngModel",e.editingBranch.state),h(),w("ngModel",e.editingBranch.pinCode),h(),w("ngModel",e.editingBranch.phoneNum),h(4),C("ngForOf",e.editingBranch.vehicles)}}function hj(t,i){if(1&t&&(l(0,"div"),u(1),c()),2&t){const e=i.$implicit;h(),Be(" dYss ",e.vehicleNo,' \u2019\'?" dY"z ',e.driverPhone," ")}}function pj(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),D(8,hj,2,2,"div",4),c(),l(9,"td")(10,"button",31),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(11),c()(),l(12,"td")(13,"button",31),M("click",function(){const o=_(e).$implicit;return v(f().editBranch(o))}),u(14,"Edit"),c()()()}if(2&t){const e=i.$implicit,n=f();h(2),N(e.branchName),h(2),N(n.getBranchAddress(e)),h(2),N(e.phoneNum),h(2),C("ngForOf",e.vehicles),h(3),k(" ","active"===e.status?"Deactivate":"Activate"," ")}}let gj=(()=>{class t{constructor(e){this.http=e,this.branches=[],this.hubs=[],this.showAddBranchPopup=!1,this.showEditBranchPopup=!1,this.lastHeadingBranchName="",this.newBranch={branchName:"",prefix:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}],status:"active"},this.editingBranch=null}ngOnInit(){localStorage.setItem("branch","All Branches"),this.loadBranches(),this.loadHubs()}loadBranches(){this.http.get("http://localhost:3000/api/branches").subscribe({next:e=>{this.branches=e},error:e=>console.error("Error loading branches:",e)})}loadHubs(){this.http.get("http://localhost:3000/api/hubs").subscribe({next:e=>{this.hubs=e},error:e=>console.error("Error loading hubs:",e)})}openAddBranchPopup(){this.showAddBranchPopup=!0}closeAddBranchPopup(){this.showAddBranchPopup=!1}closeEditBranchPopup(){this.showEditBranchPopup=!1,this.editingBranch=null}addVehicle(){this.newBranch.vehicles.push({vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""})}removeVehicle(e){this.newBranch.vehicles.splice(e,1)}addVehicleEdit(){this.editingBranch.vehicles.push({vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""})}removeVehicleEdit(e){this.editingBranch.vehicles.splice(e,1)}toggleEditVehicleStatus(e){if(!this.editingBranch?._id||!e)return;const n=String(e?.vehicleNo||"").trim();if(!n)return;const r="offline"===String(e?.vehicleStatus||"online").trim().toLowerCase()?"online":"offline";this.http.patch(`http://localhost:3000/api/branches/${this.editingBranch._id}/vehicle-status`,{vehicleNo:n,vehicleStatus:r}).subscribe({next:()=>{e.vehicleStatus=r,this.loadBranches()},error:s=>{console.error("Error updating vehicle status:",s),alert("Failed to update vehicle status.")}})}addBranch(){if(!this.newBranch.branchName||!this.newBranch.address||!this.newBranch.phoneNum)return void alert("Branch Name, Address, and Branch Phone are required.");if(Array.isArray(this.newBranch.vehicles)&&this.newBranch.vehicles.some(s=>(s?.vehicleNo||s?.driverPhone)&&!(s?.vehicleNo&&s?.driverPhone)))return void alert("Each vehicle must have both Vehicle No. and Driver Phone (or leave the row empty).");const n=Array.isArray(this.newBranch.vehicles)?this.newBranch.vehicles.filter(s=>s?.vehicleNo&&s?.driverPhone).map(s=>({...s,currentLocationId:this.normalizeLocationId(s?.currentLocationId)})):[],o=this.normalizePrefix(this.newBranch.prefix),r={branchName:this.newBranch.branchName,...o?{prefix:o}:{},address:this.newBranch.address,city:this.newBranch.city,state:this.newBranch.state,pinCode:this.newBranch.pinCode,phoneNum:this.newBranch.phoneNum,vehicles:n};this.http.post("http://localhost:3000/api/branches/add",r,{headers:{"Content-Type":"application/json"}}).subscribe({next:()=>{alert("Branch added successfully!"),this.loadBranches(),this.resetNewBranch(),this.closeAddBranchPopup()},error:s=>{console.error("Error saving branch:",s),alert("Error: "+(s?.error?.message||s?.message||"Bad Request"))}})}handleHeadingBranchChange(){const e=String(this.newBranch.branchName||"").trim(),n=String(this.lastHeadingBranchName||"").trim();Array.isArray(this.newBranch.vehicles)?(this.newBranch.vehicles.forEach(o=>{const r=String(o?.currentLocationId||"").trim(),s=n&&this.normalizeId(r)===this.normalizeLocationId(n);(!r||s)&&(o.currentLocationId=this.normalizeLocationId(e))}),this.lastHeadingBranchName=e):this.lastHeadingBranchName=e}getAddBranchOptions(){const e=[];return(this.branches||[]).forEach(n=>{const o=this.normalizeId(n?._id),r=this.getBranchLabel(n);o&&r&&e.push({id:o,label:r})}),(this.hubs||[]).forEach(n=>{const o=this.normalizeId(n?._id),r=String(n?.hubName||"").trim();o&&r&&e.push({id:o,label:r})}),e}getEditBranchOptions(e){const n=[],o=this.normalizeLocationId(String(e||"").trim()),r=this.getCurrentLocationLabel(o);o&&r&&n.push({id:o,label:r});const s=this.normalizeId(this.editingBranch?._id);return(this.hubs||[]).forEach(a=>{if(!s)return;const d=this.normalizeId(a?.originLocId);if(!d||d!==s)return;const p=this.normalizeId(a?._id),g=String(a?.hubName||"").trim();p&&g&&!n.some(m=>m.id===p)&&n.push({id:p,label:g})}),(this.branches||[]).forEach(a=>{const d=this.normalizeId(a?._id),p=this.getBranchLabel(a);d&&p&&!n.some(g=>g.id===d)&&n.push({id:d,label:p})}),n}getCurrentLocationLabel(e){const n=String(e||"").trim();if(!n)return"";const o=(this.branches||[]).find(a=>this.normalizeId(a?._id)===n),r=this.getBranchLabel(o);if(r)return r;const s=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===n);return s?.hubName?s.hubName:n}getBranchLabel(e){return String(e?.prefix||"").trim()||String(e?.branchName||"").trim()}normalizeLocationId(e){const n=String(e||"").trim();if(!n)return"";if(/^[a-f\d]{24}$/i.test(n))return n;const o=(this.branches||[]).find(s=>String(s?.branchName||"").trim().toLowerCase()===n.toLowerCase());if(o?._id)return this.normalizeId(o._id);const r=(this.hubs||[]).find(s=>String(s?.hubName||"").trim().toLowerCase()===n.toLowerCase());return r?._id?this.normalizeId(r._id):""}normalizePrefix(e){const n=String(e||"").toUpperCase().replace(/[^A-Z0-9]/g,"");if(n)return n.slice(0,3)}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}resetNewBranch(){this.newBranch={branchName:"",prefix:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}],status:"active"},this.lastHeadingBranchName=""}editBranch(e){this.editingBranch=JSON.parse(JSON.stringify(e)),Array.isArray(this.editingBranch?.vehicles)&&this.editingBranch.vehicles.forEach(n=>{!n.currentLocationId&&n.currentBranch&&(n.currentLocationId=this.normalizeLocationId(n.currentBranch)),delete n.currentBranch}),this.showEditBranchPopup=!0}saveEdit(){const e=JSON.parse(JSON.stringify(this.editingBranch||{})),n=this.normalizePrefix(e?.prefix);n?e.prefix=n:delete e.prefix,Array.isArray(e?.vehicles)&&e.vehicles.forEach(o=>{o.currentLocationId=this.normalizeLocationId(o.currentLocationId),delete o.currentBranch}),this.http.put(`http://localhost:3000/api/branches/${this.editingBranch._id}`,e).subscribe({next:()=>{alert("Branch updated successfully!"),this.closeEditBranchPopup(),this.loadBranches()},error:o=>{console.error("Error updating branch:",o),alert("Error: "+(o?.error?.message||o?.message||"Bad Request"))}})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/branches/${e._id}/status`,{}).subscribe(()=>{this.loadBranches()})}getBranchAddress(e){const n=[e?.address,e?.city,e?.state,e?.pinCode].filter(Boolean);if(n.length)return n.join(", ");const o=Array.isArray(e?.addresses)?e.addresses[0]:null;return[o?.address,o?.city,o?.state,o?.pinCode].filter(Boolean).join(", ")}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-branch"]],standalone:!0,features:[Ae],decls:23,vars:3,consts:[[1,"branches-container"],["type","button",1,"add-branch-btn",3,"click"],["class","modal",4,"ngIf"],[1,"branches-table-wrapper"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"add-branch-form"],["placeholder","Branch Name","required","",3,"ngModelChange","ngModel"],["placeholder","Prefix (1-3 letters/numbers)","maxlength","3","pattern","[A-Za-z0-9]{0,3}","title","Up to 3 letters or numbers",2,"text-transform","uppercase",3,"ngModelChange","ngModel"],["placeholder","Address","required","",3,"ngModelChange","ngModel"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","Pin Code",3,"ngModelChange","ngModel"],["placeholder","Branch Phone","required","",3,"ngModelChange","ngModel"],[1,"vehicle-wrapper"],[1,"vehicle-label"],["class","vehicle-row",4,"ngFor","ngForOf"],["type","button",1,"add-vehicle-btn",3,"click"],["type","button",1,"add-btn",3,"click"],[1,"vehicle-row"],["placeholder","Vehicle No.",3,"ngModelChange","ngModel"],["placeholder","Driver Phone",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","remove-btn",3,"click",4,"ngIf"],[1,"remove-btn",3,"click"],["type","button",3,"click"],[1,"current-branch-inline"],[3,"click"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Branches"),c(),l(3,"button",1),M("click",function(){return o.openAddBranchPopup()}),u(4,"+ Add Branch"),c(),D(5,aj,22,8,"div",2)(6,uj,22,8,"div",2),l(7,"div",3)(8,"table")(9,"tr")(10,"th"),u(11,"Branch Name"),c(),l(12,"th"),u(13,"Address"),c(),l(14,"th"),u(15,"Phone"),c(),l(16,"th"),u(17,"Vehicles & Drivers"),c(),l(18,"th"),u(19,"Status"),c(),l(20,"th"),u(21,"Actions"),c()(),D(22,pj,15,5,"tr",4),c()()()),2&n&&(h(5),C("ngIf",o.showAddBranchPopup),h(),C("ngIf",o.showEditBranchPopup&&o.editingBranch),h(16),C("ngForOf",o.branches))},dependencies:[pt,lt,Xe,et,wt,St,qe,vt,We,Dn,Pm,Dm,He],styles:[".contact-row[_ngcontent-%COMP%], .compact-contact[_ngcontent-%COMP%]{display:flex;gap:6px}.delete-small[_ngcontent-%COMP%]{background-color:#fdd;border:1px solid red;padding:2px 6px;cursor:pointer}.tiny-btn[_ngcontent-%COMP%]{margin-top:5px;font-size:12px;padding:3px 8px;cursor:pointer}.active-btn[_ngcontent-%COMP%]{background:#3cb371;color:#fff}.inactive-btn[_ngcontent-%COMP%]{background:#777;color:#fff}.add-branch-btn[_ngcontent-%COMP%]{margin-bottom:12px}.modal[_ngcontent-%COMP%]{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;width:400px;max-width:90%;position:relative}.close[_ngcontent-%COMP%]{float:right;font-size:24px;cursor:pointer}.current-branch-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}"]})}}return t})();const fj=(t,i)=>({"active-btn":t,"inactive-btn":i});function mj(t,i){if(1&t){const e=O();l(0,"button",27),M("click",function(){_(e);const o=f().index;return v(f(2).removeAddress(o))}),u(1,"dY-`\u2039,?"),c()}}function _j(t,i){if(1&t&&(l(0,"option",32),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e.id),h(),N(e.label)}}function vj(t,i){if(1&t){const e=O();l(0,"button",27),M("click",function(){_(e);const o=f().index,r=f().index;return v(f(2).removeVehicle(r,o))}),u(1,"dY-`\u2039,?"),c()}}function bj(t,i){if(1&t){const e=O();l(0,"div",28)(1,"input",29),S("ngModelChange",function(o){const r=_(e).index,s=f().$implicit;return x(s.vehicles[r].vehicleNo,o)||(s.vehicles[r].vehicleNo=o),v(o)}),c(),l(2,"input",30),S("ngModelChange",function(o){const r=_(e).index,s=f().$implicit;return x(s.vehicles[r].driverPhone,o)||(s.vehicles[r].driverPhone=o),v(o)}),c(),l(3,"span"),u(4),c(),l(5,"select",31),S("ngModelChange",function(o){const r=_(e).index,s=f().$implicit;return x(s.vehicles[r].currentLocationId,o)||(s.vehicles[r].currentLocationId=o),v(o)}),l(6,"option",32),u(7,"Use this hub"),c(),D(8,_j,2,2,"option",33),c(),D(9,vj,2,0,"button",23),c()}if(2&t){const e=i.index,n=f().$implicit,o=f(2);h(),w("ngModel",n.vehicles[e].vehicleNo),h(),w("ngModel",n.vehicles[e].driverPhone),h(2),N(n.vehicles[e].vehicleStatus||"online"),h(),w("ngModel",n.vehicles[e].currentLocationId),h(),C("ngValue",""),h(2),C("ngForOf",o.getHubBranchOptions()),h(),C("ngIf",n.vehicles.length>1)}}function yj(t,i){if(1&t){const e=O();l(0,"div",20)(1,"div",21)(2,"input",22),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.location,o)||(r.location=o),v(o)}),c(),D(3,mj,2,0,"button",23),c(),l(4,"div",24)(5,"label"),u(6,"Vehicles for this address"),c(),D(7,bj,10,7,"div",25),l(8,"button",26),M("click",function(){const o=_(e).index;return v(f(2).addVehicle(o))}),u(9,"+ Add Vehicle"),c()()()}if(2&t){const e=i.$implicit,n=f(2);h(2),w("ngModel",e.location),h(),C("ngIf",n.newHub.deliveryAddresses.length>1),h(4),C("ngForOf",e.vehicles)}}function Cj(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"span",7),M("click",function(){return _(e),v(f().closeAddHubPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Add Hub"),c(),l(6,"div",8)(7,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.hubName,o)||(r.newHub.hubName=o),v(o)}),M("ngModelChange",function(){return _(e),v(f().handleHubNameChange())}),c(),l(8,"input",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.address,o)||(r.newHub.address=o),v(o)}),c(),l(9,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.city,o)||(r.newHub.city=o),v(o)}),c(),l(10,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.state,o)||(r.newHub.state=o),v(o)}),c(),l(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.pinCode,o)||(r.newHub.pinCode=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.phoneNum,o)||(r.newHub.phoneNum=o),v(o)}),c(),l(13,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.newHub.perRev,o)||(r.newHub.perRev=o),v(o)}),c(),l(14,"div",16)(15,"label"),u(16,"Delivery / Pickup Addresses"),c(),D(17,yj,10,3,"div",17),l(18,"button",18),M("click",function(){return _(e),v(f().addAddress())}),u(19,"+ Add Address"),c()(),l(20,"button",19),M("click",function(){return _(e),v(f().addHub())}),u(21,"+ Add Hub"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.newHub.hubName),h(),w("ngModel",e.newHub.address),h(),w("ngModel",e.newHub.city),h(),w("ngModel",e.newHub.state),h(),w("ngModel",e.newHub.pinCode),h(),w("ngModel",e.newHub.phoneNum),h(),w("ngModel",e.newHub.perRev),h(4),C("ngForOf",e.newHub.deliveryAddresses)}}function Mj(t,i){if(1&t){const e=O();l(0,"button",27),M("click",function(){_(e);const o=f().index;return v(f(2).removeAddressEdit(o))}),u(1,"dY-`\ufffd?1,?"),c()}}function Ij(t,i){if(1&t&&(l(0,"option",32),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e.id),h(),N(e.label)}}function wj(t,i){if(1&t){const e=O();l(0,"button",27),M("click",function(){_(e);const o=f().index,r=f().index;return v(f(2).removeVehicleEdit(r,o))}),u(1,"dY-`\ufffd?1,?"),c()}}function Sj(t,i){if(1&t){const e=O();l(0,"div",28)(1,"input",29),S("ngModelChange",function(o){const r=_(e).index,s=f().index,a=f(2);return x(a.editingHub.deliveryAddresses[s].vehicles[r].vehicleNo,o)||(a.editingHub.deliveryAddresses[s].vehicles[r].vehicleNo=o),v(o)}),c(),l(2,"input",30),S("ngModelChange",function(o){const r=_(e).index,s=f().index,a=f(2);return x(a.editingHub.deliveryAddresses[s].vehicles[r].driverPhone,o)||(a.editingHub.deliveryAddresses[s].vehicles[r].driverPhone=o),v(o)}),c(),l(3,"button",35),M("click",function(){const o=_(e).index,r=f().index,s=f(2);return v(s.toggleEditVehicleStatus(s.editingHub.deliveryAddresses[r].vehicles[o]))}),u(4),c(),l(5,"div",36)(6,"label"),u(7,"Current Branch"),c(),l(8,"select",31),S("ngModelChange",function(o){const r=_(e).index,s=f().index,a=f(2);return x(a.editingHub.deliveryAddresses[s].vehicles[r].currentLocationId,o)||(a.editingHub.deliveryAddresses[s].vehicles[r].currentLocationId=o),v(o)}),D(9,Ij,2,2,"option",33),c()(),D(10,wj,2,0,"button",23),c()}if(2&t){const e=i.index,n=f().index,o=f(2);h(),w("ngModel",o.editingHub.deliveryAddresses[n].vehicles[e].vehicleNo),h(),w("ngModel",o.editingHub.deliveryAddresses[n].vehicles[e].driverPhone),h(2),k(" ","offline"===(o.editingHub.deliveryAddresses[n].vehicles[e].vehicleStatus||"online")?"offline":"online"," "),h(4),w("ngModel",o.editingHub.deliveryAddresses[n].vehicles[e].currentLocationId),h(),C("ngForOf",o.getEditHubBranchOptions(o.editingHub.deliveryAddresses[n].vehicles[e].currentLocationId)),h(),C("ngIf",o.editingHub.deliveryAddresses[n].vehicles.length>1)}}function xj(t,i){if(1&t){const e=O();l(0,"div",20)(1,"div",21)(2,"input",22),S("ngModelChange",function(o){const r=_(e).index,s=f(2);return x(s.editingHub.deliveryAddresses[r].location,o)||(s.editingHub.deliveryAddresses[r].location=o),v(o)}),c(),D(3,Mj,2,0,"button",23),c(),l(4,"div",24)(5,"label"),u(6,"Vehicles for this address"),c(),D(7,Sj,11,6,"div",25),l(8,"button",26),M("click",function(){const o=_(e).index;return v(f(2).addVehicleEdit(o))}),u(9,"+ Add Vehicle"),c()()()}if(2&t){const e=i.$implicit,n=i.index,o=f(2);h(2),w("ngModel",o.editingHub.deliveryAddresses[n].location),h(),C("ngIf",o.editingHub.deliveryAddresses.length>1),h(4),C("ngForOf",e.vehicles)}}function Pj(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"span",7),M("click",function(){return _(e),v(f().closeEditHubPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Edit Hub"),c(),l(6,"div",8)(7,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.hubName,o)||(r.editingHub.hubName=o),v(o)}),c(),l(8,"input",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.address,o)||(r.editingHub.address=o),v(o)}),c(),l(9,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.city,o)||(r.editingHub.city=o),v(o)}),c(),l(10,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.state,o)||(r.editingHub.state=o),v(o)}),c(),l(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.pinCode,o)||(r.editingHub.pinCode=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.phoneNum,o)||(r.editingHub.phoneNum=o),v(o)}),c(),l(13,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingHub.perRev,o)||(r.editingHub.perRev=o),v(o)}),c(),l(14,"div",16)(15,"label"),u(16,"Delivery / Pickup Addresses"),c(),D(17,xj,10,3,"div",17),l(18,"button",18),M("click",function(){return _(e),v(f().addAddressEdit())}),u(19,"+ Add Address"),c()(),l(20,"div",34)(21,"button",19),M("click",function(){return _(e),v(f().saveEdit())}),u(22,"Save"),c(),l(23,"button",35),M("click",function(){return _(e),v(f().closeEditHubPopup())}),u(24,"Cancel"),c()()()()()}if(2&t){const e=f();h(7),w("ngModel",e.editingHub.hubName),h(),w("ngModel",e.editingHub.address),h(),w("ngModel",e.editingHub.city),h(),w("ngModel",e.editingHub.state),h(),w("ngModel",e.editingHub.pinCode),h(),w("ngModel",e.editingHub.phoneNum),h(),w("ngModel",e.editingHub.perRev),h(4),C("ngForOf",e.editingHub.deliveryAddresses)}}function Dj(t,i){if(1&t&&(l(0,"div",48),u(1),c()),2&t){const e=i.$implicit;h(),Be(" dYs> ",e.vehicleNo,' \ufffd\'?" dY"z ',e.driverPhone," ")}}function Nj(t,i){if(1&t&&(l(0,"div",46),D(1,Dj,2,2,"div",47),c()),2&t){const e=f().ngIf;h(),C("ngForOf",e)}}function Tj(t,i){1&t&&(l(0,"div",49),u(1," \ufffd'?\" No vehicles assigned \ufffd'?\" "),c())}function kj(t,i){if(1&t&&(zn(0),D(1,Nj,2,1,"div",44)(2,Tj,2,0,"div",45),Gn()),2&t){const e=i.ngIf;h(),C("ngIf",e.length),h(),C("ngIf",!e.length)}}function Ej(t,i){if(1&t&&(l(0,"div",41)(1,"div",42),u(2),c(),D(3,kj,3,2,"ng-container",43),c()),2&t){const e=i.$implicit,n=f(2);h(2),k('dY"? ',e.location,""),h(),C("ngIf",n.getFilteredVehicles(e.vehicles))}}function Aj(t,i){if(1&t){const e=O();l(0,"tr")(1,"td")(2,"span"),u(3),c()(),l(4,"td")(5,"span"),u(6),c()(),l(7,"td")(8,"span"),u(9),c()(),l(10,"td")(11,"span"),u(12),c()(),l(13,"td")(14,"div",37),D(15,Ej,4,2,"div",38),c()(),l(16,"td")(17,"span"),u(18),c()(),l(19,"td")(20,"button",39),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(21),c()(),l(22,"td")(23,"button",40),M("click",function(){const o=_(e).$implicit;return v(f().editHub(o))}),u(24,"Edit"),c()()()}if(2&t){const e=i.$implicit;h(3),N(e.hubName),h(3),N(e.address),h(3),N(e.city),h(3),N(e.phoneNum),h(3),C("ngForOf",e.deliveryAddresses),h(3),k("",e.perRev,"%"),h(2),C("ngClass",function kM(t,i,e,n,o){return AM(L(),Tt(),t,i,e,n,o)}(8,fj,"active"===e.status,"inactive"===e.status)),h(),k(" ","active"===e.status?"Active":"Inactive"," ")}}let Oj=(()=>{class t{constructor(e){this.http=e,this.hubs=[],this.branches=[],this.showAddHubPopup=!1,this.showEditHubPopup=!1,this.lastHubName="",this.currentoriginLocId=localStorage.getItem("originLocId")||"all",this.newHub={hubName:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",perRev:"",originLocId:localStorage.getItem("originLocId")||"all",deliveryAddresses:[{location:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}]}],status:"active"},this.editingHub=null,this.onStorage=n=>{if("originLocId"===n.key){const o=localStorage.getItem("originLocId")||"all";o!==this.currentoriginLocId&&(this.currentoriginLocId=o),this.loadHubs()}}}ngOnInit(){localStorage.setItem("branch","All Branches"),this.newHub.originLocId=localStorage.getItem("originLocId")||"all",this.loadHubs(),this.loadBranches(),this.branchCheck=setInterval(()=>{const e=localStorage.getItem("originLocId")||"all";e!==this.currentoriginLocId&&(this.currentoriginLocId=e,this.loadHubs())},1e3),window.addEventListener("storage",this.onStorage)}ngOnDestroy(){this.branchCheck&&clearInterval(this.branchCheck),window.removeEventListener("storage",this.onStorage)}loadHubs(){this.http.get("http://localhost:3000/api/hubs").subscribe({next:e=>{console.log("Hubs loaded:",e),this.hubs=e||[]},error:e=>console.error("Error loading hubs:",e)})}loadBranches(){this.http.get("http://localhost:3000/api/branches").subscribe({next:e=>{this.branches=e},error:e=>console.error("Error loading branches:",e)})}openAddHubPopup(){this.showAddHubPopup=!0,this.syncNewHubCurrentBranchDefaults()}closeAddHubPopup(){this.showAddHubPopup=!1}closeEditHubPopup(){this.showEditHubPopup=!1,this.editingHub=null}addHub(){const e=localStorage.getItem("originLocId")||"all";if(!e||"all"===e||"all-hubs"===e)return void alert("Please select a specific branch before adding a hub.");this.syncNewHubCurrentBranchDefaults();const n=JSON.parse(JSON.stringify(this.newHub||{}));n.originLocId=e,(n.deliveryAddresses||[]).forEach(o=>{(o?.vehicles||[]).forEach(r=>{r.currentLocationId=this.normalizeLocationId(r?.currentLocationId),delete r.currentBranch})}),this.http.post("http://localhost:3000/api/hubs/add",n).subscribe({next:()=>{alert("Hub added successfully!"),this.loadHubs(),this.resetForm(),this.closeAddHubPopup()},error:o=>{console.error("Error saving hub:",o),alert("Error: "+o.error?.message)}})}resetForm(){this.newHub={hubName:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",perRev:"",originLocId:localStorage.getItem("originLocId")||"all",deliveryAddresses:[{location:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}]}],status:"active"},this.lastHubName=""}addAddress(){this.newHub.deliveryAddresses.push({location:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}]})}removeAddress(e){this.newHub.deliveryAddresses.splice(e,1)}addVehicle(e){this.newHub.deliveryAddresses[e].vehicles.push({vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""})}removeVehicle(e,n){this.newHub.deliveryAddresses[e].vehicles.splice(n,1)}editHub(e){this.editingHub=JSON.parse(JSON.stringify(e)),this.ensureVehicleStatuses(this.editingHub),(this.editingHub?.deliveryAddresses||[]).forEach(n=>{(n?.vehicles||[]).forEach(o=>{!o.currentLocationId&&o.currentBranch&&(o.currentLocationId=this.normalizeLocationId(o.currentBranch)),delete o.currentBranch})}),this.showEditHubPopup=!0}addAddressEdit(){this.editingHub.deliveryAddresses.push({location:"",vehicles:[{vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""}]})}removeAddressEdit(e){this.editingHub.deliveryAddresses.splice(e,1)}addVehicleEdit(e){this.editingHub.deliveryAddresses[e].vehicles.push({vehicleNo:"",driverPhone:"",vehicleStatus:"online",currentLocationId:""})}removeVehicleEdit(e,n){this.editingHub.deliveryAddresses[e].vehicles.splice(n,1)}toggleEditVehicleStatus(e){if(!this.editingHub?._id||!e)return;const n=String(e?.vehicleNo||"").trim();if(!n)return;const r="offline"===String(e?.vehicleStatus||"online").trim().toLowerCase()?"online":"offline";this.http.patch(`http://localhost:3000/api/hubs/${this.editingHub._id}/vehicle-status`,{vehicleNo:n,vehicleStatus:r}).subscribe({next:()=>{e.vehicleStatus=r,this.loadHubs()},error:s=>{console.error("Error updating vehicle status:",s),alert("Failed to update vehicle status.")}})}saveEdit(){const e=JSON.parse(JSON.stringify(this.editingHub||{}));(e?.deliveryAddresses||[]).forEach(n=>{(n?.vehicles||[]).forEach(o=>{o.currentLocationId=this.normalizeLocationId(o.currentLocationId),delete o.currentBranch})}),this.http.put(`http://localhost:3000/api/hubs/${this.editingHub._id}`,e).subscribe({next:()=>{this.loadHubs(),this.closeEditHubPopup()},error:n=>alert("Update failed!")})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/hubs/${e._id}/status`,{status:"active"===e.status?"inactive":"active"}).subscribe(()=>this.loadHubs())}handleHubNameChange(){const e=String(this.newHub.hubName||"").trim(),n=String(this.lastHubName||"").trim();(this.newHub.deliveryAddresses||[]).forEach(o=>{(o?.vehicles||[]).forEach(r=>{const s=String(r?.currentLocationId||"").trim(),a=n&&this.normalizeLocationId(s)===this.normalizeLocationId(n);(!s||a)&&(r.currentLocationId=this.normalizeLocationId(e))})}),this.lastHubName=e}syncNewHubCurrentBranchDefaults(){const e=String(this.newHub.hubName||"").trim();e&&(this.newHub.deliveryAddresses||[]).forEach(n=>{(n?.vehicles||[]).forEach(o=>{String(o?.currentLocationId||"").trim()||(o.currentLocationId=this.normalizeLocationId(e))})})}getHubBranchOptions(){const e=[];return(this.hubs||[]).forEach(n=>{const o=this.normalizeId(n?._id),r=String(n?.hubName||"").trim();o&&r&&e.push({id:o,label:r})}),(this.branches||[]).forEach(n=>{const o=this.normalizeId(n?._id),r=String(n?.branchName||"").trim();o&&r&&!e.some(s=>s.id===o)&&e.push({id:o,label:r})}),e}getEditHubBranchOptions(e){const n=[],o=this.normalizeLocationId(String(e||"").trim()),r=this.getLocationLabel(o);return o&&r&&n.push({id:o,label:r}),(this.hubs||[]).forEach(s=>{const a=this.normalizeId(s?._id),d=String(s?.hubName||"").trim();a&&d&&!n.some(p=>p.id===a)&&n.push({id:a,label:d})}),(this.branches||[]).forEach(s=>{const a=this.normalizeId(s?._id),d=String(s?.branchName||"").trim();a&&d&&!n.some(p=>p.id===a)&&n.push({id:a,label:d})}),n}ensureVehicleStatuses(e){e?.deliveryAddresses&&e.deliveryAddresses.forEach(n=>{(n?.vehicles||[]).forEach(o=>{o.vehicleStatus||(o.vehicleStatus="online")})})}getFilteredVehicles(e){const n=String(localStorage.getItem("originLocId")||"").trim();return n&&"all"!==n&&"all-hubs"!==n?(e||[]).filter(o=>{const r=this.normalizeLocationId(o?.currentLocationId||o?.currentBranch);return r&&r===n}):e||[]}getLocationLabel(e){const n=String(e||"").trim();if(!n)return"";const o=(this.hubs||[]).find(s=>this.normalizeId(s?._id)===n);if(o?.hubName)return o.hubName;const r=(this.branches||[]).find(s=>this.normalizeId(s?._id)===n);return r?.branchName?r.branchName:n}normalizeLocationId(e){const n=String(e||"").trim();if(!n)return"";if(/^[a-f\d]{24}$/i.test(n))return n;const o=(this.hubs||[]).find(s=>String(s?.hubName||"").trim().toLowerCase()===n.toLowerCase());if(o?._id)return this.normalizeId(o._id);const r=(this.branches||[]).find(s=>String(s?.branchName||"").trim().toLowerCase()===n.toLowerCase());return r?._id?this.normalizeId(r._id):""}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-hub"]],standalone:!0,features:[Ae],decls:29,vars:3,consts:[[1,"hubs-container"],["type","button",1,"add-hub-btn",3,"click"],["class","modal",4,"ngIf"],[1,"hubs-table-wrapper"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"add-hub-form"],["placeholder","Hub Name","required","",3,"ngModelChange","ngModel"],["placeholder","Address","required","",3,"ngModelChange","ngModel"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","Pin Code",3,"ngModelChange","ngModel"],["placeholder","Phone Number","required","",3,"ngModelChange","ngModel"],["placeholder","% of Revenue","required","",3,"ngModelChange","ngModel"],[1,"delivery-wrapper"],["class","addr-block",4,"ngFor","ngForOf"],["type","button",1,"add-addr-btn",3,"click"],["type","button",1,"add-btn",3,"click"],[1,"addr-block"],[1,"addr-row"],["placeholder","Address / Location",3,"ngModelChange","ngModel"],["class","delete-btn",3,"click",4,"ngIf"],[1,"vehicles-for-address"],["class","vehicle-row",4,"ngFor","ngForOf"],["type","button",1,"add-vehicle-btn",3,"click"],[1,"delete-btn",3,"click"],[1,"vehicle-row"],["placeholder","Vehicle No",3,"ngModelChange","ngModel"],["placeholder","Driver Phone",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"terminal-buttons"],["type","button",3,"click"],[1,"current-branch-inline"],[1,"addr-list-view"],["class","addr-view-block",4,"ngFor","ngForOf"],[3,"click","ngClass"],[3,"click"],[1,"addr-view-block"],[1,"addr-title"],[4,"ngIf"],["class","vehicles-list-view",4,"ngIf"],["class","no-vehicles",4,"ngIf"],[1,"vehicles-list-view"],["class","vehicle-view",4,"ngFor","ngForOf"],[1,"vehicle-view"],[1,"no-vehicles"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Hubs"),c(),l(3,"button",1),M("click",function(){return o.openAddHubPopup()}),u(4,"+ Add Hub"),c(),D(5,Cj,22,8,"div",2)(6,Pj,25,8,"div",2),l(7,"div",3)(8,"table")(9,"thead")(10,"tr")(11,"th"),u(12,"Hub Name"),c(),l(13,"th"),u(14,"Address"),c(),l(15,"th"),u(16,"City"),c(),l(17,"th"),u(18,"Phone"),c(),l(19,"th"),u(20,"Delivery / Pickup (with Vehicles)"),c(),l(21,"th"),u(22,"% of Revenue"),c(),l(23,"th"),u(24,"Status"),c(),l(25,"th"),u(26,"Actions"),c()()(),l(27,"tbody"),D(28,Aj,25,11,"tr",4),c()()()()),2&n&&(h(5),C("ngIf",o.showAddHubPopup),h(),C("ngIf",o.showEditHubPopup&&o.editingHub),h(22),C("ngForOf",o.hubs))},dependencies:[pt,lf,lt,Xe,et,wt,St,qe,vt,We,Dn,He],styles:[".hubs-container[_ngcontent-%COMP%]{padding:15px;max-width:100%;box-sizing:border-box}.hubs-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;vertical-align:top}.edit-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:200px;margin-bottom:5px;box-sizing:border-box}.add-hub-btn[_ngcontent-%COMP%]{margin-bottom:12px}.modal[_ngcontent-%COMP%]{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;width:400px;max-width:90%;position:relative}.close[_ngcontent-%COMP%]{float:right;font-size:24px;cursor:pointer}.current-branch-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}"]})}}return t})();function Lj(t,i){if(1&t){const e=O();l(0,"div",27),u(1),l(2,"button",25),M("click",function(){const o=_(e).index;return v(f(2).startEditNewVehicle(o))}),u(3,"Edit"),c(),l(4,"button",25),M("click",function(){const o=_(e).index;return v(f(2).removeVehicle(o))}),u(5,"Delete"),c()()}if(2&t){const e=i.$implicit;h(),ha(" ",e.number," | ",e.phone," | ",e.rateValue||0," / ","km"===e.rateType?"Km":"Day"," ")}}function Rj(t,i){if(1&t){const e=O();l(0,"div",6)(1,"div",7)(2,"span",8),M("click",function(){return _(e),v(f().closeAddPartnerPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Add Partner"),c(),l(6,"div",9)(7,"div",10)(8,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.partnerName,o)||(r.newPartner.partnerName=o),v(o)}),c(),l(9,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.GSTIN,o)||(r.newPartner.GSTIN=o),v(o)}),c()(),l(10,"div",10)(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.address,o)||(r.newPartner.address=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.city,o)||(r.newPartner.city=o),v(o)}),c()(),l(13,"div",10)(14,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.state,o)||(r.newPartner.state=o),v(o)}),c(),l(15,"input",16),S("ngModelChange",function(o){_(e);const r=f();return x(r.newPartner.pinCode,o)||(r.newPartner.pinCode=o),v(o)}),c()(),D(16,Lj,6,4,"div",17),l(17,"div",18)(18,"input",19),S("ngModelChange",function(o){_(e);const r=f();return x(r.newVehicle.number,o)||(r.newVehicle.number=o),v(o)}),c(),l(19,"input",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.newVehicle.phone,o)||(r.newVehicle.phone=o),v(o)}),c(),l(20,"select",21),S("ngModelChange",function(o){_(e);const r=f();return x(r.newVehicle.rateType,o)||(r.newVehicle.rateType=o),v(o)}),l(21,"option",22),u(22,"Rate / Km"),c(),l(23,"option",23),u(24,"Rate / Day"),c()(),l(25,"input",24),S("ngModelChange",function(o){_(e);const r=f();return x(r.newVehicle.rateValue,o)||(r.newVehicle.rateValue=o),v(o)}),c(),l(26,"button",25),M("click",function(){return _(e),v(f().addVehicle())}),u(27),c()(),l(28,"button",26),M("click",function(){return _(e),v(f().addPartner())}),u(29,"+ Add Partner"),c()()()()}if(2&t){const e=f();h(8),w("ngModel",e.newPartner.partnerName),h(),w("ngModel",e.newPartner.GSTIN),h(2),w("ngModel",e.newPartner.address),h(),w("ngModel",e.newPartner.city),h(2),w("ngModel",e.newPartner.state),h(),w("ngModel",e.newPartner.pinCode),h(),C("ngForOf",e.newPartner.vehicleNumbers),h(2),w("ngModel",e.newVehicle.number),h(),w("ngModel",e.newVehicle.phone),h(),w("ngModel",e.newVehicle.rateType),h(5),w("ngModel",e.newVehicle.rateValue),h(2),k(" ",null!==e.editingNewVehicleIndex?"Update Vehicle":"+ Vehicle"," ")}}function Fj(t,i){if(1&t){const e=O();l(0,"div",27),u(1),l(2,"button",25),M("click",function(){const o=_(e).index;return v(f(3).startEditExistingVehicle(o))}),u(3,"Edit"),c(),l(4,"button",25),M("click",function(){const o=_(e).index;return v(f(3).removeEditingVehicle(o))}),u(5,"Delete"),c()()}if(2&t){const e=i.$implicit;h(),ha(" ",e.number," | ",e.phone," | ",e.rateValue||0," / ","km"===e.rateType?"Km":"Day"," ")}}function Bj(t,i){if(1&t){const e=O();l(0,"div",9)(1,"div",10)(2,"input",11),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.partnerName,o)||(r.editing.partnerName=o),v(o)}),c(),l(3,"input",12),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.GSTIN,o)||(r.editing.GSTIN=o),v(o)}),c()(),l(4,"div",10)(5,"input",13),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.address,o)||(r.editing.address=o),v(o)}),c(),l(6,"input",14),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.city,o)||(r.editing.city=o),v(o)}),c()(),l(7,"div",10)(8,"input",15),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.state,o)||(r.editing.state=o),v(o)}),c(),l(9,"input",16),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editing.pinCode,o)||(r.editing.pinCode=o),v(o)}),c()(),D(10,Fj,6,4,"div",17),l(11,"div",18)(12,"input",19),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editVehicleField.number,o)||(r.editVehicleField.number=o),v(o)}),c(),l(13,"input",20),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editVehicleField.phone,o)||(r.editVehicleField.phone=o),v(o)}),c(),l(14,"select",21),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editVehicleField.rateType,o)||(r.editVehicleField.rateType=o),v(o)}),l(15,"option",22),u(16,"Rate / Km"),c(),l(17,"option",23),u(18,"Rate / Day"),c()(),l(19,"input",24),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editVehicleField.rateValue,o)||(r.editVehicleField.rateValue=o),v(o)}),c(),l(20,"button",25),M("click",function(){return _(e),v(f(2).addEditingVehicle())}),u(21),c()(),l(22,"div",29)(23,"button",26),M("click",function(){return _(e),v(f(2).saveEdit())}),u(24,"Save Changes"),c(),l(25,"button",25),M("click",function(){return _(e),v(f(2).closeEditPartnerPopup())}),u(26,"Cancel"),c()()()}if(2&t){const e=f(2);h(2),w("ngModel",e.editing.partnerName),h(),w("ngModel",e.editing.GSTIN),h(2),w("ngModel",e.editing.address),h(),w("ngModel",e.editing.city),h(2),w("ngModel",e.editing.state),h(),w("ngModel",e.editing.pinCode),h(),C("ngForOf",e.editing.vehicleNumbers),h(2),w("ngModel",e.editVehicleField.number),h(),w("ngModel",e.editVehicleField.phone),h(),w("ngModel",e.editVehicleField.rateType),h(5),w("ngModel",e.editVehicleField.rateValue),h(2),k(" ",null!==e.editingExistingVehicleIndex?"Update Vehicle":"+ Vehicle"," ")}}function Vj(t,i){if(1&t){const e=O();l(0,"div",6)(1,"div",7)(2,"span",8),M("click",function(){return _(e),v(f().closeEditPartnerPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Edit Partner"),c(),D(6,Bj,27,12,"div",28),c()()}if(2&t){const e=f();h(6),C("ngIf",e.editing)}}function Hj(t,i){if(1&t&&(l(0,"div",32),u(1),X(2,"br"),u(3),c()),2&t){const e=i.$implicit;h(),k(" ",e.number," "),h(2),k(" ",e.phone," ")}}function jj(t,i){if(1&t&&(zn(0),u(1),Gn()),2&t){const e=f().$implicit;h(),k(" ",e.vehicleStatus||"online"," ")}}function Uj(t,i){if(1&t){const e=O();l(0,"select",34),S("ngModelChange",function(o){_(e);const r=f().$implicit;return x(r.vehicleStatus,o)||(r.vehicleStatus=o),v(o)}),M("change",function(){_(e);const o=f().$implicit,r=f().$implicit;return v(f().updateVehicleStatus(r,o))}),l(1,"option",35),u(2,"scheduled"),c(),l(3,"option",36),u(4,"delivering"),c(),l(5,"option",37),u(6,"completed"),c()()}2&t&&w("ngModel",f().$implicit.vehicleStatus)}function zj(t,i){if(1&t&&(l(0,"div",32),D(1,jj,2,1,"ng-container",33)(2,Uj,7,1,"ng-template",null,0,qn),c()),2&t){const e=i.$implicit,n=$n(3);h(),C("ngIf","online"===(e.vehicleStatus||"online"))("ngIfElse",n)}}function Gj(t,i){if(1&t&&(l(0,"div",32),u(1),c()),2&t){const e=i.$implicit;h(),Be(" ",e.rateValue||0," / ","km"===e.rateType?"Km":"Day"," ")}}function $j(t,i){if(1&t){const e=O();l(0,"div",32)(1,"input",38),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.vehicleDailyCost,o)||(r.vehicleDailyCost=o),v(o)}),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.vehicleDailyCost),C("disabled",!0)}}function qj(t,i){if(1&t){const e=O();l(0,"tr")(1,"td")(2,"span"),u(3),c()(),l(4,"td")(5,"span"),u(6),c()(),l(7,"td")(8,"span"),u(9),c()(),l(10,"td"),D(11,Hj,4,2,"div",30),c(),l(12,"td"),D(13,zj,4,2,"div",30),c(),l(14,"td"),D(15,Gj,2,2,"div",30),c(),l(16,"td")(17,"button",31),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(18),c()(),l(19,"td"),D(20,$j,2,2,"div",30),c(),l(21,"td")(22,"button",31),M("click",function(){const o=_(e).$implicit;return v(f().editPartner(o))}),u(23,"Edit"),c()()()}if(2&t){const e=i.$implicit;h(3),N(e.partnerName),h(3),N(e.GSTIN),h(3),N(e.address),h(2),C("ngForOf",e.vehicleNumbers),h(2),C("ngForOf",e.vehicleNumbers),h(2),C("ngForOf",e.vehicleNumbers),h(2),Ce("active","active"===e.status)("inactive","active"!==e.status),h(),k(" ","active"===e.status?"Active":"Inactive"," "),h(2),C("ngForOf",e.vehicleNumbers)}}let Wj=(()=>{class t{constructor(e,n){this.http=e,this.branchService=n,this.partners=[],this.showAddPartnerPopup=!1,this.showEditPartnerPopup=!1,this.branch=localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.newPartner={partnerName:"",address:"",city:"",state:"",pinCode:"",GSTIN:"",vehicleNumbers:[],status:"active",branch:localStorage.getItem("branch")||"All Branches",originLocId:localStorage.getItem("originLocId")||"all"},this.newVehicle={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"},this.editVehicleField={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"},this.editingNewVehicleIndex=null,this.editingExistingVehicleIndex=null,this.editing=null,this.onStorageChange=o=>{if("branch"===o.key||"originLocId"===o.key){const r=localStorage.getItem("branch")||"All Branches",s=localStorage.getItem("originLocId")||"all";(r!==this.branch||s!==this.originLocId)&&(this.branch=r,this.originLocId=s,this.loadPartners())}}}ngOnInit(){this.branch=this.branchService.currentBranch||this.branch,this.originLocId=localStorage.getItem("originLocId")||this.originLocId,this.branchSub=this.branchService.branch$.subscribe(e=>{const n=localStorage.getItem("originLocId")||"all";(e!==this.branch||n!==this.originLocId)&&(this.branch=e,this.originLocId=n,this.loadPartners())}),window.addEventListener("storage",this.onStorageChange),this.loadPartners()}ngOnDestroy(){this.branchSub?.unsubscribe(),window.removeEventListener("storage",this.onStorageChange)}addVehicle(){this.newVehicle.number.trim()&&this.newVehicle.phone.trim()&&(null!==this.editingNewVehicleIndex?(this.newPartner.vehicleNumbers[this.editingNewVehicleIndex]={...this.newVehicle},this.editingNewVehicleIndex=null):this.newPartner.vehicleNumbers.push({...this.newVehicle}),this.newVehicle={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"})}removeVehicle(e){this.newPartner.vehicleNumbers.splice(e,1),this.editingNewVehicleIndex===e&&(this.editingNewVehicleIndex=null,this.newVehicle={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"})}addEditingVehicle(){this.editVehicleField.number.trim()&&this.editVehicleField.phone.trim()&&(null!==this.editingExistingVehicleIndex?(this.editing.vehicleNumbers[this.editingExistingVehicleIndex]={...this.editVehicleField},this.editingExistingVehicleIndex=null):this.editing.vehicleNumbers.push({...this.editVehicleField}),this.editVehicleField={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"})}removeEditingVehicle(e){this.editing.vehicleNumbers.splice(e,1),this.editingExistingVehicleIndex===e&&(this.editingExistingVehicleIndex=null,this.editVehicleField={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"})}loadPartners(){this.http.get("http://localhost:3000/api/tpartners",{params:{originLocId:this.originLocId||localStorage.getItem("originLocId")||"all"}}).subscribe(e=>{this.partners=e})}openAddPartnerPopup(){this.showAddPartnerPopup=!0}closeAddPartnerPopup(){this.showAddPartnerPopup=!1}addPartner(){this.newPartner.branch=this.branch||localStorage.getItem("branch")||"All Branches",this.newPartner.originLocId=this.originLocId||localStorage.getItem("originLocId")||"all","All Branches"!==this.newPartner.branch&&"all"!==this.newPartner.originLocId?this.http.post("http://localhost:3000/api/tpartners/add",this.newPartner).subscribe({next:()=>{alert("Transport Partner added!"),this.loadPartners(),this.resetForm(),this.closeAddPartnerPopup()},error:e=>alert(e.error.message)}):alert("Please select a specific branch before adding a transport partner.")}resetForm(){this.newPartner={partnerName:"",address:"",city:"",state:"",pinCode:"",GSTIN:"",vehicleNumbers:[],status:"active",branch:this.branch||localStorage.getItem("branch")||"All Branches",originLocId:this.originLocId||localStorage.getItem("originLocId")||"all"},this.editingNewVehicleIndex=null,this.newVehicle={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"}}editPartner(e){this.editing=JSON.parse(JSON.stringify(e)),this.editing.vehicleNumbers=Array.isArray(this.editing.vehicleNumbers)?this.editing.vehicleNumbers.map(n=>({vehicleStatus:"online",rateType:"km",rateValue:0,...n})):[],this.editingExistingVehicleIndex=null,this.editVehicleField={number:"",phone:"",rateType:"km",rateValue:0,vehicleStatus:"online"},this.showEditPartnerPopup=!0}saveEdit(){this.http.put(`http://localhost:3000/api/tpartners/${this.editing._id}`,this.editing).subscribe(()=>{alert("Updated Successfully"),this.editing=null,this.showEditPartnerPopup=!1,this.loadPartners()})}closeEditPartnerPopup(){this.editing=null,this.showEditPartnerPopup=!1,this.editingExistingVehicleIndex=null}startEditNewVehicle(e){const n=this.newPartner.vehicleNumbers[e];n&&(this.editingNewVehicleIndex=e,this.newVehicle={number:n.number||"",phone:n.phone||"",rateType:n.rateType||"km",rateValue:"number"==typeof n.rateValue?n.rateValue:0,vehicleStatus:n.vehicleStatus||"online"})}startEditExistingVehicle(e){if(!this.editing||!Array.isArray(this.editing.vehicleNumbers))return;const n=this.editing.vehicleNumbers[e];n&&(this.editingExistingVehicleIndex=e,this.editVehicleField={number:n.number||"",phone:n.phone||"",rateType:n.rateType||"km",rateValue:"number"==typeof n.rateValue?n.rateValue:0,vehicleStatus:n.vehicleStatus||"online"})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/tpartners/${e._id}/status`,{}).subscribe(()=>this.loadPartners())}updateVehicleStatus(e,n){!e?._id||!n?.number||this.http.patch(`http://localhost:3000/api/tpartners/${e._id}/vehicle-status`,{vehicleNumber:n.number,vehicleStatus:n.vehicleStatus,vehicleDailyCost:n.vehicleDailyCost}).subscribe({next:()=>{this.loadPartners()},error:o=>console.error("Error updating vehicle status:",o)})}static{this.\u0275fac=function(n){return new(n||t)(R(Ve),R(Xa))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-transport-partner"]],standalone:!0,features:[Ae],decls:29,vars:3,consts:[["statusSelect",""],[1,"tpartner-container"],["type","button",1,"add-partner-btn",3,"click"],["class","modal",4,"ngIf"],[1,"tpartner-table-wrapper"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"add-partner-form"],[1,"form-row"],["placeholder","Partner Name*","required","",3,"ngModelChange","ngModel"],["placeholder","GSTIN*","required","",3,"ngModelChange","ngModel"],["placeholder","Address*","required","",3,"ngModelChange","ngModel"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","Pin Code",3,"ngModelChange","ngModel"],["class","vehicle-tag",4,"ngFor","ngForOf"],[1,"vehicle-entry"],["placeholder","Vehicle Number",3,"ngModelChange","ngModel"],["placeholder","Driver Phone",3,"ngModelChange","ngModel"],["required","",3,"ngModelChange","ngModel"],["value","km"],["value","day"],["type","number","placeholder","Rate Value*","required","",3,"ngModelChange","ngModel"],["type","button",3,"click"],["type","button",1,"btn-add",3,"click"],[1,"vehicle-tag"],["class","add-partner-form",4,"ngIf"],[1,"terminal-buttons"],["class","tag",4,"ngFor","ngForOf"],[3,"click"],[1,"tag"],[4,"ngIf","ngIfElse"],[3,"ngModelChange","change","ngModel"],["value","scheduled"],["value","delivering"],["value","completed"],["type","number","min","0","placeholder","Daily cost",3,"ngModelChange","ngModel","disabled"]],template:function(n,o){1&n&&(l(0,"div",1)(1,"h2"),u(2,"Transport Partners"),c(),l(3,"button",2),M("click",function(){return o.openAddPartnerPopup()}),u(4,"+ Add Partner"),c(),D(5,Rj,30,12,"div",3)(6,Vj,7,1,"div",3),l(7,"div",4)(8,"table")(9,"tr")(10,"th"),u(11,"Partner"),c(),l(12,"th"),u(13,"GSTIN"),c(),l(14,"th"),u(15,"Address"),c(),l(16,"th"),u(17,"Vehicles"),c(),l(18,"th"),u(19,"Vehicle Status"),c(),l(20,"th"),u(21,"Rate"),c(),l(22,"th"),u(23,"Status"),c(),l(24,"th"),u(25,"Vehicle daily cost"),c(),l(26,"th"),u(27,"Actions"),c()(),D(28,qj,24,12,"tr",5),c()()()),2&n&&(h(5),C("ngIf",o.showAddPartnerPopup),h(),C("ngIf",o.showEditPartnerPopup),h(22),C("ngForOf",o.partners))},dependencies:[pt,lt,Xe,et,wt,St,qe,on,vt,We,Dn,Gi,He],styles:[".tpartner-container[_ngcontent-%COMP%]{width:100%;padding:10px}.add-partner-form[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-direction:column;gap:8px}.add-partner-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .add-partner-form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px;font-size:14px}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.vehicle-entry[_ngcontent-%COMP%]{display:flex;gap:6px;flex-wrap:wrap}.vehicle-tag[_ngcontent-%COMP%]{background:#e0f3ff;padding:3px 6px;border-radius:4px;display:inline-block;margin:3px;font-size:12px}.delete-tag[_ngcontent-%COMP%]{cursor:pointer;font-size:12px;color:red}.btn-add[_ngcontent-%COMP%]{background:#0069ff;color:#fff;border-radius:4px;padding:6px;width:fit-content}.add-partner-btn[_ngcontent-%COMP%]{margin-bottom:12px}.modal[_ngcontent-%COMP%]{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;width:400px;max-width:90%;position:relative}.close[_ngcontent-%COMP%]{float:right;font-size:24px;cursor:pointer}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:6px;border:1px solid #ccc}.active[_ngcontent-%COMP%]{background:green;color:#fff}.inactive[_ngcontent-%COMP%]{background:#000;color:#fff}.tag-edit[_ngcontent-%COMP%], .tag[_ngcontent-%COMP%]{background:#f2f2f2;padding:4px;margin-bottom:4px;border-radius:4px}.edit-field[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}@media (max-width: 720px){.form-row[_ngcontent-%COMP%], .edit-field[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}}return t})(),Qj=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-notifications"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Notifications"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function Zj(t,i){if(1&t&&(l(0,"option",11),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.hubName)}}function Yj(t,i){if(1&t){const e=O();l(0,"div",7)(1,"label")(2,"span"),u(3,"Hub"),c(),l(4,"select",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.selectedHubId,o)||(r.selectedHubId=o),v(o)}),l(5,"option",9),u(6,"Select hub"),c(),D(7,Zj,2,2,"option",10),c()()()}if(2&t){const e=f();h(4),w("ngModel",e.selectedHubId),h(3),C("ngForOf",e.hubs)}}function Kj(t,i){if(1&t){const e=O();l(0,"div",31)(1,"input",32),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.address,o)||(r.address=o),v(o)}),c(),l(2,"input",18),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.city,o)||(r.city=o),v(o)}),c(),l(3,"input",19),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.state,o)||(r.state=o),v(o)}),c(),l(4,"input",20),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pinCode,o)||(r.pinCode=o),v(o)}),c(),l(5,"button",28),M("click",function(){const o=_(e).index;return v(f(2).removeDeliveryLocation(o))}),u(6,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.address),h(),w("ngModel",e.city),h(),w("ngModel",e.state),h(),w("ngModel",e.pinCode)}}function Jj(t,i){if(1&t&&(l(0,"option",11),u(1),c()),2&t){const e=i.$implicit;C("value",e.productName),h(),Be(" ",e.hsnNum," - ",e.productName," ")}}function Xj(t,i){if(1&t){const e=O();l(0,"div",39)(1,"input",40),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pickupLocationId,o)||(r.pickupLocationId=o),v(o)}),c(),l(2,"input",41),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveryLocationId,o)||(r.deliveryLocationId=o),v(o)}),c(),l(3,"input",42),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerNum,o)||(r.rate.ratePerNum=o),v(o)}),c(),l(4,"input",43),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerVolume,o)||(r.rate.ratePerVolume=o),v(o)}),c(),l(5,"input",44),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerKg,o)||(r.rate.ratePerKg=o),v(o)}),c(),l(6,"button",28),M("click",function(){const o=_(e).index,r=f().$implicit;return v(f(2).removeRateRow(r,o))}),u(7,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.pickupLocationId),h(),w("ngModel",e.deliveryLocationId),h(),w("ngModel",e.rate.ratePerNum),h(),w("ngModel",e.rate.ratePerVolume),h(),w("ngModel",e.rate.ratePerKg)}}function e9(t,i){if(1&t&&X(0,"option",45),2&t){const e=i.$implicit;C("value",e.id)("label",e.label)}}function t9(t,i){if(1&t){const e=O();l(0,"div",33)(1,"select",34),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.productName,o)||(r.productName=o),v(o)}),M("change",function(){const o=_(e).$implicit;return v(f(2).onProductSelect(o))}),l(2,"option",9),u(3,"Select Product"),c(),D(4,Jj,2,3,"option",10),c(),X(5,"br"),l(6,"div",35),D(7,Xj,8,5,"div",36),l(8,"button",28),M("click",function(){const o=_(e).$implicit;return v(f(2).addRateRow(o))}),u(9,"+ Add Rate"),c(),l(10,"datalist",37),D(11,e9,1,2,"option",38),c()(),l(12,"button",28),M("click",function(){const o=_(e).index;return v(f(2).removeProduct(o))}),u(13,"Remove Product"),c()()}if(2&t){const e=i.$implicit,n=f(2);h(),w("ngModel",e.productName),h(3),C("ngForOf",n.productOptions),h(3),C("ngForOf",e.rates),h(4),C("ngForOf",n.rateAddressOptions)}}function n9(t,i){if(1&t){const e=O();l(0,"div",12)(1,"div",13)(2,"span",14),M("click",function(){return _(e),v(f().closeAddClientPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Add New Client"),c(),l(6,"div",15)(7,"input",16),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.clientName,o)||(r.newClient.clientName=o),v(o)}),c(),l(8,"input",17),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.deliveryLocations[0].address,o)||(r.newClient.deliveryLocations[0].address=o),v(o)}),c(),l(9,"input",18),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.deliveryLocations[0].city,o)||(r.newClient.deliveryLocations[0].city=o),v(o)}),c(),l(10,"input",19),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.deliveryLocations[0].state,o)||(r.newClient.deliveryLocations[0].state=o),v(o)}),c(),l(11,"input",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.deliveryLocations[0].pinCode,o)||(r.newClient.deliveryLocations[0].pinCode=o),v(o)}),c(),l(12,"input",21),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.GSTIN,o)||(r.newClient.GSTIN=o),v(o)}),c(),l(13,"input",22),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.phoneNum,o)||(r.newClient.phoneNum=o),v(o)}),c(),l(14,"input",23),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.perDis,o)||(r.newClient.perDis=o),v(o)}),c(),l(15,"select",24),S("ngModelChange",function(o){_(e);const r=f();return x(r.newClient.creditType,o)||(r.newClient.creditType=o),v(o)}),l(16,"option",25),u(17,"No Credit"),c(),l(18,"option",26),u(19,"Credit Allowed"),c()(),l(20,"h4"),u(21,"Delivery Locations"),c(),D(22,Kj,7,4,"div",27),l(23,"button",28),M("click",function(){return _(e),v(f().addDeliveryLocation())}),u(24,"+ Add Delivery Location"),c(),X(25,"br")(26,"br"),l(27,"h4"),u(28,"Product Pricing"),c(),D(29,t9,14,4,"div",29),l(30,"button",28),M("click",function(){return _(e),v(f().addProduct())}),u(31,"+ Add Product"),c(),X(32,"br")(33,"br"),l(34,"button",30),M("click",function(){return _(e),v(f().addClient())}),u(35,"+ Add Client"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.newClient.clientName),h(),w("ngModel",e.newClient.deliveryLocations[0].address),h(),w("ngModel",e.newClient.deliveryLocations[0].city),h(),w("ngModel",e.newClient.deliveryLocations[0].state),h(),w("ngModel",e.newClient.deliveryLocations[0].pinCode),h(),w("ngModel",e.newClient.GSTIN),h(),w("ngModel",e.newClient.phoneNum),h(),w("ngModel",e.newClient.perDis),h(),w("ngModel",e.newClient.creditType),h(7),C("ngForOf",e.newClient.deliveryLocations),h(7),C("ngForOf",e.newClient.products)}}function i9(t,i){if(1&t&&(l(0,"div"),u(1),c()),2&t){const e=i.$implicit;h(),ha(" \u{1f4e6} ",e.address," ",e.city," ",e.state," ",e.pinCode," ")}}function o9(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td"),u(12),c(),l(13,"td"),u(14),c(),l(15,"td"),u(16),c(),l(17,"td")(18,"button",46),M("click",function(){const o=_(e).$implicit;return v(f().toggleCreditType(o))}),u(19),c()(),l(20,"td"),D(21,i9,2,4,"div",6),c(),l(22,"td")(23,"button",46),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(24),c()(),l(25,"td")(26,"button",30),M("click",function(){const o=_(e).$implicit;return v(f().openEditClientPopup(o))}),u(27,"Edit"),c()()()}if(2&t){const e=i.$implicit;h(2),N(e.clientName),h(2),N(e.address),h(2),N(e.city),h(2),N(e.state),h(2),N(e.pinCode),h(2),N(e.GSTIN),h(2),N(e.phoneNum),h(2),N(e.perDis),h(2),C("ngClass","credit"===e.creditType?"credit-active":"credit-inactive"),h(),k(" ","credit"===e.creditType?"Credit":"No Credit"," "),h(2),C("ngForOf",e.deliveryLocations),h(2),C("ngClass","active"===e.status?"status-active":"status-inactive"),h(),k(" ","active"===e.status?"Active":"Deactivated"," ")}}function r9(t,i){if(1&t){const e=O();l(0,"div",31)(1,"input",32),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.address,o)||(r.address=o),v(o)}),c(),l(2,"input",18),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.city,o)||(r.city=o),v(o)}),c(),l(3,"input",19),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.state,o)||(r.state=o),v(o)}),c(),l(4,"input",20),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pinCode,o)||(r.pinCode=o),v(o)}),c(),l(5,"button",28),M("click",function(){const o=_(e).index;return v(f(2).removeDeliveryLocationEdit(o))}),u(6,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.address),h(),w("ngModel",e.city),h(),w("ngModel",e.state),h(),w("ngModel",e.pinCode)}}function s9(t,i){if(1&t&&(l(0,"option",11),u(1),c()),2&t){const e=i.$implicit;C("value",e.productName),h(),Be(" ",e.hsnNum," - ",e.productName," ")}}function a9(t,i){if(1&t){const e=O();l(0,"div",39)(1,"input",40),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pickupLocationId,o)||(r.pickupLocationId=o),v(o)}),c(),l(2,"input",41),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveryLocationId,o)||(r.deliveryLocationId=o),v(o)}),c(),l(3,"input",42),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerNum,o)||(r.rate.ratePerNum=o),v(o)}),c(),l(4,"input",43),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerVolume,o)||(r.rate.ratePerVolume=o),v(o)}),c(),l(5,"input",44),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerKg,o)||(r.rate.ratePerKg=o),v(o)}),c(),l(6,"button",28),M("click",function(){const o=_(e).index,r=f().$implicit;return v(f(2).removeRateRow(r,o))}),u(7,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.pickupLocationId),h(),w("ngModel",e.deliveryLocationId),h(),w("ngModel",e.rate.ratePerNum),h(),w("ngModel",e.rate.ratePerVolume),h(),w("ngModel",e.rate.ratePerKg)}}function c9(t,i){if(1&t&&X(0,"option",45),2&t){const e=i.$implicit;C("value",e.id)("label",e.label)}}function l9(t,i){if(1&t){const e=O();l(0,"div",33)(1,"select",34),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.productName,o)||(r.productName=o),v(o)}),M("change",function(){const o=_(e).$implicit;return v(f(2).onProductSelect(o))}),l(2,"option",9),u(3,"Select Product"),c(),D(4,s9,2,3,"option",10),c(),X(5,"br"),l(6,"div",35),D(7,a9,8,5,"div",36),l(8,"button",28),M("click",function(){const o=_(e).$implicit;return v(f(2).addRateRow(o))}),u(9,"+ Add Rate"),c(),l(10,"datalist",37),D(11,c9,1,2,"option",38),c()(),l(12,"button",28),M("click",function(){const o=_(e).index;return v(f(2).removeProductEdit(o))}),u(13,"Remove Product"),c()()}if(2&t){const e=i.$implicit,n=f(2);h(),w("ngModel",e.productName),h(3),C("ngForOf",n.productOptions),h(3),C("ngForOf",e.rates),h(4),C("ngForOf",n.rateAddressOptions)}}function d9(t,i){if(1&t){const e=O();l(0,"div",12)(1,"div",47)(2,"span",14),M("click",function(){return _(e),v(f().closeEditClientPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Edit Client"),c(),l(6,"div",15)(7,"input",16),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.clientName,o)||(r.editingClient.clientName=o),v(o)}),c(),l(8,"input",17),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.address,o)||(r.editingClient.address=o),v(o)}),c(),l(9,"input",18),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.city,o)||(r.editingClient.city=o),v(o)}),c(),l(10,"input",19),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.state,o)||(r.editingClient.state=o),v(o)}),c(),l(11,"input",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.pinCode,o)||(r.editingClient.pinCode=o),v(o)}),c(),l(12,"input",21),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.GSTIN,o)||(r.editingClient.GSTIN=o),v(o)}),c(),l(13,"input",22),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.phoneNum,o)||(r.editingClient.phoneNum=o),v(o)}),c(),l(14,"input",23),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.perDis,o)||(r.editingClient.perDis=o),v(o)}),c(),l(15,"select",24),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingClient.creditType,o)||(r.editingClient.creditType=o),v(o)}),l(16,"option",25),u(17,"No Credit"),c(),l(18,"option",26),u(19,"Credit Allowed"),c()(),l(20,"h4"),u(21,"Delivery Locations"),c(),D(22,r9,7,4,"div",27),l(23,"button",28),M("click",function(){return _(e),v(f().addDeliveryLocationEdit())}),u(24,"+ Add Delivery Location"),c(),X(25,"br")(26,"br"),l(27,"h4"),u(28,"Product Pricing"),c(),D(29,l9,14,4,"div",29),l(30,"button",28),M("click",function(){return _(e),v(f().addProductEdit())}),u(31,"+ Add Product"),c(),X(32,"br")(33,"br"),l(34,"button",30),M("click",function(){return _(e),v(f().saveEdit())}),u(35,"Save"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.editingClient.clientName),h(),w("ngModel",e.editingClient.address),h(),w("ngModel",e.editingClient.city),h(),w("ngModel",e.editingClient.state),h(),w("ngModel",e.editingClient.pinCode),h(),w("ngModel",e.editingClient.GSTIN),h(),w("ngModel",e.editingClient.phoneNum),h(),w("ngModel",e.editingClient.perDis),h(),w("ngModel",e.editingClient.creditType),h(7),C("ngForOf",e.editingClient.deliveryLocations),h(7),C("ngForOf",e.editingClient.products)}}let u9=(()=>{class t{constructor(e){this.http=e,this.clients=[],this.hubs=[],this.selectedHubId="",this.productOptions=[],this.rateAddressOptions=[],this.rateAddressLabelById=new Map,this.showAddClientPopup=!1,this.showEditClientPopup=!1,this.cbranch=localStorage.getItem("branch")||"All Branches",this.coriginLocId=localStorage.getItem("originLocId")||"all",this.newClient={clientName:"",GSTIN:"",phoneNum:"",perDis:"",creditType:"no-credit",products:[],deliveryLocations:[{address:"",city:"",state:"",pinCode:""}],status:"active",branch:localStorage.getItem("branch")||"All Branches",originLocId:localStorage.getItem("originLocId")||"all",email:localStorage.getItem("email"),username:localStorage.getItem("username")},this.editingClient=null,this.onStorage=n=>{if("branch"===n.key||"originLocId"===n.key){const o=localStorage.getItem("branch")||"All Branches",r=localStorage.getItem("originLocId")||"all";(o!==this.cbranch||r!==this.coriginLocId)&&(this.cbranch=o,this.coriginLocId=r),this.loadClients(),"All Hubs"!==o&&(this.selectedHubId=""),this.loadHubs(),this.loadProducts(),this.loadRateAddressOptions()}}}ngOnInit(){this.loadClients(),this.loadHubs(),this.loadProducts(),this.loadRateAddressOptions(),this.branchCheck=setInterval(()=>{const e=localStorage.getItem("branch")||"All Branches",n=localStorage.getItem("originLocId")||"all";(e!==this.cbranch||n!==this.coriginLocId)&&(this.cbranch=e,this.coriginLocId=n,"All Hubs"!==e&&(this.selectedHubId=""),this.loadClients(),this.loadHubs(),this.loadProducts(),this.loadRateAddressOptions())},1e3),window.addEventListener("storage",this.onStorage)}ngOnDestroy(){this.branchCheck&&clearInterval(this.branchCheck),window.removeEventListener("storage",this.onStorage)}loadClients(){const e=localStorage.getItem("email");this.cbranch=localStorage.getItem("branch")||"All Branches",this.coriginLocId=localStorage.getItem("originLocId")||"all",this.http.get(`http://localhost:3000/api/clients?email=${e}&originLocId=${"All Hubs"===this.cbranch?"all-hubs":this.coriginLocId}`).subscribe({next:o=>{console.log("Clients loaded:",o),this.clients=o},error:o=>console.error("Error loading clients:",o)})}loadHubs(){this.http.get("http://localhost:3000/api/hubs").subscribe({next:e=>{this.hubs=e||[]},error:()=>{this.hubs=[]}})}loadProducts(){const e=localStorage.getItem("branch")||"",n=localStorage.getItem("originLocId")||"all";this.http.get(`http://localhost:3000/api/products?originLocId=${encodeURIComponent(n)}&branch=${encodeURIComponent(e)}`).subscribe({next:o=>{this.productOptions=o||[]},error:o=>console.error("Error loading products:",o)})}loadRateAddressOptions(){Pn({branches:this.http.get("http://localhost:3000/api/branches"),hubs:this.http.get("http://localhost:3000/api/hubs"),clients:this.http.get("http://localhost:3000/api/clients/clientslist?originLocId=all")}).subscribe({next:({branches:n,hubs:o,clients:r})=>{this.hubs=o||[];const s=[];(n||[]).forEach(a=>{const d=Array.isArray(a?.addresses)?a.addresses:[];if(d.forEach(p=>{const g=String(p?._id||"").trim();if(!g)return;const m=[p.address,p.city,p.state,p.pinCode].filter(Boolean),b=`Branch: ${a?.branchName||""} - ${m.join(", ")}`;s.push({id:g,label:b})}),!d.length&&a?._id){const p=[a.address,a.city,a.state,a.pinCode].filter(Boolean),g=`Branch: ${a?.branchName||""} - ${p.join(", ")}`.trim();s.push({id:String(a._id),label:g})}}),(o||[]).forEach(a=>{(Array.isArray(a?.deliveryAddresses)?a.deliveryAddresses:[]).forEach(p=>{const g=String(p?._id||"").trim();if(!g)return;const m=`Hub: ${a?.hubName||""} - ${p?.location||""}`.trim();s.push({id:g,label:m})})}),(r||[]).forEach(a=>{(Array.isArray(a?.deliveryLocations)?a.deliveryLocations:[]).forEach(p=>{const g=String(p?.delivery_id||p?._id||"").trim();if(!g)return;const m=[p.address,p.city,p.state,p.pinCode].filter(Boolean),b=`Client: ${a?.clientName||""} - ${m.join(", ")}`;s.push({id:g,label:b})})}),this.rateAddressOptions=s,this.rateAddressLabelById=new Map(s.map(a=>[a.id,a.label]))},error:()=>{this.rateAddressOptions=[],this.rateAddressLabelById=new Map}})}openAddClientPopup(){this.showAddClientPopup=!0}closeAddClientPopup(){this.showAddClientPopup=!1}openEditClientPopup(e){this.editingClient=JSON.parse(JSON.stringify(e)),Array.isArray(this.editingClient.products)||(this.editingClient.products=[]),Array.isArray(this.editingClient.deliveryLocations)||(this.editingClient.deliveryLocations=[{address:"",city:"",state:"",pinCode:""}]),this.editingClient.products=this.editingClient.products.map(n=>this.ensureProductRates(n)),this.showEditClientPopup=!0}closeEditClientPopup(){this.showEditClientPopup=!1,this.editingClient=null}addProduct(){this.newClient.products.push({hsnNum:"",productName:"",rates:[this.createRateEntry()]})}onProductSelect(e){const n=this.productOptions.find(o=>o.productName===e.productName);n&&(e.hsnNum=n.hsnNum)}removeProduct(e){this.newClient.products.splice(e,1)}addProductEdit(){this.editingClient.products.push({hsnNum:"",productName:"",rates:[this.createRateEntry()]})}removeProductEdit(e){this.editingClient.products.splice(e,1)}addRateRow(e){e.rates||(e.rates=[]),e.rates.push(this.createRateEntry())}removeRateRow(e,n){e.rates&&e.rates.splice(n,1)}addDeliveryLocation(){this.newClient.deliveryLocations.push({address:"",city:"",state:"",pinCode:""})}removeDeliveryLocation(e){this.newClient.deliveryLocations.splice(e,1)}addDeliveryLocationEdit(){this.editingClient.deliveryLocations.push({address:"",city:"",state:"",pinCode:""})}removeDeliveryLocationEdit(e){this.editingClient.deliveryLocations.splice(e,1)}addClient(){if(console.log("\u{1f4e4} Sending client data:",this.newClient),this.newClient.branch=localStorage.getItem("branch")||"All Branches",this.newClient.originLocId=localStorage.getItem("originLocId")||"all","All Hubs"===this.newClient.branch||"all-hubs"===this.newClient.originLocId){const e=(this.hubs||[]).find(n=>String(n?._id||"")===String(this.selectedHubId||""));if(!e)return void alert("Please select a hub before adding a client.");this.newClient.originLocId=String(e._id||""),this.newClient.branch=String(e.hubName||"").trim()||this.newClient.branch}"All Branches"!==this.newClient.branch&&"all"!==this.newClient.originLocId?this.hasRequiredPinCodes(this.newClient)?this.http.post("http://localhost:3000/api/clients/add",this.newClient,{headers:{"Content-Type":"application/json"}}).subscribe({next:e=>{console.log("\u2705 Client saved",e),alert("Client added successfully!"),window.location.reload()},error:e=>{console.error("\u274c Error saving client:",e),alert("Error: "+e.error.message)}}):alert("Please enter a Pin Code for every delivery location."):alert("Please select a specific branch before adding a client.")}saveEdit(){this.hasRequiredPinCodes(this.editingClient)?this.http.put(`http://localhost:3000/api/clients/${this.editingClient._id}`,this.editingClient).subscribe(()=>{this.loadClients(),this.closeEditClientPopup()}):alert("Please enter a Pin Code for every delivery location.")}toggleCreditType(e){this.http.patch(`http://localhost:3000/api/clients/${e._id}/credit`,{}).subscribe(()=>this.loadClients()),console.log("Toggled credit type for client:",e._id)}toggleStatus(e){this.http.patch(`http://localhost:3000/api/clients/${e._id}/status`,{}).subscribe(()=>this.loadClients())}createRateEntry(){return{pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}}}ensureProductRates(e){return{...e,rates:Array.isArray(e.rates)&&e.rates.length>0?e.rates.map(n=>({pickupLocationId:n.pickupLocationId||"",deliveryLocationId:n.deliveryLocationId||"",rate:{ratePerNum:n.rate?.ratePerNum??0,ratePerVolume:n.rate?.ratePerVolume??0,ratePerKg:n.rate?.ratePerKg??0}})):[this.createRateEntry()]}}hasRequiredPinCodes(e){return!(!e||Array.isArray(e.deliveryLocations)&&e.deliveryLocations.some(o=>!String(o?.pinCode||"").trim())||"pinCode"in e&&!String(e?.pinCode||"").trim())}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-client"]],standalone:!0,features:[Ae],decls:39,vars:4,consts:[[1,"clients-container"],[1,"client-actions"],[1,"add-client-btn",3,"click"],["class","hub-filter",4,"ngIf"],["class","modal",4,"ngIf"],[1,"clients-table-wrapper"],[4,"ngFor","ngForOf"],[1,"hub-filter"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"add-client-form"],["placeholder","Client Name","required","",3,"ngModelChange","ngModel"],["placeholder","Address","required","",3,"ngModelChange","ngModel"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","Pin Code","required","",3,"ngModelChange","ngModel"],["placeholder","GSTIN","required","",3,"ngModelChange","ngModel"],["placeholder","Contact Number","required","",3,"ngModelChange","ngModel"],["placeholder","% of Discount","required","",3,"ngModelChange","ngModel"],[1,"small-select",3,"ngModelChange","ngModel"],["value","no-credit"],["value","credit"],["class","delivery-form",4,"ngFor","ngForOf"],["type","button",3,"click"],["class","product-form",4,"ngFor","ngForOf"],[3,"click"],[1,"delivery-form"],["placeholder","Delivery Address","required","",3,"ngModelChange","ngModel"],[1,"product-form"],["required","",3,"ngModelChange","change","ngModel"],[1,"rate-rows"],["class","rate-row",4,"ngFor","ngForOf"],["id","rate-addresses"],[3,"value","label",4,"ngFor","ngForOf"],[1,"rate-row"],["placeholder","Pickup Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["placeholder","Delivery Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate per Box",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate per Volume",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate per Kg",3,"ngModelChange","ngModel"],[3,"value","label"],[3,"click","ngClass"],[1,"modal-content","edit-modal-content"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Clients"),c(),l(3,"div",1)(4,"button",2),M("click",function(){return o.openAddClientPopup()}),u(5,"+ Add Client"),c(),D(6,Yj,8,2,"div",3),c(),D(7,n9,36,11,"div",4),l(8,"div",5)(9,"table")(10,"thead")(11,"tr")(12,"th"),u(13,"Client Name"),c(),l(14,"th"),u(15,"Address"),c(),l(16,"th"),u(17,"City"),c(),l(18,"th"),u(19,"State"),c(),l(20,"th"),u(21,"Pin"),c(),l(22,"th"),u(23,"GSTIN"),c(),l(24,"th"),u(25,"Contact Number"),c(),l(26,"th"),u(27,"% Discount"),c(),l(28,"th"),u(29,"Credit Type"),c(),l(30,"th"),u(31,"Delivery Locations"),c(),l(32,"th"),u(33,"Status"),c(),l(34,"th"),u(35,"Actions"),c()()(),l(36,"tbody"),D(37,o9,28,13,"tr",6),c()()()(),D(38,d9,36,11,"div",4)),2&n&&(h(6),C("ngIf","All Hubs"===o.cbranch),h(),C("ngIf",o.showAddClientPopup),h(30),C("ngForOf",o.clients),h(),C("ngIf",o.showEditClientPopup))},dependencies:[pt,lf,lt,Xe,et,wt,St,qe,on,vt,We,Dn,He],styles:[".clients-container[_ngcontent-%COMP%]{padding:15px;max-width:100%;box-sizing:border-box;overflow-x:hidden}.client-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:10px;margin-bottom:10px}.hub-filter[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.hub-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px}.hub-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:4px 6px}.clients-table-wrapper[_ngcontent-%COMP%]{overflow-x:hidden}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;table-layout:fixed}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;vertical-align:top;word-break:break-word;overflow-wrap:anywhere}.edit-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:200px;margin-bottom:5px;box-sizing:border-box}.credit-active[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;font-weight:700;border:none;padding:5px 10px;border-radius:4px}.credit-inactive[_ngcontent-%COMP%]{background-color:#333;color:#fff;border:none;padding:5px 10px;border-radius:4px}.status-active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;font-weight:700;border:none;padding:5px 10px;border-radius:4px}.status-inactive[_ngcontent-%COMP%]{background-color:#555;color:#fff;border:none;padding:5px 10px;border-radius:4px}.modal[_ngcontent-%COMP%]{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;border:1px solid #007bff;box-shadow:0 6px 18px #007bff26;width:400px;max-width:90%;max-height:85vh;overflow-y:auto}.edit-modal-content[_ngcontent-%COMP%]{max-height:90vh;overflow-y:auto}.close[_ngcontent-%COMP%]{float:right;font-size:24px;cursor:pointer}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer}.modal-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0069d9}"]})}}return t})();function h9(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"span",7),M("click",function(){return _(e),v(f().closeAddGuestPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Add Guest"),c(),l(6,"div",8)(7,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.guestName,o)||(r.newGuest.guestName=o),v(o)}),c(),l(8,"input",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.address,o)||(r.newGuest.address=o),v(o)}),c(),l(9,"input",11),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.city,o)||(r.newGuest.city=o),v(o)}),c(),l(10,"input",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.state,o)||(r.newGuest.state=o),v(o)}),c(),l(11,"input",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.pinCode,o)||(r.newGuest.pinCode=o),v(o)}),c(),l(12,"input",14),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.phoneNum,o)||(r.newGuest.phoneNum=o),v(o)}),c(),l(13,"input",15),S("ngModelChange",function(o){_(e);const r=f();return x(r.newGuest.perDis,o)||(r.newGuest.perDis=o),v(o)}),c(),l(14,"button",16),M("click",function(){return _(e),v(f().addGuest())}),u(15,"+ Add Guest"),c()()()()}if(2&t){const e=f();h(7),w("ngModel",e.newGuest.guestName),h(),w("ngModel",e.newGuest.address),h(),w("ngModel",e.newGuest.city),h(),w("ngModel",e.newGuest.state),h(),w("ngModel",e.newGuest.pinCode),h(),w("ngModel",e.newGuest.phoneNum),h(),w("ngModel",e.newGuest.perDis)}}function p9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.guestName)}}function g9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.guestName,o)||(r.editingGuest.guestName=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.guestName)}}function f9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.address)}}function m9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.address,o)||(r.editingGuest.address=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.address)}}function _9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.city)}}function v9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.city,o)||(r.editingGuest.city=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.city)}}function b9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.state)}}function y9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.state,o)||(r.editingGuest.state=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.state)}}function C9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.pinCode)}}function M9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.pinCode,o)||(r.editingGuest.pinCode=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.pinCode)}}function I9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.phoneNum)}}function w9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.phoneNum,o)||(r.editingGuest.phoneNum=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.phoneNum)}}function S9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.perDis)}}function x9(t,i){if(1&t){const e=O();l(0,"div",21)(1,"input",22),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingGuest.perDis,o)||(r.editingGuest.perDis=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingGuest.perDis)}}function P9(t,i){if(1&t){const e=O();l(0,"button",19),M("click",function(){_(e);const o=f().$implicit;return v(f().editGuest(o))}),u(1,"Edit"),c()}}function D9(t,i){if(1&t){const e=O();l(0,"button",19),M("click",function(){return _(e),v(f(2).saveEdit())}),u(1,"Save"),c()}}function N9(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),D(2,p9,2,1,"span",17)(3,g9,2,1,"div",18),c(),l(4,"td"),D(5,f9,2,1,"span",17)(6,m9,2,1,"div",18),c(),l(7,"td"),D(8,_9,2,1,"span",17)(9,v9,2,1,"div",18),c(),l(10,"td"),D(11,b9,2,1,"span",17)(12,y9,2,1,"div",18),c(),l(13,"td"),D(14,C9,2,1,"span",17)(15,M9,2,1,"div",18),c(),l(16,"td"),D(17,I9,2,1,"span",17)(18,w9,2,1,"div",18),c(),l(19,"td"),D(20,S9,2,1,"span",17)(21,x9,2,1,"div",18),c(),l(22,"td")(23,"button",19),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(24),c()(),l(25,"td"),D(26,P9,2,0,"button",20)(27,D9,2,0,"button",20),c()()}if(2&t){const e=i.$implicit,n=f();h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id),h(3),k(" ","active"===e.status?"Deactivate":"Activate"," "),h(2),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)!==e._id),h(),C("ngIf",(null==n.editingGuest?null:n.editingGuest._id)===e._id)}}let T9=(()=>{class t{constructor(e){this.http=e,this.guests=[],this.showAddGuestPopup=!1,this.newGuest={guestName:"",address:"",city:"",state:"",pinCode:"",phoneNum:"",perDis:"",status:"active",email:localStorage.getItem("email"),username:localStorage.getItem("username")},this.editingGuest=null}ngOnInit(){this.loadGuests()}loadGuests(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/guests?email=${e}`).subscribe({next:n=>{console.log("Guests loaded:",n),this.guests=n},error:n=>console.error("Error loading guests:",n)})}openAddGuestPopup(){this.showAddGuestPopup=!0}closeAddGuestPopup(){this.showAddGuestPopup=!1}addGuest(){console.log("\u{1f4e4} Sending guest data:"),this.http.post("http://localhost:3000/api/guests/add",this.newGuest,{headers:{"Content-Type":"application/json"}}).subscribe({next:e=>{console.log("\u2705 Guest saved",e),alert("Guest added successfully!"),this.closeAddGuestPopup(),window.location.reload()},error:e=>{console.error("\u274c Error saving guest:",e),alert("Error12: "+e.error.message)}})}editGuest(e){this.editingGuest={...e}}saveEdit(){this.http.put(`http://localhost:3000/api/guests/${this.editingGuest._id}`,this.editingGuest).subscribe(()=>{this.loadGuests(),this.editingGuest=null})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/guests/${e._id}/status`,{}).subscribe(()=>this.loadGuests())}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-guest"]],standalone:!0,features:[Ae],decls:28,vars:2,consts:[[1,"guests-container"],["type","button",1,"add-guest-btn",3,"click"],["class","modal",4,"ngIf"],[1,"guests-table-wrapper"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"add-guest-form"],["placeholder","Guest Name","required","",3,"ngModelChange","ngModel"],["placeholder","Address","required","",3,"ngModelChange","ngModel"],["placeholder","City",3,"ngModelChange","ngModel"],["placeholder","State",3,"ngModelChange","ngModel"],["placeholder","Pin Code",3,"ngModelChange","ngModel"],["placeholder","Contact Number","required","",3,"ngModelChange","ngModel"],["placeholder","% of Discount","required","",3,"ngModelChange","ngModel"],["type","button",3,"click"],[4,"ngIf"],["class","edit-field",4,"ngIf"],[3,"click"],[3,"click",4,"ngIf"],[1,"edit-field"],[3,"ngModelChange","ngModel"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Guests"),c(),l(3,"button",1),M("click",function(){return o.openAddGuestPopup()}),u(4,"+ Add Guest"),c(),D(5,h9,16,7,"div",2),l(6,"div",3)(7,"table")(8,"tr")(9,"th"),u(10,"Guest Name"),c(),l(11,"th"),u(12,"Address"),c(),l(13,"th"),u(14,"City"),c(),l(15,"th"),u(16,"State"),c(),l(17,"th"),u(18,"Pin"),c(),l(19,"th"),u(20,"Contact Number"),c(),l(21,"th"),u(22,"% of Discount"),c(),l(23,"th"),u(24,"Status"),c(),l(25,"th"),u(26,"Actions"),c()(),D(27,N9,28,17,"tr",4),c()()()),2&n&&(h(5),C("ngIf",o.showAddGuestPopup),h(22),C("ngForOf",o.guests))},dependencies:[pt,lt,Xe,et,qe,We,Dn,He],styles:[".guests-container[_ngcontent-%COMP%]{padding:15px;max-width:100%;box-sizing:border-box}.guests-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;vertical-align:top}.edit-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:200px;margin-bottom:5px;box-sizing:border-box}.add-guest-btn[_ngcontent-%COMP%]{margin-bottom:12px}.modal[_ngcontent-%COMP%]{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#00000080;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;width:400px;max-width:90%;position:relative}.close[_ngcontent-%COMP%]{float:right;font-size:24px;cursor:pointer}"]})}}return t})(),k9=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-categories"]],standalone:!0,features:[Ae],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Running cost"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function E9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.pkgName)}}function A9(t,i){if(1&t){const e=O();l(0,"div",10)(1,"input",11),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingPkg.pkgName,o)||(r.editingPkg.pkgName=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingPkg.pkgName)}}function O9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.rate)}}function L9(t,i){if(1&t){const e=O();l(0,"div",10)(1,"input",12),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingPkg.rate,o)||(r.editingPkg.rate=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingPkg.rate)}}function R9(t,i){if(1&t){const e=O();l(0,"button",4),M("click",function(){_(e);const o=f().$implicit;return v(f().editPkg(o))}),u(1,"Edit"),c()}}function F9(t,i){if(1&t){const e=O();l(0,"button",4),M("click",function(){return _(e),v(f(2).saveEdit())}),u(1,"Save"),c()}}function B9(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),D(2,E9,2,1,"span",7)(3,A9,2,1,"div",8),c(),l(4,"td"),D(5,O9,2,1,"span",7)(6,L9,2,1,"div",8),c(),l(7,"td")(8,"button",4),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(9),c()(),l(10,"td"),D(11,R9,2,0,"button",9)(12,F9,2,0,"button",9),c()()}if(2&t){const e=i.$implicit,n=f();h(2),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)!==e._id),h(),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)===e._id),h(2),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)!==e._id),h(),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)===e._id),h(3),k(" ","active"===e.status?"Deactivate":"Activate"," "),h(2),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)!==e._id),h(),C("ngIf",(null==n.editingPkg?null:n.editingPkg._id)===e._id)}}let V9=(()=>{class t{constructor(e){this.http=e,this.pkgs=[],this.newPkg={pkgName:"",rate:0,status:"active",email:localStorage.getItem("email"),username:localStorage.getItem("username")},this.editingPkg=null}ngOnInit(){this.loadPkgs()}loadPkgs(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/pkgs?email=${e}`).subscribe({next:n=>{console.log("Packages loaded:",n),this.pkgs=n},error:n=>console.error("Error loading pkgs:",n)})}addPkg(){console.log("\u{1f4e4} Sending pkg data:"),this.http.post("http://localhost:3000/api/pkgs/add",this.newPkg,{headers:{"Content-Type":"application/json"}}).subscribe({next:e=>{console.log("\u2705 Package type saved",e),alert("Package type added successfully!"),window.location.reload()},error:e=>{console.error("\u274c Error saving pkg:",e),alert("Error12: "+e.error.message)}})}editPkg(e){this.editingPkg={...e}}saveEdit(){this.http.put(`http://localhost:3000/api/pkgs/${this.editingPkg._id}`,this.editingPkg).subscribe(()=>{this.loadPkgs(),this.editingPkg=null})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/pkgs/${e._id}/status`,{}).subscribe(()=>this.loadPkgs())}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-pkg"]],standalone:!0,features:[Ae],decls:20,vars:3,consts:[[1,"pkgs-container"],[1,"add-pkg-form"],["placeholder","Package Type","required","",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate","required","",3,"ngModelChange","ngModel"],[3,"click"],[1,"pkgs-table-wrapper"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","edit-field",4,"ngIf"],[3,"click",4,"ngIf"],[1,"edit-field"],[3,"ngModelChange","ngModel"],["type","number",3,"ngModelChange","ngModel"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Packages"),c(),l(3,"div",1)(4,"input",2),S("ngModelChange",function(s){return x(o.newPkg.pkgName,s)||(o.newPkg.pkgName=s),s}),c(),l(5,"input",3),S("ngModelChange",function(s){return x(o.newPkg.rate,s)||(o.newPkg.rate=s),s}),c(),l(6,"button",4),M("click",function(){return o.addPkg()}),u(7,"+ Add Package"),c()(),l(8,"div",5)(9,"table")(10,"tr")(11,"th"),u(12,"Package Type"),c(),l(13,"th"),u(14,"Rate"),c(),l(15,"th"),u(16,"Status"),c(),l(17,"th"),u(18,"Actions"),c()(),D(19,B9,13,7,"tr",6),c()()()),2&n&&(h(4),w("ngModel",o.newPkg.pkgName),h(),w("ngModel",o.newPkg.rate),h(14),C("ngForOf",o.pkgs))},dependencies:[pt,lt,Xe,et,qe,on,We,Dn,He],styles:[".pkgs-container[_ngcontent-%COMP%]{padding:15px;max-width:100%;box-sizing:border-box}.pkgs-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;vertical-align:top}.edit-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:200px;margin-bottom:5px;box-sizing:border-box}"]})}}return t})();function H9(t,i){if(1&t){const e=O();l(0,"div",16)(1,"input",17),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pickupLocationId,o)||(r.pickupLocationId=o),v(o)}),c(),l(2,"input",18),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveryLocationId,o)||(r.deliveryLocationId=o),v(o)}),c(),l(3,"input",19),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerNum,o)||(r.rate.ratePerNum=o),v(o)}),c(),l(4,"input",20),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerVolume,o)||(r.rate.ratePerVolume=o),v(o)}),c(),l(5,"input",21),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerKg,o)||(r.rate.ratePerKg=o),v(o)}),c(),l(6,"button",11),M("click",function(){const o=_(e).index,r=f(2);return v(r.removeRateRow(r.newProduct,o))}),u(7,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.pickupLocationId),h(),w("ngModel",e.deliveryLocationId),h(),w("ngModel",e.rate.ratePerNum),h(),w("ngModel",e.rate.ratePerVolume),h(),w("ngModel",e.rate.ratePerKg)}}function j9(t,i){if(1&t&&X(0,"option",22),2&t){const e=i.$implicit;C("value",e.id)("label",e.label)}}function U9(t,i){if(1&t){const e=O();l(0,"div",5)(1,"div",6)(2,"div",7)(3,"h3"),u(4,"Add Product"),c(),l(5,"button",8),M("click",function(){return _(e),v(f().closeAddProductPopup())}),u(6,"x"),c()(),l(7,"label"),u(8,"HSN Number* "),l(9,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newProduct.hsnNum,o)||(r.newProduct.hsnNum=o),v(o)}),c()(),l(10,"label"),u(11,"Product Name* "),l(12,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newProduct.productName,o)||(r.newProduct.productName=o),v(o)}),c()(),l(13,"h4"),u(14,"Rates by Route"),c(),D(15,H9,8,5,"div",10),l(16,"button",11),M("click",function(){_(e);const o=f();return v(o.addRateRow(o.newProduct))}),u(17,"+ Add Rate"),c(),l(18,"datalist",12),D(19,j9,1,2,"option",13),c(),l(20,"div",14)(21,"button",15),M("click",function(){return _(e),v(f().addProduct())}),u(22,"Save"),c(),l(23,"button",15),M("click",function(){return _(e),v(f().closeAddProductPopup())}),u(24,"Cancel"),c()()()()}if(2&t){const e=f();h(9),w("ngModel",e.newProduct.hsnNum),h(3),w("ngModel",e.newProduct.productName),h(3),C("ngForOf",e.newProduct.rates),h(4),C("ngForOf",e.rateAddressOptions)}}function z9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.hsnNum)}}function G9(t,i){if(1&t){const e=O();l(0,"div",27)(1,"input",9),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingProduct.hsnNum,o)||(r.editingProduct.hsnNum=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingProduct.hsnNum)}}function $9(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),N(e.productName)}}function q9(t,i){if(1&t){const e=O();l(0,"div",27)(1,"input",9),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingProduct.productName,o)||(r.editingProduct.productName=o),v(o)}),c()()}if(2&t){const e=f(2);h(),w("ngModel",e.editingProduct.productName)}}function W9(t,i){if(1&t&&(l(0,"div",30)(1,"span"),u(2),c(),l(3,"span"),u(4),c(),l(5,"span"),u(6),c(),l(7,"span"),u(8),c(),l(9,"span"),u(10),c()()),2&t){const e=i.$implicit,n=f(3);h(2),k("Pickup: ",n.getRateAddressLabel(e.pickupLocationId),""),h(2),k("Delivery: ",n.getRateAddressLabel(e.deliveryLocationId),""),h(2),k("Box: ",null==e.rate?null:e.rate.ratePerNum,""),h(2),k("cmA3: ",null==e.rate?null:e.rate.ratePerVolume,""),h(2),k("Kg: ",null==e.rate?null:e.rate.ratePerKg,"")}}function Q9(t,i){if(1&t&&(l(0,"div",28),D(1,W9,11,5,"div",29),c()),2&t){const e=f().$implicit;h(),C("ngForOf",e.rates)}}function Z9(t,i){if(1&t){const e=O();l(0,"div",33)(1,"input",17),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.pickupLocationId,o)||(r.pickupLocationId=o),v(o)}),c(),l(2,"input",18),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveryLocationId,o)||(r.deliveryLocationId=o),v(o)}),c(),l(3,"input",34),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerNum,o)||(r.rate.ratePerNum=o),v(o)}),c(),l(4,"input",35),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerVolume,o)||(r.rate.ratePerVolume=o),v(o)}),c(),l(5,"input",36),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.rate.ratePerKg,o)||(r.rate.ratePerKg=o),v(o)}),c(),l(6,"button",32),M("click",function(){const o=_(e).index,r=f(3);return v(r.removeRateRow(r.editingProduct,o))}),u(7,"Remove"),c()()}if(2&t){const e=i.$implicit;h(),w("ngModel",e.pickupLocationId),h(),w("ngModel",e.deliveryLocationId),h(),w("ngModel",e.rate.ratePerNum),h(),w("ngModel",e.rate.ratePerVolume),h(),w("ngModel",e.rate.ratePerKg)}}function Y9(t,i){if(1&t){const e=O();l(0,"div",27),D(1,Z9,8,5,"div",31),l(2,"button",32),M("click",function(){_(e);const o=f(2);return v(o.addRateRow(o.editingProduct))}),u(3,"+ Add Rate"),c()()}if(2&t){const e=f(2);h(),C("ngForOf",e.editingProduct.rates)}}function K9(t,i){if(1&t){const e=O();l(0,"button",15),M("click",function(){_(e);const o=f().$implicit;return v(f().editProduct(o))}),u(1,"Edit"),c()}}function J9(t,i){if(1&t){const e=O();l(0,"button",15),M("click",function(){return _(e),v(f(2).saveEdit())}),u(1,"Save"),c()}}function X9(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),D(2,z9,2,1,"span",23)(3,G9,2,1,"div",24),c(),l(4,"td"),D(5,$9,2,1,"span",23)(6,q9,2,1,"div",24),c(),l(7,"td"),D(8,Q9,2,1,"div",25)(9,Y9,4,1,"div",24),c(),l(10,"td")(11,"button",15),M("click",function(){const o=_(e).$implicit;return v(f().toggleStatus(o))}),u(12),c()(),l(13,"td"),D(14,K9,2,0,"button",26)(15,J9,2,0,"button",26),c()()}if(2&t){const e=i.$implicit,n=f();h(2),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)!==e._id),h(),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)===e._id),h(2),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)!==e._id),h(),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)===e._id),h(2),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)!==e._id),h(),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)===e._id),h(3),k(" ","active"===e.status?"Deactivate":"Activate"," "),h(2),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)!==e._id),h(),C("ngIf",(null==n.editingProduct?null:n.editingProduct._id)===e._id)}}let eU=(()=>{class t{get filteredProducts(){const e=localStorage.getItem("originLocId")||"all";return"all"===e?this.products:(this.products||[]).filter(n=>String(n?.originLocId)===String(e))}constructor(e){this.http=e,this.products=[],this.showAddProductPopup=!1,this.rateAddressOptions=[],this.rateAddressLabelById=new Map,this.newProduct={productName:"",originLocId:localStorage.getItem("originLocId")||"all",status:"active",rates:[{pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}}],email:localStorage.getItem("email"),username:localStorage.getItem("username")},this.editingProduct=null}ngOnInit(){this.loadProducts(),this.loadRateAddressOptions()}loadProducts(){const e=localStorage.getItem("email"),n=localStorage.getItem("branch")||"",o=localStorage.getItem("originLocId")||"all";this.http.get(`http://localhost:3000/api/products?email=${e}&originLocId=${encodeURIComponent(o)}&branch=${encodeURIComponent(n)}`).subscribe({next:r=>{this.products=r},error:r=>console.error("Error loading products:",r)})}loadRateAddressOptions(){Pn({branches:this.http.get("http://localhost:3000/api/branches"),hubs:this.http.get("http://localhost:3000/api/hubs"),clients:this.http.get("http://localhost:3000/api/clients/clientslist?originLocId=all")}).subscribe({next:({branches:n,hubs:o,clients:r})=>{const s=[];(n||[]).forEach(a=>{const d=Array.isArray(a?.addresses)?a.addresses:[];if(d.forEach(p=>{const g=String(p?._id||"").trim();if(!g)return;const m=[p.address,p.city,p.state,p.pinCode].filter(Boolean),b=`Branch: ${a?.branchName||""} - ${m.join(", ")}`;s.push({id:g,label:b})}),!d.length&&a?._id){const p=[a.address,a.city,a.state,a.pinCode].filter(Boolean),g=`Branch: ${a?.branchName||""} - ${p.join(", ")}`.trim();s.push({id:String(a._id),label:g})}}),(o||[]).forEach(a=>{(Array.isArray(a?.deliveryAddresses)?a.deliveryAddresses:[]).forEach(p=>{const g=String(p?._id||"").trim();if(!g)return;const m=`Hub: ${a?.hubName||""} - ${p?.location||""}`.trim();s.push({id:g,label:m})})}),(r||[]).forEach(a=>{(Array.isArray(a?.deliveryLocations)?a.deliveryLocations:[]).forEach(p=>{const g=String(p?.delivery_id||p?._id||"").trim();if(!g)return;const m=[p.address,p.city,p.state,p.pinCode].filter(Boolean),b=`Client: ${a?.clientName||""} - ${m.join(", ")}`;s.push({id:g,label:b})})}),this.rateAddressOptions=s,this.rateAddressLabelById=new Map(s.map(a=>[a.id,a.label]))},error:()=>{this.rateAddressOptions=[],this.rateAddressLabelById=new Map}})}getRateAddressLabel(e){const n=String(e||"").trim();return n?this.rateAddressLabelById.get(n)||n:"-"}openAddProductPopup(){this.showAddProductPopup=!0}closeAddProductPopup(){this.showAddProductPopup=!1}addProduct(){this.newProduct.originLocId=localStorage.getItem("originLocId")||"all","all"!==this.newProduct.originLocId?(this.ensureRates(this.newProduct),this.http.post("http://localhost:3000/api/products/add",this.newProduct,{headers:{"Content-Type":"application/json"}}).subscribe({next:()=>{alert("Product type added successfully!"),this.closeAddProductPopup(),window.location.reload()},error:e=>{alert("Error: "+e.error?.message)}})):alert("Please select a specific branch before adding a product.")}editProduct(e){this.editingProduct=JSON.parse(JSON.stringify(e)),this.ensureRates(this.editingProduct)}saveEdit(){this.http.put(`http://localhost:3000/api/products/${this.editingProduct._id}`,this.editingProduct).subscribe(()=>{this.loadProducts(),this.editingProduct=null})}toggleStatus(e){this.http.patch(`http://localhost:3000/api/products/${e._id}/status`,{}).subscribe(()=>this.loadProducts())}addRateRow(e){e.rates||(e.rates=[]),e.rates.push({pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}})}removeRateRow(e,n){e.rates&&e.rates.splice(n,1)}ensureRates(e){e.rates=Array.isArray(e.rates)&&0!==e.rates.length?e.rates.map(n=>({pickupLocationId:n.pickupLocationId||"",deliveryLocationId:n.deliveryLocationId||"",rate:{ratePerNum:n.rate?.ratePerNum??0,ratePerVolume:n.rate?.ratePerVolume??0,ratePerKg:n.rate?.ratePerKg??0}})):[{pickupLocationId:"",deliveryLocationId:"",rate:{ratePerNum:0,ratePerVolume:0,ratePerKg:0}}]}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-product"]],standalone:!0,features:[Ae],decls:20,vars:2,consts:[[1,"products-container"],["type","button",1,"add-product-btn",3,"click"],["class","modal-backdrop",4,"ngIf"],[1,"products-table-wrapper"],[4,"ngFor","ngForOf"],[1,"modal-backdrop"],[1,"modal"],[1,"modal-head"],["type","button",1,"icon-btn",3,"click"],[3,"ngModelChange","ngModel"],["class","inline-fields",4,"ngFor","ngForOf"],["type","button",1,"tiny-btn",3,"click"],["id","rate-addresses"],[3,"value","label",4,"ngFor","ngForOf"],[1,"modal-actions"],[3,"click"],[1,"inline-fields"],["placeholder","Pickup Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["placeholder","Delivery Address Id","list","rate-addresses",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / Box",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / cmA3",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / Kg",3,"ngModelChange","ngModel"],[3,"value","label"],[4,"ngIf"],["class","edit-field",4,"ngIf"],["class","rate-list",4,"ngIf"],[3,"click",4,"ngIf"],[1,"edit-field"],[1,"rate-list"],["class","rate-item",4,"ngFor","ngForOf"],[1,"rate-item"],["class","rate-row",4,"ngFor","ngForOf"],["type","button",3,"click"],[1,"rate-row"],["type","number","placeholder","Rate / Box","required","",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / cmA3","required","",3,"ngModelChange","ngModel"],["type","number","placeholder","Rate / Kg","required","",3,"ngModelChange","ngModel"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Manage Standard Products Pricing"),c(),l(3,"button",1),M("click",function(){return o.openAddProductPopup()}),u(4,"+ Add Product"),c(),D(5,U9,25,4,"div",2),l(6,"div",3)(7,"table")(8,"tr")(9,"th"),u(10,"HSN number"),c(),l(11,"th"),u(12,"Product Type"),c(),l(13,"th"),u(14,"Rates by Route"),c(),l(15,"th"),u(16,"Status"),c(),l(17,"th"),u(18,"Actions"),c()(),D(19,X9,16,9,"tr",4),c()()()),2&n&&(h(5),C("ngIf",o.showAddProductPopup),h(14),C("ngForOf",o.filteredProducts))},dependencies:[pt,lt,Xe,et,wt,St,qe,on,We,Dn,He],styles:[".products-container[_ngcontent-%COMP%]{padding:15px;max-width:100%;box-sizing:border-box}.products-table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px;border:1px solid #ddd;vertical-align:top}.edit-field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.edit-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;max-width:200px;margin-bottom:5px;box-sizing:border-box}.add-product-btn[_ngcontent-%COMP%]{margin-bottom:12px}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000059;display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px}.modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;width:min(520px,100%);box-shadow:0 10px 40px #00000029;display:flex;flex-direction:column;gap:10px;max-height:90vh;overflow-y:auto}.modal-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #e5e7eb;width:28px;height:28px;border-radius:6px;cursor:pointer;color:#6b7280}.inline-fields[_ngcontent-%COMP%]{display:flex;gap:8px;flex:1;min-width:260px;flex-wrap:wrap}.tiny-btn[_ngcontent-%COMP%]{background:#f8fafc;color:#111827;border:1px solid #e5e7eb;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600}"]})}}return t})();function tU(t,i){if(1&t&&(l(0,"option",19),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e._id),h(),N(e.branchName)}}function nU(t,i){if(1&t){const e=O();zn(0),l(1,"td",20),u(2),c(),l(3,"td",20),u(4),c(),l(5,"td",20),u(6),c(),l(7,"td",20),u(8),c(),l(9,"td",20),u(10),c(),l(11,"td",20),u(12),c(),l(13,"td",20),u(14,"\u2014"),c(),l(15,"td",20)(16,"button",21),M("click",function(){_(e);const o=f().$implicit;return v(f(2).startEdit(o))}),u(17,"Edit"),c(),l(18,"button",22),M("click",function(){_(e);const o=f().$implicit;return v(f(2).deleteUser(o._id))}),u(19,"Delete"),c()(),Gn()}if(2&t){const e=f().$implicit;h(2),N(e._id),h(2),N(e.email),h(2),N(e.username),h(2),N(e.phoneNumber||"-"),h(2),N(e.role),h(2),N(e.branchNames&&e.branchNames.length?e.branchNames.join(", "):e.branchName||e.branch)}}function iU(t,i){if(1&t&&(l(0,"option",19),u(1),c()),2&t){const e=i.$implicit;C("ngValue",e._id),h(),N(e.branchName)}}function oU(t,i){if(1&t){const e=O();l(0,"td",20),u(1),c(),l(2,"td",20)(3,"input",23),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.email,o)||(r.editUser.email=o),v(o)}),c()(),l(4,"td",20)(5,"input",23),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.username,o)||(r.editUser.username=o),v(o)}),c()(),l(6,"td",20)(7,"input",23),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.phoneNumber,o)||(r.editUser.phoneNumber=o),v(o)}),c()(),l(8,"td",20)(9,"select",10),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.role,o)||(r.editUser.role=o),v(o)}),M("change",function(){return _(e),v(f(3).onEditRoleChange())}),l(10,"option",11),u(11,"User"),c(),l(12,"option",12),u(13,"Admin"),c()()(),l(14,"td",20)(15,"select",13),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.branches,o)||(r.editUser.branches=o),v(o)}),D(16,iU,2,2,"option",14),c()(),l(17,"td",20)(18,"input",24),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.editUser.password,o)||(r.editUser.password=o),v(o)}),c()(),l(19,"td",20)(20,"button",21),M("click",function(){return _(e),v(f(3).saveEdit())}),u(21,"Save"),c(),l(22,"button",22),M("click",function(){return _(e),v(f(3).cancelEdit())}),u(23,"Cancel"),c()()}if(2&t){const e=f().$implicit,n=f(2);h(),N(e._id),h(2),w("ngModel",n.editUser.email),h(2),w("ngModel",n.editUser.username),h(2),w("ngModel",n.editUser.phoneNumber),h(2),w("ngModel",n.editUser.role),h(6),w("ngModel",n.editUser.branches),C("disabled","admin"===n.editUser.role),h(),C("ngForOf",n.branches),h(2),w("ngModel",n.editUser.password)}}function rU(t,i){if(1&t&&(l(0,"tr"),D(1,nU,20,6,"ng-container",2)(2,oU,24,9,"ng-template",null,1,qn),c()),2&t){const e=i.$implicit,n=$n(3),o=f(2);h(),C("ngIf",o.editId!==e._id)("ngIfElse",n)}}function sU(t,i){if(1&t){const e=O();zn(0),l(1,"h2"),u(2,"Roles Settings"),c(),l(3,"p"),u(4,"Create/manage users for this company here."),c(),l(5,"div",3)(6,"h3",4),u(7,"Add User"),c(),l(8,"div",5)(9,"div")(10,"label"),u(11,"Email"),c(),l(12,"input",6),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.email,o)||(r.newUser.email=o),v(o)}),c()(),l(13,"div")(14,"label"),u(15,"Username"),c(),l(16,"input",7),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.username,o)||(r.newUser.username=o),v(o)}),c()(),l(17,"div")(18,"label"),u(19,"Phone Number"),c(),l(20,"input",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.phoneNumber,o)||(r.newUser.phoneNumber=o),v(o)}),c()(),l(21,"div")(22,"label"),u(23,"Password"),c(),l(24,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.password,o)||(r.newUser.password=o),v(o)}),c()(),l(25,"div")(26,"label"),u(27,"Role"),c(),l(28,"select",10),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.role,o)||(r.newUser.role=o),v(o)}),M("change",function(){return _(e),v(f().onNewRoleChange())}),l(29,"option",11),u(30,"User"),c(),l(31,"option",12),u(32,"Admin"),c()()(),l(33,"div")(34,"label"),u(35,"Branch"),c(),l(36,"select",13),S("ngModelChange",function(o){_(e);const r=f();return x(r.newUser.branches,o)||(r.newUser.branches=o),v(o)}),D(37,tU,2,2,"option",14),c()(),l(38,"div")(39,"button",15),M("click",function(){return _(e),v(f().createUser())}),u(40,"Add"),c()()()(),l(41,"h3"),u(42,"Users"),c(),l(43,"table",16)(44,"thead")(45,"tr")(46,"th",17),u(47,"User ID"),c(),l(48,"th",17),u(49,"Email"),c(),l(50,"th",17),u(51,"Username"),c(),l(52,"th",17),u(53,"Phone"),c(),l(54,"th",17),u(55,"Role"),c(),l(56,"th",17),u(57,"Branch"),c(),l(58,"th",17),u(59,"Password"),c(),l(60,"th",17),u(61,"Actions"),c()()(),l(62,"tbody"),D(63,rU,4,2,"tr",18),c()(),Gn()}if(2&t){const e=f();h(12),w("ngModel",e.newUser.email),h(4),w("ngModel",e.newUser.username),h(4),w("ngModel",e.newUser.phoneNumber),h(4),w("ngModel",e.newUser.password),h(4),w("ngModel",e.newUser.role),h(8),w("ngModel",e.newUser.branches),C("disabled","admin"===e.newUser.role),h(),C("ngForOf",e.branches),h(26),C("ngForOf",e.users)}}function aU(t,i){1&t&&(l(0,"h2"),u(1,"No privileges"),c(),l(2,"p"),u(3,"Only admins can access Roles Settings."),c())}let cU=(()=>{class t{constructor(e){this.http=e,this.isAdmin="admin"===String(localStorage.getItem("role")||"").toLowerCase(),this.email=localStorage.getItem("email")||"",this.branches=[],this.users=[],this.newUser={branches:[],email:"",username:"",phoneNumber:"",password:"",role:"user"},this.editId=null,this.editUser={branches:[],email:"",username:"",phoneNumber:"",password:"",role:"user"}}ngOnInit(){this.isAdmin&&(this.loadBranches(),this.loadUsers())}loadBranches(){this.http.get("http://localhost:3000/api/branches").subscribe({next:e=>{this.branches=e||[]},error:()=>{this.branches=[]}})}loadUsers(){this.http.get("http://localhost:3000/api/admin/users").subscribe({next:e=>{this.users=e||[]},error:()=>{this.users=[]}})}onNewRoleChange(){"admin"===String(this.newUser.role).toLowerCase()&&(this.newUser.branches=["All Branches"])}createUser(){this.newUser.email&&this.newUser.username&&this.newUser.password?"admin"===String(this.newUser.role).toLowerCase()||this.newUser.branches.length?this.http.post("http://localhost:3000/api/admin/users",{email:this.newUser.email,username:this.newUser.username,phoneNumber:this.newUser.phoneNumber,password:this.newUser.password,role:this.newUser.role,originLocIds:this.newUser.branches}).subscribe({next:()=>{this.newUser={branches:[],email:"",username:"",phoneNumber:"",password:"",role:"user"},this.loadUsers()},error:n=>{alert(n?.error?.message||"Failed to create user")}}):alert("At least one branch is required"):alert("Email, username, and password are required")}startEdit(e){this.editId=Number(e?._id),this.editUser={branches:Array.isArray(e?.originLocIds)?e.originLocIds:this.mapBranchNamesToIds(e?.branchNames||e?.branches||[]),email:e?.email||"",username:e?.username||"",phoneNumber:e?.phoneNumber||"",password:"",role:e?.role||"user"}}cancelEdit(){this.editId=null,this.editUser={branches:[],email:"",username:"",phoneNumber:"",password:"",role:"user"}}onEditRoleChange(){"admin"===String(this.editUser.role).toLowerCase()&&(this.editUser.branches=["All Branches"])}saveEdit(){if(null===this.editId)return;const e={originLocIds:this.editUser.branches,email:this.editUser.email,username:this.editUser.username,phoneNumber:this.editUser.phoneNumber,role:this.editUser.role};this.editUser.password&&(e.password=this.editUser.password),this.http.put(`http://localhost:3000/api/admin/users/${this.editId}`,e).subscribe({next:()=>{this.cancelEdit(),this.loadUsers()},error:n=>{alert(n?.error?.message||"Failed to update user")}})}mapBranchNamesToIds(e){return(Array.isArray(e)?e:[e]).map(o=>String(o||"").trim()).filter(Boolean).map(o=>{const r=(this.branches||[]).find(s=>String(s?.branchName||"").trim().toLowerCase()===o.toLowerCase());return r?._id?String(r._id):""}).filter(Boolean)}deleteUser(e){const n=Number(e);Number.isFinite(n)&&confirm("Delete this user?")&&this.http.delete(`http://localhost:3000/api/admin/users/${n}`).subscribe({next:()=>this.loadUsers(),error:o=>alert(o?.error?.message||"Failed to delete user")})}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-roleSettings"]],standalone:!0,features:[Ae],decls:3,vars:2,consts:[["noPrivileges",""],["editRow",""],[4,"ngIf","ngIfElse"],[2,"margin","12px 0","padding","12px","border","1px solid #ddd","border-radius","8px"],[2,"margin-top","0"],[2,"display","grid","grid-template-columns","1fr 1fr","gap","10px","align-items","end"],["placeholder","user@example.com",2,"width","100%",3,"ngModelChange","ngModel"],["placeholder","username",2,"width","100%",3,"ngModelChange","ngModel"],["placeholder","phone number",2,"width","100%",3,"ngModelChange","ngModel"],["type","password","placeholder","password",2,"width","100%",3,"ngModelChange","ngModel"],[2,"width","100%",3,"ngModelChange","change","ngModel"],["value","user"],["value","admin"],["multiple","",2,"width","100%","min-height","80px",3,"ngModelChange","ngModel","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[2,"width","100%",3,"click"],[2,"width","100%","border-collapse","collapse"],[2,"text-align","left","border-bottom","1px solid #ddd","padding","6px"],[4,"ngFor","ngForOf"],[3,"ngValue"],[2,"padding","6px","border-bottom","1px solid #f0f0f0"],[3,"click"],[2,"margin-left","6px",3,"click"],[2,"width","100%",3,"ngModelChange","ngModel"],["type","password","placeholder","new password (optional)",2,"width","100%",3,"ngModelChange","ngModel"]],template:function(n,o){if(1&n&&D(0,sU,64,9,"ng-container",2)(1,aU,4,0,"ng-template",null,0,qn),2&n){const r=$n(2);C("ngIf",o.isAdmin)("ngIfElse",r)}},dependencies:[Xe,lt,et,wt,St,qe,vt,lu,We,He],styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function lU(t,i){if(1&t){const e=O();l(0,"button",19),M("click",function(){const o=_(e).$implicit;return v(f().setActiveTab(o.key))}),u(1),c()}if(2&t){const e=i.$implicit;Ce("active",f().activeTab===e.key),h(),k(" ",e.label," ")}}function dU(t,i){if(1&t&&(l(0,"div",20),u(1),c()),2&t){const e=f();h(),N(e.error)}}function uU(t,i){if(1&t&&(l(0,"div",20),u(1),c()),2&t){const e=f();h(),N(e.syncError)}}function hU(t,i){if(1&t&&(l(0,"div",20),u(1),c()),2&t){const e=f();h(),N(e.backfillError)}}function pU(t,i){1&t&&(l(0,"div",20),u(1,"Loading payments..."),c())}function gU(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td",25),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td"),u(12),c(),l(13,"td")(14,"span",26),u(15),c()(),l(16,"td")(17,"button",27),M("click",function(){const o=_(e).$implicit,r=f(2).$implicit;return v(f().openDrawer(r.key,o))}),u(18,"View"),c()()()}if(2&t){const e=i.$implicit,n=f(3);h(2),N(e.name||"-"),h(2),N(e.entityId||"-"),h(2),N(n.formatAmount(e.totalDue)),h(2),N(n.formatAmount(e.totalPaid)),h(2),N(n.formatAmount(e.totalBalance)),h(2),N(n.formatDate(e.lastPaymentDate)),h(2),Ce("overdue","overdue"===(e.status||"").toLowerCase()),h(),k(" ",e.status||"Pending"," ")}}function fU(t,i){if(1&t&&(l(0,"div",23)(1,"table")(2,"thead")(3,"tr")(4,"th"),u(5,"Name"),c(),l(6,"th"),u(7,"Entity ID"),c(),l(8,"th"),u(9,"Total Due"),c(),l(10,"th"),u(11,"Paid"),c(),l(12,"th"),u(13,"Balance"),c(),l(14,"th"),u(15,"Last Payment"),c(),l(16,"th"),u(17,"Status"),c(),l(18,"th"),u(19,"Actions"),c()()(),l(20,"tbody"),D(21,gU,19,9,"tr",24),c()()()),2&t){const e=f().$implicit,n=f();h(21),C("ngForOf",n.getRowsForTab(e.key))}}function mU(t,i){1&t&&(l(0,"div",28),u(1,"No payment records."),c())}function _U(t,i){if(1&t&&(l(0,"section",21)(1,"h3"),u(2),c(),D(3,fU,22,1,"div",22)(4,mU,2,0,"ng-template",null,0,qn),c()),2&t){const e=i.$implicit,n=$n(5),o=f();C("hidden",o.activeTab!==e.key),h(2),N(e.label),h(),C("ngIf",o.getRowsForTab(e.key).length)("ngIfElse",n)}}function vU(t,i){if(1&t&&(l(0,"div",52)(1,"div")(2,"span"),u(3,"Total Due"),c(),l(4,"strong"),u(5),c()(),l(6,"div")(7,"span"),u(8,"Paid"),c(),l(9,"strong"),u(10),c()(),l(11,"div")(12,"span"),u(13,"Balance"),c(),l(14,"strong"),u(15),c()()()),2&t){const e=f(2);h(5),N(e.formatAmount(e.activeRow.totalDue)),h(5),N(e.formatAmount(e.activeRow.totalPaid)),h(5),N(e.formatAmount(e.activeRow.totalBalance))}}function bU(t,i){if(1&t&&(l(0,"p",53),u(1),c()),2&t){const e=f(2);h(),N(e.dueError)}}function yU(t,i){if(1&t&&(l(0,"p",53),u(1),c()),2&t){const e=f(2);h(),N(e.recordError)}}function CU(t,i){if(1&t&&(l(0,"div",20),u(1),c()),2&t){const e=f(2);h(),N(e.transactionsError)}}function MU(t,i){1&t&&(l(0,"div",20),u(1,"Loading transactions..."),c())}function IU(t,i){if(1&t&&(l(0,"div",64),u(1),c()),2&t){const e=f().$implicit;h(),k("Ref: ",e.referenceNo,"")}}function wU(t,i){if(1&t&&(l(0,"div",65),u(1),c()),2&t){const e=f().$implicit;h(),N(e.notes)}}function SU(t,i){if(1&t){const e=O();l(0,"div",57)(1,"div")(2,"div",58),u(3),c(),l(4,"div",59),u(5),c(),D(6,IU,2,1,"div",60)(7,wU,2,1,"div",61),c(),l(8,"div",62)(9,"span",26),u(10),c(),l(11,"button",63),M("click",function(){const o=_(e).$implicit;return v(f(3).voidTransaction(o))}),u(12," Void "),c()()()}if(2&t){const e=i.$implicit,n=f(3);h(3),N(n.formatAmount(e.amount)),h(2),Be(" ",n.formatDate(e.transactionDate)," \xb7 ",e.method||"-"," "),h(),C("ngIf",e.referenceNo),h(),C("ngIf",e.notes),h(2),Ce("voided","voided"===(e.status||"")),h(),k(" ",e.status||"posted"," "),h(),C("disabled","voided"===(e.status||""))}}function xU(t,i){1&t&&(l(0,"div",28),u(1,"No transactions yet."),c())}function PU(t,i){if(1&t&&(l(0,"div",54),D(1,SU,13,9,"div",55)(2,xU,2,0,"div",56),c()),2&t){const e=f(2);h(),C("ngForOf",e.transactions),h(),C("ngIf",!e.transactions.length)}}function DU(t,i){if(1&t){const e=O();l(0,"div",29)(1,"div",30)(2,"div",31)(3,"div")(4,"h3"),u(5),c(),l(6,"p",25),u(7),c()(),l(8,"button",32),M("click",function(){return _(e),v(f().closeDrawer())}),u(9,"\u2715"),c()(),D(10,vU,16,3,"div",33),l(11,"div",34)(12,"h4"),u(13,"Set Due Amount"),c(),l(14,"div",35)(15,"label"),u(16," Total Due "),l(17,"input",36),S("ngModelChange",function(o){_(e);const r=f();return x(r.dueAmount,o)||(r.dueAmount=o),v(o)}),c()()(),l(18,"button",37),M("click",function(){return _(e),v(f().updateDueAmount())}),u(19),c(),D(20,bU,2,1,"p",38),c(),l(21,"div",34)(22,"h4"),u(23,"Record Payment"),c(),l(24,"div",35)(25,"label"),u(26," Amount "),l(27,"input",36),S("ngModelChange",function(o){_(e);const r=f();return x(r.recordForm.amount,o)||(r.recordForm.amount=o),v(o)}),c()(),l(28,"label"),u(29," Date "),l(30,"input",39),S("ngModelChange",function(o){_(e);const r=f();return x(r.recordForm.transactionDate,o)||(r.recordForm.transactionDate=o),v(o)}),c()(),l(31,"label"),u(32," Method "),l(33,"select",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.recordForm.method,o)||(r.recordForm.method=o),v(o)}),l(34,"option",40),u(35,"Select"),c(),l(36,"option",41),u(37,"Cash"),c(),l(38,"option",42),u(39,"UPI"),c(),l(40,"option",43),u(41,"Card"),c(),l(42,"option",44),u(43,"Bank Transfer"),c(),l(44,"option",45),u(45,"Cheque"),c()()(),l(46,"label"),u(47," Reference "),l(48,"input",46),S("ngModelChange",function(o){_(e);const r=f();return x(r.recordForm.referenceNo,o)||(r.recordForm.referenceNo=o),v(o)}),c()(),l(49,"label",47),u(50," Notes "),l(51,"textarea",48),S("ngModelChange",function(o){_(e);const r=f();return x(r.recordForm.notes,o)||(r.recordForm.notes=o),v(o)}),c()()(),l(52,"button",49),M("click",function(){return _(e),v(f().submitPayment())}),u(53),c(),D(54,yU,2,1,"p",38),l(55,"p",50),u(56,"These entries update balances and are irreversible."),c()(),l(57,"div",34)(58,"h4"),u(59,"Recent Transactions"),c(),D(60,CU,2,1,"div",16)(61,MU,2,0,"div",16)(62,PU,3,2,"div",51),c()()()}if(2&t){const e=f();h(5),N((null==e.activeEntity?null:e.activeEntity.name)||"Payments"),h(2),N(null==e.activeEntity?null:e.activeEntity.entityId),h(3),C("ngIf",e.activeRow),h(7),w("ngModel",e.dueAmount),h(),C("disabled",e.transactionsLoading),h(),k(" ",e.transactionsLoading?"Saving...":"Update due"," "),h(),C("ngIf",e.dueError),h(7),w("ngModel",e.recordForm.amount),h(3),w("ngModel",e.recordForm.transactionDate),h(3),w("ngModel",e.recordForm.method),h(15),w("ngModel",e.recordForm.referenceNo),h(3),w("ngModel",e.recordForm.notes),h(),C("disabled",e.transactionsLoading),h(),k(" ",e.transactionsLoading?"Saving...":"Save payment"," "),h(),C("ngIf",e.recordError),h(6),C("ngIf",e.transactionsError),h(),C("ngIf",e.transactionsLoading),h(),C("ngIf",!e.transactionsLoading)}}let NU=(()=>{class t{constructor(e){this.http=e,this.tabs=[{key:"clients",label:"Clients"},{key:"branches",label:"Branches"},{key:"hubs",label:"Hubs"},{key:"transportPartners",label:"Transport Partners"}],this.activeTab="clients",this.paymentData={clients:[],branches:[],hubs:[],transportPartners:[]},this.loading=!1,this.error="",this.searchText="",this.statusFilter="all",this.totals={due:0,paid:0,balance:0,entities:0},this.showDrawer=!1,this.activeEntity=null,this.activeRow=null,this.transactions=[],this.transactionsLoading=!1,this.transactionsError="",this.recordForm={amount:"",transactionDate:"",method:"",referenceNo:"",notes:""},this.recordError="",this.dueAmount="",this.dueError="",this.syncLoading=!1,this.syncError="",this.backfillLoading=!1,this.backfillError=""}ngOnInit(){this.loadPayments()}setActiveTab(e){this.activeTab=e}loadPayments(){this.loading=!0,this.error="",this.syncError="",this.backfillError="",this.http.get("http://localhost:3000/api/payments/summary").subscribe({next:e=>{const n=e?.data||{};this.paymentData={clients:Array.isArray(n.clients)?n.clients:[],branches:Array.isArray(n.branches)?n.branches:[],hubs:Array.isArray(n.hubs)?n.hubs:[],transportPartners:Array.isArray(n.transportPartners)?n.transportPartners:[]},this.computeTotals(),this.loading=!1},error:e=>{console.error("Error loading payments summary:",e),this.error="Failed to load payments. Please try again.",this.loading=!1}})}computeTotals(){const e=Object.values(this.paymentData).flat();this.totals=e.reduce((n,o)=>(n.due+=Number(o.totalDue||0),n.paid+=Number(o.totalPaid||0),n.balance+=Number(o.totalBalance||0),n.entities+=1,n),{due:0,paid:0,balance:0,entities:0})}getRowsForTab(e){const n=this.paymentData[e]||[],o=this.searchText.trim().toLowerCase(),r=this.statusFilter;return n.filter(s=>{const a=!o||String(s.name||"").toLowerCase().includes(o)||String(s.entityId||"").toLowerCase().includes(o),d="all"===r||String(s.status||"").toLowerCase()===r;return a&&d})}formatAmount(e){const n=Number(e||0);return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(n)}formatDate(e){if(!e)return"-";const n=new Date(e);return Number.isNaN(n.getTime())?"-":n.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}openDrawer(e,n){const r={clients:"client",branches:"branch",hubs:"hub",transportPartners:"transport_partner"}[e];r&&(this.activeEntity={tabKey:e,entityType:r,entityId:String(n?.entityId||""),name:String(n?.name||"")},this.activeRow=n,this.showDrawer=!0,this.dueAmount=String(n?.totalDue??""),this.dueError="",this.recordError="",this.recordForm.transactionDate||(this.recordForm.transactionDate=this.formatDateInput(new Date)),this.loadTransactions())}closeDrawer(){this.showDrawer=!1,this.activeEntity=null,this.activeRow=null,this.transactions=[],this.transactionsError="",this.recordError="",this.dueError=""}loadTransactions(){if(!this.activeEntity)return;this.transactionsLoading=!0,this.transactionsError="";const{entityType:e,entityId:n}=this.activeEntity;this.http.get(`http://localhost:3000/api/payments/${e}/${n}/transactions`).subscribe({next:o=>{this.transactions=Array.isArray(o?.transactions)?o.transactions:[],o?.summary&&(this.activeRow={...this.activeRow,...o.summary},this.dueAmount=String(o.summary.totalDue??"")),this.transactionsLoading=!1},error:o=>{console.error("Error loading transactions:",o),this.transactionsError="Failed to load transactions.",this.transactionsLoading=!1}})}submitPayment(){if(!this.activeEntity||this.transactionsLoading)return;const e=Number(this.recordForm.amount||0);if(this.recordError="",!Number.isFinite(e)||e<=0)return void(this.recordError="Enter a valid amount.");if(!this.recordForm.transactionDate)return void(this.recordError="Select a payment date.");if(!this.recordForm.method)return void(this.recordError="Select a payment method.");this.transactionsLoading=!0;const n={amount:e,transactionDate:this.recordForm.transactionDate,method:this.recordForm.method,referenceNo:this.recordForm.referenceNo,notes:this.recordForm.notes},{entityType:o,entityId:r}=this.activeEntity;this.http.post(`http://localhost:3000/api/payments/${o}/${r}/transactions`,n).subscribe({next:s=>{s?.transaction&&(this.transactions=[s.transaction,...this.transactions]),s?.summary&&(this.activeRow={...this.activeRow,...s.summary}),this.recordForm.amount="",this.recordForm.referenceNo="",this.recordForm.notes="",this.recordError="",this.transactionsLoading=!1,this.loadPayments()},error:s=>{console.error("Error recording payment:",s),this.transactionsError="Failed to record payment.",this.recordError=s?.error?.message||"Failed to record payment.",this.transactionsLoading=!1}})}syncFromInvoices(){this.syncLoading||(this.syncError="",this.backfillError="",this.syncLoading=!0,this.http.post("http://localhost:3000/api/payments/sync/generated-invoices",{}).subscribe({next:()=>{this.syncLoading=!1,this.loadPayments()},error:e=>{console.error("Error syncing payments:",e),this.syncError=e?.error?.message||"Failed to sync payments.",this.syncLoading=!1}}))}backfillInvoiceTransactions(){this.backfillLoading||(this.backfillError="",this.backfillLoading=!0,this.http.post("http://localhost:3000/api/payments/transactions/backfill-invoice-ids",{}).subscribe({next:e=>{this.backfillLoading=!1,Number(e?.updated)&&this.loadPayments()},error:e=>{console.error("Error backfilling invoice transactions:",e),this.backfillError=e?.error?.message||"Failed to backfill invoice transactions.",this.backfillLoading=!1}}))}updateDueAmount(){if(!this.activeEntity||this.transactionsLoading)return;const e=Number(this.dueAmount);if(this.dueError="",!Number.isFinite(e)||e<0)return void(this.dueError="Enter a valid due amount.");const{entityType:n,entityId:o}=this.activeEntity;this.transactionsLoading=!0,this.http.post(`http://localhost:3000/api/payments/${n}/${o}/summary/due`,{totalDue:e}).subscribe({next:r=>{r?.summary&&(this.activeRow={...this.activeRow,...r.summary},this.dueAmount=String(r.summary.totalDue??"")),this.dueError="",this.transactionsLoading=!1,this.loadPayments()},error:r=>{console.error("Error updating due amount:",r),this.dueError=r?.error?.message||"Failed to update due amount.",this.transactionsLoading=!1}})}voidTransaction(e){if(!this.activeEntity||this.transactionsLoading||!e?._id||!window.confirm("Void this transaction? This cannot be undone."))return;const o=String(e?.voidReason||"").trim(),{entityType:r,entityId:s}=this.activeEntity;this.transactionsLoading=!0,this.http.post(`http://localhost:3000/api/payments/${r}/${s}/transactions/${e._id}/void`,{voidReason:o}).subscribe({next:a=>{a?.transaction&&(this.transactions=this.transactions.map(d=>String(d._id)===String(a.transaction._id)?a.transaction:d)),a?.summary&&(this.activeRow={...this.activeRow,...a.summary}),this.transactionsLoading=!1,this.loadPayments()},error:a=>{console.error("Error voiding transaction:",a),this.transactionsError=a?.error?.message||"Failed to void transaction.",this.transactionsLoading=!1}})}formatDateInput(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-users"]],standalone:!0,features:[Ae],decls:53,vars:19,consts:[["emptyState",""],[1,"payments-page"],[1,"page-hero"],[1,"page-header"],[1,"stats"],[1,"stat-card"],[1,"filters"],["type","text","placeholder","Search by name or ID",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","all"],["value","pending"],["value","paid"],["value","overdue"],["type","button",3,"click","disabled"],[1,"tabs"],["type","button",3,"active","click",4,"ngFor","ngForOf"],["class","status",4,"ngIf"],["class","tab-panel",3,"hidden",4,"ngFor","ngForOf"],["class","drawer-overlay",4,"ngIf"],["type","button",3,"click"],[1,"status"],[1,"tab-panel",3,"hidden"],["class","table-wrap",4,"ngIf","ngIfElse"],[1,"table-wrap"],[4,"ngFor","ngForOf"],[1,"muted"],[1,"status-pill"],["type","button",1,"view-btn",3,"click"],[1,"empty-state"],[1,"drawer-overlay"],[1,"drawer"],[1,"drawer-header"],["type","button",1,"close-btn",3,"click"],["class","drawer-summary",4,"ngIf"],[1,"drawer-section"],[1,"form-grid"],["type","number","min","0",3,"ngModelChange","ngModel"],["type","button",1,"secondary",3,"click","disabled"],["class","form-error",4,"ngIf"],["type","date",3,"ngModelChange","ngModel"],["value",""],["value","Cash"],["value","UPI"],["value","Card"],["value","Bank Transfer"],["value","Cheque"],["type","text",3,"ngModelChange","ngModel"],[1,"full"],["rows","2",3,"ngModelChange","ngModel"],["type","button",1,"primary",3,"click","disabled"],[1,"form-hint"],["class","transactions",4,"ngIf"],[1,"drawer-summary"],[1,"form-error"],[1,"transactions"],["class","transaction",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],[1,"transaction"],[1,"tx-amount"],[1,"tx-meta"],["class","tx-ref",4,"ngIf"],["class","tx-notes",4,"ngIf"],[1,"tx-actions"],["type","button",1,"danger-outline",3,"click","disabled"],[1,"tx-ref"],[1,"tx-notes"]],template:function(n,o){1&n&&(l(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),u(4,"Payments"),c(),l(5,"p"),u(6,"Track balances across clients, branches, hubs, and transport partners."),c()(),l(7,"div",4)(8,"div",5)(9,"span"),u(10,"Total Due"),c(),l(11,"strong"),u(12),c()(),l(13,"div",5)(14,"span"),u(15,"Total Paid"),c(),l(16,"strong"),u(17),c()(),l(18,"div",5)(19,"span"),u(20,"Total Balance"),c(),l(21,"strong"),u(22),c()(),l(23,"div",5)(24,"span"),u(25,"Entities"),c(),l(26,"strong"),u(27),c()()()(),l(28,"div",6)(29,"input",7),S("ngModelChange",function(s){return x(o.searchText,s)||(o.searchText=s),s}),c(),l(30,"select",8),S("ngModelChange",function(s){return x(o.statusFilter,s)||(o.statusFilter=s),s}),l(31,"option",9),u(32,"All statuses"),c(),l(33,"option",10),u(34,"Pending"),c(),l(35,"option",11),u(36,"Paid"),c(),l(37,"option",12),u(38,"Overdue"),c()(),l(39,"button",13),M("click",function(){return o.loadPayments()}),u(40),c(),l(41,"button",13),M("click",function(){return o.syncFromInvoices()}),u(42),c(),l(43,"button",13),M("click",function(){return o.backfillInvoiceTransactions()}),u(44),c()(),l(45,"div",14),D(46,lU,2,3,"button",15),c(),D(47,dU,2,1,"div",16)(48,uU,2,1,"div",16)(49,hU,2,1,"div",16)(50,pU,2,0,"div",16)(51,_U,6,4,"section",17),c(),D(52,DU,63,18,"div",18)),2&n&&(h(12),N(o.formatAmount(o.totals.due)),h(5),N(o.formatAmount(o.totals.paid)),h(5),N(o.formatAmount(o.totals.balance)),h(5),N(o.totals.entities),h(2),w("ngModel",o.searchText),h(),w("ngModel",o.statusFilter),h(9),C("disabled",o.loading),h(),k(" ",o.loading?"Refreshing...":"Refresh"," "),h(),C("disabled",o.syncLoading),h(),k(" ",o.syncLoading?"Syncing...":"Sync from Invoices"," "),h(),C("disabled",o.backfillLoading),h(),k(" ",o.backfillLoading?"Backfilling...":"Backfill Invoice Tx"," "),h(2),C("ngForOf",o.tabs),h(),C("ngIf",o.error),h(),C("ngIf",o.syncError),h(),C("ngIf",o.backfillError),h(),C("ngIf",o.loading),h(),C("ngForOf",o.tabs),h(),C("ngIf",o.showDrawer))},dependencies:[pt,lt,Xe,et,wt,St,qe,on,vt,We,Gi,He],styles:[".payments-page[_ngcontent-%COMP%]{padding:20px;color:#0f172a}.page-hero[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;background:linear-gradient(120deg,#eef2ff,#fef9c3);padding:18px;border-radius:16px;border:1px solid #e2e8f0}.page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#1e3a8a}.page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0 0;color:#6b7280;font-size:13px}.stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:12px 14px;border:1px solid #e5e7eb;display:flex;flex-direction:column;gap:6px}.stat-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#64748b;font-size:12px}.stat-card[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:16px;color:#0f172a}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:18px 0 10px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #cbd5f5;border-radius:10px;min-width:220px;background:#fff}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid #cbd5f5;background:#fff;cursor:pointer}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:#2563eb;color:#1e3a8a}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin:10px 0 14px;flex-wrap:wrap}.tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid #d1d5db;background:#f9fafb;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;color:#374151}.tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#2563eb;border-color:#2563eb;color:#fff}.status[_ngcontent-%COMP%]{padding:10px 12px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;margin-bottom:12px;color:#64748b;font-size:13px}.tab-panel[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 10px;color:#111827}.table-wrap[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid #e5e7eb;border-radius:10px;background:#fff}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px 12px;text-align:left;border-bottom:1px solid #e5e7eb;font-size:13px}th[_ngcontent-%COMP%]{background:#f3f4f6;font-weight:700}.view-btn[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #2563eb;background:#fff;color:#2563eb;cursor:pointer}.view-btn[_ngcontent-%COMP%]:hover{background:#eff6ff}.muted[_ngcontent-%COMP%]{color:#64748b;font-size:12px}.status-pill[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:999px;background:#e0f2fe;color:#0369a1;font-size:12px;text-transform:capitalize}.status-pill.overdue[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.empty-state[_ngcontent-%COMP%]{padding:16px;border:1px dashed #d1d5db;border-radius:10px;color:#6b7280;font-size:13px;background:#f9fafb}.drawer-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a80;display:flex;justify-content:flex-end;z-index:1200}.drawer[_ngcontent-%COMP%]{width:min(520px,92vw);height:100%;background:#fff;padding:20px;overflow-y:auto;box-shadow:-10px 0 30px #0f172a33;display:flex;flex-direction:column;gap:16px}.drawer-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}.close-btn[_ngcontent-%COMP%]{background:transparent;border:none;font-size:20px;cursor:pointer;color:#64748b}.drawer-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:12px}.drawer-summary[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;color:#64748b;font-size:12px}.drawer-summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:15px;color:#0f172a}.drawer-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-bottom:12px}.form-grid[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-size:12px;color:#475569}.form-grid[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-grid[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-grid[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:8px 10px;border-radius:8px;border:1px solid #cbd5f5;font-size:13px}.form-grid[_ngcontent-%COMP%]   .full[_ngcontent-%COMP%]{grid-column:1 / -1}.primary[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:none;background:#2563eb;color:#fff;cursor:pointer}.secondary[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid #cbd5f5;background:#fff;color:#1e3a8a;cursor:pointer}.secondary[_ngcontent-%COMP%]:hover{border-color:#2563eb}.primary[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.form-error[_ngcontent-%COMP%]{margin:8px 0 0;color:#b91c1c;font-size:12px}.form-hint[_ngcontent-%COMP%]{margin-top:8px;color:#94a3b8;font-size:12px}.transactions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.transaction[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px;background:#fff;display:flex;justify-content:space-between;gap:12px}.tx-amount[_ngcontent-%COMP%]{font-weight:600;color:#0f172a}.tx-meta[_ngcontent-%COMP%]{color:#64748b;font-size:12px}.tx-ref[_ngcontent-%COMP%], .tx-notes[_ngcontent-%COMP%]{color:#475569;font-size:12px;margin-top:4px}.tx-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:flex-end}.status-pill.voided[_ngcontent-%COMP%]{background:#e2e8f0;color:#475569}.danger-outline[_ngcontent-%COMP%]{padding:6px 10px;border-radius:8px;border:1px solid #dc2626;background:#fff;color:#dc2626;cursor:pointer}.danger-outline[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}@media (max-width: 700px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:100%}.drawer-summary[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:8px 10px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:7px 8px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:6px;font-size:11px}}"]})}}return t})();function TU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.hubName)}}function kU(t,i){if(1&t){const e=O();l(0,"select",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.selectedHubFilterId,o)||(r.selectedHubFilterId=o),v(o)}),M("ngModelChange",function(o){return _(e),v(f().onHubFilterChange(o))}),D(1,TU,2,2,"option",21),c()}if(2&t){const e=f();w("ngModel",e.selectedHubFilterId),h(),C("ngForOf",e.getAllHubsFilterOptions())}}function EU(t,i){if(1&t){const e=O();l(0,"tr",5),M("click",function(){const o=_(e).$implicit;return v(f().openStockDetails(o))}),l(1,"td")(2,"input",23),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.selected,o)||(r.selected=o),v(o)}),M("click",function(o){return _(e),v(o.stopPropagation())}),c()(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td"),u(12),c(),l(13,"td"),u(14),c(),l(15,"td"),u(16),c(),l(17,"td")(18,"button",5),M("click",function(o){const r=_(e).$implicit;return f().editStock(r),v(o.stopPropagation())}),u(19,"Edit"),c()()()}if(2&t){const e=i.$implicit,n=f();h(2),w("ngModel",e.selected),h(2),N(e.consignmentNumber),h(2),N(e.shipmentStatus),h(2),N(e.consignor),h(2),N(e.deliveryAddress),h(2),N(n.getInvoiceAmountTotal(e.invoices)),h(2),N(n.getOriginBranchLabel(e)),h(2),N(n.getCurrentBranchLabel(e))}}function AU(t,i){if(1&t&&(l(0,"li")(1,"span",37),u(2),c(),l(3,"span",38),u(4),c(),l(5,"span",38),u(6),c()()),2&t){const e=i.$implicit;h(2),N(e.type),h(2),k("In Stock: ",e.instock,""),h(2),k("Total: ",e.amount,"")}}function OU(t,i){if(1&t&&(l(0,"div",33)(1,"div",34),u(2),c(),l(3,"ul",35),D(4,AU,7,3,"li",36),c()()),2&t){const e=i.$implicit;h(2),k("Invoice #",e.number,""),h(2),C("ngForOf",e.products)}}function LU(t,i){if(1&t){const e=O();l(0,"div",24)(1,"div",25)(2,"button",26),M("click",function(){return _(e),v(f().closeStockDetails())}),u(3,"\xd7"),c(),l(4,"div",27)(5,"div")(6,"h2"),u(7,"Shipment Details"),c(),l(8,"p",28),u(9),c()(),l(10,"span",29),u(11),c()(),l(12,"div",30)(13,"p")(14,"strong"),u(15,"Consignment No.:"),c(),u(16),c(),l(17,"p")(18,"strong"),u(19,"Status:"),c(),u(20),c(),l(21,"p")(22,"strong"),u(23,"Branch:"),c(),u(24),c(),l(25,"p")(26,"strong"),u(27,"Consignor:"),c(),u(28),c(),l(29,"p")(30,"strong"),u(31,"Consignor GST:"),c(),u(32),c(),l(33,"p")(34,"strong"),u(35,"Consignor Phone:"),c(),u(36),c(),l(37,"p")(38,"strong"),u(39,"Consignor Address:"),c(),u(40),c(),l(41,"p")(42,"strong"),u(43,"Consignee:"),c(),u(44),c(),l(45,"p")(46,"strong"),u(47,"Consignee GST:"),c(),u(48),c(),l(49,"p")(50,"strong"),u(51,"Consignee Phone:"),c(),u(52),c(),l(53,"p")(54,"strong"),u(55,"Consignee Address:"),c(),u(56),c(),l(57,"p")(58,"strong"),u(59,"Payment Mode:"),c(),u(60),c(),l(61,"p")(62,"strong"),u(63,"External Ref ID:"),c(),u(64),c(),l(65,"p")(66,"strong"),u(67,"Billing Type:"),c(),u(68),c(),l(69,"p")(70,"strong"),u(71,"Billing Name:"),c(),u(72),c(),l(73,"p")(74,"strong"),u(75,"Billing GSTIN:"),c(),u(76),c(),l(77,"p")(78,"strong"),u(79,"Billing Phone:"),c(),u(80),c(),l(81,"p")(82,"strong"),u(83,"Billing Address:"),c(),u(84),c(),l(85,"p")(86,"strong"),u(87,"Pickup Type:"),c(),u(88),c(),l(89,"p")(90,"strong"),u(91,"Pickup Name:"),c(),u(92),c(),l(93,"p")(94,"strong"),u(95,"Pickup Phone:"),c(),u(96),c(),l(97,"p")(98,"strong"),u(99,"Pickup Address:"),c(),u(100),c(),l(101,"p")(102,"strong"),u(103,"Pickup Pincode:"),c(),u(104),c(),l(105,"p")(106,"strong"),u(107,"Delivery Type:"),c(),u(108),c(),l(109,"p")(110,"strong"),u(111,"Delivery To:"),c(),u(112),c(),l(113,"p")(114,"strong"),u(115,"Delivery Phone:"),c(),u(116),c(),l(117,"p")(118,"strong"),u(119,"Delivery Address:"),c(),u(120),c(),l(121,"p")(122,"strong"),u(123,"Delivery Pincode:"),c(),u(124),c(),l(125,"p")(126,"strong"),u(127,"Date:"),c(),u(128),hi(129,"date"),c(),l(130,"p")(131,"strong"),u(132,"Final Amount:"),c(),u(133),c(),l(134,"p")(135,"strong"),u(136,"Charges - ODC:"),c(),u(137),c(),l(138,"p")(139,"strong"),u(140,"Charges - Unloading:"),c(),u(141),c(),l(142,"p")(143,"strong"),u(144,"Charges - Docket:"),c(),u(145),c(),l(146,"p")(147,"strong"),u(148,"Charges - Other:"),c(),u(149),c(),l(150,"p")(151,"strong"),u(152,"Charges - CCC:"),c(),u(153),c(),l(154,"p")(155,"strong"),u(156,"Charges - Consignor Discount:"),c(),u(157),c(),l(158,"p")(159,"strong"),u(160,"Products in stock:"),c(),u(161),c(),l(162,"p")(163,"strong"),u(164,"No. of Products:"),c(),u(165),c()(),l(166,"h3"),u(167,"Products"),c(),l(168,"div",31),D(169,OU,5,2,"div",32),c()()()}if(2&t){const e=f();h(9),k("Consignment ",e.selectedStock.consignmentNumber,""),h(2),N(e.selectedStock.shipmentStatus),h(5),k(" ",e.selectedStock.consignmentNumber,""),h(4),k(" ",e.selectedStock.shipmentStatus,""),h(4),k(" ",e.getOriginBranchLabel(e.selectedStock),""),h(4),k(" ",e.selectedStock.consignor,""),h(4),k(" ",e.selectedStock.consignorGST,""),h(4),k(" ",e.selectedStock.consignorPhone,""),h(4),k(" ",e.selectedStock.consignorAddress,""),h(4),k(" ",e.selectedStock.consignee,""),h(4),k(" ",e.selectedStock.consigneeGST,""),h(4),k(" ",e.selectedStock.consigneePhone,""),h(4),k(" ",e.selectedStock.consigneeAddress,""),h(4),k(" ",e.selectedStock.paymentMode,""),h(4),k(" ",e.selectedStock.externalRefId,""),h(4),k(" ",e.selectedStock.billingType,""),h(4),k(" ",e.selectedStock.billingName,""),h(4),k(" ",e.selectedStock.billingGSTIN,""),h(4),k(" ",e.selectedStock.billingPhone,""),h(4),k(" ",e.selectedStock.billingAddress,""),h(4),k(" ",e.selectedStock.pickupType,""),h(4),k(" ",e.selectedStock.pickupName,""),h(4),k(" ",e.selectedStock.pickupPhone,""),h(4),k(" ",e.selectedStock.pickupAddress,""),h(4),k(" ",e.selectedStock.pickupPincode,""),h(4),k(" ",e.selectedStock.deliveryType,""),h(4),k(" ",e.getDeliveryDisplayName(e.selectedStock),""),h(4),k(" ",e.selectedStock.deliveryPhone,""),h(4),k(" ",e.selectedStock.deliveryAddress,""),h(4),k(" ",e.selectedStock.deliveryPincode,""),h(4),k(" ",_o(129,41,e.selectedStock.date,"short"),""),h(5),k(" ",e.selectedStock.finalAmount,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.odc,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.unloading,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.docket,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.other,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.ccc,""),h(4),k(" ",null==e.selectedStock||null==e.selectedStock.charges?null:e.selectedStock.charges.consignorDiscount,""),h(4),k(" ",e.getInStockAmountTotal(e.selectedStock.invoices),""),h(4),k(" ",e.getInvoiceAmountTotal(e.selectedStock.invoices),""),h(4),C("ngForOf",e.selectedStock.invoices)}}function RU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.clientName),h(),Be("",e.clientName,", ",e.address,"")}}function FU(t,i){if(1&t){const e=O();l(0,"div",44)(1,"label"),u(2,"Consignor: "),l(3,"select",48),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignor,o)||(r.editingStock.consignor=o),v(o)}),M("change",function(){_(e);const o=f(2);return v(o.onConsignorSelect(o.editingStock.consignor))}),D(4,RU,2,3,"option",21),c()(),l(5,"label"),u(6,"GSTIN: "),l(7,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignorGST,o)||(r.editingStock.consignorGST=o),v(o)}),c()(),l(8,"label"),u(9,"Address: "),l(10,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignorAddress,o)||(r.editingStock.consignorAddress=o),v(o)}),c()(),l(11,"label"),u(12,"Phone: "),l(13,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignorPhone,o)||(r.editingStock.consignorPhone=o),v(o)}),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.editingStock.consignor),h(),C("ngForOf",e.clientList),h(3),w("ngModel",e.editingStock.consignorGST),h(3),w("ngModel",e.editingStock.consignorAddress),h(3),w("ngModel",e.editingStock.consignorPhone)}}function BU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.guestName),h(),Be("",e.guestName,", ",e.address,"")}}function VU(t,i){if(1&t){const e=O();l(0,"div",44)(1,"label"),u(2,"Guest Name: "),l(3,"select",48),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignor,o)||(r.editingStock.consignor=o),v(o)}),M("change",function(){_(e);const o=f(2);return v(o.onConsignorGuestSelect(o.editingStock.consignor))}),D(4,BU,2,3,"option",21),c()(),l(5,"label"),u(6,"Address: "),l(7,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignorAddress,o)||(r.editingStock.consignorAddress=o),v(o)}),c()(),l(8,"label"),u(9,"Phone: "),l(10,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignorPhone,o)||(r.editingStock.consignorPhone=o),v(o)}),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.editingStock.consignor),h(),C("ngForOf",e.guestList),h(3),w("ngModel",e.editingStock.consignorAddress),h(3),w("ngModel",e.editingStock.consignorPhone)}}function HU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.clientName),h(),Be("",e.clientName,", ",e.address,"")}}function jU(t,i){if(1&t){const e=O();l(0,"div",44)(1,"label"),u(2,"Consignee: "),l(3,"select",48),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignee,o)||(r.editingStock.consignee=o),v(o)}),M("change",function(){_(e);const o=f(2);return v(o.onConsigneeSelect(o.editingStock.consignee))}),D(4,HU,2,3,"option",21),c()(),l(5,"label"),u(6,"GSTIN: "),l(7,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consigneeGST,o)||(r.editingStock.consigneeGST=o),v(o)}),c()(),l(8,"label"),u(9,"Address: "),l(10,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consigneeAddress,o)||(r.editingStock.consigneeAddress=o),v(o)}),c()(),l(11,"label"),u(12,"Phone: "),l(13,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consigneePhone,o)||(r.editingStock.consigneePhone=o),v(o)}),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.editingStock.consignee),h(),C("ngForOf",e.clientList),h(3),w("ngModel",e.editingStock.consigneeGST),h(3),w("ngModel",e.editingStock.consigneeAddress),h(3),w("ngModel",e.editingStock.consigneePhone)}}function UU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.guestName),h(),Be("",e.guestName,", ",e.address,"")}}function zU(t,i){if(1&t){const e=O();l(0,"div",44)(1,"label"),u(2,"Guest Name: "),l(3,"select",48),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consignee,o)||(r.editingStock.consignee=o),v(o)}),M("change",function(){_(e);const o=f(2);return v(o.onConsigneeGuestSelect(o.editingStock.consignee))}),D(4,UU,2,3,"option",21),c()(),l(5,"label"),u(6,"Address: "),l(7,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consigneeAddress,o)||(r.editingStock.consigneeAddress=o),v(o)}),c()(),l(8,"label"),u(9,"Phone: "),l(10,"input",58),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.consigneePhone,o)||(r.editingStock.consigneePhone=o),v(o)}),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.editingStock.consignee),h(),C("ngForOf",e.guestList),h(3),w("ngModel",e.editingStock.consigneeAddress),h(3),w("ngModel",e.editingStock.consigneePhone)}}function GU(t,i){if(1&t){const e=O();l(0,"div",44)(1,"label"),u(2,"Name: "),l(3,"input",20),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.billingName,o)||(r.editingStock.billingName=o),v(o)}),c()(),l(4,"label"),u(5,"GSTIN: "),l(6,"input",20),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.billingGSTIN,o)||(r.editingStock.billingGSTIN=o),v(o)}),c()(),l(7,"label"),u(8,"Address: "),l(9,"textarea",20),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.editingStock.billingAddress,o)||(r.editingStock.billingAddress=o),v(o)}),c()()()}if(2&t){const e=f(2);h(3),w("ngModel",e.editingStock.billingName),h(3),w("ngModel",e.editingStock.billingGSTIN),h(3),w("ngModel",e.editingStock.billingAddress)}}function $U(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.pkgName),h(),N(e.pkgName)}}function qU(t,i){if(1&t){const e=O();l(0,"div",65)(1,"select",48),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.type,o)||(r.type=o),v(o)}),M("change",function(){const o=_(e).$implicit;return v(f(3).onPackageList(o.pkgName))}),D(2,$U,2,2,"option",21),c(),l(3,"input",66),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.amount,o)||(r.amount=o),v(o)}),c(),l(4,"button",63),M("click",function(){const o=_(e).index,r=f().index;return v(f(2).deletePackage(r,o))}),u(5),c()()}if(2&t){const e=i.$implicit,n=i.index,o=f().index,r=f(2);h(),w("ngModel",e.type),h(),C("ngForOf",r.pkgList),h(),w("ngModel",e.amount),h(2),Be("dY-`\ufffd,? Delete Package ",o,"/",n,"")}}function WU(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.productName),h(),Be(" ",e.hsnNum," - ",e.productName," ")}}function QU(t,i){if(1&t){const e=O();l(0,"div",65)(1,"select",48),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.type,o)||(r.type=o),v(o)}),M("change",function(){const o=_(e).$implicit;return v(f(3).onPackageList(o.productName))}),D(2,WU,2,3,"option",21),c(),l(3,"input",67),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.amount,o)||(r.amount=o),v(o)}),M("focus",function(){const o=_(e).$implicit,r=f(),s=r.$implicit,a=r.index;return v(f(2).onProductAmountFocus(s,o,a))})("ngModelChange",function(o){const r=_(e).$implicit,s=f(),a=s.$implicit,d=s.index;return v(f(2).onProductAmountChange(a,r,o,d))}),c(),l(4,"button",63),M("click",function(){const o=_(e).index,r=f().index;return v(f(2).deleteProduct(r,o))}),u(5),c()()}if(2&t){const e=i.$implicit,n=i.index,o=f().index,r=f(2);h(),w("ngModel",e.type),h(),C("ngForOf",r.productList),h(),w("ngModel",e.amount),h(2),Be("dY-`\ufffd,? Delete Product ",o,"/",n,"")}}function ZU(t,i){if(1&t){const e=O();l(0,"div",59)(1,"div",60)(2,"input",61),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.number,o)||(r.number=o),v(o)}),c(),l(3,"input",62),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.value,o)||(r.value=o),v(o)}),c(),l(4,"button",63),M("click",function(){const o=_(e).index;return v(f(2).deleteInvoice(o))}),u(5,"Delete Invoice"),c()(),l(6,"h4"),u(7,"Packages"),c(),D(8,qU,6,5,"div",64),l(9,"button",53),M("click",function(){const o=_(e).index;return v(f(2).addPackage(o))}),u(10,"+ Add Package"),c(),l(11,"h4"),u(12,"Products"),c(),D(13,QU,6,5,"div",64),l(14,"button",53),M("click",function(){const o=_(e).index;return v(f(2).addProduct(o))}),u(15,"+ Add Product"),c()()}if(2&t){const e=i.$implicit;h(2),w("ngModel",e.number),h(),w("ngModel",e.value),h(5),C("ngForOf",e.packages),h(5),C("ngForOf",e.products)}}function YU(t,i){if(1&t){const e=O();l(0,"div",39)(1,"div",40)(2,"div",41)(3,"div")(4,"h3"),u(5,"Edit Stock"),c(),l(6,"p",42),u(7),c()()(),l(8,"div",43)(9,"div",44)(10,"label"),u(11,"E-way Bill No: "),l(12,"input",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.ewaybillNumber,o)||(r.editingStock.ewaybillNumber=o),v(o)}),c()(),l(13,"label"),u(14,"Date: "),l(15,"input",45),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.date,o)||(r.editingStock.date=o),v(o)}),c()()()(),l(16,"div",43)(17,"h4"),u(18,"Consignor"),c(),l(19,"div",46)(20,"button",5),M("click",function(){return _(e),v(f().editingStock.consignorTab="consignor")}),u(21,"Consignor"),c(),l(22,"button",5),M("click",function(){return _(e),v(f().editingStock.consignorTab="guest")}),u(23,"Guest"),c()(),D(24,FU,14,5,"div",47)(25,VU,11,4,"div",47),c(),l(26,"div",43)(27,"h4"),u(28,"Consignee"),c(),l(29,"div",46)(30,"button",5),M("click",function(){return _(e),v(f().editingStock.consigneeTab="consignee")}),u(31,"Consignee"),c(),l(32,"button",5),M("click",function(){return _(e),v(f().editingStock.consigneeTab="guest")}),u(33,"Guest"),c()(),D(34,jU,14,5,"div",47)(35,zU,11,4,"div",47),c(),l(36,"div",43)(37,"div",44)(38,"label"),u(39,"Payment Mode: "),l(40,"select",48),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.paymentMode,o)||(r.editingStock.paymentMode=o),v(o)}),M("change",function(){return _(e),v(f().onEditingPaymentModeChange())}),l(41,"option"),u(42,"Account Credit"),c(),l(43,"option"),u(44,"Paid"),c(),l(45,"option"),u(46,"To Pay"),c()()(),l(47,"label"),u(48,"External Ref ID: "),l(49,"input",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.externalRefId,o)||(r.editingStock.externalRefId=o),v(o)}),c()()(),l(50,"h4"),u(51,"Billing Type"),c(),l(52,"div",49)(53,"label")(54,"input",50),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.billingType,o)||(r.editingStock.billingType=o),v(o)}),c(),u(55," Consignor's GST Address"),c(),l(56,"label")(57,"input",51),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.billingType,o)||(r.editingStock.billingType=o),v(o)}),c(),u(58," Different Address"),c()(),D(59,GU,10,3,"div",47),c(),l(60,"section",43)(61,"h3"),u(62,"4. Invoice"),c(),D(63,ZU,16,4,"div",52),l(64,"button",53),M("click",function(){return _(e),v(f().addInvoice())}),u(65,"+ Add Invoice"),c()(),l(66,"div",43)(67,"h4"),u(68,"Charges"),c(),l(69,"div",44)(70,"label"),u(71,"ODC: "),l(72,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.charges.odc,o)||(r.editingStock.charges.odc=o),v(o)}),c()(),l(73,"label"),u(74,"Unloading: "),l(75,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.charges.unloading,o)||(r.editingStock.charges.unloading=o),v(o)}),c()(),l(76,"label"),u(77,"Docket: "),l(78,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.charges.docket,o)||(r.editingStock.charges.docket=o),v(o)}),c()(),l(79,"label"),u(80,"Other: "),l(81,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.charges.other,o)||(r.editingStock.charges.other=o),v(o)}),c()(),l(82,"label"),u(83,"CCC: "),l(84,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.charges.ccc,o)||(r.editingStock.charges.ccc=o),v(o)}),c()(),l(85,"label"),u(86,"Final Amount: "),l(87,"input",54),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingStock.finalAmount,o)||(r.editingStock.finalAmount=o),v(o)}),c()()()(),l(88,"div",55)(89,"button",56),M("click",function(){return _(e),v(f().calculateFinalAmount())}),u(90,"Calculate"),c(),l(91,"button",57),M("click",function(){return _(e),v(f().saveStockEdit())}),u(92,"Save"),c(),l(93,"button",56),M("click",function(){return _(e),v(f().cancelEdit())}),u(94,"Cancel"),c()()()()}if(2&t){const e=f();h(7),Be("Consignment No: ",e.editingStock.consignmentNumber," | Status: ",e.editingStock.shipmentStatus,""),h(5),w("ngModel",e.editingStock.ewaybillNumber),h(3),w("ngModel",e.editingStock.date),h(5),Ce("active","consignor"===e.editingStock.consignorTab),h(2),Ce("active","guest"===e.editingStock.consignorTab),h(2),C("ngIf","consignor"===e.editingStock.consignorTab),h(),C("ngIf","guest"===e.editingStock.consignorTab),h(5),Ce("active","consignee"===e.editingStock.consigneeTab),h(2),Ce("active","guest"===e.editingStock.consigneeTab),h(2),C("ngIf","consignee"===e.editingStock.consigneeTab),h(),C("ngIf","guest"===e.editingStock.consigneeTab),h(5),w("ngModel",e.editingStock.paymentMode),h(9),w("ngModel",e.editingStock.externalRefId),h(5),w("ngModel",e.editingStock.billingType),h(3),w("ngModel",e.editingStock.billingType),h(2),C("ngIf","different"===e.editingStock.billingType),h(4),C("ngForOf",e.editingStock.invoices),h(9),w("ngModel",e.editingStock.charges.odc),h(3),w("ngModel",e.editingStock.charges.unloading),h(3),w("ngModel",e.editingStock.charges.docket),h(3),w("ngModel",e.editingStock.charges.other),h(3),w("ngModel",e.editingStock.charges.ccc),h(3),w("ngModel",e.editingStock.finalAmount)}}function KU(t,i){if(1&t){const e=O();l(0,"div")(1,"p")(2,"strong"),u(3,"Consignment:"),c(),u(4),c(),l(5,"p")(6,"strong"),u(7,"Product:"),c(),u(8),c(),l(9,"p")(10,"strong"),u(11,"New Total Qty:"),c(),u(12),c(),l(13,"p")(14,"strong"),u(15,"In Stock Qty:"),c(),l(16,"input",73),S("ngModelChange",function(o){_(e);const r=f(2);return x(r.pendingManifestAdjustment.popupInstock,o)||(r.pendingManifestAdjustment.popupInstock=o),v(o)}),M("ngModelChange",function(o){return _(e),v(f(2).onPopupInstockChange(o))}),c()()()}if(2&t){const e=f(2);h(4),k(" ",e.pendingManifestAdjustment.consignmentNumber,""),h(4),k(" ",e.pendingManifestAdjustment.productType,""),h(4),k(" ",e.getPopupTargetTotal()," "),h(4),w("ngModel",e.pendingManifestAdjustment.popupInstock)}}function JU(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),hi(5,"date"),c(),l(6,"td"),u(7),c(),l(8,"td")(9,"input",73),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.newManifestQty,o)||(r.newManifestQty=o),v(o)}),M("ngModelChange",function(){const o=_(e).$implicit;return v(f(3).onManifestQtyChange(o))}),c()()()}if(2&t){const e=i.$implicit;h(2),N(e.manifestationNumber),h(2),N(_o(5,4,e.date,"short")),h(3),N(e.invoiceNumber),h(2),w("ngModel",e.newManifestQty)}}function XU(t,i){if(1&t&&(l(0,"table",14)(1,"thead")(2,"tr")(3,"th"),u(4,"Manifest No."),c(),l(5,"th"),u(6,"Date"),c(),l(7,"th"),u(8,"Invoice"),c(),l(9,"th"),u(10,"Qty"),c()()(),l(11,"tbody"),D(12,JU,10,7,"tr",36),c()()),2&t){const e=f(2);h(12),C("ngForOf",e.manifestAdjustmentLines)}}function ez(t,i){if(1&t){const e=O();l(0,"div",68)(1,"div",69)(2,"h3"),u(3,"Adjust Manifest Quantities"),c(),D(4,KU,17,4,"div",70)(5,XU,13,1,"table",71),l(6,"p")(7,"strong"),u(8,"Manifest Total:"),c(),u(9),l(10,"strong"),u(11,"Delivered Total:"),c(),u(12),c(),l(13,"div",72)(14,"button",5),M("click",function(){return _(e),v(f().applyManifestAdjustments())}),u(15,"Apply"),c(),l(16,"button",5),M("click",function(){return _(e),v(f().cancelManifestAdjustments())}),u(17,"Cancel"),c()()()()}if(2&t){const e=f();h(4),C("ngIf",e.pendingManifestAdjustment),h(),C("ngIf",e.manifestAdjustmentLines.length>0),h(4),k(" ",e.getManifestLineTotal()," | "),h(3),k(" ",e.getPopupDeliveredTotal(),"")}}function tz(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e),h(),N(e)}}function nz(t,i){if(1&t&&(l(0,"p",80)(1,"strong"),u(2,"Manifest No:"),c(),u(3),c()),2&t){const e=f(2);h(3),k(" ",e.manifestationNumber," ")}}function iz(t,i){if(1&t){const e=O();l(0,"div",86)(1,"label",87)(2,"input",88),S("ngModelChange",function(o){_(e);const r=f().$implicit;return x(r.hubWillPickedUp,o)||(r.hubWillPickedUp=o),v(o)}),M("change",function(){_(e);const o=f().$implicit;return v(f(3).onHubPickedUpToggle(o))}),c(),l(3,"span"),u(4,"Will picked-up from the location"),c()(),l(5,"div",89)(6,"label"),u(7," Hub charge "),l(8,"input",90),S("ngModelChange",function(o){_(e);const r=f().$implicit;return x(r.hubPerRevAmount,o)||(r.hubPerRevAmount=o),v(o)}),c()(),l(9,"span",91),u(10),c()()()}if(2&t){const e=f().$implicit,n=f(3);h(2),w("ngModel",e.hubWillPickedUp),h(6),w("ngModel",e.hubPerRevAmount),C("disabled",e.hubWillPickedUp),h(2),k("Suggested: ",n.getHubChargeSuggestion(e),"")}}function oz(t,i){if(1&t){const e=O();zn(0),l(1,"label",92)(2,"input",93),S("ngModelChange",function(o){_(e);const r=f().$implicit;return x(r.ewayBillRequired,o)||(r.ewayBillRequired=o),v(o)}),c(),X(3,"span",94),l(4,"span",95),u(5),c()(),Gn()}if(2&t){const e=f().$implicit;h(2),w("ngModel",e.ewayBillRequired),h(3),k(" ",e.ewayBillRequired?"Eway Bill will be created":"Eway Bill not required"," ")}}function rz(t,i){if(1&t&&(l(0,"p")(1,"strong"),u(2,"Customer created Eway Bill No:"),c(),u(3),c()),2&t){const e=f().$implicit;h(3),k(" ",e.ewaybillNumber,"")}}function sz(t,i){if(1&t){const e=O();l(0,"li")(1,"div",96)(2,"span")(3,"strong"),u(4),c()(),l(5,"span"),u(6),c(),l(7,"span")(8,"input",97),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.manifestQty,o)||(r.manifestQty=o),v(o)}),c()()()()}if(2&t){const e=i.$implicit;h(4),N(e.type),h(2),k(" Total: ",e.amount," "),h(2),C("max",e.instock),w("ngModel",e.manifestQty)}}function az(t,i){if(1&t&&(l(0,"li")(1,"strong"),u(2,"Invoice:"),c(),u(3),l(4,"ul"),D(5,sz,9,4,"li",36),c()()),2&t){const e=i.$implicit;h(3),k(" ",e.number," "),h(2),C("ngForOf",e.products)}}function cz(t,i){if(1&t&&(l(0,"div",83)(1,"h4"),u(2),c(),D(3,iz,11,4,"div",84),l(4,"div",85),D(5,oz,6,2,"ng-container",79)(6,rz,4,1,"ng-template",null,1,qn),c(),l(8,"p")(9,"strong"),u(10,"Consignor:"),c(),u(11),c(),l(12,"ul"),D(13,az,6,2,"li",36),c(),X(14,"hr"),c()),2&t){const e=i.$implicit,n=$n(7),o=f(3);h(2),k("Consignment: ",e.consignmentNumber,""),h(),C("ngIf",o.isSelectedNextDeliveryPointHub()),h(2),C("ngIf",""===e.ewaybillNumber)("ngIfElse",n),h(6),k(" ",e.consignor,""),h(2),C("ngForOf",e.invoices)}}function lz(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e),h(),N(e)}}function dz(t,i){if(1&t){const e=O();zn(0),l(1,"select",105)(2,"option",106),u(3,"Select transport partner"),c()(),l(4,"select",48),S("ngModelChange",function(o){_(e);const r=f(4);return x(r.selectedRouteVehicle,o)||(r.selectedRouteVehicle=o),v(o)}),M("change",function(){return _(e),v(f(4).onRouteVehicleChange())}),l(5,"option",106),u(6,"Select Vehicle"),c(),D(7,lz,2,2,"option",21),c(),Gn()}if(2&t){const e=f(4);h(4),w("ngModel",e.selectedRouteVehicle),h(3),C("ngForOf",e.getBranchVehicles())}}function uz(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e._id),h(),N(e.partnerName)}}function hz(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e),h(),N(e)}}function pz(t,i){if(1&t){const e=O();l(0,"select",48),S("ngModelChange",function(o){_(e);const r=f(4);return x(r.selectedTransportPartnerId,o)||(r.selectedTransportPartnerId=o),v(o)}),M("change",function(){return _(e),v(f(4).onTransportPartnerChange())}),l(1,"option",106),u(2,"Select transport partner"),c(),D(3,uz,2,2,"option",21),c(),l(4,"select",48),S("ngModelChange",function(o){_(e);const r=f(4);return x(r.selectedRouteVehicle,o)||(r.selectedRouteVehicle=o),v(o)}),M("change",function(){return _(e),v(f(4).onRouteVehicleChange())}),l(5,"option",106),u(6,"Select Vehicle"),c(),D(7,hz,2,2,"option",21),c()}if(2&t){const e=f(4);w("ngModel",e.selectedTransportPartnerId),h(3),C("ngForOf",e.transportPartners),h(),w("ngModel",e.selectedRouteVehicle),h(3),C("ngForOf",e.getTransportPartnerVehicles())}}function gz(t,i){if(1&t&&(l(0,"option",22),u(1),c()),2&t){const e=i.$implicit;C("value",e.name),h(),Be(" ",e.name," (",e.type,") ")}}function fz(t,i){if(1&t){const e=O();l(0,"label"),u(1," Next delivery point "),l(2,"select",48),S("ngModelChange",function(o){_(e);const r=f(4);return x(r.selectedNextDeliveryPoint,o)||(r.selectedNextDeliveryPoint=o),v(o)}),M("change",function(){return _(e),v(f(4).onNextDeliveryPointChange())}),l(3,"option",106),u(4,"Select next point"),c(),D(5,gz,2,3,"option",21),c()()}if(2&t){const e=f(4);h(2),w("ngModel",e.selectedNextDeliveryPoint),h(3),C("ngForOf",e.availableRoutePoints)}}function mz(t,i){if(1&t&&(l(0,"div",107),u(1),c()),2&t){const e=f(4);h(),k(" Hub charge total: ",e.getHubChargeTotal()," ")}}function _z(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=f().$implicit;h(),k("- ",e.vehicleNo,"")}}function vz(t,i){if(1&t){const e=O();l(0,"li"),u(1),D(2,_z,2,1,"span",70),l(3,"button",108),M("click",function(){const o=_(e).index;return v(f(4).removeRoutePoint(o))}),u(4,"x"),c()()}if(2&t){const e=i.$implicit,n=i.index;h(),ua(" ",n+1,". ",e.name," (",e.type,") "),h(),C("ngIf",e.vehicleNo)}}function bz(t,i){if(1&t){const e=O();l(0,"div",98)(1,"div",99)(2,"h3"),u(3,"Transportation Vehicle"),c(),l(4,"label",100)(5,"input",101),S("ngModelChange",function(o){_(e);const r=f(3);return x(r.isExternalTransport,o)||(r.isExternalTransport=o),v(o)}),M("change",function(){return _(e),v(f(3).onExternalTransportToggle())}),c(),X(6,"span",94),l(7,"span",95),u(8,"External"),c()()(),l(9,"div",102),D(10,dz,8,2,"ng-container",79)(11,pz,8,4,"ng-template",null,2,qn)(13,fz,6,2,"label",70)(14,mz,2,1,"div",103),c(),l(15,"ul",104),D(16,vz,5,4,"li",36),c()()}if(2&t){const e=$n(12),n=f(3);h(5),w("ngModel",n.isExternalTransport),h(5),C("ngIf",!n.isExternalTransport)("ngIfElse",e),h(3),C("ngIf","Manifestation"===n.manifestationStatus),h(),C("ngIf","Manifestation"===n.manifestationStatus&&n.isSelectedNextDeliveryPointHub()),h(2),C("ngForOf",n.shipmentRoute)}}function yz(t,i){if(1&t){const e=O();l(0,"div"),X(1,"hr"),D(2,cz,15,6,"div",81)(3,bz,17,6,"div",82),l(4,"div",72)(5,"button",5),M("click",function(){return _(e),v(f(2).finalizeManifestation())}),u(6,"Manifest"),c(),l(7,"button",5),M("click",function(){return _(e),v(f(2).closeManifestationPopup())}),u(8,"Cancel"),c()()()}if(2&t){const e=f(2);h(2),C("ngForOf",e.selectedForManifestation),h(),C("ngIf","Will be Picked-Up"!==e.manifestationStatus)}}function Cz(t,i){if(1&t){const e=O();l(0,"p"),u(1,"No consignments selected for manifestation."),c(),l(2,"button",5),M("click",function(){return _(e),v(f(2).closeManifestationPopup())}),u(3,"Close"),c()}}function Mz(t,i){if(1&t){const e=O();l(0,"div",68)(1,"div",74)(2,"span",75),M("click",function(){return _(e),v(f().closeManifestationPopup())}),u(3,"\xd7"),c(),l(4,"div",76)(5,"h2"),u(6,"Manifestation Terminal"),c(),l(7,"label",77)(8,"span"),u(9,"Status"),c(),l(10,"select",20),S("ngModelChange",function(o){_(e);const r=f();return x(r.manifestationStatus,o)||(r.manifestationStatus=o),v(o)}),D(11,tz,2,2,"option",21),c()()(),D(12,nz,4,1,"p",78)(13,yz,9,2,"div",79)(14,Cz,4,0,"ng-template",null,0,qn),c()()}if(2&t){const e=$n(15),n=f();h(10),w("ngModel",n.manifestationStatus),h(),C("ngForOf",n.manifestationStatusOptions),h(),C("ngIf",n.manifestationNumber),h(),C("ngIf",n.selectedForManifestation.length>0)("ngIfElse",e)}}function Iz(t,i){if(1&t){const e=O();l(0,"li")(1,"span"),u(2),c(),l(3,"button",110),M("click",function(){const o=_(e).$implicit;return v(f(2).removeSelection(o))}),u(4,"Remove"),c()()}if(2&t){const e=i.$implicit;h(2),N(e.consignmentNumber)}}function wz(t,i){if(1&t){const e=O();l(0,"div",68)(1,"div",69)(2,"h3"),u(3,"Are you sure you want to cancel the below list? This cannot be reverted! You can always edit it"),c(),l(4,"ul",109),D(5,Iz,5,1,"li",36),c(),l(6,"div",72)(7,"button",5),M("click",function(){return _(e),v(f().confirmCancelSelection())}),u(8,"Ok"),c(),l(9,"button",5),M("click",function(){return _(e),v(f().closeCancelPopup())}),u(10,"Cancel"),c()()()()}if(2&t){const e=f();h(5),C("ngForOf",e.getSelectedConsignments())}}let Sz=(()=>{class t{constructor(e,n){this.http=e,this.branchService=n,this.allStocks=[],this.stocks=[],this.filteredStocks=[],this.activeTab="stocks",this.searchText="",this.filterDate="",this.filterConsignor="",this.selectedHubFilterId=null,this.selectedHubFilterName="",this.selectedStock=null,this.editingStock=null,this.billingType="consignor",this.billingName="",this.billingAddress="",this.billingGSTIN="",this.billingPhone="",this.clientList=[],this.guestList=[],this.pkgList=[],this.productList=[],this.transportPartners=[],this.selectedTransportPartnerId="",this.pickupType="consignor",this.pickupName="",this.pickupAddress="",this.pickupPhone="",this.deliveryType="consignee",this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.consignorTab="consignor",this.consigneeTab="consignee",this.email="",this.username="",this.isAdmin="admin"===String(localStorage.getItem("role")||"").toLowerCase(),this.branch=localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.consignmentNumber=localStorage.getItem("consignmentNumber")||"-999",this.date=(new Date).toISOString().split("T")[0],this.ewaybillNumber="",this.consignor="",this.consignorGST="",this.consignorAddress="",this.consignorPhone="",this.consignee="",this.consigneeGST="",this.consigneeAddress="",this.consigneePhone="",this.paymentMode="Account Credit",this.externalRefId="",this.invoices=[{number:"",value:0}],this.packages=[{type:"",amount:1}],this.products=[{type:"",amount:1}],this.charges={odc:0,unloading:0,docket:0,other:0,ccc:0},this.finalAmount=0,this.shipmentStatus="Pending",this.shipmentStatusDetails="",this.manifestationStatusOptions=["Manifestation","Out for Delivery","Will be Picked-Up"],this.manifestationStatus="Manifestation",this.isExternalTransport=!1,this.branches=[],this.hubs=[],this.availableRoutePoints=[],this.shipmentRoute=[],this.selectedRoutePoint=null,this.selectedRouteVehicle="",this.selectedNextDeliveryPoint="",this.showCancelPopup=!1,this.onStorageChange=o=>{if("branch"===o.key||"originLocId"===o.key){const r=localStorage.getItem("branch")||"All Branches",s=localStorage.getItem("originLocId")||"all";(r!==this.branch||s!==this.originLocId)&&(this.branch=r,this.originLocId=s,"all-hubs"!==this.originLocId&&(this.selectedHubFilterId=null,this.selectedHubFilterName=""),this.loadStocks())}},this.showManifestAdjustmentPopup=!1,this.pendingManifestAdjustment=null,this.manifestAdjustments=[],this.manifestAdjustmentLines=[],this.manifestEditsById={},this.showManifestationPopup=!1,this.selectedForManifestation=[],this.manifestationNumber=""}addInvoice(){this.editingStock.invoices.push({number:"",value:0,packages:[],products:[]})}deleteInvoice(e){this.editingStock.invoices.splice(e,1)}addPackage(e){const n=this.editingStock.invoices[e];n.packages||(n.packages=[]),n.packages.push({type:"",amount:1})}deletePackage(e,n){const o=this.editingStock.invoices[e];o.packages&&o.packages.length>n&&o.packages.splice(n,1)}addProduct(e){const n=this.editingStock.invoices[e];n.products||(n.products=[]),n.products.push({type:"",amount:1,instock:0,intransitstock:0,deliveredstock:0})}deleteProduct(e,n){const o=this.editingStock.invoices[e];if(o.products&&o.products.length>n){if(this.isProductManifested(o.products[n]))return void alert("This product has been manifested and cannot be deleted.");o.products.splice(n,1)}}calculateFinalAmount(){const e=this.editingStock.invoices.reduce((r,s)=>r+(s.value||0),0),n=this.editingStock.packages.reduce((r,s)=>r+(s.amount||0),0),o=Object.values(this.charges).reduce((r,s)=>r+(Number(s)||0),0);this.editingStock.finalAmount=e+n+o}loadStocks(){const e=this.username||localStorage.getItem("username")||"",n=this.originLocId||localStorage.getItem("originLocId")||"all";if(!e)return void console.error("Missing username for loading stocks");const o="stocks"===this.activeTab?n:"all",r="all-hubs"===o?"all":o,s={username:e},a=this.getSelectedOrigin(r);a?(s.originType=a.originType,s.originLocId=a.originLocId):s.originLocId=r,this.http.get("http://localhost:3000/api/newshipments",{params:s}).subscribe({next:d=>{console.log("[stocks][load]",{originLocId:n,branchParam:r,activeTab:this.activeTab,count:Array.isArray(d)?d.length:0});const p=(d||[]).map(g=>({...g,branch:g.branch||g.branchName||"",invoices:this.flattenInvoices(g.ewaybills||g.invoices||[])}));this.allStocks=p,this.refreshStocksView()},error:d=>console.error("Error loading shipments:",d)})}flattenInvoices(e){return(e||[]).flatMap(n=>n.invoices||[])}getInStockAmountTotal(e){let n=0;return(e||[]).forEach(o=>{(o.products||[]).forEach(r=>{n+=Number(r.instock||0)})}),n}getInvoiceAmountTotal(e){let n=0;return(e||[]).forEach(o=>{(o.products||[]).forEach(r=>{n+=Number(r.amount||0)})}),n}getProductTotal(e,n){let o=0;return e.forEach(r=>{r.invoices.forEach(s=>{s.products.forEach(a=>{o+=a[n]||0})})}),o}isDeliveryStatus(e){return"DPending"===e||"DManifestation"===e||"D-Out for Delivery"===e||"D-|Will be Picked-Up"===e}isDeliveryStatusForOthers(e){return"DPending"===e||"DManifestation"===e||"D-Out for Delivery"===e||"D-|Will be Picked-Up"===e}isCompanyMatch(e){const n=String(localStorage.getItem("GSTIN_ID")||"").trim();if(!n)return!0;const o=String(e?.GSTIN_ID??e?.gstinId??"").trim();return!!o&&o===n}getBaseStocks(){const e=this.originLocId||localStorage.getItem("originLocId")||"all";return"all"===e?(this.allStocks||[]).filter("others-in-branch"===this.activeTab?n=>{if("DPending"!==String(n.shipmentStatus||"").trim())return!1;const r=this.getOriginId(n),s=this.normalizeId(n.currentLocationId||n.currentBranch);return r&&s&&r!==s}:n=>"Pending"===String(n.shipmentStatus||"").trim()):"others-in-branch"===this.activeTab?e&&"all"!==e?(this.allStocks||[]).filter("all-hubs"===e?n=>{if("DPending"!==String(n.shipmentStatus||"").trim())return!1;const r=this.normalizeId(n.currentLocationId||n.currentBranch),s=this.getOriginId(n)||r,a=this.normalizeId(this.selectedHubFilterId),d=a?String((this.hubs||[]).find(m=>this.normalizeId(m?._id)===a)?.hubName||"").trim():"",p=String(n.currentBranch||"").trim(),g=!!a&&(r===a||String(p).toLowerCase()===String(d).toLowerCase()||this.matchesBranchLabel(p,d));return a&&s&&s!==a&&g}:n=>{const o=this.normalizeId(n.currentLocationId||n.currentBranch),r=this.getOriginId(n);if("DPending"!==String(n.shipmentStatus||"").trim())return!1;const a=this.normalizeId(e);return o&&a&&o===a&&r&&r!==o}):[]:(this.allStocks||[]).filter(n=>{if("Pending"!==String(n.shipmentStatus||"").trim())return!1;if(!e||"all"===e)return!0;if("all-hubs"===e){const a=this.getOriginId(n)||this.normalizeId(n.currentLocationId||n.currentBranch);return this.isHubLinkedToAssignedBranch(a)}const r=this.normalizeId(n.currentLocationId||n.currentBranch),s=this.normalizeId(e);return r&&s&&r===s})}refreshStocksView(){this.stocks=this.getBaseStocks().sort((e,n)=>new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()),this.applyFilters()}setActiveTab(e){this.activeTab!==e&&(this.activeTab=e,this.loadStocks())}applyFilters(){const e=this.originLocId||localStorage.getItem("originLocId")||"all",n=this.normalizeId(this.selectedHubFilterId),o="all-hubs"===e;if(o&&!n){const a=this.normalizeId(localStorage.getItem("hubId")),d=String(localStorage.getItem("hubName")||"").trim();if(a){const p=(this.hubs||[]).find(g=>this.normalizeId(g?._id)===a);this.selectedHubFilterId=a,this.selectedHubFilterName=String(p?.hubName||d||"").trim()}else{const p=this.getAllHubsFilterOptions(),g=this.normalizeId(p?.[0]?._id);this.selectedHubFilterId=g||null,this.selectedHubFilterName=String(p?.[0]?.hubName||"").trim()}}const r=this.normalizeId(this.selectedHubFilterId);if(r&&!this.selectedHubFilterName){const a=(this.hubs||[]).find(d=>this.normalizeId(d?._id)===r);this.selectedHubFilterName=String(a?.hubName||"").trim()}const s=this.selectedHubFilterName;this.filteredStocks=this.stocks.filter(a=>(!this.searchText||a.consignmentNumber?.includes(this.searchText)||a.consignor?.includes(this.searchText))&&(!this.filterDate||new Date(a.date).toISOString().split("T")[0]===this.filterDate)&&(!this.filterConsignor||a.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()))&&(!o||r&&this.matchesHubFilter(a,r,s)))}onHubFilterChange(e){this.selectedHubFilterId=e;const n=(this.hubs||[]).find(o=>this.normalizeId(o?._id)===this.normalizeId(e));this.selectedHubFilterName=String(n?.hubName||"").trim(),e&&(localStorage.setItem("hubId",String(e)),localStorage.setItem("hubName",this.selectedHubFilterName)),this.refreshStocksView()}matchesHubFilter(e,n,o){if(!n)return!1;const r=!!o;if("others-in-branch"===this.activeTab){const s=this.normalizeId(e?.currentLocationId||e?.currentBranch),a=String(e?.currentBranch||"").trim();return s===n||r&&a.toLowerCase()===o.toLowerCase()||r&&this.matchesBranchLabel(a,o)}return this.getStockHubId(e)===n}getAllHubsFilterOptions(){return this.isAdmin?this.hubs||[]:(this.hubs||[]).filter(e=>this.isHubLinkedToAssignedBranch(this.normalizeId(e?._id)))}getStockHubId(e){return this.normalizeId(e?.originLocId)||this.normalizeId(e?.currentLocationId||e?.currentBranch)}getStockCurrentHubId(e){const n=this.normalizeId(e?.currentLocationId||e?.currentBranch);if(!n)return"";const o=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===n);if(o?._id)return this.normalizeId(o._id);const r=String(e?.currentBranch||"").trim().toLowerCase();if(!r)return"";const s=(this.hubs||[]).find(a=>String(a?.hubName||"").trim().toLowerCase()===r);return s?._id?this.normalizeId(s._id):""}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}getOriginId(e){return e?this.normalizeId(e?.originLocId||e?.originLocId||e?.originLocId||e?.branch):""}getSelectedOrigin(e=null){const n=(e||this.originLocId||localStorage.getItem("originLocId")||"all").toLowerCase();if(!n||"all"===n)return null;if("all-hubs"===n){const r=this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId"));return r?{originType:"hub",originLocId:r}:null}const o=this.normalizeId(n);return o?{originType:"branch",originLocId:o}:null}getoriginLocIdByName(e){const n=String(e||"").trim().toLowerCase();if(!n)return"";const o=(this.branches||[]).find(r=>String(r?.branchName||"").trim().toLowerCase()===n);return o?._id?String(o._id):""}getBranchNameById(e){const n=this.normalizeId(e);if(!n)return"";const o=(this.branches||[]).find(r=>this.normalizeId(r?._id)===n);return o?.branchName?String(o.branchName):""}isCurrentBranchMatch(e,n){if(!e||!n)return!1;if(this.normalizeId(e)===this.normalizeId(n))return!0;const o=this.getBranchNameById(n);if(o&&String(e||"").trim().toLowerCase()===String(o).trim().toLowerCase()||this.matchesBranchLabel(String(e||""),String(o||"")))return!0;const r=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===this.normalizeId(e));if(!r?.branch)return!1;const s=this.getoriginLocIdByName(r.branch);return!!s&&this.normalizeId(s)===this.normalizeId(n)}getDeliveryDisplayName(e){const n=String(e?.deliveryName||"").trim();if(n)return n;const o=this.normalizeId(e?.deliveryID);if(!o)return"-";const r=(this.branches||[]).find(d=>this.normalizeId(d?._id)===o);if(r?.branchName)return r.branchName;const s=(this.clientList||[]).find(d=>this.normalizeId(d?._id)===o);if(s?.clientName)return s.clientName;const a=(this.guestList||[]).find(d=>this.normalizeId(d?._id)===o);return a?.guestName?a.guestName:o}formatLocationDisplay(e,n){const o=this.normalizeId(e),r=String(n||"").trim();let s=o,a="";const d=o?(this.branches||[]).find(g=>this.normalizeId(g?._id)===o):null;if(d?._id)s=this.normalizeId(d._id),a=String(d.branchName||"").trim();else{const g=o?(this.hubs||[]).find(m=>this.normalizeId(m?._id)===o):null;g?._id&&(s=this.normalizeId(g._id),a=String(g.hubName||"").trim())}if(!a&&r){const g=r.toLowerCase(),m=(this.branches||[]).find(b=>String(b?.branchName||"").trim().toLowerCase()===g);if(m?._id)s=this.normalizeId(m._id),a=String(m.branchName||"").trim();else{const b=(this.hubs||[]).find(y=>String(y?.hubName||"").trim().toLowerCase()===g);b?._id&&(s=this.normalizeId(b._id),a=String(b.hubName||"").trim())}}const p=a||r||s||"-";return s&&p.toLowerCase()!==String(s).toLowerCase()?`${p}$$${s}`:p}getCurrentBranchLabel(e){return this.formatLocationDisplay(e?.currentLocationId||e?.currentBranch,e?.currentBranch)}getOriginBranchLabel(e){return this.formatLocationDisplay(e?.originLocId||e?.branch,e?.branch||e?.branchName)}firstNonEmpty(...e){for(const n of e){if(null==n)continue;const o=String(n).trim();if(o)return o}return"-"}resolveClientByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.clientList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.clientName||"").trim().toLowerCase()===r)||null}resolveGuestByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.guestList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.guestName||"").trim().toLowerCase()===r)||null}resolveBranchByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.branches||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.branchName||"").trim().toLowerCase()===r)||null}resolveHubByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.hubs||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.hubName||"").trim().toLowerCase()===r)||null}isHubLinkedToAssignedBranch(e){if(this.isAdmin)return!!String(e||"").trim();const n=this.getAssignedoriginLocIds();if(!n.length)return!1;const o=this.resolveHubByIdOrName(e,e);return!!o&&n.includes(this.normalizeId(o?.originLocId))}getAssignedoriginLocIds(){try{const e=JSON.parse(localStorage.getItem("originLocIds")||"[]");return Array.isArray(e)?e.map(n=>String(n||"").trim()).filter(n=>n):[]}catch{return[]}}resolveBranchByName(e){const n=String(e||"").trim().toLowerCase();return n&&(this.branches||[]).find(o=>String(o?.branchName||"").trim().toLowerCase()===n)||null}resolveHubByName(e){const n=String(e||"").trim().toLowerCase();return n&&(this.hubs||[]).find(o=>String(o?.hubName||"").trim().toLowerCase()===n)||null}resolveBranchByVehicle(e){const n=String(e||"").trim().toLowerCase();return n&&(this.branches||[]).find(o=>(o?.vehicles||[]).some(r=>String(r?.vehicleNo||"").trim().toLowerCase()===n))||null}resolveHubByVehicle(e){const n=String(e||"").trim().toLowerCase();return n&&(this.hubs||[]).find(o=>(o?.deliveryAddresses||[]).some(r=>(r?.vehicles||[]).some(s=>String(s?.vehicleNo||"").trim().toLowerCase()===n)))||null}resolveClientLocation(e,n){if(!e)return null;const o=this.normalizeId(n),r=e?.deliveryLocations||[];return o?r.find(s=>this.normalizeId(s?.delivery_id)===o)||null:r[0]||null}getNextDeliveryPointId(e){const n=String(e||"").trim();if(!n)return"";const o=(this.branches||[]).find(s=>String(s?.branchName||"").trim()===n);if(o?._id)return String(o._id);const r=(this.hubs||[]).find(s=>String(s?.hubName||"").trim()===n);return r?._id?String(r._id):""}enrichShipmentDetails(e){const n={...e},o=this.firstNonEmpty(e?.branchName,e?.branch),r=this.resolveBranchByIdOrName(e?.originLocId,o);n.branch=this.firstNonEmpty(r?.branchName,o);const s="guest"===e?.consignorTab?this.resolveGuestByIdOrName(e?.consignorId,e?.consignor):this.resolveClientByIdOrName(e?.consignorId,e?.consignor),a="guest"===e?.consigneeTab?this.resolveGuestByIdOrName(e?.consigneeId,e?.consignee):this.resolveClientByIdOrName(e?.consigneeId,e?.consignee);if(n.consignor=this.firstNonEmpty(n.consignor,s?.clientName,s?.guestName),n.consignorGST=this.firstNonEmpty(n.consignorGST,s?.GSTIN,"guest"===e?.consignorTab?"GUEST":""),n.consignorPhone=this.firstNonEmpty(n.consignorPhone,s?.phoneNum),n.consignorAddress=this.firstNonEmpty(n.consignorAddress,s?.address),n.consignee=this.firstNonEmpty(n.consignee,a?.clientName,a?.guestName),n.consigneeGST=this.firstNonEmpty(n.consigneeGST,a?.GSTIN,"guest"===e?.consigneeTab?"GUEST":""),n.consigneePhone=this.firstNonEmpty(n.consigneePhone,a?.phoneNum),n.consigneeAddress=this.firstNonEmpty(n.consigneeAddress,a?.address),"consignor"===e?.billingType)n.billingName=this.firstNonEmpty(n.billingName,n.consignor),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,n.consignorGST),n.billingPhone=this.firstNonEmpty(n.billingPhone,n.consignorPhone),n.billingAddress=this.firstNonEmpty(n.billingAddress,n.consignorAddress);else{const p=this.resolveClientByIdOrName(e?.billingClientId,e?.billingName);n.billingName=this.firstNonEmpty(n.billingName,p?.clientName),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,p?.GSTIN),n.billingPhone=this.firstNonEmpty(n.billingPhone,p?.phoneNum),n.billingAddress=this.firstNonEmpty(n.billingAddress,p?.address)}if("branch"===e?.pickupType){const p=this.resolveBranchByIdOrName(e?.pickupLocationId,e?.pickupName)||this.resolveBranchByIdOrName(null,e?.branch);n.pickupName=this.firstNonEmpty(n.pickupName,p?.branchName),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,p?.address),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,p?.phoneNum),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,p?.pinCode)}else"consignor"===e?.pickupType&&(n.pickupName=this.firstNonEmpty(n.pickupName,n.consignor),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,n.consignorAddress),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,n.consignorPhone),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,s?.pinCode));if("Customer self pick up"===e?.deliveryType||"branch"===e?.deliveryType||"hub"===e?.deliveryType){const p=this.resolveBranchByIdOrName(e?.deliveryID,e?.deliveryName),g=p?null:this.resolveHubByIdOrName(e?.deliveryID,e?.deliveryName);n.deliveryName=this.firstNonEmpty(n.deliveryName,p?.branchName,g?.hubName),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,p?.address,g?.address),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,p?.phoneNum,g?.phoneNum),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,p?.pinCode,g?.pinCode)}else{const p=this.resolveClientByIdOrName(e?.deliveryID,e?.deliveryName),g=this.resolveGuestByIdOrName(e?.deliveryID,e?.deliveryName),m=this.resolveClientLocation(p,e?.deliveryLocationId);n.deliveryName=this.firstNonEmpty(n.deliveryName,p?.clientName,g?.guestName,n.consignee),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,m?.address,p?.address,g?.address,n.consigneeAddress),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,p?.phoneNum,g?.phoneNum,n.consigneePhone),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,m?.pinCode,p?.pinCode,g?.pinCode)}return n}toggleAllSelection(e){const n=e.target.checked;this.filteredStocks.forEach(o=>{o.selected=n})}clearSelection(){this.filteredStocks.forEach(e=>{e.selected=!1}),this.selectedForManifestation=[]}hasSelectedConsignment(){return(this.filteredStocks||[]).some(e=>e.selected)}openCancelPopup(){"all"!==String(this.originLocId||"").trim().toLowerCase()?this.hasSelectedConsignment()&&(this.showCancelPopup=!0):alert("Please select a specific branch for canceling")}closeCancelPopup(){this.showCancelPopup=!1}getSelectedConsignments(){return(this.filteredStocks||[]).filter(e=>e.selected)}removeSelection(e){e&&(e.selected=!1)}confirmCancelSelection(){const e=this.getSelectedConsignments();e.length?Pn(e.map(o=>{const r=o?._id?encodeURIComponent(o._id):"",s=r?`?shipmentId=${r}`:"",a={...o,shipmentStatus:"Deleted from Stocks"};return this.http.put(`http://localhost:3000/api/newshipments/${o.consignmentNumber}${s}`,a)})).subscribe({next:()=>{this.closeCancelPopup(),this.clearSelection(),this.loadStocks()},error:o=>{console.error("Error cancelling consignments:",o),alert("Failed to cancel consignments. Please try again.")}}):this.closeCancelPopup()}openStockDetails(e){this.selectedStock=this.enrichShipmentDetails(e)}closeStockDetails(){this.selectedStock=null}editStock(e){console.log("Edit stock:",e);const n=JSON.parse(JSON.stringify(e));n.invoices=this.flattenInvoices(n.ewaybills||n.invoices||[]),this.editingStock=n,this.manifestEditsById={},this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1,this.captureOriginalProductValues(this.editingStock)}saveStockEdit(){if(!this.editingStock||(this.pendingManifestAdjustment||this.showManifestAdjustmentPopup)&&(this.applyManifestAdjustments(),this.pendingManifestAdjustment||this.showManifestAdjustmentPopup))return;this.editingStock.shipmentStatus="To Pay"===this.editingStock.paymentMode?"To Pay":"Pending",this.syncEwaybillsFromInvoices();const e=this.buildShipmentPayload();e.paymentMode=this.editingStock.paymentMode,e.shipmentStatus=this.editingStock.shipmentStatus,e.shipmentStatusDetails=this.editingStock.shipmentStatusDetails;const n=Object.values(this.manifestEditsById||{});(n.length?Pn(n.map(r=>this.http.put(`http://localhost:3000/api/manifest/${r._id}`,r))):Q([])).subscribe({next:()=>{const r=this.editingStock?.consignmentNumber,s=this.editingStock?._id;console.log("[stocks:update] payload",{consignmentNumber:r,paymentMode:e.paymentMode,shipmentStatus:e.shipmentStatus});const a=s?`?shipmentId=${encodeURIComponent(s)}`:"";this.http.put(`http://localhost:3000/api/newshipments/${r}${a}`,e).subscribe({next:d=>{console.log("[stocks:update] response",{shipmentStatus:d?.shipmentStatus,paymentMode:d?.paymentMode}),this.loadStocks(),this.editingStock=null},error:d=>console.error("Error updating stock:",d)})},error:r=>{console.error("Error updating manifests:",r),alert("Failed to update manifests. Please try again.")}})}cancelEdit(){this.editingStock=null,this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}captureOriginalProductValues(e){(e?.invoices||[]).forEach(n=>{(n.products||[]).forEach(o=>{o._originalAmount=Number(o.amount)||0,o._originalInstock=Number(o.instock)||0,o._originalIntransit=Number(o.intransitstock)||0,o._originalDelivered=Number(o.deliveredstock)||0})})}resetProductToOriginal(e){e.amount=Number(e._originalAmount)||0,e.instock=Number(e._originalInstock)||0,e.intransitstock=Number(e._originalIntransit)||0,e.deliveredstock=Number(e._originalDelivered)||0}normalizeInvoiceNumber(e){return String(e?.number||e?.invoicenum||"").trim()}normalizeProductType(e){return String(e?.type||"").trim()}getManifestTotals(){const e=this.manifestAdjustmentLines||[],n=e.filter(s=>s?.isDelivered).reduce((s,a)=>s+(Number(a.newManifestQty)||0),0),o=e.reduce((s,a)=>s+(Number(a.newManifestQty)||0),0);return{manifestTotal:o,deliveredTotal:n,intransitTotal:Math.max(0,o-n)}}syncEwaybillsFromInvoices(){if(this.editingStock?.ewaybills?.length&&this.editingStock?.invoices?.length)for(const e of this.editingStock.invoices||[]){const n=this.normalizeInvoiceNumber(e);for(const o of this.editingStock.ewaybills||[])for(const r of o.invoices||[])if(this.normalizeInvoiceNumber(r)===n)for(const s of r.products||[]){const a=(e.products||[]).find(d=>this.normalizeProductType(d)===this.normalizeProductType(s));a&&(s.amount=a.amount,s.instock=a.instock,s.intransitstock=a.intransitstock,s.deliveredstock=a.deliveredstock,void 0!==a.manifestQty&&(s.manifestQty=a.manifestQty))}}}applyProductUpdate(e,n,o,r){const s=String(n||"").trim(),a=String(o||"").trim();(e||[]).forEach(d=>{const p=this.normalizeInvoiceNumber(d);s&&p!==s||(d.products||[]).forEach(g=>{this.normalizeProductType(g)===a&&r(g)})})}isProductManifested(e){return Number(e?._originalIntransit??e?.intransitstock??0)>0}onProductAmountFocus(e,n,o){this.isProductManifested(n)&&this.openManifestAdjustmentPopup(e,n,n.amount,o)}onProductAmountChange(e,n,o,r){if(!this.editingStock)return;let s=Number(o);Number.isFinite(s)||(s=0),s<0&&(s=0);const a=Number(n._originalAmount)||0,d=Number(n._originalInstock)||0,p=Number(n._originalIntransit)||0,g=Number(n._originalDelivered)||0;if(!this.isProductManifested(n)){if(s>=a){const y=s-a;return n.amount=s,n.instock=d+y,n.intransitstock=p,void(n.deliveredstock=g)}const b=a-s;return b<=d?(n.amount=s,n.instock=d-b,n.intransitstock=p,void(n.deliveredstock=g)):(alert("Reduction exceeds available in-stock quantity."),void this.resetProductToOriginal(n))}if(a-s>d+p)return alert("Reduction exceeds available in-stock and manifested quantity."),void this.resetProductToOriginal(n);this.pendingManifestAdjustment&&this.pendingManifestAdjustment.productRef===n?(this.pendingManifestAdjustment.targetAmount=s,n.amount=s):this.openManifestAdjustmentPopup(e,n,s,r)}openManifestAdjustmentPopup(e,n,o,r){const s=this.editingStock?.consignmentNumber;if(!s)return;let a=this.normalizeInvoiceNumber(e);!a&&Number.isFinite(r)&&(a=`MAN-${String(s||"").trim()}-${Number(r)+1}`),this.pendingManifestAdjustment={consignmentNumber:s,invoiceNumber:a,productType:this.normalizeProductType(n),targetAmount:Number(o)||0,popupInstock:Number(n._originalInstock)||0,originalAmount:Number(n._originalAmount)||0,originalInstock:Number(n._originalInstock)||0,originalIntransit:Number(n._originalIntransit)||0,originalDelivered:Number(n._originalDelivered)||0,productRef:n},this.http.get(`http://localhost:3000/api/manifest/by-consignment/${encodeURIComponent(s)}`).subscribe({next:d=>{this.manifestAdjustments=d||[],this.buildManifestAdjustmentLines()},error:d=>{console.error("Error loading manifests:",d),alert("Failed to load manifests for adjustment."),this.cancelManifestAdjustments()}})}buildManifestAdjustmentLines(){const e=this.pendingManifestAdjustment;if(!e)return;const n=e.productType,o=e.consignmentNumber,r=[];for(const s of this.manifestAdjustments||[])for(const a of s.consignments||[])if(String(a.consignmentNumber||"").trim()===o)for(const d of a.invoices||[]){const p=this.normalizeInvoiceNumber(d);if(!e.invoiceNumber||p===e.invoiceNumber)for(const g of d.products||[]){if(this.normalizeProductType(g)!==n)continue;const m=Number(g.manifestQty)||0;r.push({manifestId:s._id,manifestationNumber:s.manifestationNumber,date:s.date,manifestStatus:s.mshipmentStatus,consignmentNumber:o,invoiceNumber:p,productType:n,originalManifestQty:m,newManifestQty:m,isDelivered:"delivered"===String(s.mshipmentStatus||"").toLowerCase()})}}if(!r.length)return alert("No manifest lines found for this product."),void this.cancelManifestAdjustments();this.manifestAdjustmentLines=r,this.syncPopupInstockWithTarget(),this.showManifestAdjustmentPopup=!0}onManifestQtyChange(e){let n=Number(e.newManifestQty);Number.isFinite(n)||(n=0),n<0&&(n=0),e.newManifestQty=n;const o=this.pendingManifestAdjustment;if(!o)return;const r=this.getManifestTotals();o.targetAmount=(Number(o.popupInstock)||0)+r.manifestTotal,o.productRef&&(o.productRef.amount=Number(o.targetAmount)||0)}getManifestLineTotal(){return this.getManifestTotals().manifestTotal}getPopupTargetTotal(){const e=this.pendingManifestAdjustment;return e&&Number(e.targetAmount)||0}getPopupDeliveredTotal(){return this.getManifestTotals().deliveredTotal}getPopupInstockTotal(){const e=this.pendingManifestAdjustment;if(!e)return 0;const n=this.getManifestTotals();return(Number(e.targetAmount)||0)-n.manifestTotal}syncPopupInstockWithTarget(){const e=this.pendingManifestAdjustment;if(!e)return;const n=this.getManifestTotals(),r=(Number(e.targetAmount)||0)-n.manifestTotal;e.popupInstock=Math.max(0,r),e.targetAmount=e.popupInstock+n.manifestTotal}syncTargetFromInstock(){const e=this.pendingManifestAdjustment;if(!e)return;const n=Math.max(0,Number(e.popupInstock)||0);e.popupInstock=n;const o=this.getManifestTotals();e.targetAmount=n+o.manifestTotal}onPopupTargetAmountChange(e){const n=this.pendingManifestAdjustment;if(!n)return;let o=Number(e);Number.isFinite(o)||(o=0),o<0&&(o=0),n.targetAmount=o,this.syncPopupInstockWithTarget(),n.productRef&&(n.productRef.amount=o)}onPopupInstockChange(e){const n=this.pendingManifestAdjustment;if(!n)return;let o=Number(e);Number.isFinite(o)||(o=0),o<0&&(o=0),n.popupInstock=o,this.syncTargetFromInstock(),n.productRef&&(n.productRef.amount=Number(n.targetAmount)||0)}applyManifestAdjustments(){const e=this.pendingManifestAdjustment;if(!e)return;const n=this.getManifestTotals(),o=Math.max(0,Number(e.popupInstock)||0),r=o+n.manifestTotal;if(o<0)return void alert("New Total Qty must be at least manifest + delivered quantities.");for(const a of this.manifestAdjustmentLines||[])a.updatedAmount=r,a.updatedInstock=o,a.updatedIntransit=n.intransitTotal,a.updatedDelivered=n.deliveredTotal;for(const a of this.manifestAdjustmentLines||[])this.queueManifestUpdate(a);const s=a=>{a.amount=r,a.instock=o,a.intransitstock=n.intransitTotal,a.deliveredstock=n.deliveredTotal,a.manifestQty=n.manifestTotal};e.productRef&&s(e.productRef),this.applyProductUpdate(this.editingStock?.invoices||[],e.invoiceNumber,e.productType,s),(this.editingStock?.ewaybills||[]).forEach(a=>{this.applyProductUpdate(a.invoices||[],e.invoiceNumber,e.productType,s)}),this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}cancelManifestAdjustments(){const e=this.pendingManifestAdjustment;e?.productRef&&this.resetProductToOriginal(e.productRef),this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}queueManifestUpdate(e){const n=(this.manifestAdjustments||[]).find(o=>o._id===e.manifestId);if(n){for(const o of n.consignments||[])if(String(o.consignmentNumber||"").trim()===e.consignmentNumber)for(const r of o.invoices||[])if(this.normalizeInvoiceNumber(r)===e.invoiceNumber)for(const a of r.products||[])this.normalizeProductType(a)===e.productType&&(a.manifestQty=Number(e.newManifestQty)||0,void 0!==e.updatedAmount&&(a.amount=Number(e.updatedAmount)||0,a.instock=Number(e.updatedInstock)||0,a.intransitstock=Number(e.updatedIntransit)||0,a.deliveredstock=Number(e.updatedDelivered)||0));this.manifestEditsById[n._id]=n}}buildShipmentPayload(){const e=JSON.parse(JSON.stringify(this.editingStock));delete e._id,delete e.consignmentNumber,delete e.GSTIN_ID,delete e.originLocId,delete e.branchName;const n=o=>{delete o._originalAmount,delete o._originalInstock,delete o._originalIntransit,delete o._originalDelivered};return(e.ewaybills||[]).forEach(o=>{(o.invoices||[]).forEach(r=>{(r.products||[]).forEach(s=>n(s))})}),(e.invoices||[]).forEach(o=>{(o.products||[]).forEach(r=>n(r))}),e}onConsignorSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.editingStock.consignorGST=n.GSTIN,this.editingStock.consignorAddress=n.address,this.editingStock.consignorPhone=n.phoneNum)}onConsigneeSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.editingStock.consigneeGST=n.GSTIN,this.editingStock.consigneeAddress=n.address,this.editingStock.consigneePhone=n.phoneNum)}onConsignorGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.editingStock.consignorGST="GUEST",this.editingStock.consignorAddress=n.address,this.editingStock.consignorPhone=n.phoneNum)}onConsigneeGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.editingStock.consigneeGST="GUEST",this.editingStock.editingStock.consigneeAddress=n.address,this.editingStock.editingStock.consigneePhone=n.phoneNum)}onPackageList(e){this.pkgList.find(o=>o.pkgName===e)}onProductList(e){this.productList.find(o=>o.productName===e)}addRoutePoint(){if(!this.selectedRoutePoint)return;const e=this.selectedRouteVehicle||"",o="all-hubs"===this.normalizeId(this.originLocId||localStorage.getItem("originLocId")),r=o?this.normalizeId(this.selectedHubFilterId)||this.normalizeId(localStorage.getItem("hubId")):"",s=r?(this.hubs||[]).find(b=>this.normalizeId(b?._id)===r):null,a=String(s?.hubName||"").trim(),p=String(this.selectedRoutePoint.name||"").trim().toLowerCase(),m=o&&"Branch"===this.selectedRoutePoint.type&&a&&("all hubs"===p||p===String(this.branch||"").trim().toLowerCase())?a:this.selectedRoutePoint.name;this.shipmentRoute.push({name:m,type:this.selectedRoutePoint.type,vehicleNo:e}),this.selectedRoutePoint=null,this.selectedRouteVehicle=""}removeRoutePoint(e){this.shipmentRoute.splice(e,1)}loadBranches(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/branches?email=${e}&vehicleStatusNot=offline`).subscribe({next:n=>{console.log("Branches loaded:",n),this.branches=n,this.updateAvailableRoutePoints(),this.refreshStocksView()},error:n=>console.error("Error loading branches:",n)})}loadHubs(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/hubs?email=${e}&vehicleStatusNot=offline`).subscribe({next:n=>{console.log("Hubs loaded:",n),this.hubs=n,this.updateAvailableRoutePoints(),this.refreshStocksView()},error:n=>console.error("Error loading hubs:",n)})}updateAvailableRoutePoints(){const e=this.normalizeId(this.originLocId||localStorage.getItem("originLocId")),n="all-hubs"===e,o=this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId")),r=n?o:e,s=!!r&&"all"!==r&&"all-hubs"!==r,a=s?String((this.branches||[]).find(m=>this.normalizeId(m?._id)===r)?.branchName||(this.hubs||[]).find(m=>this.normalizeId(m?._id)===r)?.hubName||"").trim().toLowerCase():"",d=m=>s?(m||[]).filter(b=>{const y=this.normalizeId(b?.currentLocationId||b?.currentBranch);if(y&&y===r)return!0;if(!a)return!1;const I=String(b?.currentBranch||"").trim().toLowerCase();return!(!I||I!==a)||!!I&&this.matchesBranchLabel(I,a)}):m,p=[...this.branches.map(m=>({name:m.branchName,type:"Branch",vehicles:d(m.vehicles||[]).map(b=>b.vehicleNo).filter(Boolean)})),...this.hubs.map(m=>({name:m.hubName,type:"Hub",vehicles:(m.deliveryAddresses||[]).flatMap(b=>d(b.vehicles||[]).map(y=>y.vehicleNo)).filter(Boolean)}))],g=a.trim().toLowerCase();this.availableRoutePoints=g?p.filter(m=>String(m?.name||"").trim().toLowerCase()!==g):p}onRoutePointChange(){this.selectedRouteVehicle=this.selectedRoutePoint?.vehicles?.[0]||""}onNextDeliveryPointChange(){this.ensureHubChargesForSelectedConsignments(),!this.isExternalTransport&&this.onRouteVehicleChange()}getSelectedNextHub(){const e=String(this.selectedNextDeliveryPoint||"").trim();return e&&(this.hubs||[]).find(n=>String(n?.hubName||"").trim()===e)||null}getSelectedNextRoutePoint(){const e=String(this.selectedNextDeliveryPoint||"").trim();return e&&(this.availableRoutePoints||[]).find(n=>String(n?.name||"").trim()===e)||null}getNextDeliveryPointVehicles(){const e=this.getSelectedNextRoutePoint();return e?.vehicles?.length?e.vehicles:[]}isSelectedNextDeliveryPointHub(){return!!String(this.selectedNextDeliveryPoint||"").trim()&&"Hub"===this.getSelectedNextRoutePoint()?.type}getHubChargeTotal(){return this.isSelectedNextDeliveryPointHub()?(this.selectedForManifestation||[]).reduce((e,n)=>e+(Number(n?.hubPerRevAmount)||0),0):0}getHubChargeSuggestion(e){const n=this.getSelectedNextHub();if(!n)return 0;const o=Number(n?.perRev)||0,s=(Number(e?.finalAmount)||0)*o/100;return Math.round(100*s)/100}ensureHubChargesForSelectedConsignments(){if(this.isSelectedNextDeliveryPointHub()&&this.getSelectedNextHub())for(const n of this.selectedForManifestation||[]){if(n?.hubWillPickedUp){n.hubPerRevAmount=0;continue}const o=this.getHubChargeSuggestion(n);n.hubPerRevAmount=o}}onHubPickedUpToggle(e){if(e){if(e.hubWillPickedUp)return void(e.hubPerRevAmount=0);e.hubPerRevAmount=this.getHubChargeSuggestion(e)}}onTransportPartnerChange(){this.selectedRouteVehicle="",this.shipmentRoute=[]}onExternalTransportToggle(){this.selectedTransportPartnerId="",this.selectedRouteVehicle="",this.shipmentRoute=[]}onRouteVehicleChange(){const e=String(this.selectedRouteVehicle||"").trim();if(!e)return void(this.shipmentRoute=[]);if(this.isExternalTransport){const s=this.transportPartners.find(d=>String(d._id)===String(this.selectedTransportPartnerId)),a=String(s?.partnerName||"").trim();return void(this.shipmentRoute=[{name:a||"Transport Partner",type:"Transport Partner",vehicleNo:e}])}const n=this.getSelectedNextRoutePoint();this.shipmentRoute=[{name:n?.name||this.branch||"Branch",type:n?.type||"Branch",vehicleNo:e}]}getTransportPartnerVehicles(){const e=this.transportPartners.find(o=>String(o._id)===String(this.selectedTransportPartnerId));return(e?.vehicleNumbers||e?.vehicles||[]).filter(o=>{if("string"==typeof o)return!0;const r=String(o?.vehicleStatus||"online").toLowerCase();return"online"===r||"scheduled"===r}).map(o=>"string"==typeof o?o:o?.number||o?.vehicleNo||o?.vehicleNumber||o?.regNo||"").filter(Boolean)}getBranchVehicles(){const e=this.normalizeId(this.originLocId||localStorage.getItem("originLocId")),o=String(this.branch||localStorage.getItem("branch")||"").trim().toLowerCase(),r="all-hubs"===e||"all hubs"===o,s=r?this.normalizeId(this.selectedHubFilterId)||this.normalizeId(this.getSelectedNextHub()?._id)||this.normalizeId(localStorage.getItem("hubId")):"",a=r?s:e,d=a?String((this.branches||[]).find(y=>this.normalizeId(y?._id)===a)?.branchName||(this.hubs||[]).find(y=>this.normalizeId(y?._id)===a)?.hubName||"").trim():"";if(!a||"all"===a||"all-hubs"===a)return[];const m=[...(this.branches||[]).flatMap(y=>y?.vehicles||[]),...(this.hubs||[]).flatMap(y=>(y?.deliveryAddresses||[]).flatMap(I=>I?.vehicles||[]))],b=new Set;return m.filter(y=>{const I=y?.currentLocationId||y?.currentBranch||y?.currentBranch||"",P=this.normalizeId(I);return!!P&&!!(this.isCurrentBranchMatch(P,a)||d&&this.matchesBranchLabel(String(I||""),d)||d&&this.matchesBranchLabel(String(P||""),d))}).map(y=>"string"==typeof y?y:y?.vehicleNo||y?.number||y?.vehicleNumber||"").filter(y=>!(!y||b.has(y)||(b.add(y),0)))}getManifestationTargetBranch(){const e=(this.selectedForManifestation||[])[0];if(!e)return null;const n=this.normalizeId(e?.currentLocationId||e?.currentBranch||e?.currentBranch);if(n){const a=(this.branches||[]).find(p=>this.normalizeId(p?._id)===n);if(a?.branchName)return{id:n,name:String(a.branchName).trim()};const d=(this.hubs||[]).find(p=>this.normalizeId(p?._id)===n);return d?.hubName?{id:n,name:String(d.hubName).trim()}:{id:n,name:""}}const o=String(e?.currentBranch||"").trim();if(!o)return null;const r=(this.hubs||[]).find(a=>String(a?.hubName||"").trim().toLowerCase()===o.toLowerCase());if(r?._id)return{id:this.normalizeId(r._id),name:String(r.hubName).trim()};const s=(this.branches||[]).find(a=>String(a?.branchName||"").trim().toLowerCase()===o.toLowerCase());return s?._id?{id:this.normalizeId(s._id),name:String(s.branchName).trim()}:{id:"",name:o}}resolveManifestEntityType(e){return e?(this.hubs||[]).find(o=>this.normalizeId(o?._id)===this.normalizeId(e))?._id?"hub":"branch":""}resolveManifestVehicleNo(){const e=String(this.selectedRouteVehicle||"").trim();if(e)return e;const n=(this.shipmentRoute||[]).find(r=>String(r?.vehicleNo||"").trim());if(n?.vehicleNo)return String(n.vehicleNo).trim();const o=(this.selectedForManifestation||[]).find(r=>String(r?.currentVehicleNo||"").trim());return o?String(o.currentVehicleNo||"").trim():""}createManifestRecord(e){const n=String(this.manifestationStatus||"Manifested").trim(),o="Manifestation"===n?"Scheduled":n,r="will be picked-up"===n.toLowerCase(),s=String(this.selectedNextDeliveryPoint||"").trim(),a=!r&&s?this.getNextDeliveryPointId(s):"",d=!r&&s?this.getSelectedNextRoutePoint():null,p=d?.type?String(d.type).toLowerCase():"",g=this.normalizeId("all-hubs"===this.originLocId?this.selectedHubFilterId||localStorage.getItem("hubId"):this.originLocId),m=g,b=this.resolveManifestEntityType(m);if(!b||!m){const T=g;if(!T)return void alert("Cannot create manifest: missing branch/hub context.");const A=this.resolveManifestEntityType(T);if(!A)return void alert("Cannot create manifest: invalid branch/hub context.");console.warn("[manifest] Missing entity for manifest creation, using fallback.",{fallbackType:A,fallbackEntityId:T});const E=this.resolveManifestVehicleNo();if(!E&&!r)return void alert("Cannot create manifest: missing vehicle number.");const V=(e||[]).map(G=>({shipmentId:G?._id||"",consignmentNumber:G?.consignmentNumber||""})).filter(G=>G.shipmentId||G.consignmentNumber);if(!V.length)return;return void this.http.post("http://localhost:3000/api/manifests",{entityType:A,entityId:T,deliveryType:p||void 0,deliveryId:a||void 0,vehicleNo:E,status:o,consignments:V}).subscribe({next:G=>{const te=G?.manifest?.manifestNumber||"";te?(this.manifestationNumber=te,console.log("[manifest] created",te),alert(`Manifest created: ${te}`)):alert("Manifest created, but no number returned.")},error:G=>{console.error("Failed to create manifest record",G);const te=String(G?.error?.message||"").trim();alert(te||"Failed to create manifest number. Please try again.")}})}const y=this.resolveManifestVehicleNo();if(!y&&!r)return void alert("Cannot create manifest: missing vehicle number.");const I=(e||[]).map(T=>({shipmentId:T?._id||"",consignmentNumber:T?.consignmentNumber||""})).filter(T=>T.shipmentId||T.consignmentNumber);I.length&&this.http.post("http://localhost:3000/api/manifests",{entityType:b,entityId:m,deliveryType:p||void 0,deliveryId:a||void 0,vehicleNo:y,status:o,consignments:I}).subscribe({next:T=>{const A=T?.manifest?.manifestNumber||"";A?(this.manifestationNumber=A,console.log("[manifest] created",A),alert(`Manifest created: ${A}`)):alert("Manifest created, but no number returned.")},error:T=>{console.error("Failed to create manifest record",T);const A=String(T?.error?.message||"").trim();alert(A||"Failed to create manifest number. Please try again.")}})}matchesBranchLabel(e,n){const o=String(e||"").trim().toLowerCase(),r=String(n||"").trim().toLowerCase();if(!o||!r)return!1;if(r===o||r.startsWith(`${o}-`))return!0;const s=r.split("-")[0].trim();return!!s&&s===o}onEditingPaymentModeChange(){this.editingStock&&(this.editingStock.shipmentStatus="To Pay"===this.editingStock.paymentMode?"To Pay":"Pending")}ngOnInit(){this.email=localStorage.getItem("email")||"",this.username=localStorage.getItem("username")||"",this.branch=this.branchService.currentBranch||localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.branchSub=this.branchService.branch$.subscribe(s=>{this.branch=s,this.originLocId=localStorage.getItem("originLocId")||"all","all-hubs"!==this.originLocId&&(this.selectedHubFilterId=null,this.selectedHubFilterName=""),this.loadStocks()}),this.branchCheck=setInterval(()=>{const s=localStorage.getItem("branch")||"All Branches",a=localStorage.getItem("originLocId")||"all";(s!==this.branch||a!==this.originLocId)&&(this.branch=s,this.originLocId=a,"all-hubs"!==this.originLocId&&(this.selectedHubFilterId=null,this.selectedHubFilterName=""),this.loadStocks())},1e3),window.addEventListener("storage",this.onStorageChange),this.http.get(`http://localhost:3000/api/clients/clientslist?emailId=${this.email}`).subscribe({next:s=>this.clientList=s,error:s=>console.error("Error fetching client list",s),complete:()=>console.log("Client list fetch complete")}),this.http.get(`http://localhost:3000/api/guests/guestslist?emailId=${this.email}`).subscribe({next:s=>this.guestList=s,error:s=>console.error("Error fetching guest list",s),complete:()=>console.log("Guest list fetch complete")}),this.http.get(`http://localhost:3000/api/pkgs/pkglist?emailId=${this.email}`).subscribe({next:s=>this.pkgList=s,error:s=>console.error("Error fetching package list",s),complete:()=>console.log("Package list fetch complete")});const e=this.getSelectedOrigin(),n={branch:this.branch||localStorage.getItem("branch")||""};if(e)n.originType=e.originType,n.originLocId=e.originLocId;else{const s=this.originLocId||localStorage.getItem("originLocId")||"all";n.originLocId="all-hubs"===s?"all":s}this.http.get("http://localhost:3000/api/products/productlist",{params:n}).subscribe({next:s=>this.productList=s,error:s=>console.error("Error fetching product list",s),complete:()=>console.log("Product list fetch complete")});const o={},r=this.getSelectedOrigin();if(r)o.originType=r.originType,o.originLocId=r.originLocId;else{const s=this.originLocId||localStorage.getItem("originLocId")||"all";o.originLocId="all-hubs"===s?"all":s}this.http.get("http://localhost:3000/api/tpartners/tpartnerslist",{params:o}).subscribe({next:s=>this.transportPartners=Array.isArray(s)?s:s?.value||[],error:s=>console.error("Error fetching transport partners",s),complete:()=>console.log("Transport partners fetch complete")}),this.loadBranches(),this.loadHubs(),this.loadStocks()}ngOnDestroy(){this.branchSub?.unsubscribe(),this.branchCheck&&clearInterval(this.branchCheck),window.removeEventListener("storage",this.onStorageChange)}getEwaybillNumberFromDB(e){return this.stocks.find(o=>o.consignmentNumber===e)?.ewaybillNumber||""}openManifestationPopup(){"all"!==this.originLocId&&this.originLocId?(this.manifestationNumber="",this.selectedForManifestation=this.filteredStocks.filter(n=>n.selected),0!==this.selectedForManifestation.length?new Set(this.selectedForManifestation.map(n=>this.normalizeId(n?.currentLocationId||n?.currentBranch||n?.currentBranch)).filter(Boolean)).size>1?alert("Selected consignments are in different branches/hubs."):(this.manifestationStatus="Manifestation",this.selectedNextDeliveryPoint="",this.selectedForManifestation=this.selectedForManifestation.map(n=>{const o={...n,ewayBillRequired:!1,ewaybillNumber:this.getEwaybillNumberFromDB(n.consignmentNumber)};return o.invoices?.forEach(r=>{r.products?.forEach(s=>{const a=Number(s.amount)||0,d=Number(s.intransitstock)||0,p=Number(s.deliveredstock)||0,g=Math.max(0,a-d-p);!Number(s.instock)&&g>0&&(s.instock=g),s.manifestQty=Number(s.instock)||g,s.manifestQtyTouched=!1})}),o}),this.showManifestationPopup=!0):alert("Please select at least one consignment to manifest.")):alert("Please select a specific branch before manifesting consignments.")}closeManifestationPopup(){this.showManifestationPopup=!1}finalizeManifestation(){if(0===this.selectedForManifestation.length)return void alert("No consignments selected.");const e="Will be Picked-Up"!==String(this.manifestationStatus||"").trim(),n=!!String(this.selectedRouteVehicle||"").trim();if(e&&!n)return void alert("Please select a vehicle.");if("Manifestation"===this.manifestationStatus&&!String(this.selectedNextDeliveryPoint||"").trim())return void alert("Please select a next delivery point.");const o=(this.selectedForManifestation||[]).map(r=>{const s=(r.ewaybills||[]).map(Te=>({...Te})),a=String(this.selectedNextDeliveryPoint||"").trim(),d=a?this.getNextDeliveryPointId(a):"",p=d?`$$${d}`:"",g=this.getSelectedNextRoutePoint(),m=String(this.selectedRouteVehicle||"").trim(),b=g?.type?String(g.type).toLowerCase():"",y=d,I=this.getSelectedNextHub(),P=I?._id?String(I._id):"",T=this.isSelectedNextDeliveryPointHub()&&Number(r?.hubPerRevAmount)||0,A=String(r?.shipmentStatus||"").trim();let E=this.manifestationStatus||"Manifestation";"DPending"===A&&("Manifestation"===E?E="DManifestation":"Out for Delivery"===E?E="D-Out for Delivery":"Will be Picked-Up"===E&&(E="D-|Will be Picked-Up"));const V=e&&m&&b&&y&&["Manifestation","DManifestation","Out for Delivery","D-Out for Delivery"].includes(E),U={shipmentId:r?._id||"",shipmentStatus:E,shipmentStatusDetails:`${r.shipmentStatusDetails||""}${p}`,ewaybills:s,...P?{hubId:P,hubCharge:T}:{},...V?{currentVehicleNo:m,currentVehicleOwnerType:b,currentVehicleOwnerId:y}:{}},G=r?._id?encodeURIComponent(r._id):"";return this.http.put(`http://localhost:3000/api/newshipments/${r.consignmentNumber}${G?`?shipmentId=${G}`:""}`,U)});o.length&&Pn(o).subscribe({next:()=>{("Manifestation"===this.manifestationStatus||"Out for Delivery"===this.manifestationStatus)&&this.updateInternalVehicleStatuses("scheduled"),this.createManifestRecord(this.selectedForManifestation),this.showManifestationPopup=!1,this.selectedForManifestation=[],this.filteredStocks.forEach(r=>r.selected=!1),this.loadStocks()},error:r=>{console.error("Error updating consignment status:",r),alert("Failed to update consignment status.")}})}updateInternalVehicleStatuses(e){if(this.isExternalTransport)return;let n=(this.shipmentRoute||[]).filter(s=>s&&"Transport Partner"!==s.type);if(!n.length){const s=String(this.selectedRouteVehicle||"").trim(),a=this.getSelectedNextRoutePoint();s&&a?n=[{name:a.name,type:a.type,vehicleNo:s}]:s&&(n=[{name:this.branch||"Branch",type:"Branch",vehicleNo:s}])}if(!n.length)return;const o=[],r=new Set;n.forEach(s=>{const a=String(s?.vehicleNo||"").trim();if(a)if("Branch"===s.type){const d=this.resolveBranchByName(s.name)||this.resolveBranchByVehicle(a),p=d?._id?String(d._id):"";if(!p)return;const g=`branch:${p}:${a}`;if(r.has(g))return;r.add(g),o.push(this.http.patch(`http://localhost:3000/api/branches/${p}/vehicle-status`,{vehicleNo:a,vehicleStatus:e}))}else if("Hub"===s.type){const d=this.resolveHubByName(s.name)||this.resolveHubByVehicle(a),p=d?._id?String(d._id):"";if(!p)return;const g=`hub:${p}:${a}`;if(r.has(g))return;r.add(g),o.push(this.http.patch(`http://localhost:3000/api/hubs/${p}/vehicle-status`,{vehicleNo:a,vehicleStatus:e}))}else{const d=this.resolveBranchByVehicle(a);if(d?._id){const g=String(d._id),m=`branch:${g}:${a}`;return void(r.has(m)||(r.add(m),o.push(this.http.patch(`http://localhost:3000/api/branches/${g}/vehicle-status`,{vehicleNo:a,vehicleStatus:e}))))}const p=this.resolveHubByVehicle(a);if(p?._id){const g=String(p._id),m=`hub:${g}:${a}`;r.has(m)||(r.add(m),o.push(this.http.patch(`http://localhost:3000/api/hubs/${g}/vehicle-status`,{vehicleNo:a,vehicleStatus:e})))}}}),o.length&&Pn(o).subscribe({error:s=>console.error("Error updating internal vehicle status:",s)})}buildManifestationPincodeDirections(e){return(e||[]).map(n=>{const o=this.enrichShipmentDetails(n),r=String(o?.pickupPincode||"").trim(),s=String(o?.deliveryPincode||"").trim();return r||s?`$$${r}-${s}`:""}).filter(Boolean)}validateManifestQty(e){e.manifestQtyTouched=!0,e.manifestQty>e.instock&&(alert(`Manifest quantity cannot exceed available stock (${e.instock}).`),e.manifestQty=e.instock),e.manifestQty<0&&(alert("Manifest quantity cannot be negative."),e.manifestQty=0)}printReceipts(){const e=this.filteredStocks?.filter(n=>n.selected)||[];0!==e.length?fetch("assets/receipt-template.html").then(n=>n.text()).then(n=>{let o="\n        <html>\n          <head>\n            <style>\n              body { font-family: Arial, sans-serif; padding: 20px; }\n              h2 { margin-bottom: 0; }\n              table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n              th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n              th { background-color: #f2f2f2; }\n              .page-break { page-break-after: always; }\n            </style>\n          </head>\n          <body>\n      ";e.forEach((s,a)=>{const d=s.invoices.flatMap(g=>g.products.map(m=>`\n            <tr>\n              <td>${g.number}</td>\n              <td>${m.type}</td>\n              <td>${m.instock}</td>\n              <td>${m.manifestQty}</td>\n              <td>${m.amount}</td>\n            </tr>\n          `)).join(""),p=n.replace("{{consignmentNumber}}",s.consignmentNumber).replace("{{consignor}}",s.consignor).replace("{{rows}}",d);o+=p,a<e.length-1&&(o+='<div class="page-break"></div>')}),o+="</body></html>";const r=window.open("","_blank");r&&(r.document.open(),r.document.write(o),r.document.close(),r.print())}):alert("No consignments selected.")}static{this.\u0275fac=function(n){return new(n||t)(R(Ve),R(Xa))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-stocks"]],standalone:!0,features:[Ae],decls:49,vars:15,consts:[["noSelection",""],["showEwaybill",""],["externalTransport",""],[1,"stocks-container"],[1,"stocks-tabs"],[3,"click"],[1,"filters"],["type","text","placeholder","Search by consignment no. or consignor",3,"ngModelChange","input","ngModel"],[3,"ngModel","ngModelChange",4,"ngIf"],["type","date",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Filter by consignor",3,"ngModelChange","input","ngModel"],[1,"cancel-btn",3,"click","disabled"],[1,"actions"],[1,"stocks-table-wrapper"],[1,"stocks-table"],["type","checkbox",3,"change"],[3,"click",4,"ngFor","ngForOf"],["class","modal details-modal",4,"ngIf"],["class","modal edit-stock-modal",4,"ngIf"],["class","modal",4,"ngIf"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","checkbox",3,"ngModelChange","click","ngModel"],[1,"modal","details-modal"],[1,"modal-content","details-content"],["type","button",1,"details-close",3,"click"],[1,"details-header"],[1,"details-sub"],[1,"details-status"],[1,"stock-details","details-grid"],[1,"details-products"],["class","details-invoice",4,"ngFor","ngForOf"],[1,"details-invoice"],[1,"details-invoice-title"],[1,"details-product-list"],[4,"ngFor","ngForOf"],[1,"product-name"],[1,"product-meta"],[1,"modal","edit-stock-modal"],[1,"modal-content","edit-stock-content"],[1,"edit-stock-header"],[1,"edit-stock-meta"],[1,"edit-stock-section"],[1,"edit-stock-grid"],["type","date",3,"ngModelChange","ngModel"],[1,"tabs","edit-stock-tabs"],["class","edit-stock-grid",4,"ngIf"],[3,"ngModelChange","change","ngModel"],[1,"edit-stock-radio"],["type","radio","name","billing","value","consignor",3,"ngModelChange","ngModel"],["type","radio","name","billing","value","different",3,"ngModelChange","ngModel"],["class","invoice-block",4,"ngFor","ngForOf"],["type","button",1,"ghost",3,"click"],["type","number",3,"ngModelChange","ngModel"],[1,"edit-stock-actions"],[1,"ghost",3,"click"],[1,"primary",3,"click"],["readonly","",3,"ngModelChange","ngModel"],[1,"invoice-block"],[1,"grid-3"],["placeholder","Invoice Number",3,"ngModelChange","ngModel"],["placeholder","Invoice Value","type","number",3,"ngModelChange","ngModel"],["type","button",1,"danger",3,"click"],["class","grid-4",4,"ngFor","ngForOf"],[1,"grid-4"],["placeholder","Amount*","type","number",3,"ngModelChange","ngModel"],["placeholder","Amount*","type","number",3,"ngModelChange","focus","ngModel"],[1,"modal"],[1,"modal-content"],[4,"ngIf"],["class","stocks-table",4,"ngIf"],[1,"terminal-buttons"],["type","number","min","0",3,"ngModelChange","ngModel"],[1,"modal-content","terminal-style"],[1,"close",3,"click"],[1,"terminal-header"],[1,"terminal-status"],["class","manifest-number",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"manifest-number"],["class","consignment-block",4,"ngFor","ngForOf"],["class","routing-section",4,"ngIf"],[1,"consignment-block"],["class","hub-charge-wrapper",4,"ngIf"],[1,"ewaybill-section"],[1,"hub-charge-wrapper"],[1,"hub-pickup-toggle"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"hub-charge-row"],["type","number","min","0",3,"ngModelChange","ngModel","disabled"],[1,"hint"],[1,"eway-toggle-label"],["type","checkbox",1,"eway-toggle-input",3,"ngModelChange","ngModel"],[1,"eway-toggle-slider"],[1,"eway-toggle-text"],[1,"product-line"],["type","number","min","0","readonly","","disabled","",1,"manifest-input",3,"ngModelChange","max","ngModel"],[1,"routing-section"],[1,"routing-header"],[1,"eway-toggle-label","external-toggle"],["type","checkbox",1,"eway-toggle-input",3,"ngModelChange","change","ngModel"],[1,"routing-controls"],["class","hub-charge-total",4,"ngIf"],[1,"route-list"],["disabled",""],["value",""],[1,"hub-charge-total"],[1,"remove-btn",3,"click"],[1,"cancel-list"],["type","button",1,"remove-btn",3,"click"]],template:function(n,o){1&n&&(l(0,"div",3)(1,"h2"),u(2,"Stocks"),c(),l(3,"div",4)(4,"button",5),M("click",function(){return o.setActiveTab("stocks")}),u(5," Stocks "),c(),l(6,"button",5),M("click",function(){return o.setActiveTab("others-in-branch")}),u(7," Others stocks in our branch "),c()(),l(8,"div",6)(9,"input",7),S("ngModelChange",function(s){return x(o.searchText,s)||(o.searchText=s),s}),M("input",function(){return o.applyFilters()}),c(),D(10,kU,2,2,"select",8),l(11,"input",9),S("ngModelChange",function(s){return x(o.filterDate,s)||(o.filterDate=s),s}),M("change",function(){return o.applyFilters()}),c(),l(12,"input",10),S("ngModelChange",function(s){return x(o.filterConsignor,s)||(o.filterConsignor=s),s}),M("input",function(){return o.applyFilters()}),c(),l(13,"button",5),M("click",function(){return o.openManifestationPopup()}),u(14,"Manifestation"),c(),l(15,"button",11),M("click",function(){return o.openCancelPopup()}),u(16,"Delete"),c(),l(17,"button",5),M("click",function(){return o.printReceipts()}),u(18,"\u{1f5a8}\ufe0f Print Receipts"),c()(),X(19,"div",12),l(20,"div",13)(21,"table",14)(22,"thead")(23,"tr")(24,"th")(25,"input",15),M("change",function(s){return o.toggleAllSelection(s)}),c()(),l(26,"th"),u(27,"Consignment No."),c(),l(28,"th"),u(29,"Status"),c(),l(30,"th"),u(31,"Consignor"),c(),l(32,"th"),u(33,"Delivery Address"),c(),l(34,"th"),u(35,"No. of Products"),c(),l(36,"th"),u(37,"Branch"),c(),l(38,"th"),u(39,"Current Branch"),c(),l(40,"th"),u(41,"Actions"),c()()(),l(42,"tbody"),D(43,EU,20,8,"tr",16),c()()()(),D(44,LU,170,44,"div",17)(45,YU,95,28,"div",18)(46,ez,18,4,"div",19)(47,Mz,16,5,"div",19)(48,wz,11,1,"div",19)),2&n&&(h(4),Ce("active","stocks"===o.activeTab),h(2),Ce("active","others-in-branch"===o.activeTab),h(3),w("ngModel",o.searchText),h(),C("ngIf","all-hubs"===o.originLocId),h(),w("ngModel",o.filterDate),h(),w("ngModel",o.filterConsignor),h(3),C("disabled",!o.hasSelectedConsignment()),h(28),C("ngForOf",o.filteredStocks),h(),C("ngIf",o.selectedStock),h(),C("ngIf",o.editingStock),h(),C("ngIf",o.showManifestAdjustmentPopup),h(),C("ngIf",o.showManifestationPopup),h(),C("ngIf",o.showCancelPopup))},dependencies:[pt,lt,Xe,Fr,et,wt,St,qe,on,Jr,vt,cu,We,Gi,du,He],styles:['.stocks-container[_ngcontent-%COMP%]{padding:20px;color:var(--stock-text);max-width:1200px;margin:0 auto;width:100%;box-sizing:border-box}[_nghost-%COMP%]{--stock-bg: #f6f8fb;--stock-card: #ffffff;--stock-border: #e5e7eb;--stock-text: #0f172a;--stock-muted: #6b7280;--stock-primary: #2563eb;--stock-primary-strong: #1e3a8a;--stock-danger: #dc2626}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}.stocks-tabs[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:12px}.stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 14px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.stocks-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#fff;color:var(--stock-text);flex:1 1 190px;min-width:0}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-text);cursor:pointer;flex:0 0 auto}.filters[_ngcontent-%COMP%]   button.cancel-btn[_ngcontent-%COMP%]{border-color:var(--stock-danger);color:var(--stock-danger);background:#fff5f5}.filters[_ngcontent-%COMP%]   button.cancel-btn[_ngcontent-%COMP%]:hover{border-color:#b91c1c;color:#b91c1c}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:var(--stock-primary);color:var(--stock-primary-strong)}.stocks-table-wrapper[_ngcontent-%COMP%]{overflow-x:hidden;max-width:100%}.stocks-table[_ngcontent-%COMP%]{table-layout:fixed;width:100%;border-collapse:collapse;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;overflow:hidden}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--stock-border);padding:4px 6px;text-align:left;font-size:12px;word-wrap:break-word}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600;font-size:12px}.stocks-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:10px;border:1px solid var(--stock-primary);background:var(--stock-primary);color:#fff;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--stock-primary-strong);border-color:var(--stock-primary-strong)}.actions[_ngcontent-%COMP%]{margin-top:15px}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:500px;max-height:80vh;overflow-y:auto;border-radius:8px;position:relative}.details-modal[_ngcontent-%COMP%]{background:#0f172a8c}.details-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(860px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.details-close[_ngcontent-%COMP%]{position:absolute;right:18px;top:12px;background:transparent;border:none;font-size:24px;cursor:pointer;color:var(--stock-muted)}.details-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.details-sub[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.details-status[_ngcontent-%COMP%]{background:#e0f2fe;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px;margin-bottom:16px}.details-products[_ngcontent-%COMP%]{display:grid;gap:12px}.details-invoice[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px}.details-invoice-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:8px}.details-product-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:8px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;border-bottom:1px solid var(--stock-border);padding-bottom:6px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.product-name[_ngcontent-%COMP%]{font-weight:600}.product-meta[_ngcontent-%COMP%]{color:var(--stock-muted);font-size:13px}@media (max-width: 700px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:7px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;font-size:11px}}.edit-stock-modal[_ngcontent-%COMP%]{background:#0f172a8c}.edit-stock-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(1100px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.edit-stock-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px}.edit-stock-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:22px;color:var(--stock-text)}.edit-stock-meta[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.edit-stock-section[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:14px;margin-bottom:14px}.edit-stock-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:15px}.edit-stock-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.edit-stock-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:13px;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid var(--stock-border);border-radius:10px;padding:8px 10px;font-size:13px;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:80px;resize:vertical}.edit-stock-tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px}.edit-stock-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.edit-stock-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.edit-stock-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:10px 0 4px;color:var(--stock-muted);font-size:13px}.edit-stock-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}.edit-stock-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:10px;border:1px solid var(--stock-border);padding:8px 14px;font-size:13px;cursor:pointer;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.primary[_ngcontent-%COMP%]{background:var(--stock-primary);border-color:var(--stock-primary);color:#fff}.edit-stock-content[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]{background:#f8fafc;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{border-color:#fecaca;background:#fef2f2;color:var(--stock-danger)}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{gap:10px}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr))}@media (max-width: 900px){.edit-stock-grid[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.edit-stock-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}.close[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;font-size:24px;cursor:pointer}.terminal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.terminal-status[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-size:12px}.terminal-status[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background:#2a2a2a;color:#d4d4d4;border:1px solid #444;border-radius:6px;padding:4px 8px}.modal-content.terminal-style[_ngcontent-%COMP%]{background-color:#1e1e1e;color:#d4d4d4;font-family:Courier New,monospace;border-radius:10px;padding:20px;width:80%;max-height:80vh;overflow-y:auto}.consignment-block[_ngcontent-%COMP%]{background:#2a2a2a;padding:10px;border-radius:6px;margin-bottom:10px}.terminal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 20px;border:none;border-radius:6px;cursor:pointer}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#007acc;color:#fff}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#555;color:#fff}.manifest-number[_ngcontent-%COMP%]{margin:6px 0 10px;color:#9cdcfe}.cancel-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:12px 0 16px;display:flex;flex-direction:column;gap:8px}.cancel-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#f8fafc;color:var(--stock-text)}.cancel-list[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{border:1px solid var(--stock-danger);color:var(--stock-danger);background:#fff5f5;border-radius:8px;padding:6px 10px;cursor:pointer}.cancel-list[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover{border-color:#b91c1c;color:#b91c1c}.product-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:4px 0}.hub-charge-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin:6px 0 10px}.hub-charge-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:12px}.hub-pickup-toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px}.hub-charge-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.hub-charge-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80px;padding:4px;background-color:#333;color:#fff;border:1px solid #555;border-radius:4px;text-align:right}.hub-charge-row[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:#9ca3af;font-size:12px}.manifest-input[_ngcontent-%COMP%]{width:60px;padding:4px;margin-left:4px;background-color:#333;color:#fff;border:1px solid #555;border-radius:4px;text-align:right}.eway-toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;position:relative;cursor:pointer;-webkit-user-select:none;user-select:none}.eway-toggle-input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.eway-toggle-slider[_ngcontent-%COMP%]{position:relative;width:40px;height:20px;background-color:#ccc;border-radius:20px;transition:background-color .3s}.eway-toggle-slider[_ngcontent-%COMP%]:before{content:"";position:absolute;height:16px;width:16px;left:2px;bottom:2px;background-color:#fff;border-radius:50%;transition:transform .3s}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]{background-color:#4caf50}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]:before{transform:translate(20px)}.eway-toggle-text[_ngcontent-%COMP%]{font-weight:500}.routing-section[_ngcontent-%COMP%]{margin-top:20px}.routing-controls[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:10px}.route-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.route-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.remove-btn[_ngcontent-%COMP%]{background:none;border:none;color:red;cursor:pointer}.routing-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}.external-toggle[_ngcontent-%COMP%]{margin-left:auto}']})}}return t})();function xz(t,i){if(1&t){const e=O();l(0,"button",15),M("click",function(o){_(e);const r=f().$implicit;return f().deliverManifest(r),v(o.stopPropagation())}),u(1,"Deliver"),c()}}function Pz(t,i){if(1&t){const e=O();l(0,"button",15),M("click",function(o){_(e);const r=f().$implicit;return f().cancelManifest(r),v(o.stopPropagation())}),u(1,"Cancel"),c()}}function Dz(t,i){if(1&t){const e=O();l(0,"button",18),M("click",function(o){_(e);const r=f().$implicit;return f().uncancelManifest(r),v(o.stopPropagation())}),u(1," Uncancel "),c()}if(2&t){const e=f().$implicit;C("disabled",!f().canUncancelManifest(e))}}function Nz(t,i){if(1&t){const e=O();l(0,"tr",15),M("click",function(){const o=_(e).$implicit;return v(f().openManifestDetails(o))}),l(1,"td"),u(2),c(),l(3,"td"),u(4),hi(5,"date"),c(),l(6,"td"),u(7),c(),l(8,"td"),u(9),c(),l(10,"td"),u(11),c(),l(12,"td"),u(13),c(),l(14,"td"),D(15,xz,2,0,"button",16)(16,Pz,2,0,"button",16)(17,Dz,2,1,"button",17),c()()}if(2&t){const e=i.$implicit,n=f();h(2),N(e.manifestNumber),h(2),N(_o(5,9,e.createdAt,"short")),h(3),N(e.status||"-"),h(2),N(e.vehicleNo||"-"),h(2),N(n.getManifestEntityName(e)),h(2),N(n.getManifestItemCount(e)),h(2),C("ngIf",n.canDeliverManifest(e)),h(),C("ngIf",n.canCancelManifest(e)),h(),C("ngIf",n.isCancelledManifest(e))}}function Tz(t,i){1&t&&(l(0,"tr")(1,"td",19),u(2,"No manifests found."),c()())}function kz(t,i){if(1&t&&(l(0,"p")(1,"strong"),u(2,"Manifest ID:"),c(),l(3,"a",29),u(4),c()()),2&t){const e=f(3);h(3),C("href",e.getManifestUrl(e.selectedManifestDetails.manifest),As),h(),k(" ",e.selectedManifestDetails.manifest._id," ")}}function Ez(t,i){if(1&t&&(l(0,"div",28)(1,"p")(2,"strong"),u(3,"Manifest No.:"),c(),u(4),c(),l(5,"p")(6,"strong"),u(7,"Vehicle No.:"),c(),u(8),c(),l(9,"p")(10,"strong"),u(11,"Status:"),c(),u(12),c(),l(13,"p")(14,"strong"),u(15,"Delivery Point:"),c(),u(16),c(),l(17,"p")(18,"strong"),u(19,"Pickup Point:"),c(),u(20),c(),l(21,"p")(22,"strong"),u(23,"Entity ID:"),c(),u(24),c(),D(25,kz,5,2,"p",13),l(26,"p")(27,"strong"),u(28,"Linked consignments:"),c(),u(29),c()()),2&t){let e;const n=f(2);h(4),k(" ",n.selectedManifestDetails.manifest.manifestNumber,""),h(4),k(" ",n.selectedManifestDetails.manifest.vehicleNo||"-",""),h(4),k(" ",n.selectedManifestDetails.manifest.status||"-",""),h(4),k(" ",n.selectedManifestDetails.deliveryPoint||"-",""),h(4),k(" ",n.selectedManifestDetails.pickupPoint||"-",""),h(4),k(" ",n.selectedManifestDetails.manifest.entityId||"-"," "),h(),C("ngIf",n.selectedManifestDetails.manifest._id),h(4),k(" ",(null==(e=n.getManifestConsignments())?null:e.length)||0,"")}}function Az(t,i){if(1&t){const e=O();l(0,"button",18),M("click",function(){_(e);const o=f(3);return v(o.uncancelManifest(o.selectedManifestDetails.manifest))}),u(1," Uncancel "),c()}if(2&t){const e=f(3);C("disabled",!e.canUncancelManifest(e.selectedManifestDetails.manifest))}}function Oz(t,i){if(1&t&&(l(0,"div",30),D(1,Az,2,1,"button",17),c()),2&t){const e=f(2);h(),C("ngIf",e.isCancelledManifest(e.selectedManifestDetails.manifest))}}function Lz(t,i){if(1&t&&(l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c()()),2&t){const e=i.$implicit;h(2),N(e.name),h(2),N(e.amount),h(2),N(e.instock),h(2),N(e.intransit),h(2),N(e.delivered)}}function Rz(t,i){1&t&&(l(0,"tr")(1,"td",38),u(2,"No products found."),c()())}function Fz(t,i){if(1&t&&(l(0,"div",33)(1,"div",34)(2,"span")(3,"strong"),u(4,"Consignment No.:"),c(),u(5),c(),l(6,"span")(7,"strong"),u(8,"Status:"),c(),u(9),c(),l(10,"span")(11,"strong"),u(12,"Current Location:"),c(),u(13),c()(),l(14,"div",35)(15,"span")(16,"strong"),u(17,"Pickup:"),c(),u(18),c(),l(19,"span")(20,"strong"),u(21,"Phone:"),c(),u(22),c(),l(23,"span")(24,"strong"),u(25,"Pincode:"),c(),u(26),c(),l(27,"span",36)(28,"strong"),u(29,"Address:"),c(),u(30),c()(),l(31,"table",11)(32,"thead")(33,"tr")(34,"th"),u(35,"Product"),c(),l(36,"th"),u(37,"Total"),c(),l(38,"th"),u(39,"In Stock"),c(),l(40,"th"),u(41,"In Transit"),c(),l(42,"th"),u(43,"Delivered"),c()()(),l(44,"tbody"),D(45,Lz,11,5,"tr",37)(46,Rz,3,0,"tr",13),c()()()),2&t){const e=i.$implicit;h(5),k(" ",e.consignmentNumber,""),h(4),k(" ",e.shipmentStatus,""),h(4),k(" ",e.currentLocation||"-",""),h(5),k(" ",e.pickupName||"-",""),h(4),k(" ",e.pickupPhone||"-",""),h(4),k(" ",e.pickupPincode||"-",""),h(4),k(" ",e.pickupAddress||"-",""),h(15),C("ngForOf",e.productSummary),h(),C("ngIf",!(null!=e.productSummary&&e.productSummary.length))}}function Bz(t,i){if(1&t&&(l(0,"div",31),D(1,Fz,47,9,"div",32),c()),2&t){const e=f(2);h(),C("ngForOf",e.getManifestConsignments())}}function Vz(t,i){1&t&&(l(0,"p"),u(1,"No consignments found for this manifest."),c())}function Hz(t,i){if(1&t){const e=O();l(0,"div",39)(1,"button",15),M("click",function(){_(e);const o=f(2);return v(o.startConsignmentEdit(o.selectedManifestDetails.manifest))}),u(2,"Edit Consignments"),c()()}}function jz(t,i){1&t&&(l(0,"div",47),u(1,"Loading eligible consignments..."),c())}function Uz(t,i){if(1&t&&(l(0,"div",48),u(1),c()),2&t){const e=f(3);h(),N(e.consignmentEditError)}}function zz(t,i){if(1&t){const e=O();l(0,"div",49)(1,"label")(2,"input",50),M("change",function(){const o=_(e).$implicit;return v(f(3).toggleConsignmentRemove(o))}),c(),l(3,"span"),u(4),c()()()}if(2&t){const e=i.$implicit,n=f(3);h(2),C("checked",n.isConsignmentMarkedForRemove(e)),h(2),ua(" ",e.consignmentNumber," ",n.getBranchNameById(e.originLocId||"")||e.originLocId||"-"," (",e.shipmentStatus,") ")}}function Gz(t,i){1&t&&(l(0,"div",51),u(1," No consignments in this manifest. "),c())}function $z(t,i){if(1&t){const e=O();l(0,"div",49)(1,"label")(2,"input",50),M("change",function(){const o=_(e).$implicit;return v(f(3).toggleConsignmentAdd(o))}),c(),l(3,"span"),u(4),c()()()}if(2&t){const e=i.$implicit,n=f(3);h(2),C("checked",n.isConsignmentMarkedForAdd(e)),h(2),ua(" ",e.consignmentNumber," ",n.getBranchNameById(e.originLocId||"")||e.originLocId||"-"," (",e.shipmentStatus,") ")}}function qz(t,i){1&t&&(l(0,"div",51),u(1," No eligible consignments found. "),c())}function Wz(t,i){if(1&t){const e=O();l(0,"div",40),D(1,jz,2,0,"div",41)(2,Uz,2,1,"div",42),l(3,"div",43)(4,"div",44)(5,"h5"),u(6,"Current Consignments (remove)"),c(),D(7,zz,5,4,"div",45)(8,Gz,2,0,"div",46),c(),l(9,"div",44)(10,"h5"),u(11,"Eligible Consignments (add)"),c(),D(12,$z,5,4,"div",45)(13,qz,2,0,"div",46),c()(),l(14,"div",39)(15,"button",15),M("click",function(){_(e);const o=f(2);return v(o.applyConsignmentEdit(o.selectedManifestDetails.manifest))}),u(16,"OK"),c(),l(17,"button",15),M("click",function(){return _(e),v(f(2).cancelConsignmentEdit())}),u(18,"Cancel"),c()()()}if(2&t){const e=f(2);h(),C("ngIf",e.consignmentEditLoading),h(),C("ngIf",e.consignmentEditError),h(5),C("ngForOf",e.getManifestConsignments()),h(),C("ngIf",!e.getManifestConsignments().length),h(4),C("ngForOf",e.eligibleConsignments),h(),C("ngIf",!e.eligibleConsignments.length&&!e.consignmentEditLoading)}}function Qz(t,i){if(1&t){const e=O();l(0,"div",20)(1,"div",21)(2,"button",22),M("click",function(){return _(e),v(f().closeManifestDetails())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Manifest Details"),c(),D(6,Ez,30,8,"div",23)(7,Oz,2,1,"div",24),l(8,"h4"),u(9,"Consignments"),c(),D(10,Bz,2,1,"div",25)(11,Vz,2,0,"ng-template",null,0,qn)(13,Hz,3,0,"div",26)(14,Wz,19,6,"div",27),c()()}if(2&t){let e;const n=$n(12),o=f();h(6),C("ngIf",null==o.selectedManifestDetails?null:o.selectedManifestDetails.manifest),h(),C("ngIf",null==o.selectedManifestDetails?null:o.selectedManifestDetails.manifest),h(3),C("ngIf",null==(e=o.getManifestConsignments())?null:e.length)("ngIfElse",n),h(3),C("ngIf",(null==o.selectedManifestDetails?null:o.selectedManifestDetails.manifest)&&o.canEditConsignments(o.selectedManifestDetails.manifest)&&!o.showConsignmentEdit),h(),C("ngIf",o.showConsignmentEdit)}}let Zz=(()=>{class t{constructor(e,n){this.http=e,this.branchService=n,this.stocks=[],this.filteredStocks=[],this.activeTab="stocks",this.searchText="",this.filterDate="",this.filterConsignor="",this.filterStatus="Manifestation",this.selectedHubFilterId=null,this.selectedHubFilterName="",this.selectedStock=null,this.editingStock=null,this.manifests=[],this.manifestSearchText="",this.manifestStatusFilter="",this.manifestVehicleFilter="",this.showManifestDetails=!1,this.selectedManifestDetails=null,this.showConsignmentEdit=!1,this.eligibleConsignments=[],this.consignmentEditLoading=!1,this.consignmentEditError="",this.consignmentsToAdd=new Set,this.consignmentsToRemove=new Set,this.billingType="consignor",this.billingName="",this.billingAddress="",this.billingGSTIN="",this.billingPhone="",this.clientList=[],this.guestList=[],this.pkgList=[],this.productList=[],this.pickupType="consignor",this.pickupName="",this.pickupAddress="",this.pickupPhone="",this.deliveryType="consignee",this.deliveryName="",this.deliveryAddress="",this.deliveryPhone="",this.consignorTab="consignor",this.consigneeTab="consignee",this.email="",this.username="",this.branch=localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.consignmentNumber=localStorage.getItem("consignmentNumber")||"-999",this.date=(new Date).toISOString().split("T")[0],this.ewaybillNumber="",this.consignor="",this.consignorGST="",this.consignorAddress="",this.consignorPhone="",this.consignee="",this.consigneeGST="",this.consigneeAddress="",this.consigneePhone="",this.paymentMode="Account Credit",this.externalRefId="",this.invoices=[{number:"",value:0}],this.packages=[{type:"",amount:1}],this.products=[{type:"",amount:1}],this.charges={odc:0,unloading:0,docket:0,other:0,ccc:0},this.finalAmount=0,this.shipmentStatus="Pending",this.shipmentStatusDetails="",this.branches=[],this.hubs=[],this.availableRoutePoints=[],this.shipmentRoute=[],this.selectedRoutePoint=null,this.selectedRouteVehicle="",this.showCancelPopup=!1,this.showDeleteErrorPopup=!1,this.deleteErrorMessage="",this.onStorageChange=o=>{if("branch"===o.key||"originLocId"===o.key){const r=localStorage.getItem("branch")||"All Branches",s=localStorage.getItem("originLocId")||"all";(r!==this.branch||s!==this.originLocId)&&(this.branch=r,this.originLocId=s,this.loadStocks(),this.loadManifests())}},this.showManifestAdjustmentPopup=!1,this.pendingManifestAdjustment=null,this.manifestAdjustments=[],this.manifestAdjustmentLines=[],this.manifestEditsById={},this.showManifestationPopup=!1,this.selectedForManifestation=[],this.manifestationNumber=""}addInvoice(){this.editingStock.invoices.push({number:"",value:0,packages:[],products:[]})}deleteInvoice(e){this.editingStock.invoices.splice(e,1)}addPackage(e){const n=this.editingStock.invoices[e];n.packages||(n.packages=[]),n.packages.push({type:"",amount:1})}deletePackage(e,n){const o=this.editingStock.invoices[e];o.packages&&o.packages.length>n&&o.packages.splice(n,1)}addProduct(e){const n=this.editingStock.invoices[e];n.products||(n.products=[]),n.products.push({type:"",amount:1,instock:0,intransitstock:0,deliveredstock:0})}deleteProduct(e,n){const o=this.editingStock.invoices[e];if(o.products&&o.products.length>n){if(this.isProductManifested(o.products[n]))return void alert("This product has been manifested and cannot be deleted.");o.products.splice(n,1)}}calculateFinalAmount(){const e=this.editingStock.invoices.reduce((r,s)=>r+(s.value||0),0),n=this.editingStock.packages.reduce((r,s)=>r+(s.amount||0),0),o=Object.values(this.charges).reduce((r,s)=>r+(Number(s)||0),0);this.editingStock.finalAmount=e+n+o}loadStocks(){const e=this.username||localStorage.getItem("username")||"",n=this.originLocId||localStorage.getItem("originLocId")||"all";if(!e)return void console.error("Missing username for loading stocks");const o="stocks"===this.activeTab?n:"all";this.http.get("http://localhost:3000/api/newshipments",{params:{username:e,originLocId:"all-hubs"===o?"all":o}}).subscribe({next:s=>{const a=(s||[]).map(d=>({...d,invoices:this.flattenInvoices(d.ewaybills||d.invoices||[])}));this.stocks=this.getBaseStocks(a).sort((d,p)=>new Date(p.createdAt).getTime()-new Date(d.createdAt).getTime()),this.applyFilters()},error:s=>console.error("Error loading shipments:",s)})}flattenInvoices(e){return(e||[]).flatMap(n=>n.invoices||[])}getInStockAmountTotal(e){let n=0;return(e||[]).forEach(o=>{(o.products||[]).forEach(r=>{n+=Number(r.instock||0)})}),n}getInvoiceAmountTotal(e){let n=0;return(e||[]).forEach(o=>{(o.products||[]).forEach(r=>{n+=Number(r.amount||0)})}),n}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}formatLocationDisplay(e,n){const o=this.normalizeId(e),r=String(n||"").trim();let s=o,a="";const d=o?(this.branches||[]).find(g=>this.normalizeId(g?._id)===o):null;if(d?._id)s=this.normalizeId(d._id),a=String(d.branchName||"").trim();else{const g=o?(this.hubs||[]).find(m=>this.normalizeId(m?._id)===o):null;g?._id&&(s=this.normalizeId(g._id),a=String(g.hubName||"").trim())}if(!a&&r){const g=r.toLowerCase(),m=(this.branches||[]).find(b=>String(b?.branchName||"").trim().toLowerCase()===g);if(m?._id)s=this.normalizeId(m._id),a=String(m.branchName||"").trim();else{const b=(this.hubs||[]).find(y=>String(y?.hubName||"").trim().toLowerCase()===g);b?._id&&(s=this.normalizeId(b._id),a=String(b.hubName||"").trim())}}const p=a||r||s||"-";return s&&p.toLowerCase()!==String(s).toLowerCase()?`${p}$$${s}`:p}getOriginBranchDisplay(e){return this.formatLocationDisplay(this.getOriginId(e),e?.branch)}getCurrentBranchDisplay(e){return this.formatLocationDisplay(e?.currentLocationId||e?.currentBranch,e?.currentBranch)}getoriginLocIdByName(e){const n=String(e||"").trim().toLowerCase();if(!n)return"";const o=(this.branches||[]).find(r=>String(r?.branchName||"").trim().toLowerCase()===n);return o?._id?String(o._id):""}getOriginId(e){return e?this.normalizeId(e?.originLocId||e?.originLocId||e?.originLocId||e?.branch):""}getBranchNameById(e){const n=this.normalizeId(e);if(!n)return"";const o=(this.branches||[]).find(r=>this.normalizeId(r?._id)===n);return o?.branchName?String(o.branchName):""}getHubById(e){const n=this.normalizeId(e);return n&&(this.hubs||[]).find(o=>this.normalizeId(o?._id)===n)||null}matchesSelectedBranch(e,n,o){if(!o)return!1;const r=this.normalizeId(o);if(e&&this.normalizeId(e)===r)return!0;const s=(this.hubs||[]).find(p=>this.normalizeId(p?._id)===this.normalizeId(e));if(s){const p=this.normalizeId(s?.originLocId||s?.branch);if(p&&p===r)return!0}const a=this.getHubById(r);if(a){const p=this.normalizeId(a?.originLocId||a?.branch);if(p&&this.normalizeId(e)===p)return!0;const g=String(a?.hubName||"").trim();if(g&&n&&String(n).trim().toLowerCase()===g.toLowerCase())return!0;const m=this.getBranchNameById(p);if(m&&n&&String(n).trim().toLowerCase()===m.toLowerCase())return!0}const d=this.getBranchNameById(r);return!(!d||!n)&&String(n).trim().toLowerCase()===String(d).trim().toLowerCase()}isCurrentBranchMatch(e,n){if(!e||!n)return!1;if(this.normalizeId(e)===this.normalizeId(n))return!0;const o=this.getBranchNameById(n);if(o&&String(e||"").trim().toLowerCase()===String(o).trim().toLowerCase())return!0;const r=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===this.normalizeId(e));if(!r?.branch)return!1;const s=this.getoriginLocIdByName(r.branch);return!!s&&this.normalizeId(s)===this.normalizeId(n)}matchesBranchLabel(e,n){const o=String(e||"").trim().toLowerCase(),r=String(n||"").trim().toLowerCase();if(!o||!r)return!1;if(r===o||r.startsWith(`${o}-`))return!0;const s=r.split("-")[0].trim();return!!s&&s===o}isAllowedManifestStatus(e){return"Manifestation"===e||"Out for Delivery"===e||"Will be Picked-Up"===e}isAllowedDeliveryStatus(e){return"DManifestation"===e||"D-Out for Delivery"===e||"D-Will be Picked-Up"===e}isCompanyMatch(e){const n=String(localStorage.getItem("GSTIN_ID")||"").trim();if(!n)return!0;const o=String(e?.GSTIN_ID??e?.gstinId??"").trim();return!!o&&o===n}getLastStatusDetailoriginLocId(e){if(!e)return"";const n=String(e).split("$$").map(o=>String(o||"").trim()).filter(Boolean);return n.length?n[n.length-1]:""}getManifestEntityName(e){const n=String(e?.entityType||"").toLowerCase(),o=this.normalizeId(e?.entityId);if(!n||!o)return"-";if("hub"===n){const s=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===o);return s?.hubName?String(s.hubName).trim():o}const r=(this.branches||[]).find(s=>this.normalizeId(s?._id)===o);return r?.branchName?String(r.branchName).trim():o}getManifestDeliveryPointName(e){const n=String(e?.deliveryType||"").toLowerCase(),o=this.normalizeId(e?.deliveryId);if(!n||!o)return"-";if("hub"===n){const s=(this.hubs||[]).find(a=>this.normalizeId(a?._id)===o);return s?.hubName?String(s.hubName).trim():o}const r=(this.branches||[]).find(s=>this.normalizeId(s?._id)===o);return r?.branchName?String(r.branchName).trim():o}resolveLocationNameByIdOrName(e){const n=String(e||"").trim();if(!n)return"";const o=this.resolveBranchByIdOrName(n,n);if(o?.branchName)return String(o.branchName).trim();const r=this.resolveHubByIdOrName(n,n);return r?.hubName?String(r.hubName).trim():n}getManifestItemCount(e){return(Array.isArray(e?.items)?e.items:[]).length}getManifestUrl(e){const n=String(e?._id||"").trim();return n?`/manifests/${n}`:"#"}openManifestDetails(e){if(!e?._id)return;if(!(Array.isArray(e?.items)?e.items:[]).length)return this.selectedManifestDetails={manifest:e,deliveryPoint:this.getManifestDeliveryPointName(e)||this.getManifestEntityName(e)||"-",pickupPoint:"-",consignments:[]},void(this.showManifestDetails=!0);const o=String(e._id||"");o&&this.http.get(`http://localhost:3000/api/manifests/${o}/consignments`).subscribe({next:r=>{const s=String(e._id||""),d=(r||[]).filter(b=>String(b?.manifestId||"").trim()===s).map(b=>{const y=this.enrichShipmentDetails(b),P=(Array.isArray(y?.ewaybills)?y.ewaybills.flatMap(V=>V?.invoices||[]):y?.invoices||[]).flatMap(V=>V?.products||[]),T=new Map;P.forEach(V=>{const U=String(V?.type||V?.productName||"").trim();if(!U)return;const G=T.get(U)||{name:U,amount:0,instock:0,intransit:0,delivered:0};G.amount+=Number(V?.amount)||0,G.instock+=Number(V?.instock)||0,G.intransit+=Number(V?.intransitstock)||0,G.delivered+=Number(V?.deliveredstock)||0,T.set(U,G)});const A=Array.from(T.values()),E=String(b?.manifestId||s);return{shipmentId:y?._id?String(y._id):"",consignmentNumber:y?.consignmentNumber||"",shipmentStatus:y?.shipmentStatus||"",shipmentStatusDetails:y?.shipmentStatusDetails||"",currentLocation:this.resolveLocationNameByIdOrName(this.normalizeId(y?.currentLocationId||y?.currentBranch)||String(y?.currentBranch||""))||"-",originLocId:this.normalizeId(y?.originLocId||y?.branch),originType:y?.originType||(y?.originLocId?"hub":""),pickupName:y?.pickupName||"",pickupAddress:y?.pickupAddress||"",pickupPhone:y?.pickupPhone||"",pickupPincode:y?.pickupPincode||"",productSummary:A,manifestId:E}});let g=this.getManifestDeliveryPointName(e),m="-";if(!g||"-"===g){const b=String(d?.[0]?.shipmentStatusDetails||"").trim(),y=this.getLastStatusDetailoriginLocId(b);g=this.resolveLocationNameByIdOrName(y)||this.getManifestEntityName(e)||"-"}d?.length&&(m=this.resolveLocationNameByIdOrName(d[0]?.pickupName||"")||"-"),this.selectedManifestDetails={manifest:e,deliveryPoint:g,pickupPoint:m,consignments:d},this.showManifestDetails=!0,this.resetConsignmentEditState()},error:r=>{console.error("Failed to load manifest consignments",r),this.selectedManifestDetails={manifest:e,deliveryPoint:this.getManifestDeliveryPointName(e)||this.getManifestEntityName(e)||"-",pickupPoint:"-",consignments:[]},this.showManifestDetails=!0,this.resetConsignmentEditState()}})}refreshSelectedManifestDetails(e){if(!this.showManifestDetails)return;const n=this.normalizeId(this.selectedManifestDetails?.manifest?._id),o=this.normalizeId(e);if(!n||!o||n!==o)return;const r=this.selectedManifestDetails?.manifest;r&&this.openManifestDetails(r)}closeManifestDetails(){this.showManifestDetails=!1,this.selectedManifestDetails=null,this.resetConsignmentEditState()}canDeliverManifest(e){const n=String(e?.status||"").trim().toLowerCase();return"completed"!==n&&"cancelled"!==n}canCancelManifest(e){const n=String(e?.status||"").trim().toLowerCase();return"completed"!==n&&"cancelled"!==n}canUncancelManifest(e){if("cancelled"!==String(e?.status||"").trim().toLowerCase())return!1;let o=!0;"boolean"==typeof e?.canUncancel&&(o=e.canUncancel);const r=this.normalizeId(this.selectedManifestDetails?.manifest?._id),s=this.normalizeId(e?._id);return r&&s&&r===s&&(Array.isArray(this.selectedManifestDetails?.consignments)?this.selectedManifestDetails.consignments:[]).some(p=>"delivered"===String(p?.shipmentStatus||"").trim().toLowerCase())&&(o=!1),o}isCancelledManifest(e){return"cancelled"===String(e?.status||"").trim().toLowerCase()}canEditConsignments(e){const n=String(e?.status||"").trim().toLowerCase();return"completed"!==n&&"cancelled"!==n}resetConsignmentEditState(){this.showConsignmentEdit=!1,this.eligibleConsignments=[],this.consignmentEditLoading=!1,this.consignmentEditError="",this.consignmentsToAdd.clear(),this.consignmentsToRemove.clear()}startConsignmentEdit(e){e?._id&&(this.resetConsignmentEditState(),this.showConsignmentEdit=!0,this.loadEligibleConsignments(e))}cancelConsignmentEdit(){this.resetConsignmentEditState()}loadEligibleConsignments(e){this.consignmentEditLoading=!0,this.http.get(`http://localhost:3000/api/manifests/${e._id}/eligible-consignments`,{}).subscribe({next:n=>{this.eligibleConsignments=Array.isArray(n?.consignments)?n.consignments:[],this.consignmentEditLoading=!1},error:n=>{console.error("Failed to load eligible consignments",n),this.consignmentEditError="Failed to load eligible consignments.",this.consignmentEditLoading=!1}})}getConsignmentKey(e){return String(e?._id||e?.shipmentId||"").trim()}toggleConsignmentAdd(e){const n=this.getConsignmentKey(e);n&&(this.consignmentsToAdd.has(n)?this.consignmentsToAdd.delete(n):this.consignmentsToAdd.add(n))}toggleConsignmentRemove(e){const n=this.getConsignmentKey(e);n&&(this.consignmentsToRemove.has(n)?this.consignmentsToRemove.delete(n):this.consignmentsToRemove.add(n))}isConsignmentMarkedForAdd(e){const n=this.getConsignmentKey(e);return!!n&&this.consignmentsToAdd.has(n)}isConsignmentMarkedForRemove(e){const n=this.getConsignmentKey(e);return!!n&&this.consignmentsToRemove.has(n)}applyConsignmentEdit(e){if(!e?._id)return;const n=Array.from(this.consignmentsToAdd.values()),o=Array.from(this.consignmentsToRemove.values());this.http.patch(`http://localhost:3000/api/manifests/${e._id}/consignments`,{addShipmentIds:n,removeShipmentIds:o}).subscribe({next:r=>{if(this.resetConsignmentEditState(),this.loadManifests(),this.loadStocks(),r?.manifest){const s={...r.manifest,items:r.items||[]};this.openManifestDetails(s)}else this.refreshSelectedManifestDetails(e._id)},error:r=>{console.error("Failed to update manifest consignments",r),alert("Failed to update consignments.")}})}isObjectId(e){return/^[a-f0-9]{24}$/i.test(String(e||"").trim())}getManifestConsignments(){const e=String(this.selectedManifestDetails?.manifest?._id||"");if(!e)return[];const n=["Manifestation","DManifestation"];return(this.selectedManifestDetails?.consignments||[]).filter(o=>{const r=String(o?.shipmentStatus||"").trim();return!(r&&!n.includes(r))&&String(o?.manifestId||"").trim()===e})}deliverManifest(e){if(!e?._id)return;const n=Array.isArray(e?.items)?e.items:[],o=Array.from(new Set(n.map(s=>String(s?.consignmentNumber||"").trim()).filter(Boolean)));o.length?confirm(`Deliver manifest ${e.manifestNumber||""} for ${o.length} consignments?`)&&this.http.put(`http://localhost:3000/api/manifests/${e._id}/status`,{status:"Completed"}).subscribe({next:()=>{this.loadManifests(),this.loadStocks()},error:s=>{console.error("Failed to update manifest status",s),alert("Failed to update manifest status.")}}):alert("No consignments found for this manifest.")}cancelManifest(e){if(!e?._id)return;const n=Array.isArray(e?.items)?e.items:[],o=Array.from(new Set(n.map(s=>String(s?.consignmentNumber||"").trim()).filter(Boolean)));o.length?confirm(`Cancel manifest ${e.manifestNumber||""} for ${o.length} consignments?`)&&this.http.put(`http://localhost:3000/api/manifests/${e._id}/status`,{status:"Cancelled"}).subscribe({next:()=>{this.loadManifests(),this.loadStocks(),this.refreshSelectedManifestDetails(e._id)},error:s=>{console.error("Failed to cancel manifest",s),alert("Failed to cancel manifest.")}}):alert("No consignments found for this manifest.")}uncancelManifest(e){if(!e?._id)return;const n=Array.isArray(e?.items)?e.items:[],o=Array.from(new Set(n.map(s=>String(s?.consignmentNumber||"").trim()).filter(Boolean)));o.length?confirm(`Uncancel manifest ${e.manifestNumber||""} for ${o.length} consignments?`)&&this.http.put(`http://localhost:3000/api/manifests/${e._id}/status`,{status:"Scheduled"}).subscribe({next:()=>{this.loadManifests(),this.loadStocks(),this.refreshSelectedManifestDetails(e._id)},error:s=>{console.error("Failed to uncancel manifest",s),alert("Failed to uncancel manifest.")}}):alert("No consignments found for this manifest.")}getBaseStocks(e){if("all"===(this.originLocId||localStorage.getItem("originLocId")||"all"))return(e||[]).filter("other-branch"===this.activeTab||"others-in-branch"===this.activeTab?r=>{const s=String(r.shipmentStatus||"").trim();if(!this.isAllowedDeliveryStatus(s))return!1;const a=this.getOriginId(r),d=this.normalizeId(r.currentLocationId||r.currentBranch);return a&&d&&a!==d}:r=>{const s=String(r.shipmentStatus||"").trim();return this.isAllowedManifestStatus(s)});if("other-branch"===this.activeTab){const r=this.originLocId||localStorage.getItem("originLocId")||"all",s=this.normalizeId("all-hubs"===r?this.selectedHubFilterId||localStorage.getItem("hubId"):r);if(!s||"all"===s)return[];const a=(this.branches||[]).find(m=>this.normalizeId(m?._id)===s),d=a?null:(this.hubs||[]).find(m=>this.normalizeId(m?._id)===s),p=String(a?.branchName||d?.hubName||"").trim(),g=p.toLowerCase();return(e||[]).filter(m=>{const b=String(m.shipmentStatus||"").trim();if(!this.isAllowedDeliveryStatus(b))return!1;const y=this.getOriginId(m),I=String(m.branch||"").trim(),P=this.normalizeId(m.currentLocationId||m.currentBranch),T=!!y&&y===s,A=!!p&&!!I&&(I.toLowerCase()===g||this.matchesBranchLabel(I,p));return y&&P&&(T||A)&&y!==P})}if("others-in-branch"===this.activeTab){const r=this.originLocId||localStorage.getItem("originLocId")||"all",s=this.normalizeId("all-hubs"===r?this.selectedHubFilterId||localStorage.getItem("hubId"):r);if(!s||"all"===s)return[];const a=(this.branches||[]).find(m=>this.normalizeId(m?._id)===s),d=a?null:(this.hubs||[]).find(m=>this.normalizeId(m?._id)===s),p=String(a?.branchName||d?.hubName||"").trim(),g=p.toLowerCase();return(e||[]).filter(m=>{const b=String(m.shipmentStatus||"").trim();if(!this.isAllowedDeliveryStatus(b))return!1;const y=this.getOriginId(m),I=this.normalizeId(m.currentLocationId||m.currentBranch),P=String(m.currentBranch||"").trim(),T=!!I&&I===s,A=!!p&&!!P&&(P.toLowerCase()===g||this.matchesBranchLabel(P,p));return y&&I&&(T||A)&&y!==I})}const o=this.getSelectedManifestoriginLocId();return o?(e||[]).filter(r=>{const s=String(r.shipmentStatus||"").trim();if(!this.isAllowedManifestStatus(s))return!1;const a=this.normalizeId(r.currentLocationId||r.currentBranch||r.currentBranch),d=String(r.currentBranch||"").trim();return a&&this.matchesSelectedBranch(a,d,o)}):[]}getSelectedManifestoriginLocId(){const e=this.originLocId||localStorage.getItem("originLocId")||"all";return"all-hubs"===e?this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId")):e&&"all"!==e?this.normalizeId(e):""}getManifestEntityFilter(){const e=this.originLocId||localStorage.getItem("originLocId")||"all";if("all-hubs"===e){const n=this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId"));return n?{entityType:"hub",entityId:n}:null}return e&&"all"!==e?{entityType:"branch",entityId:this.normalizeId(e)}:null}getManifestOriginFilter(){const e=this.originLocId||localStorage.getItem("originLocId")||"all";if("all-hubs"===e){const n=this.normalizeId(this.selectedHubFilterId||localStorage.getItem("hubId"));return n?{originType:"hub",originLocId:n}:null}return e&&"all"!==e?{originType:"branch",originLocId:this.normalizeId(e)}:null}loadManifests(){const e={},n=this.getManifestEntityFilter();n?.entityType&&n?.entityId&&(e.entityType=n.entityType,e.entityId=n.entityId);const o=this.getManifestOriginFilter();o?.originType&&o?.originLocId&&(e.originType=o.originType,e.originLocId=o.originLocId),this.http.get("http://localhost:3000/api/manifests",{params:e}).subscribe({next:r=>{this.manifests=Array.isArray(r)?r:[]},error:r=>console.error("Error loading manifests:",r)})}filterManifests(e){const n=Array.isArray(e)?e:[],o=String(this.manifestSearchText||"").trim().toLowerCase(),r=String(this.manifestStatusFilter||"").trim().toLowerCase(),s=String(this.manifestVehicleFilter||"").trim().toLowerCase();return n.filter(a=>{const d=String(a?.manifestNumber||"").toLowerCase(),p=!o||d.includes(o),g=String(a?.status||"").trim().toLowerCase(),m=!r||g===r,b=String(a?.vehicleNo||"").trim().toLowerCase(),y=!s||b.includes(s);return p&&m&&y})}getDeliveryDisplayName(e){const n=String(e?.deliveryName||"").trim();if(n)return n;const o=this.normalizeId(e?.deliveryID);if(!o)return"-";const r=(this.branches||[]).find(d=>this.normalizeId(d?._id)===o);if(r?.branchName)return r.branchName;const s=(this.clientList||[]).find(d=>this.normalizeId(d?._id)===o);if(s?.clientName)return s.clientName;const a=(this.guestList||[]).find(d=>this.normalizeId(d?._id)===o);return a?.guestName?a.guestName:o}firstNonEmpty(...e){for(const n of e){if(null==n)continue;const o=String(n).trim();if(o)return o}return"-"}resolveClientByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.clientList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.clientName||"").trim().toLowerCase()===r)||null}resolveGuestByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.guestList||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.guestName||"").trim().toLowerCase()===r)||null}resolveBranchByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.branches||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.branchName||"").trim().toLowerCase()===r)||null}resolveHubByIdOrName(e,n){const o=this.normalizeId(e),r=String(n||"").trim().toLowerCase();return(this.hubs||[]).find(s=>o&&this.normalizeId(s?._id)===o||r&&String(s?.hubName||"").trim().toLowerCase()===r)||null}resolveBranchByVehicle(e){const n=String(e||"").trim().toLowerCase();return n&&(this.branches||[]).find(o=>(o?.vehicles||[]).some(r=>String(r?.vehicleNo||"").trim().toLowerCase()===n))||null}resolveHubByVehicle(e){const n=String(e||"").trim().toLowerCase();return n&&(this.hubs||[]).find(o=>(o?.deliveryAddresses||[]).some(r=>(r?.vehicles||[]).some(s=>String(s?.vehicleNo||"").trim().toLowerCase()===n)))||null}findVehicleStatus(e){const n=String(e||"").trim().toLowerCase();if(!n)return"";for(const o of this.branches||[]){const r=(o?.vehicles||[]).find(s=>String(s?.vehicleNo||"").trim().toLowerCase()===n);if(r)return String(r?.vehicleStatus||"").trim().toLowerCase()}for(const o of this.hubs||[])for(const r of o?.deliveryAddresses||[]){const s=(r?.vehicles||[]).find(a=>String(a?.vehicleNo||"").trim().toLowerCase()===n);if(s)return String(s?.vehicleStatus||"").trim().toLowerCase()}return""}resolveVehicleOwner(e,n,o){const r=String(n||"").trim().toLowerCase(),s=String(o||"").trim();if(s&&("branch"===r||"hub"===r))return{ownerType:"branch"===r?"Branch":"Hub",ownerId:s};const a=this.resolveBranchByVehicle(e);if(a?._id)return{ownerType:"Branch",ownerId:String(a._id)};const d=this.resolveHubByVehicle(e);return d?._id?{ownerType:"Hub",ownerId:String(d._id)}:{ownerType:"",ownerId:""}}resolveClientLocation(e,n){if(!e)return null;const o=this.normalizeId(n),r=e?.deliveryLocations||[];return o?r.find(s=>this.normalizeId(s?.delivery_id)===o)||null:r[0]||null}enrichShipmentDetails(e){const n={...e},o="guest"===e?.consignorTab?this.resolveGuestByIdOrName(e?.consignorId,e?.consignor):this.resolveClientByIdOrName(e?.consignorId,e?.consignor),r="guest"===e?.consigneeTab?this.resolveGuestByIdOrName(e?.consigneeId,e?.consignee):this.resolveClientByIdOrName(e?.consigneeId,e?.consignee);if(n.consignor=this.firstNonEmpty(n.consignor,o?.clientName,o?.guestName),n.consignorGST=this.firstNonEmpty(n.consignorGST,o?.GSTIN,"guest"===e?.consignorTab?"GUEST":""),n.consignorPhone=this.firstNonEmpty(n.consignorPhone,o?.phoneNum),n.consignorAddress=this.firstNonEmpty(n.consignorAddress,o?.address),n.consignee=this.firstNonEmpty(n.consignee,r?.clientName,r?.guestName),n.consigneeGST=this.firstNonEmpty(n.consigneeGST,r?.GSTIN,"guest"===e?.consigneeTab?"GUEST":""),n.consigneePhone=this.firstNonEmpty(n.consigneePhone,r?.phoneNum),n.consigneeAddress=this.firstNonEmpty(n.consigneeAddress,r?.address),"consignor"===e?.billingType)n.billingName=this.firstNonEmpty(n.billingName,n.consignor),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,n.consignorGST),n.billingPhone=this.firstNonEmpty(n.billingPhone,n.consignorPhone),n.billingAddress=this.firstNonEmpty(n.billingAddress,n.consignorAddress);else{const a=this.resolveClientByIdOrName(e?.billingClientId,e?.billingName);n.billingName=this.firstNonEmpty(n.billingName,a?.clientName),n.billingGSTIN=this.firstNonEmpty(n.billingGSTIN,a?.GSTIN),n.billingPhone=this.firstNonEmpty(n.billingPhone,a?.phoneNum),n.billingAddress=this.firstNonEmpty(n.billingAddress,a?.address)}if("branch"===e?.pickupType){const a=this.resolveBranchByIdOrName(e?.pickupLocationId,e?.pickupName)||this.resolveBranchByIdOrName(null,e?.branch);n.pickupName=this.firstNonEmpty(n.pickupName,a?.branchName),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,a?.address),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,a?.phoneNum),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,a?.pinCode)}else"consignor"===e?.pickupType&&(n.pickupName=this.firstNonEmpty(n.pickupName,n.consignor),n.pickupAddress=this.firstNonEmpty(n.pickupAddress,n.consignorAddress),n.pickupPhone=this.firstNonEmpty(n.pickupPhone,n.consignorPhone),n.pickupPincode=this.firstNonEmpty(n.pickupPincode,o?.pinCode));if("Customer self pick up"===e?.deliveryType||"branch"===e?.deliveryType||"hub"===e?.deliveryType){const a=this.resolveBranchByIdOrName(e?.deliveryID,e?.deliveryName),d=a?null:this.resolveHubByIdOrName(e?.deliveryID,e?.deliveryName);n.deliveryName=this.firstNonEmpty(n.deliveryName,a?.branchName,d?.hubName),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,a?.address,d?.address),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,a?.phoneNum,d?.phoneNum),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,a?.pinCode,d?.pinCode)}else{const a=this.resolveClientByIdOrName(e?.deliveryID,e?.deliveryName),d=this.resolveGuestByIdOrName(e?.deliveryID,e?.deliveryName),p=this.resolveClientLocation(a,e?.deliveryLocationId);n.deliveryName=this.firstNonEmpty(n.deliveryName,a?.clientName,d?.guestName,n.consignee),n.deliveryAddress=this.firstNonEmpty(n.deliveryAddress,p?.address,a?.address,d?.address,n.consigneeAddress),n.deliveryPhone=this.firstNonEmpty(n.deliveryPhone,a?.phoneNum,d?.phoneNum,n.consigneePhone),n.deliveryPincode=this.firstNonEmpty(n.deliveryPincode,p?.pinCode,a?.pinCode,d?.pinCode)}return n}getProductTotal(e,n){let o=0;return e.forEach(r=>{r.invoices.forEach(s=>{s.products.forEach(a=>{o+=a[n]||0})})}),o}applyFilters(){const e=this.originLocId||localStorage.getItem("originLocId")||"all",n=this.normalizeId(this.selectedHubFilterId),o="all-hubs"===e&&("stocks"===this.activeTab||"other-branch"===this.activeTab||"others-in-branch"===this.activeTab);if(o&&!n){const a=this.normalizeId(localStorage.getItem("hubId")),d=String(localStorage.getItem("hubName")||"").trim();if(a){const p=(this.hubs||[]).find(g=>this.normalizeId(g?._id)===a);this.selectedHubFilterId=a,this.selectedHubFilterName=String(p?.hubName||d||"").trim()}else{const p=this.getAllHubsFilterOptions(),g=this.normalizeId(p?.[0]?._id);this.selectedHubFilterId=g||null,this.selectedHubFilterName=String(p?.[0]?.hubName||"").trim()}}const r=this.normalizeId(this.selectedHubFilterId);if(r&&!this.selectedHubFilterName){const a=(this.hubs||[]).find(d=>this.normalizeId(d?._id)===r);this.selectedHubFilterName=String(a?.hubName||"").trim()}const s=this.selectedHubFilterName;this.filteredStocks=this.stocks.filter(a=>(!this.searchText||a.consignmentNumber?.includes(this.searchText)||a.consignor?.includes(this.searchText))&&(!this.filterDate||new Date(a.date).toISOString().split("T")[0]===this.filterDate)&&(!this.filterConsignor||a.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()))&&(!this.filterStatus||String(a.shipmentStatus||"").trim()===this.filterStatus)&&(!o||r&&this.matchesHubFilter(a,r,s)))}onHubFilterChange(e){this.selectedHubFilterId=e;const n=(this.hubs||[]).find(o=>this.normalizeId(o?._id)===this.normalizeId(e));this.selectedHubFilterName=String(n?.hubName||"").trim(),e&&(localStorage.setItem("hubId",String(e)),localStorage.setItem("hubName",this.selectedHubFilterName)),this.applyFilters()}getAllHubsFilterOptions(){return this.hubs||[]}matchesHubFilter(e,n,o){if(!n)return!1;const r=!!o;if("stocks"===this.activeTab){const s=this.normalizeId(e?.currentLocationId||e?.currentBranch),a=String(e?.currentBranch||"").trim();return s===n||r&&a.toLowerCase()===o.toLowerCase()||r&&this.matchesBranchLabel(a,o)}if("other-branch"===this.activeTab){const s=this.getOriginId(e),a=String(e?.branch||"").trim();return s===n||r&&a.toLowerCase()===o.toLowerCase()||r&&this.matchesBranchLabel(a,o)}if("others-in-branch"===this.activeTab){const s=this.normalizeId(e?.currentLocationId||e?.currentBranch),a=String(e?.currentBranch||"").trim();return s===n||r&&a.toLowerCase()===o.toLowerCase()||r&&this.matchesBranchLabel(a,o)}return this.getStockHubId(e)===n}getStockHubId(e){return this.getOriginId(e)||this.normalizeId(e?.currentLocationId||e?.currentBranch)}toggleAllSelection(e){const n=e.target.checked;this.filteredStocks.forEach(o=>o.selected=n)}clearSelection(){this.filteredStocks.forEach(e=>{e.selected=!1}),this.selectedForManifestation=[]}hasSelectedConsignment(){return(this.filteredStocks||[]).some(e=>e.selected)}openCancelPopup(){"all"!==String(this.originLocId||"").trim().toLowerCase()?this.hasSelectedConsignment()&&(this.showCancelPopup=!0):alert("Please select a specific branch for canceling")}closeCancelPopup(){this.showCancelPopup=!1}getSelectedConsignments(){return(this.filteredStocks||[]).filter(e=>e.selected)}removeSelection(e){e&&(e.selected=!1)}confirmCancelSelection(){const e=this.getSelectedConsignments();e.length?Pn(e.map(o=>{const r=o?._id?encodeURIComponent(o._id):"",s=r?`?shipmentId=${r}`:"",a={...o,shipmentStatus:"Deleted during Transportation",currentVehicleNo:"",currentVehicleOwnerType:"",currentVehicleOwnerId:null};return this.http.put(`http://localhost:3000/api/newshipments/${o.consignmentNumber}${s}`,a)})).subscribe({next:()=>{this.closeCancelPopup(),this.clearSelection(),this.loadStocks()},error:o=>{console.error("Error deleting consignments:",o),this.deleteErrorMessage="Failed to delete consignments. Please try again.",this.showDeleteErrorPopup=!0}}):this.closeCancelPopup()}closeDeleteErrorPopup(){this.showDeleteErrorPopup=!1}setActiveTab(e){this.activeTab!==e&&(this.activeTab=e,"stocks"===e?this.isAllowedDeliveryStatus(String(this.filterStatus||"").trim())&&(this.filterStatus="Manifestation"):this.isAllowedDeliveryStatus(String(this.filterStatus||"").trim())||(this.filterStatus=""),this.loadStocks())}openStockDetails(e){this.selectedStock=this.enrichShipmentDetails(e)}closeStockDetails(){this.selectedStock=null}editStock(e){console.log("?o??,? Edit stock:",e);const n=JSON.parse(JSON.stringify(e));n.invoices=this.flattenInvoices(n.ewaybills||n.invoices||[]),this.editingStock=n,this.manifestEditsById={},this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1,this.captureOriginalProductValues(this.editingStock)}saveStockEdit(){if(!this.editingStock||(this.pendingManifestAdjustment||this.showManifestAdjustmentPopup)&&(this.applyManifestAdjustments(),this.pendingManifestAdjustment||this.showManifestAdjustmentPopup))return;this.syncEwaybillsFromInvoices(),console.log("kkkkkkkkkkklllllllllllllllll"+this.editingStock.consignmentNumber);const e=this.buildShipmentPayload(),n=Object.values(this.manifestEditsById||{});(n.length?Pn(n.map(r=>this.http.put(`http://localhost:3000/api/manifest/${r._id}`,r))):Q([])).subscribe({next:()=>{this.http.put(`http://localhost:3000/api/newshipments/${e.consignmentNumber}`,e).subscribe({next:()=>{console.log("?o. Stock updated"),this.loadStocks(),this.editingStock=null},error:r=>console.error("??O Error updating stock:",r)})},error:r=>{console.error("??O Error updating manifests:",r),alert("Failed to update manifests. Please try again.")}})}cancelEdit(){this.editingStock=null,this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}captureOriginalProductValues(e){(e?.invoices||[]).forEach(n=>{(n.products||[]).forEach(o=>{o._originalAmount=Number(o.amount)||0,o._originalInstock=Number(o.instock)||0,o._originalIntransit=Number(o.intransitstock)||0,o._originalDelivered=Number(o.deliveredstock)||0})})}resetProductToOriginal(e){e.amount=Number(e._originalAmount)||0,e.instock=Number(e._originalInstock)||0,e.intransitstock=Number(e._originalIntransit)||0,e.deliveredstock=Number(e._originalDelivered)||0}normalizeInvoiceNumber(e){return String(e?.number||e?.invoicenum||"").trim()}normalizeProductType(e){return String(e?.type||"").trim()}getManifestTotals(){const e=this.manifestAdjustmentLines||[],n=e.filter(s=>s?.isDelivered).reduce((s,a)=>s+(Number(a.newManifestQty)||0),0),o=e.reduce((s,a)=>s+(Number(a.newManifestQty)||0),0);return{manifestTotal:o,deliveredTotal:n,intransitTotal:Math.max(0,o-n)}}syncEwaybillsFromInvoices(){if(this.editingStock?.ewaybills?.length&&this.editingStock?.invoices?.length)for(const e of this.editingStock.invoices||[]){const n=this.normalizeInvoiceNumber(e);for(const o of this.editingStock.ewaybills||[])for(const r of o.invoices||[])if(this.normalizeInvoiceNumber(r)===n)for(const s of r.products||[]){const a=(e.products||[]).find(d=>this.normalizeProductType(d)===this.normalizeProductType(s));a&&(s.amount=a.amount,s.instock=a.instock,s.intransitstock=a.intransitstock,s.deliveredstock=a.deliveredstock,void 0!==a.manifestQty&&(s.manifestQty=a.manifestQty))}}}applyProductUpdate(e,n,o,r){const s=String(n||"").trim(),a=String(o||"").trim();(e||[]).forEach(d=>{const p=this.normalizeInvoiceNumber(d);s&&p!==s||(d.products||[]).forEach(g=>{this.normalizeProductType(g)===a&&r(g)})})}isProductManifested(e){return Number(e?._originalIntransit??e?.intransitstock??0)>0}onProductAmountFocus(e,n,o){this.isProductManifested(n)&&this.openManifestAdjustmentPopup(e,n,n.amount,o)}onProductAmountChange(e,n,o,r){if(!this.editingStock)return;let s=Number(o);Number.isFinite(s)||(s=0),s<0&&(s=0);const a=Number(n._originalAmount)||0,d=Number(n._originalInstock)||0,p=Number(n._originalIntransit)||0,g=Number(n._originalDelivered)||0;if(!this.isProductManifested(n)){if(s>=a){const y=s-a;return n.amount=s,n.instock=d+y,n.intransitstock=p,void(n.deliveredstock=g)}const b=a-s;return b<=d?(n.amount=s,n.instock=d-b,n.intransitstock=p,void(n.deliveredstock=g)):(alert("Reduction exceeds available in-stock quantity."),void this.resetProductToOriginal(n))}if(a-s>d+p)return alert("Reduction exceeds available in-stock and manifested quantity."),void this.resetProductToOriginal(n);this.pendingManifestAdjustment&&this.pendingManifestAdjustment.productRef===n?(this.pendingManifestAdjustment.targetAmount=s,n.amount=s):this.openManifestAdjustmentPopup(e,n,s,r)}openManifestAdjustmentPopup(e,n,o,r){const s=this.editingStock?.consignmentNumber;if(!s)return;let a=this.normalizeInvoiceNumber(e);!a&&Number.isFinite(r)&&(a=`MAN-${String(s||"").trim()}-${Number(r)+1}`),this.pendingManifestAdjustment={consignmentNumber:s,invoiceNumber:a,productType:this.normalizeProductType(n),targetAmount:Number(o)||0,popupInstock:Number(n._originalInstock)||0,originalAmount:Number(n._originalAmount)||0,originalInstock:Number(n._originalInstock)||0,originalIntransit:Number(n._originalIntransit)||0,originalDelivered:Number(n._originalDelivered)||0,productRef:n},this.http.get(`http://localhost:3000/api/manifest/by-consignment/${encodeURIComponent(s)}`).subscribe({next:d=>{this.manifestAdjustments=d||[],this.buildManifestAdjustmentLines()},error:d=>{console.error("Error loading manifests:",d),alert("Failed to load manifests for adjustment."),this.cancelManifestAdjustments()}})}buildManifestAdjustmentLines(){const e=this.pendingManifestAdjustment;if(!e)return;const n=e.productType,o=e.consignmentNumber,r=[];for(const s of this.manifestAdjustments||[])for(const a of s.consignments||[])if(String(a.consignmentNumber||"").trim()===o)for(const d of a.invoices||[]){const p=this.normalizeInvoiceNumber(d);if(!e.invoiceNumber||p===e.invoiceNumber)for(const g of d.products||[]){if(this.normalizeProductType(g)!==n)continue;const m=Number(g.manifestQty)||0;r.push({manifestId:s._id,manifestationNumber:s.manifestationNumber,date:s.date,manifestStatus:s.mshipmentStatus,consignmentNumber:o,invoiceNumber:p,productType:n,originalManifestQty:m,newManifestQty:m,isDelivered:"delivered"===String(s.mshipmentStatus||"").toLowerCase()})}}if(!r.length)return alert("No manifest lines found for this product."),void this.cancelManifestAdjustments();this.manifestAdjustmentLines=r,this.syncPopupInstockWithTarget(),this.showManifestAdjustmentPopup=!0}onManifestQtyChange(e){let n=Number(e.newManifestQty);Number.isFinite(n)||(n=0),n<0&&(n=0),e.newManifestQty=n;const o=this.pendingManifestAdjustment;if(!o)return;const r=this.getManifestTotals();o.targetAmount=(Number(o.popupInstock)||0)+r.manifestTotal,o.productRef&&(o.productRef.amount=Number(o.targetAmount)||0)}getManifestLineTotal(){return this.getManifestTotals().manifestTotal}getPopupTargetTotal(){const e=this.pendingManifestAdjustment;return e&&Number(e.targetAmount)||0}getPopupDeliveredTotal(){return this.getManifestTotals().deliveredTotal}getPopupInstockTotal(){const e=this.pendingManifestAdjustment;if(!e)return 0;const n=this.getManifestTotals();return(Number(e.targetAmount)||0)-n.manifestTotal}syncPopupInstockWithTarget(){const e=this.pendingManifestAdjustment;if(!e)return;const n=this.getManifestTotals(),r=(Number(e.targetAmount)||0)-n.manifestTotal;e.popupInstock=Math.max(0,r),e.targetAmount=e.popupInstock+n.manifestTotal}syncTargetFromInstock(){const e=this.pendingManifestAdjustment;if(!e)return;const n=Math.max(0,Number(e.popupInstock)||0);e.popupInstock=n;const o=this.getManifestTotals();e.targetAmount=n+o.manifestTotal}onPopupTargetAmountChange(e){const n=this.pendingManifestAdjustment;if(!n)return;let o=Number(e);Number.isFinite(o)||(o=0),o<0&&(o=0),n.targetAmount=o,this.syncPopupInstockWithTarget(),n.productRef&&(n.productRef.amount=o)}onPopupInstockChange(e){const n=this.pendingManifestAdjustment;if(!n)return;let o=Number(e);Number.isFinite(o)||(o=0),o<0&&(o=0),n.popupInstock=o,this.syncTargetFromInstock(),n.productRef&&(n.productRef.amount=Number(n.targetAmount)||0)}applyManifestAdjustments(){const e=this.pendingManifestAdjustment;if(!e)return;const n=this.getManifestTotals(),o=Math.max(0,Number(e.popupInstock)||0),r=o+n.manifestTotal;if(o<0)return void alert("New Total Qty must be at least manifest + delivered quantities.");for(const a of this.manifestAdjustmentLines||[])a.updatedAmount=r,a.updatedInstock=o,a.updatedIntransit=n.intransitTotal,a.updatedDelivered=n.deliveredTotal;for(const a of this.manifestAdjustmentLines||[])this.queueManifestUpdate(a);const s=a=>{a.amount=r,a.instock=o,a.intransitstock=n.intransitTotal,a.deliveredstock=n.deliveredTotal,a.manifestQty=n.manifestTotal};e.productRef&&s(e.productRef),this.applyProductUpdate(this.editingStock?.invoices||[],e.invoiceNumber,e.productType,s),(this.editingStock?.ewaybills||[]).forEach(a=>{this.applyProductUpdate(a.invoices||[],e.invoiceNumber,e.productType,s)}),this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}cancelManifestAdjustments(){const e=this.pendingManifestAdjustment;e?.productRef&&this.resetProductToOriginal(e.productRef),this.pendingManifestAdjustment=null,this.manifestAdjustmentLines=[],this.showManifestAdjustmentPopup=!1}queueManifestUpdate(e){const n=(this.manifestAdjustments||[]).find(o=>o._id===e.manifestId);if(n){for(const o of n.consignments||[])if(String(o.consignmentNumber||"").trim()===e.consignmentNumber)for(const r of o.invoices||[])if(this.normalizeInvoiceNumber(r)===e.invoiceNumber)for(const a of r.products||[])this.normalizeProductType(a)===e.productType&&(a.manifestQty=Number(e.newManifestQty)||0,void 0!==e.updatedAmount&&(a.amount=Number(e.updatedAmount)||0,a.instock=Number(e.updatedInstock)||0,a.intransitstock=Number(e.updatedIntransit)||0,a.deliveredstock=Number(e.updatedDelivered)||0));this.manifestEditsById[n._id]=n}}buildShipmentPayload(){const e=JSON.parse(JSON.stringify(this.editingStock)),n=o=>{delete o._originalAmount,delete o._originalInstock,delete o._originalIntransit,delete o._originalDelivered};return(e.ewaybills||[]).forEach(o=>{(o.invoices||[]).forEach(r=>{(r.products||[]).forEach(s=>n(s))})}),(e.invoices||[]).forEach(o=>{(o.products||[]).forEach(r=>n(r))}),e}onConsignorSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.editingStock.consignorGST=n.GSTIN,this.editingStock.consignorAddress=n.address,this.editingStock.consignorPhone=n.phoneNum)}onConsigneeSelect(e){const n=this.clientList.find(o=>o.clientName===e);n&&(this.editingStock.consigneeGST=n.GSTIN,this.editingStock.consigneeAddress=n.address,this.editingStock.consigneePhone=n.phoneNum)}onConsignorGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.editingStock.consignorGST="GUEST",this.editingStock.consignorAddress=n.address,this.editingStock.consignorPhone=n.phoneNum)}onConsigneeGuestSelect(e){const n=this.guestList.find(o=>o.guestName===e);n&&(this.editingStock.consigneeGST="GUEST",this.editingStock.consigneeAddress=n.address,this.editingStock.consigneePhone=n.phoneNum)}onPackageList(e){this.pkgList.find(o=>o.pkgName===e)}onProductList(e){this.productList.find(o=>o.productName===e)}addRoutePoint(){this.selectedRoutePoint&&(this.shipmentRoute.push({name:this.selectedRoutePoint.name,type:this.selectedRoutePoint.type,vehicleNo:this.selectedRouteVehicle||""}),this.selectedRoutePoint=null,this.selectedRouteVehicle="")}removeRoutePoint(e){this.shipmentRoute.splice(e,1)}loadBranches(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/branches?email=${e}`).subscribe({next:n=>{console.log("Branches loaded:",n),this.branches=n,this.updateAvailableRoutePoints(),this.loadStocks(),this.loadManifests()},error:n=>console.error("Error loading branches:",n)})}loadHubs(){const e=localStorage.getItem("email");this.http.get(`http://localhost:3000/api/hubs?email=${e}`).subscribe({next:n=>{if(console.log("Hubs loaded:",n),this.hubs=n,this.updateAvailableRoutePoints(),"all-hubs"===(this.originLocId||localStorage.getItem("originLocId")||"all")){const r=this.normalizeId(localStorage.getItem("hubId")),s=this.normalizeId((this.hubs||[])[0]?._id),a=r||s;if(a){this.selectedHubFilterId=a;const d=(this.hubs||[]).find(p=>this.normalizeId(p?._id)===a);this.selectedHubFilterName=String(d?.hubName||"").trim(),localStorage.setItem("hubId",a),localStorage.setItem("hubName",this.selectedHubFilterName)}this.loadStocks(),this.loadManifests()}},error:n=>console.error("Error loading hubs:",n)})}updateAvailableRoutePoints(){const e=String(this.originLocId||"").trim(),n=String(this.branch||"").trim().toLowerCase(),o=n&&"all branches"!==n;this.availableRoutePoints=[...this.branches.filter(r=>{if(!o)return!0;const s=e&&"all"!==e&&this.normalizeId(r?._id)===this.normalizeId(e),a=String(r?.branchName||"").trim().toLowerCase()===n;return!(s||a)}).map(r=>({name:r.branchName,type:"Branch",vehicles:(r.vehicles||[]).map(s=>s.vehicleNo).filter(Boolean)})),...this.hubs.filter(r=>{if(!o)return!0;if(e&&"all"!==e&&this.normalizeId(r?.originLocId)===this.normalizeId(e))return!1;const a=(this.branches||[]).find(p=>this.normalizeId(p?._id)===this.normalizeId(r?.originLocId));return!(a?.branchName&&String(a.branchName).trim().toLowerCase()===n)}).map(r=>({name:r.hubName,type:"Hub",vehicles:(r.deliveryAddresses||[]).flatMap(s=>(s.vehicles||[]).map(a=>a.vehicleNo)).filter(Boolean)}))],console.log("[manifest] route points",{originLocId:e,branchName:this.branch,points:this.availableRoutePoints.map(r=>`${r.name} (${r.type})`)})}onRoutePointChange(){this.selectedRouteVehicle=this.selectedRoutePoint?.vehicles?.[0]||""}ngOnInit(){this.activeTab="stocks",this.email=localStorage.getItem("email")||"",this.username=localStorage.getItem("username")||"",this.branch=this.branchService.currentBranch||localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all","all"===this.originLocId&&(this.filterStatus=""),this.branchSub=this.branchService.branch$.subscribe(o=>{this.branch=o,this.originLocId=localStorage.getItem("originLocId")||"all",this.updateAvailableRoutePoints(),this.loadStocks(),this.loadManifests()}),this.branchCheck=setInterval(()=>{const o=localStorage.getItem("branch")||"All Branches",r=localStorage.getItem("originLocId")||"all";(o!==this.branch||r!==this.originLocId)&&(this.branch=o,this.originLocId=r,this.updateAvailableRoutePoints(),this.loadStocks(),this.loadManifests())},1e3),window.addEventListener("storage",this.onStorageChange),this.http.get(`http://localhost:3000/api/clients/clientslist?emailId=${this.email}`).subscribe({next:o=>this.clientList=o,error:o=>console.error("Error fetching client list",o),complete:()=>console.log("Client list fetch complete")}),this.http.get(`http://localhost:3000/api/guests/guestslist?emailId=${this.email}`).subscribe({next:o=>this.guestList=o,error:o=>console.error("Error fetching guest list",o),complete:()=>console.log("Guest list fetch complete")}),this.http.get(`http://localhost:3000/api/pkgs/pkglist?emailId=${this.email}`).subscribe({next:o=>this.pkgList=o,error:o=>console.error("Error fetching package list",o),complete:()=>console.log("Package list fetch complete")});const e=this.getManifestOriginFilter(),n={branch:this.branch||localStorage.getItem("branch")||""};if(e)n.originType=e.originType,n.originLocId=e.originLocId;else{const o=this.originLocId||localStorage.getItem("originLocId")||"all";n.originLocId="all-hubs"===o?"all":o}this.http.get("http://localhost:3000/api/products/productlist",{params:n}).subscribe({next:o=>this.productList=o,error:o=>console.error("Error fetching product list",o),complete:()=>console.log("Product list fetch complete")}),this.loadBranches(),this.loadHubs()}ngOnDestroy(){this.branchSub?.unsubscribe(),this.branchCheck&&clearInterval(this.branchCheck),window.removeEventListener("storage",this.onStorageChange)}getEwaybillNumberFromDB(e){return this.stocks.find(o=>o.consignmentNumber===e)?.ewaybillNumber||""}openManifestationPopup(){"all"!==this.originLocId&&this.originLocId?(this.selectedForManifestation=this.filteredStocks.filter(e=>e.selected),0!==this.selectedForManifestation.length?(this.selectedForManifestation=this.selectedForManifestation.map(e=>{const n={...e,ewayBillRequired:!1,ewaybillNumber:this.getEwaybillNumberFromDB(e.consignmentNumber)};return n.invoices?.forEach(o=>{o.products?.forEach(r=>{const s=Number(r.amount)||0,a=Number(r.intransitstock)||0,d=Number(r.deliveredstock)||0,p=Math.max(0,s-a-d);!Number(r.instock)&&p>0&&(r.instock=p),r.manifestQty=Number(r.instock)||p,r.manifestQtyTouched=!1})}),n}),this.showManifestationPopup=!0):alert("G??n+? Please select at least one consignment to manifest.")):alert("Please select a specific branch before manifesting consignments.")}closeManifestationPopup(){this.showManifestationPopup=!1}executeDelivery(e,n){if(!e.length)return void alert("No consignments selected.");const o=[],r=new Map,s=(e||[]).map(d=>{const p=(d.ewaybills||[]).map(E=>({...E})),g=String(d?.shipmentStatus||"").trim(),m="Manifestation"===g||"DManifestation"===g,y=this.getLastStatusDetailoriginLocId(d?.shipmentStatusDetails||"")||d?.currentLocationId||d?.currentBranch||d?.currentBranch,I=String(d?.currentVehicleNo||"").trim(),P={shipmentId:d?._id||"",shipmentStatus:m?"DPending":"Delivered",currentLocationId:y,currentVehicleNo:d?.currentVehicleNo||"",currentVehicleOwnerType:d?.currentVehicleOwnerType||"",currentVehicleOwnerId:d?.currentVehicleOwnerId||null,clearAllVehicles:!0,ewaybills:p},T=d?._id?encodeURIComponent(d._id):"",A=T?`?shipmentId=${T}`:"";if(console.log("[manifest:update] payload",{consignmentNumber:d.consignmentNumber,shipmentId:P.shipmentId,shipmentStatus:P.shipmentStatus,currentLocationId:P.currentLocationId}),!m&&I&&y){const E=this.findVehicleStatus(I);if("scheduled"===E||"delivering"===E){const V=this.resolveVehicleOwner(I,d?.currentVehicleOwnerType,d?.currentVehicleOwnerId);V.ownerType&&V.ownerId&&r.set(`${V.ownerType}:${V.ownerId}:${I}`,{vehicleNo:I,ownerType:V.ownerType,ownerId:V.ownerId,locationId:String(y||"")})}}return this.http.put(`http://localhost:3000/api/newshipments/${d.consignmentNumber}${A}`,P)});r.forEach(d=>{o.push(this.http.patch("Hub"===d.ownerType?`http://localhost:3000/api/hubs/${d.ownerId}/vehicle-status`:`http://localhost:3000/api/branches/${d.ownerId}/vehicle-status`,{vehicleNo:d.vehicleNo,vehicleStatus:"online",currentLocationId:d.locationId}))});const a=[...s,...o];a.length&&Pn(a).subscribe({next:d=>{console.log("[manifest:update] response",d),n?n():(this.showManifestationPopup=!1,this.selectedForManifestation=[],this.filteredStocks.forEach(p=>p.selected=!1),this.loadStocks())},error:d=>{console.error("Error updating consignment status:",d),alert("Failed to update consignment status.")}})}finalizeManifestation(){this.executeDelivery(this.selectedForManifestation,()=>{this.showManifestationPopup=!1,this.selectedForManifestation=[],this.filteredStocks.forEach(e=>e.selected=!1),this.loadStocks()})}validateManifestQty(e){e.manifestQtyTouched=!0,e.manifestQty>e.instock&&(alert(`G??n+? Manifest quantity cannot exceed available stock (${e.instock}).`),e.manifestQty=e.instock),e.manifestQty<0&&(alert("G??n+? Manifest quantity cannot be negative."),e.manifestQty=0)}printReceipts(){const e=this.filteredStocks?.filter(n=>n.selected)||[];0!==e.length?fetch("assets/receipt-template.html").then(n=>n.text()).then(n=>{let o="\n        <html>\n          <head>\n            <style>\n              body { font-family: Arial, sans-serif; padding: 20px; }\n              h2 { margin-bottom: 0; }\n              table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n              th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n              th { background-color: #f2f2f2; }\n              .page-break { page-break-after: always; }\n            </style>\n          </head>\n          <body>\n      ";e.forEach((s,a)=>{const d=s.invoices.flatMap(g=>g.products.map(m=>`\n            <tr>\n              <td>${g.number}</td>\n              <td>${m.type}</td>\n              <td>${m.instock}</td>\n              <td>${m.manifestQty}</td>\n              <td>${m.amount}</td>\n            </tr>\n          `)).join(""),p=n.replace("{{consignmentNumber}}",s.consignmentNumber).replace("{{consignor}}",s.consignor).replace("{{rows}}",d);o+=p,a<e.length-1&&(o+='<div class="page-break"></div>')}),o+="</body></html>";const r=window.open("","_blank");r&&(r.document.open(),r.document.write(o),r.document.close(),r.print())}):alert("No consignments selected.")}static{this.\u0275fac=function(n){return new(n||t)(R(Ve),R(Xa))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-manifest"]],standalone:!0,features:[Ae],decls:37,vars:6,consts:[["noConsignments",""],[1,"stocks-container"],[1,"manifest-table-section"],[1,"manifest-filters"],["type","text","placeholder","Search manifest no.",3,"ngModelChange","ngModel"],["type","text","placeholder","Filter vehicle no.",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value",""],["value","Scheduled"],["value","Completed"],["value","Cancelled"],[1,"stocks-table"],[3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["class","modal",4,"ngIf"],[3,"click"],[3,"click",4,"ngIf"],[3,"disabled","click",4,"ngIf"],[3,"click","disabled"],["colspan","7"],[1,"modal"],[1,"modal-content","manifest-details-content"],["type","button",1,"details-close",3,"click"],["class","manifest-details-grid",4,"ngIf"],["class","manifest-details-actions",4,"ngIf"],["class","manifest-consignments",4,"ngIf","ngIfElse"],["class","consignment-edit-actions",4,"ngIf"],["class","consignment-edit-panel",4,"ngIf"],[1,"manifest-details-grid"],["target","_blank","rel","noopener noreferrer",3,"href"],[1,"manifest-details-actions"],[1,"manifest-consignments"],["class","consignment-split",4,"ngFor","ngForOf"],[1,"consignment-split"],[1,"consignment-header"],[1,"consignment-pickup"],[1,"pickup-address"],[4,"ngFor","ngForOf"],["colspan","5"],[1,"consignment-edit-actions"],[1,"consignment-edit-panel"],["class","consignment-edit-status",4,"ngIf"],["class","consignment-edit-status error",4,"ngIf"],[1,"consignment-edit-grid"],[1,"consignment-edit-list"],["class","consignment-edit-item",4,"ngFor","ngForOf"],["class","consignment-edit-empty",4,"ngIf"],[1,"consignment-edit-status"],[1,"consignment-edit-status","error"],[1,"consignment-edit-item"],["type","checkbox",3,"change","checked"],[1,"consignment-edit-empty"]],template:function(n,o){1&n&&(l(0,"div",1)(1,"h2"),u(2,"Manifest List"),c(),l(3,"div",2)(4,"div",3)(5,"input",4),S("ngModelChange",function(s){return x(o.manifestSearchText,s)||(o.manifestSearchText=s),s}),c(),l(6,"input",5),S("ngModelChange",function(s){return x(o.manifestVehicleFilter,s)||(o.manifestVehicleFilter=s),s}),c(),l(7,"select",6),S("ngModelChange",function(s){return x(o.manifestStatusFilter,s)||(o.manifestStatusFilter=s),s}),l(8,"option",7),u(9,"All statuses"),c(),l(10,"option",8),u(11,"Scheduled"),c(),l(12,"option",9),u(13,"Completed"),c(),l(14,"option",10),u(15,"Cancelled"),c()()(),l(16,"table",11)(17,"thead")(18,"tr")(19,"th"),u(20,"Manifest No."),c(),l(21,"th"),u(22,"Date"),c(),l(23,"th"),u(24,"Status"),c(),l(25,"th"),u(26,"Vehicle"),c(),l(27,"th"),u(28,"Entity"),c(),l(29,"th"),u(30,"Consignments"),c(),l(31,"th"),u(32,"Actions"),c()()(),l(33,"tbody"),D(34,Nz,18,12,"tr",12)(35,Tz,3,0,"tr",13),c()()(),D(36,Qz,15,6,"div",14),c()),2&n&&(h(5),w("ngModel",o.manifestSearchText),h(),w("ngModel",o.manifestVehicleFilter),h(),w("ngModel",o.manifestStatusFilter),h(27),C("ngForOf",o.filterManifests(o.manifests)),h(),C("ngIf",!o.filterManifests(o.manifests).length),h(),C("ngIf",o.showManifestDetails))},dependencies:[pt,lt,Xe,Fr,et,wt,St,qe,vt,We,He],styles:['.stocks-container[_ngcontent-%COMP%]{padding:20px;color:var(--stock-text)}[_nghost-%COMP%]{--stock-bg: #f6f8fb;--stock-card: #ffffff;--stock-border: #e5e7eb;--stock-text: #0f172a;--stock-muted: #6b7280;--stock-primary: #2563eb;--stock-primary-strong: #1e3a8a;--stock-danger: #dc2626}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}.stocks-tabs[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:12px}.stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 14px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.stocks-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#fff;color:var(--stock-text);flex:1 1 190px;min-width:0}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-text);cursor:pointer;flex:0 0 auto}.filters[_ngcontent-%COMP%]   button.cancel-btn[_ngcontent-%COMP%]{border-color:var(--stock-danger);color:var(--stock-danger);background:#fff5f5}.filters[_ngcontent-%COMP%]   button.cancel-btn[_ngcontent-%COMP%]:hover{border-color:#b91c1c;color:#b91c1c}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:var(--stock-primary);color:var(--stock-primary-strong)}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:7px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;font-size:11px}}.stocks-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;overflow:hidden}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--stock-border);padding:8px;text-align:left}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600}.stocks-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:10px;border:1px solid var(--stock-primary);background:var(--stock-primary);color:#fff;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--stock-primary-strong);border-color:var(--stock-primary-strong)}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled, .manifest-details-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#e5e7eb;border-color:#e5e7eb;color:#fff;cursor:not-allowed;opacity:1}.actions[_ngcontent-%COMP%]{margin-top:15px}.manifest-table-section[_ngcontent-%COMP%]{margin:20px 0}.manifest-table-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 10px}.manifest-filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin:8px 0 12px;flex-wrap:wrap}.manifest-filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .manifest-filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#fff;color:var(--stock-text);flex:1 1 180px;min-width:0}.manifest-details-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(720px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.manifest-details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px;margin-bottom:16px}.manifest-consignments[_ngcontent-%COMP%]{margin-top:10px}.consignment-split[_ngcontent-%COMP%]{border:1px solid var(--stock-border);border-radius:12px;padding:10px;background:var(--stock-card);margin-bottom:12px}.consignment-header[_ngcontent-%COMP%]{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:8px;color:var(--stock-muted);font-size:13px}.consignment-pickup[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px;color:var(--stock-text);font-size:12px}.consignment-pickup[_ngcontent-%COMP%]   .pickup-address[_ngcontent-%COMP%]{flex:1 1 100%}.consignment-edit-panel[_ngcontent-%COMP%]{margin:12px 0 16px;padding:12px;border:1px solid var(--stock-border);border-radius:12px;background:var(--stock-card)}.consignment-edit-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin-top:8px}.consignment-edit-list[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 8px;font-size:13px;color:var(--stock-text)}.consignment-edit-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--stock-text);padding:6px 8px;border:1px solid var(--stock-border);border-radius:8px;background:#f8fafc;margin-bottom:6px}.consignment-edit-empty[_ngcontent-%COMP%]{font-size:12px;color:var(--stock-muted);padding:6px 0}.consignment-edit-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}.consignment-edit-status[_ngcontent-%COMP%]{font-size:12px;color:var(--stock-muted)}.consignment-edit-status.error[_ngcontent-%COMP%]{color:var(--stock-danger)}@media (max-width: 700px){.manifest-details-grid[_ngcontent-%COMP%], .consignment-edit-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:500px;max-height:80vh;overflow-y:auto;border-radius:8px;position:relative}.details-modal[_ngcontent-%COMP%]{background:#0f172a8c}.details-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(860px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.details-close[_ngcontent-%COMP%]{position:absolute;right:18px;top:12px;background:transparent;border:none;font-size:24px;cursor:pointer;color:var(--stock-muted)}.details-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.details-sub[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.details-status[_ngcontent-%COMP%]{background:#e0f2fe;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px;margin-bottom:16px}.details-products[_ngcontent-%COMP%]{display:grid;gap:12px}.details-invoice[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px}.details-invoice-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:8px}.details-product-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:8px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;border-bottom:1px solid var(--stock-border);padding-bottom:6px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.product-name[_ngcontent-%COMP%]{font-weight:600}.product-meta[_ngcontent-%COMP%]{color:var(--stock-muted);font-size:13px}@media (max-width: 700px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.edit-stock-modal[_ngcontent-%COMP%]{background:#0f172a8c}.edit-stock-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(1100px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.edit-stock-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px}.edit-stock-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:22px;color:var(--stock-text)}.edit-stock-meta[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.edit-stock-section[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:14px;margin-bottom:14px}.edit-stock-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:15px}.edit-stock-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.edit-stock-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:13px;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid var(--stock-border);border-radius:10px;padding:8px 10px;font-size:13px;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:80px;resize:vertical}.edit-stock-tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px}.edit-stock-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.edit-stock-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.edit-stock-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:10px 0 4px;color:var(--stock-muted);font-size:13px}.edit-stock-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}.edit-stock-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:10px;border:1px solid var(--stock-border);padding:8px 14px;font-size:13px;cursor:pointer;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.primary[_ngcontent-%COMP%]{background:var(--stock-primary);border-color:var(--stock-primary);color:#fff}.edit-stock-content[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]{background:#f8fafc;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{border-color:#fecaca;background:#fef2f2;color:var(--stock-danger)}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{gap:10px}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr))}@media (max-width: 900px){.edit-stock-grid[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.edit-stock-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}.close[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;font-size:24px;cursor:pointer}.modal-content.terminal-style[_ngcontent-%COMP%]{background-color:#1e1e1e;color:#d4d4d4;font-family:Courier New,monospace;border-radius:10px;padding:20px;width:80%;max-height:80vh;overflow-y:auto}.consignment-block[_ngcontent-%COMP%]{background:#2a2a2a;padding:10px;border-radius:6px;margin-bottom:10px}.terminal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 20px;border:none;border-radius:6px;cursor:pointer}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#007acc;color:#fff}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#555;color:#fff}.cancel-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:12px 0 16px;display:flex;flex-direction:column;gap:8px}.cancel-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#f8fafc;color:var(--stock-text)}.cancel-list[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]{border:1px solid var(--stock-danger);color:var(--stock-danger);background:#fff5f5;border-radius:8px;padding:6px 10px;cursor:pointer}.cancel-list[_ngcontent-%COMP%]   .remove-btn[_ngcontent-%COMP%]:hover{border-color:#b91c1c;color:#b91c1c}.product-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:4px 0}.manifest-input[_ngcontent-%COMP%]{width:60px;padding:4px;margin-left:4px;background-color:#333;color:#fff;border:1px solid #555;border-radius:4px;text-align:right}.eway-toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;position:relative;cursor:pointer;-webkit-user-select:none;user-select:none}.eway-toggle-input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.eway-toggle-slider[_ngcontent-%COMP%]{position:relative;width:40px;height:20px;background-color:#ccc;border-radius:20px;transition:background-color .3s}.eway-toggle-slider[_ngcontent-%COMP%]:before{content:"";position:absolute;height:16px;width:16px;left:2px;bottom:2px;background-color:#fff;border-radius:50%;transition:transform .3s}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]{background-color:#4caf50}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]:before{transform:translate(20px)}.eway-toggle-text[_ngcontent-%COMP%]{font-weight:500}.routing-section[_ngcontent-%COMP%]{margin-top:20px}.routing-controls[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:10px}.route-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.route-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.remove-btn[_ngcontent-%COMP%]{background:none;border:none;color:red;cursor:pointer}']})}}return t})();function Yz(t,i){if(1&t){const e=O();l(0,"tr")(1,"td")(2,"input",16),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.selected,o)||(r.selected=o),v(o)}),M("click",function(o){return _(e),v(o.stopPropagation())}),c()(),l(3,"td",8),M("click",function(){const o=_(e).$implicit;return v(f().openInvoiceDetails(o))}),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td")(10,"button",17),M("click",function(){const o=_(e).$implicit;return v(f().editInvoice(o))}),u(11,"fo?<,? Edit"),c()()()}if(2&t){const e=i.$implicit;Ce("selected",e.selected),h(2),w("ngModel",e.selected),h(2),N(e.consignmentNumber),h(2),N(e.shipmentStatus),h(2),N(e.consignor)}}function Kz(t,i){if(1&t){const e=O();l(0,"tr")(1,"td")(2,"input",16),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.selected,o)||(r.selected=o),v(o)}),M("click",function(o){return _(e),v(o.stopPropagation())}),c()(),l(3,"td",8),M("click",function(){const o=_(e).$implicit;return v(f().openInvoiceDetails(o))}),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td")(10,"button",17),M("click",function(){const o=_(e).$implicit;return v(f().editInvoice(o))}),u(11,"fo?<,? Edit"),c()()()}if(2&t){const e=i.$implicit;Ce("selected",e.selected),h(2),w("ngModel",e.selected),h(2),N(e.consignmentNumber),h(2),N(e.shipmentStatus),h(2),N(e.consignor)}}function Jz(t,i){if(1&t&&(l(0,"li")(1,"span",32),u(2),c(),l(3,"span",33),u(4),c()()),2&t){const e=i.$implicit;h(2),N(e.productName||e.type),h(2),k("Qty: ",e.quantity||e.amount,"")}}function Xz(t,i){if(1&t){const e=O();l(0,"div",18)(1,"div",19)(2,"button",20),M("click",function(){return _(e),v(f().closeInvoiceDetails())}),u(3,"\xd7"),c(),l(4,"div",21)(5,"div")(6,"h2"),u(7,"Consignment Details"),c(),l(8,"p",22),u(9),c()(),l(10,"span",23),u(11),c()(),l(12,"div",24)(13,"div",25)(14,"div",26),u(15,"Consignor"),c(),l(16,"div",27),u(17),c()(),l(18,"div",25)(19,"div",26),u(20,"Consignor GST"),c(),l(21,"div",27),u(22),c()(),l(23,"div",25)(24,"div",26),u(25,"Consignor Phone"),c(),l(26,"div",27),u(27),c()(),l(28,"div",25)(29,"div",26),u(30,"Consignor Address"),c(),l(31,"div",27),u(32),c()(),l(33,"div",25)(34,"div",26),u(35,"Consignee"),c(),l(36,"div",27),u(37),c()(),l(38,"div",25)(39,"div",26),u(40,"Consignee GST"),c(),l(41,"div",27),u(42),c()(),l(43,"div",25)(44,"div",26),u(45,"Consignee Phone"),c(),l(46,"div",27),u(47),c()(),l(48,"div",25)(49,"div",26),u(50,"Consignee Address"),c(),l(51,"div",27),u(52),c()(),l(53,"div",25)(54,"div",26),u(55,"Branch"),c(),l(56,"div",27),u(57),c()(),l(58,"div",25)(59,"div",26),u(60,"Date"),c(),l(61,"div",27),u(62),hi(63,"date"),c()(),l(64,"div",25)(65,"div",26),u(66,"Payment Mode"),c(),l(67,"div",27),u(68),c()(),l(69,"div",25)(70,"div",26),u(71,"External Ref ID"),c(),l(72,"div",27),u(73),c()(),l(74,"div",25)(75,"div",26),u(76,"Billing Type"),c(),l(77,"div",27),u(78),c()(),l(79,"div",25)(80,"div",26),u(81,"Billing Name"),c(),l(82,"div",27),u(83),c()(),l(84,"div",25)(85,"div",26),u(86,"Billing GSTIN"),c(),l(87,"div",27),u(88),c()(),l(89,"div",25)(90,"div",26),u(91,"Billing Phone"),c(),l(92,"div",27),u(93),c()(),l(94,"div",25)(95,"div",26),u(96,"Billing Address"),c(),l(97,"div",27),u(98),c()(),l(99,"div",25)(100,"div",26),u(101,"Pickup Type"),c(),l(102,"div",27),u(103),c()(),l(104,"div",25)(105,"div",26),u(106,"Pickup Name"),c(),l(107,"div",27),u(108),c()(),l(109,"div",25)(110,"div",26),u(111,"Pickup Phone"),c(),l(112,"div",27),u(113),c()(),l(114,"div",25)(115,"div",26),u(116,"Pickup Address"),c(),l(117,"div",27),u(118),c()(),l(119,"div",25)(120,"div",26),u(121,"Pickup Pincode"),c(),l(122,"div",27),u(123),c()(),l(124,"div",25)(125,"div",26),u(126,"Delivery Type"),c(),l(127,"div",27),u(128),c()(),l(129,"div",25)(130,"div",26),u(131,"Delivery To"),c(),l(132,"div",27),u(133),c()(),l(134,"div",25)(135,"div",26),u(136,"Delivery Phone"),c(),l(137,"div",27),u(138),c()(),l(139,"div",25)(140,"div",26),u(141,"Delivery Address"),c(),l(142,"div",27),u(143),c()(),l(144,"div",25)(145,"div",26),u(146,"Delivery Pincode"),c(),l(147,"div",27),u(148),c()(),l(149,"div",25)(150,"div",26),u(151,"Products"),c(),l(152,"div",27),u(153),c()(),l(154,"div",25)(155,"div",26),u(156,"Status"),c(),l(157,"div",27),u(158),c()(),l(159,"div",25)(160,"div",26),u(161,"Final Amount"),c(),l(162,"div",27),u(163),c()(),l(164,"div",25)(165,"div",26),u(166,"Charges - ODC"),c(),l(167,"div",27),u(168),c()(),l(169,"div",25)(170,"div",26),u(171,"Charges - Unloading"),c(),l(172,"div",27),u(173),c()(),l(174,"div",25)(175,"div",26),u(176,"Charges - Docket"),c(),l(177,"div",27),u(178),c()(),l(179,"div",25)(180,"div",26),u(181,"Charges - Other"),c(),l(182,"div",27),u(183),c()(),l(184,"div",25)(185,"div",26),u(186,"Charges - CCC"),c(),l(187,"div",27),u(188),c()(),l(189,"div",25)(190,"div",26),u(191,"Charges - Consignor Discount"),c(),l(192,"div",27),u(193),c()()(),l(194,"div",28)(195,"div",29)(196,"h3"),u(197,"Products"),c(),l(198,"ul",30),D(199,Jz,5,2,"li",31),c()()()()()}if(2&t){const e=f();h(9),k("Consignment #",null==e.selectedInvoice?null:e.selectedInvoice.consignmentNumber,""),h(2),N(null==e.selectedInvoice?null:e.selectedInvoice.shipmentStatus),h(6),N(null==e.selectedInvoice?null:e.selectedInvoice.consignor),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consignorGST),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consignorPhone),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consignorAddress),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consignee),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consigneeGST),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consigneePhone),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.consigneeAddress),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.branch),h(5),N(_o(63,39,null==e.selectedInvoice?null:e.selectedInvoice.date,"short")),h(6),N(null==e.selectedInvoice?null:e.selectedInvoice.paymentMode),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.externalRefId),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.billingType),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.billingName),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.billingGSTIN),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.billingPhone),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.billingAddress),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.pickupType),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.pickupName),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.pickupPhone),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.pickupAddress),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.pickupPincode),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.deliveryType),h(5),N((null==e.selectedInvoice?null:e.selectedInvoice.deliveryName)||(null==e.selectedInvoice?null:e.selectedInvoice.deliveryID)),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.deliveryPhone),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.deliveryAddress),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.deliveryPincode),h(5),N((null==e.selectedInvoice||null==e.selectedInvoice.products?null:e.selectedInvoice.products.length)||0),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.shipmentStatus),h(5),N(null==e.selectedInvoice?null:e.selectedInvoice.finalAmount),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.odc),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.unloading),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.docket),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.other),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.ccc),h(5),N(null==e.selectedInvoice||null==e.selectedInvoice.charges?null:e.selectedInvoice.charges.consignorDiscount),h(6),C("ngForOf",null==e.selectedInvoice?null:e.selectedInvoice.products)}}function eG(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td")(4,"input",53),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.amount,o)||(r.amount=o),v(o)}),M("ngModelChange",function(o){const r=_(e).$implicit,s=f().$implicit;return v(f(3).onTotalQtyChange(s,r,o))}),c()(),l(5,"td")(6,"input",54),S("ngModelChange",function(o){const r=_(e).$implicit;return x(r.deliveredstock,o)||(r.deliveredstock=o),v(o)}),M("ngModelChange",function(o){const r=_(e).$implicit,s=f().$implicit;return v(f(3).onDeliveredQtyChange(s,r,o))}),c()()()}if(2&t){const e=i.$implicit,n=i.index,o=f().index;h(2),N(e.type||e.productName),h(2),Hl("name","total-",o,"-",n,""),C("min",e.deliveredstock||0),w("ngModel",e.amount),h(2),Hl("name","delivered-",o,"-",n,""),w("ngModel",e.deliveredstock)}}function tG(t,i){if(1&t&&(l(0,"div",50)(1,"div",51),u(2),c(),l(3,"table",52)(4,"thead")(5,"tr")(6,"th"),u(7,"Product"),c(),l(8,"th"),u(9,"Total Qty"),c(),l(10,"th"),u(11,"Delivered Qty"),c()()(),l(12,"tbody"),D(13,eG,7,10,"tr",31),c()()()),2&t){const e=i.$implicit;h(2),k("Pre-Invoice #",e.number,""),h(11),C("ngForOf",e.products)}}function nG(t,i){if(1&t&&(l(0,"div",36)(1,"h3"),u(2,"Delivered/Pre-Invoice & Products"),c(),D(3,tG,14,2,"div",49),c()),2&t){const e=f(2);h(3),C("ngForOf",e.editingInvoice.invoices)}}function iG(t,i){if(1&t){const e=O();l(0,"div",34)(1,"div",35)(2,"h2"),u(3,"Edit Details"),c(),l(4,"form")(5,"div",36)(6,"label",37),u(7,"Consignor:"),c(),l(8,"input",38),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingInvoice.consignor,o)||(r.editingInvoice.consignor=o),v(o)}),c()(),l(9,"div",36)(10,"label",39),u(11,"Delivery Address:"),c(),l(12,"textarea",40),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingInvoice.deliveryAddress,o)||(r.editingInvoice.deliveryAddress=o),v(o)}),c()(),l(13,"div",36)(14,"label",41),u(15,"Status:"),c(),l(16,"select",42),S("ngModelChange",function(o){_(e);const r=f();return x(r.editingInvoice.shipmentStatus,o)||(r.editingInvoice.shipmentStatus=o),v(o)}),l(17,"option",43),u(18,"Pending"),c(),l(19,"option",44),u(20,"Delivered"),c(),l(21,"option",45),u(22,"Invoiced"),c()()(),D(23,nG,4,1,"div",46),l(24,"div",47)(25,"button",48),M("click",function(){return _(e),v(f().saveInvoiceEdit())}),u(26,"Save"),c(),l(27,"button",48),M("click",function(){return _(e),v(f().cancelEdit())}),u(28,"Cancel"),c()()()()()}if(2&t){const e=f();h(8),w("ngModel",e.editingInvoice.consignor),h(4),w("ngModel",e.editingInvoice.deliveryAddress),h(4),w("ngModel",e.editingInvoice.shipmentStatus),h(7),C("ngIf",null==e.editingInvoice||null==e.editingInvoice.invoices?null:e.editingInvoice.invoices.length)}}function oG(t,i){if(1&t){const e=O();l(0,"div",34)(1,"div",55)(2,"h2"),u(3,"Generate Invoice"),c(),l(4,"p"),u(5,"Generate invoice for the selected consignments?"),c(),l(6,"div",56)(7,"button",48),M("click",function(){return _(e),v(f().confirmGenerateInvoice())}),u(8,"Okay"),c(),l(9,"button",48),M("click",function(){return _(e),v(f().cancelGenerateInvoice())}),u(10,"Cancel"),c()()()()}}let rG=(()=>{class t{constructor(e,n){this.http=e,this.branchService=n,this.invoices=[],this.deliveredInvoices=[],this.preInvoicedInvoices=[],this.filteredDelivered=[],this.filteredPreInvoiced=[],this.searchText="",this.filterDate="",this.filterConsignor="",this.selectedInvoice=null,this.showInvoiceModal=!1,this.branch=localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.editingInvoice=null,this.showEditPopup=!1,this.showGenerateInvoicePopup=!1,this.onStorageChange=o=>{if("branch"===o.key||"originLocId"===o.key){const r=localStorage.getItem("branch")||"All Branches",s=localStorage.getItem("originLocId")||"all";(r!==this.branch||s!==this.originLocId)&&(this.branch=r,this.originLocId=s,this.loadInvoices())}}}ngOnInit(){this.branch=this.branchService.currentBranch||this.branch,this.originLocId=localStorage.getItem("originLocId")||"all",this.branchSub=this.branchService.branch$.subscribe(e=>{e!==this.branch&&(this.branch=e,this.originLocId=localStorage.getItem("originLocId")||"all",this.loadInvoices())}),window.addEventListener("storage",this.onStorageChange),this.loadInvoices()}ngOnDestroy(){this.branchSub?.unsubscribe(),window.removeEventListener("storage",this.onStorageChange)}loadInvoices(){this.http.get("http://localhost:3000/api/newshipments",{params:{username:localStorage.getItem("username")||"",originLocId:this.originLocId||localStorage.getItem("originLocId")||"all"}}).subscribe({next:e=>{const o=((Array.isArray(e)?e:e?.value||[])||[]).map(r=>({...r,_normalizedStatus:this.normalizeStatus(r?.shipmentStatus)}));this.invoices=o.filter(r=>"delivered"===r._normalizedStatus||"pre-invoiced"===r._normalizedStatus),this.deliveredInvoices=this.invoices.filter(r=>"delivered"===r._normalizedStatus),this.preInvoicedInvoices=this.invoices.filter(r=>"pre-invoiced"===r._normalizedStatus),this.applyFilters(),console.log("A??,f??A? Filtered Delivered consignments:",this.filteredDelivered),console.log("A??,f??A? Filtered Pre-Invoiced consignments:",this.filteredPreInvoiced)},error:e=>console.error("\ufffdO Error loading invoices:",e)})}normalizeStatus(e){const n=String(e||"").trim().toLowerCase();return n?n.includes("delivered")?"delivered":"pre invoiced"===n||"preinvoiced"===n||n.includes("pre-invoiced")?"pre-invoiced":n:""}applyFilters(){const e=n=>(!this.searchText||n.consignmentNumber?.includes(this.searchText)||n.consignor?.includes(this.searchText))&&(!this.filterDate||new Date(n.date).toISOString().split("T")[0]===this.filterDate)&&(!this.filterConsignor||n.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()));this.filteredDelivered=this.deliveredInvoices.filter(e),this.filteredPreInvoiced=this.preInvoicedInvoices.filter(e)}toggleAllDeliveredSelection(e){const n=e.target.checked;this.filteredDelivered.forEach(o=>o.selected=n)}toggleAllPreInvoicedSelection(e){const n=e.target.checked;this.filteredPreInvoiced.forEach(o=>o.selected=n)}openInvoiceDetails(e){this.selectedInvoice=e,this.showInvoiceModal=!0}closeInvoiceDetails(){this.showInvoiceModal=!1,this.selectedInvoice=null}invoiceSelected(){const e=this.filteredDelivered.filter(n=>n.selected);0!==e.length?(e.forEach(n=>{const o={...n,shipmentStatus:"Pre-Invoiced"};this.http.put(`http://localhost:3000/api/newshipments/${n.consignmentNumber}`,o).subscribe({next:()=>{console.log(`Consignment ${n.consignmentNumber} updated to Pre-Invoiced`),this.loadInvoices()},error:r=>{console.error(`Error updating consignment ${n.consignmentNumber}:`,r)}})}),this.filteredDelivered.forEach(n=>n.selected=!1)):console.warn("No consignments selected for invoicing.")}editInvoice(e){console.log("Edit invoice:",e);const n=JSON.parse(JSON.stringify(e||{}));n.invoices=Array.isArray(n.ewaybills)&&n.ewaybills.length?this.flattenInvoices(n.ewaybills):n.invoices||[],this.editingInvoice=n,this.captureOriginalDelivered(this.editingInvoice),this.showEditPopup=!0}flattenInvoices(e){return(e||[]).flatMap(n=>n.invoices||[])}captureOriginalDelivered(e){(e?.invoices||[]).forEach(n=>{(n.products||[]).forEach(o=>{o._originalDelivered=Number(o.deliveredstock)||0})})}deleteDelivered(){this.deleteConsignments(this.filteredDelivered)}deletePreInvoiced(){this.deleteConsignments(this.filteredPreInvoiced)}deleteInvoice(){this.deleteConsignments([...this.filteredDelivered,...this.filteredPreInvoiced])}finalizePreInvoiced(){const e=(this.filteredPreInvoiced||[]).filter(n=>n.selected);0!==e.length?(e.forEach(n=>{const o={...n,shipmentStatus:"Invoiced"};this.http.put(`http://localhost:3000/api/newshipments/${n.consignmentNumber}`,o).subscribe({next:()=>{console.log(`Consignment ${n.consignmentNumber} updated to Invoiced`),this.loadInvoices()},error:r=>{console.error(`Error updating consignment ${n.consignmentNumber}:`,r)}})}),this.filteredPreInvoiced.forEach(n=>n.selected=!1)):console.warn("No consignments selected for invoicing.")}openGenerateInvoicePopup(){0!==(this.filteredPreInvoiced||[]).filter(n=>n.selected).length?this.showGenerateInvoicePopup=!0:console.warn("No consignments selected for invoicing.")}confirmGenerateInvoice(){const e=(this.filteredPreInvoiced||[]).filter(o=>o.selected);if(0===e.length)return console.warn("No consignments selected for invoicing."),void(this.showGenerateInvoicePopup=!1);const n=e.map(o=>o.consignmentNumber);this.http.post("http://localhost:3000/api/newshipments/generateInvoices",{consignmentNumbers:n}).subscribe({next:()=>{this.showGenerateInvoicePopup=!1,this.filteredPreInvoiced.forEach(o=>o.selected=!1),this.loadInvoices()},error:o=>{console.error("Error generating invoices:",o),this.showGenerateInvoicePopup=!1}})}cancelGenerateInvoice(){this.showGenerateInvoicePopup=!1}deleteConsignments(e){const n=(e||[]).filter(o=>o.selected);0!==n.length?(n.forEach(o=>{const r={...o,shipmentStatus:" Cancelled-"+o.shipmentStatus};this.http.put(`http://localhost:3000/api/newshipments/${o.consignmentNumber}`,r).subscribe({next:()=>{console.log(`Consignment ${o.consignmentNumber} updated to Invoiced`),this.loadInvoices()},error:s=>{console.error(`Error updating consignment ${o.consignmentNumber}:`,s)}})}),(e||[]).forEach(o=>o.selected=!1)):console.warn("No consignments selected for invoicing.")}printDelivered(){this.printConsignments(this.filteredDelivered)}printPreInvoiced(){this.printConsignments(this.filteredPreInvoiced)}printInvoice(){this.printConsignments([...this.filteredDelivered,...this.filteredPreInvoiced])}printConsignments(e){const n=(e||[]).filter(o=>o.selected);0!==n.length?fetch("assets/invoice-template.html").then(o=>o.text()).then(o=>{let r="\n      <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; }\n            h2 { margin-bottom: 0; }\n            table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n            th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n            th { background-color: #f2f2f2; }\n            .page-break { page-break-after: always; }\n            .totals { margin-top: 15px; font-weight: bold; }\n          </style>\n        </head>\n        <body>\n    ";n.forEach((a,d)=>{let p=0;const g=(a.invoices||[]).map(P=>(P.products||[]).map(T=>{const A=(T.price||0)*(T.deliveredstock||0);return p+=A,`\n          <tr>\n          <td>${a.consignmentNumber}</td>\n          <td>${a.shipmentStatus}</td>\n          <td>${a.consignor}</td>\n          <td>${a.deliveryAddress}</td>\n          <td>${T.type}</td>\n          <td>${T.deliveredstock}</td>\n          <td>${T.price||0}</td>\n          <td>${A.toFixed(2)}</td>\n          </tr>\n          `}).join("")).join(""),m=localStorage.getItem("companyType")||"default",b=a.finalAmount*(parseInt(m,10)/100),y=a.finalAmount+b,I=o.replace("{{consignmentNumber}}",a.consignmentNumber).replace("{{consignor}}",a.consignor).replace("{{deliveryAddress}}",a.deliveryAddress).replace("{{status}}",a.shipmentStatus).replace("{{rows}}",g).replace("{{subtotal}}",p.toFixed(2)).replace("{{gst}}",b.toFixed(2)).replace("{{grandTotal}}",y.toFixed(2));r+=I,d<n.length-1&&(r+='<div class="page-break"></div>')}),r+="</body></html>";const s=window.open("","_blank");s&&(s.document.open(),s.document.write(r),s.document.close(),s.print())}).catch(o=>console.error("Error loading invoice template:",o)):alert("No invoices selected.")}static{this.\u0275fac=function(n){return new(n||t)(R(Ve),R(Xa))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-invoice"]],standalone:!0,features:[Ae],decls:61,vars:8,consts:[[1,"invoice-container"],[1,"filters"],["type","text","placeholder","Search by Consignment / Consignor",3,"ngModelChange","input","ngModel"],["type","date",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Filter by Consignor",3,"ngModelChange","input","ngModel"],[1,"invoice-sections"],[1,"invoice-section"],[1,"action-bar"],[3,"click"],[1,"delete-btn",3,"click"],[1,"print-btn",3,"click"],[1,"invoice-table"],["type","checkbox",3,"change"],[3,"selected",4,"ngFor","ngForOf"],["class","modal details-modal",4,"ngIf"],["class","popup-overlay",4,"ngIf"],["type","checkbox",3,"ngModelChange","click","ngModel"],[1,"edit-btn",3,"click"],[1,"modal","details-modal"],[1,"modal-content","details-content"],["type","button",1,"details-close",3,"click"],[1,"details-header"],[1,"details-sub"],[1,"details-status"],[1,"details-grid"],[1,"details-item"],[1,"details-label"],[1,"details-value"],[1,"details-products"],[1,"details-invoice"],[1,"details-product-list"],[4,"ngFor","ngForOf"],[1,"product-name"],[1,"product-meta"],[1,"popup-overlay"],[1,"popup-content"],[1,"form-row"],["for","consignor"],["type","text","id","consignor","name","consignor",3,"ngModelChange","ngModel"],["for","deliveryAddress"],["id","deliveryAddress","name","deliveryAddress",3,"ngModelChange","ngModel"],["for","status"],["id","status","name","status",3,"ngModelChange","ngModel"],["value","Pending"],["value","Delivered"],["value","Invoiced"],["class","form-row",4,"ngIf"],[1,"button-section"],["type","button",3,"click"],["class","invoice-block",4,"ngFor","ngForOf"],[1,"invoice-block"],[1,"invoice-title"],[1,"product-table"],["type","number","min","0",3,"ngModelChange","min","ngModel","name"],["type","number","min","0",3,"ngModelChange","ngModel","name"],[1,"popup-content","confirm-popup"],[1,"button-section","confirm-actions"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"\u{1f4e6} Delivered/Pre-Invoice Management"),c(),l(3,"div",1)(4,"input",2),S("ngModelChange",function(s){return x(o.searchText,s)||(o.searchText=s),s}),M("input",function(){return o.applyFilters()}),c(),l(5,"input",3),S("ngModelChange",function(s){return x(o.filterDate,s)||(o.filterDate=s),s}),M("change",function(){return o.applyFilters()}),c(),l(6,"input",4),S("ngModelChange",function(s){return x(o.filterConsignor,s)||(o.filterConsignor=s),s}),M("input",function(){return o.applyFilters()}),c()(),l(7,"div",5)(8,"div",6)(9,"h3"),u(10,"Delivered"),c(),l(11,"div",7)(12,"button",8),M("click",function(){return o.invoiceSelected()}),u(13,"Generate Pre-Invoice"),c(),l(14,"button",9),M("click",function(){return o.deleteDelivered()}),u(15,"Delete"),c(),l(16,"button",10),M("click",function(){return o.printDelivered()}),u(17,"Print Manifest"),c()(),l(18,"table",11)(19,"thead")(20,"tr")(21,"th")(22,"input",12),M("change",function(s){return o.toggleAllDeliveredSelection(s)}),c()(),l(23,"th"),u(24,"Consignment No."),c(),l(25,"th"),u(26,"Status"),c(),l(27,"th"),u(28,"Consignor"),c(),l(29,"th"),u(30,"Actions"),c()()(),l(31,"tbody"),D(32,Yz,12,6,"tr",13),c()()(),l(33,"div",6)(34,"h3"),u(35,"Pre-Invoiced"),c(),l(36,"div",7)(37,"button",8),M("click",function(){return o.openGenerateInvoicePopup()}),u(38,"Generate Invoice"),c(),l(39,"button",9),M("click",function(){return o.deletePreInvoiced()}),u(40,"Delete"),c(),l(41,"button",10),M("click",function(){return o.printPreInvoiced()}),u(42,"Print Manifest"),c()(),l(43,"table",11)(44,"thead")(45,"tr")(46,"th")(47,"input",12),M("change",function(s){return o.toggleAllPreInvoicedSelection(s)}),c()(),l(48,"th"),u(49,"Consignment No."),c(),l(50,"th"),u(51,"Status"),c(),l(52,"th"),u(53,"Consignor"),c(),l(54,"th"),u(55,"Actions"),c()()(),l(56,"tbody"),D(57,Kz,12,6,"tr",13),c()()()(),D(58,Xz,200,42,"div",14)(59,iG,29,4,"div",15)(60,oG,11,0,"div",15),c()),2&n&&(h(4),w("ngModel",o.searchText),h(),w("ngModel",o.filterDate),h(),w("ngModel",o.filterConsignor),h(26),C("ngForOf",o.filteredDelivered),h(25),C("ngForOf",o.filteredPreInvoiced),h(),C("ngIf",o.showInvoiceModal),h(),C("ngIf",o.showEditPopup),h(),C("ngIf",o.showGenerateInvoicePopup))},dependencies:[pt,lt,Xe,Fr,et,Im,wt,St,qe,on,Jr,vt,We,dm,Gi,He,Ja],styles:[".invoice-container[_ngcontent-%COMP%]{padding:20px;color:var(--text)}[_nghost-%COMP%]{--page-bg: #f6f8fb;--card: #ffffff;--border: #e5e7eb;--text: #0f172a;--muted: #6b7280;--primary: #2563eb;--primary-strong: #1e3a8a;--danger: #dc2626}.filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:15px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;color:var(--text);flex:1 1 190px;min-width:0}.action-bar[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center}.invoice-sections[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:24px;width:100%}.invoice-section[_ngcontent-%COMP%]{min-width:0}.invoice-section[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 10px 24px #0f172a14}.invoice-section[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{margin-top:0}.invoice-section[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]{margin:8px 0 12px;flex-wrap:wrap}.action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--text);cursor:pointer}.action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:var(--primary);color:var(--primary-strong)}.print-btn[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border:1px solid var(--primary)}.print-btn[_ngcontent-%COMP%]:hover{background:var(--primary-strong);border-color:var(--primary-strong);color:#fff}.invoice-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}.invoice-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .invoice-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--border);padding:8px;text-align:left}.invoice-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600}.invoice-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#0009;z-index:2000}.modal-content[_ngcontent-%COMP%]{position:relative}.edit-btn[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border:1px solid var(--primary);padding:4px 8px;border-radius:4px;cursor:pointer}.edit-btn[_ngcontent-%COMP%]:hover{background:var(--primary-strong)}.modal-actions[_ngcontent-%COMP%]{margin-top:10px;display:flex;justify-content:space-between}.popup-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a8c;display:flex;align-items:center;justify-content:center;z-index:1000}.popup-content[_ngcontent-%COMP%]{background:var(--card);padding:20px;border-radius:12px;width:520px;max-width:90%;border:1px solid var(--border);box-shadow:0 18px 40px #0f172a33}.details-modal[_ngcontent-%COMP%]{background:#0f172a8c}.details-content[_ngcontent-%COMP%]{background:#fff;color:var(--text);width:min(860px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--border);box-shadow:0 18px 40px #0f172a33;padding:20px;position:relative}.details-close[_ngcontent-%COMP%]{position:absolute;right:18px;top:12px;background:transparent;border:none;font-size:24px;cursor:pointer;color:var(--muted)}.details-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.details-sub[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--muted);font-size:13px}.details-status[_ngcontent-%COMP%]{background:#e0f2fe;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:16px}.details-products[_ngcontent-%COMP%]{display:grid;gap:12px}.details-invoice[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px}.details-product-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:8px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;border-bottom:1px solid var(--border);padding-bottom:6px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.product-name[_ngcontent-%COMP%]{font-weight:600}.product-meta[_ngcontent-%COMP%]{color:var(--muted);font-size:13px}@media (max-width: 700px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}.invoice-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .invoice-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:7px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.invoice-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .invoice-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}.invoice-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .invoice-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;font-size:11px}}.form-row[_ngcontent-%COMP%]{margin-bottom:12px}.form-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:4px;font-weight:700}.form-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:6px;box-sizing:border-box;border:1px solid var(--border);border-radius:8px}.button-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.delete-btn[_ngcontent-%COMP%]{background-color:#fef2f2;color:var(--danger);border:1px solid #fecaca;padding:5px 10px;margin-left:5px;cursor:pointer;border-radius:4px}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#fee2e2}.invoice-block[_ngcontent-%COMP%]{margin-top:12px;padding:10px;border:1px solid #e5e7eb;border-radius:6px;background:#f9fafb}.invoice-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:8px}.product-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.product-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .product-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb;padding:6px 8px;text-align:left}.product-table[_ngcontent-%COMP%]   input[type=number][_ngcontent-%COMP%]{width:100%;padding:4px 6px;box-sizing:border-box}.confirm-popup[_ngcontent-%COMP%]{max-width:420px}.confirm-actions[_ngcontent-%COMP%]{justify-content:flex-end}.confirm-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100px}"]})}}return t})();function sG(t,i){if(1&t&&(l(0,"option",13),u(1),c()),2&t){const e=i.$implicit;C("value",e),h(),N(e)}}function aG(t,i){1&t&&(l(0,"div",14),u(1,"Loading invoices..."),c())}function cG(t,i){if(1&t&&(l(0,"span"),u(1),c()),2&t){const e=i.$implicit;h(),N(e.consignmentNumber)}}function lG(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td",18),u(8),c(),l(9,"td")(10,"div",19),D(11,cG,2,1,"span",16),c()(),l(12,"td")(13,"span",20),u(14),c()(),l(15,"td")(16,"button",21),M("click",function(){const o=_(e).$implicit;return v(f(2).togglePaymentStatus(o))}),u(17),c()(),l(18,"td")(19,"button",22),M("click",function(){const o=_(e).$implicit;return v(f(2).printInvoice(o))}),u(20,"Print"),c(),l(21,"button",23),M("click",function(){const o=_(e).$implicit;return v(f(2).openDeletePopup(o))}),u(22," Delete "),c()()()}if(2&t){const e=i.$implicit,n=f(2);h(2),N(e.invoiceNumber),h(2),N(e.clientName||"-"),h(2),N(e.clientGSTIN||"-"),h(2),N(e.billingAddress||"-"),h(3),C("ngForOf",e.consignments),h(2),Ce("cancelled","cancelled"===(e.status||"")),h(),k(" ",e.status||"active"," "),h(2),Ce("cancel","paid"===(e.status||"").toLowerCase()),C("disabled",n.paymentUpdatingId===e._id||"cancelled"===(e.status||"")),h(),k(" ","paid"===(e.status||"").toLowerCase()?"Payment got cancelled":"Paid"," "),h(4),C("disabled","cancelled"===(e.status||""))}}function dG(t,i){1&t&&(l(0,"tr")(1,"td",24),u(2,"No generated invoices found."),c()())}function uG(t,i){if(1&t&&(l(0,"div",15)(1,"table")(2,"thead")(3,"tr")(4,"th"),u(5,"Invoice #"),c(),l(6,"th"),u(7,"Client"),c(),l(8,"th"),u(9,"GSTIN"),c(),l(10,"th"),u(11,"Billing Address"),c(),l(12,"th"),u(13,"Consignments"),c(),l(14,"th"),u(15,"Status"),c(),l(16,"th"),u(17,"Payment"),c(),l(18,"th"),u(19,"Actions"),c()()(),l(20,"tbody"),D(21,lG,23,13,"tr",16)(22,dG,3,0,"tr",17),c()()()),2&t){const e=f();h(21),C("ngForOf",e.filteredInvoices),h(),C("ngIf",!e.filteredInvoices.length)}}function hG(t,i){if(1&t){const e=O();l(0,"div",25)(1,"div",26)(2,"h3"),u(3,"Cancel this generated invoice?"),c(),l(4,"p"),u(5,"This action cannot be reverted. The invoice will be marked as cancelled."),c(),l(6,"div",27)(7,"button",8),M("click",function(){return _(e),v(f().cancelDelete())}),u(8,"Keep"),c(),l(9,"button",28),M("click",function(){return _(e),v(f().confirmDelete())}),u(10),c()()()()}if(2&t){const e=f();h(9),C("disabled",e.deleting),h(),k(" ",e.deleting?"Cancelling...":"Confirm delete"," ")}}let pG=(()=>{class t{constructor(e){this.http=e,this.invoices=[],this.filteredInvoices=[],this.fiscalYear="",this.fiscalYearInput="",this.fiscalYears=[],this.searchText="",this.loading=!1,this.gstPercent=0,this.invoiceTemplate="",this.showDeletePopup=!1,this.deleteTarget=null,this.deleting=!1,this.paymentUpdatingId=null}ngOnInit(){this.loadInvoices(),this.loadFiscalYears()}loadInvoices(){this.loading=!0,this.http.get("http://localhost:3000/api/newshipments/generatedInvoices",{params:{fiscalYear:this.fiscalYearInput||""}}).subscribe({next:e=>{this.fiscalYear=e?.fiscalYear||this.fiscalYear,this.fiscalYearInput||(this.fiscalYearInput=this.fiscalYear||""),this.gstPercent=Number(e?.gstPercent)||0,this.invoices=Array.isArray(e?.invoices)?e.invoices:[],this.applyFilters(),this.loading=!1},error:e=>{console.error("Error loading generated invoices:",e),this.invoices=[],this.filteredInvoices=[],this.loading=!1}})}loadFiscalYears(){this.http.get("http://localhost:3000/api/newshipments/generatedInvoices/years").subscribe({next:e=>{this.fiscalYears=Array.isArray(e?.years)?e.years:[]},error:e=>{console.error("Error loading fiscal years:",e),this.fiscalYears=[]}})}applyFilters(){const e=this.searchText.trim().toLowerCase();this.filteredInvoices=e?this.invoices.filter(n=>!!(String(n.invoiceNumber||"").toLowerCase().includes(e)||String(n.clientName||"").toLowerCase().includes(e)||String(n.clientGSTIN||"").toLowerCase().includes(e)||String(n.billingAddress||"").toLowerCase().includes(e))||(n.consignments||[]).some(r=>String(r.consignmentNumber||"").toLowerCase().includes(e))):[...this.invoices]}openDeletePopup(e){this.deleteTarget=e,this.showDeletePopup=!0}cancelDelete(){this.showDeletePopup=!1,this.deleteTarget=null}confirmDelete(){!this.deleteTarget?._id||this.deleting||(this.deleting=!0,this.http.put(`http://localhost:3000/api/newshipments/generatedInvoices/${this.deleteTarget._id}/cancel`,{}).subscribe({next:e=>{const n=e?.invoice;n?._id&&(this.invoices=this.invoices.map(o=>String(o._id)===String(n._id)?{...o,...n}:o),this.applyFilters()),this.deleting=!1,this.cancelDelete()},error:e=>{console.error("Error cancelling generated invoice:",e),this.deleting=!1}}))}togglePaymentStatus(e){if(!e?._id||this.paymentUpdatingId)return;const o="paid"===String(e.status||"").trim().toLowerCase()?"Active":"Paid";this.paymentUpdatingId=String(e._id),this.http.put(`http://localhost:3000/api/newshipments/generatedInvoices/${e._id}/payment-status`,{status:o}).subscribe({next:r=>{const s=r?.invoice;s?._id&&(this.invoices=this.invoices.map(a=>String(a._id)===String(s._id)?{...a,...s}:a),this.applyFilters()),this.paymentUpdatingId=null},error:r=>{console.error("Error updating payment status:",r),this.paymentUpdatingId=null}})}printInvoice(e){var n=this;return ka(function*(){try{const o=yield n.getTemplate(),r=n.buildInvoiceBody(e);n.openPrintWindow(o.replace("{{content}}",r))}catch(o){console.error("Error loading invoice template:",o)}})()}printAllInvoices(){var e=this;return ka(function*(){if(e.filteredInvoices.length)try{const n=yield e.getTemplate(),o=e.filteredInvoices.map(s=>e.buildInvoiceBody(s)),r=o.map((s,a)=>s+(a<o.length-1?'<div class="page-break"></div>':"")).join("");e.openPrintWindow(n.replace("{{content}}",r))}catch(n){console.error("Error loading invoice template:",n)}})()}buildInvoiceBody(e){const n=e?.consignments||[],o=n.reduce((m,b)=>m+Number(b.finalAmount||0),0),r=["odc","unloading","docket","other","ccc","consignorDiscount"],s=r.reduce((m,b)=>(m[b]=n.reduce((y,I)=>y+Number(I?.charges?.[b]||0),0),m),{}),a=o*(this.gstPercent/100),d=o+a,p=n.map((m,b)=>`\n      <tr>\n        <td>${b+1}</td>\n        <td>${m.consignmentNumber||""}</td>\n        <td>${m.consignor||""}</td>\n        <td>${m.deliveryAddress||""}</td>\n        <td style="text-align:right">${Number(m.finalAmount||0).toFixed(2)}</td>\n      </tr>\n    `).join(""),g=r.map(m=>`\n      <div>${m}: ${Number(s[m]||0).toFixed(2)}</div>\n    `).join("");return`\n      <h2>Invoice #${e.invoiceNumber||""}</h2>\n      <div class="meta">\n        <div>Client: ${e.clientName||""}</div>\n        <div>GSTIN: ${e.clientGSTIN||""}</div>\n        <div>Billing Address: ${e.billingAddress||""}</div>\n        <div>GST Percent: ${this.gstPercent}%</div>\n      </div>\n      <table>\n        <thead>\n          <tr>\n            <th>#</th>\n            <th>Consignment</th>\n            <th>Consignor</th>\n            <th>Delivery Address</th>\n            <th style="text-align:right">Amount</th>\n          </tr>\n        </thead>\n        <tbody>\n          ${p||'<tr><td colspan="5">No consignments</td></tr>'}\n        </tbody>\n      </table>\n      <div class="totals">\n        <div>Subtotal: ${o.toFixed(2)}</div>\n        <div>GST (${this.gstPercent}%): ${a.toFixed(2)}</div>\n        <div>Grand Total: ${d.toFixed(2)}</div>\n      </div>\n      <div class="charges">\n        <div class="charges-title">Charges</div>\n        ${g}\n      </div>\n    `}getTemplate(){var e=this;return ka(function*(){if(e.invoiceTemplate)return e.invoiceTemplate;const n=yield fetch("assets/generated-invoice-template.html");return e.invoiceTemplate=yield n.text(),e.invoiceTemplate})()}openPrintWindow(e){const n=window.open("","_blank");n&&(n.document.open(),n.document.write(e),n.document.close(),n.print())}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-reports"]],standalone:!0,features:[Ae],decls:22,vars:9,consts:[[1,"reports-page"],[1,"header"],[1,"subtitle"],[1,"controls"],[3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","placeholder","Search by invoice, client, GSTIN, or consignment",3,"ngModelChange","input","ngModel"],["type","button",3,"click"],["type","button",3,"click","disabled"],["class","status",4,"ngIf"],["class","table-wrap",4,"ngIf"],["class","popup-overlay",4,"ngIf"],[3,"value"],[1,"status"],[1,"table-wrap"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"address-cell"],[1,"consignment-list"],[1,"status-pill"],["type","button",1,"payment-btn",3,"click","disabled"],["type","button",1,"print-btn",3,"click"],["type","button",1,"delete-btn",3,"click","disabled"],["colspan","8",1,"empty"],[1,"popup-overlay"],[1,"popup-card"],[1,"popup-actions"],["type","button",1,"danger",3,"click","disabled"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"div",1)(2,"div")(3,"h2"),u(4,"Generated Invoices"),c(),l(5,"p",2),u(6),c(),l(7,"p",2),u(8),c()(),l(9,"div",3)(10,"select",4),S("ngModelChange",function(s){return x(o.fiscalYearInput,s)||(o.fiscalYearInput=s),s}),l(11,"option",5),u(12,"Current Fiscal Year"),c(),D(13,sG,2,2,"option",6),c(),l(14,"input",7),S("ngModelChange",function(s){return x(o.searchText,s)||(o.searchText=s),s}),M("input",function(){return o.applyFilters()}),c(),l(15,"button",8),M("click",function(){return o.loadInvoices()}),u(16,"Apply FY"),c(),l(17,"button",9),M("click",function(){return o.printAllInvoices()}),u(18,"Print All"),c()()(),D(19,aG,2,0,"div",10)(20,uG,23,2,"div",11),c(),D(21,hG,11,2,"div",12)),2&n&&(h(6),k("Fiscal Year: ",o.fiscalYear||"Current",""),h(2),k("GST Percent: ",o.gstPercent||0,"%"),h(2),w("ngModel",o.fiscalYearInput),h(3),C("ngForOf",o.fiscalYears),h(),w("ngModel",o.searchText),h(3),C("disabled",!o.filteredInvoices.length),h(2),C("ngIf",o.loading),h(),C("ngIf",!o.loading),h(),C("ngIf",o.showDeletePopup))},dependencies:[pt,lt,Xe,et,wt,St,qe,vt,We,He],styles:[".reports-page[_ngcontent-%COMP%]{padding:20px;color:#0f172a}.header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}.subtitle[_ngcontent-%COMP%]{margin:6px 0 0;color:#64748b;font-size:13px}.controls[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:center}.controls[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .controls[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #cbd5f5;border-radius:10px;min-width:280px}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid #cbd5f5;background:#fff;cursor:pointer}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:#2563eb;color:#1e3a8a}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.status[_ngcontent-%COMP%]{padding:12px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px}.table-wrap[_ngcontent-%COMP%]{overflow:auto;background:#fff;border:1px solid #e2e8f0;border-radius:12px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;padding:10px 12px;text-align:left;vertical-align:top}th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600}.address-cell[_ngcontent-%COMP%]{min-width:220px}.consignment-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}.consignment-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#eef2ff;color:#3730a3;padding:2px 8px;border-radius:999px;font-size:12px}.print-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #2563eb;background:#2563eb;color:#fff;cursor:pointer}.print-btn[_ngcontent-%COMP%]:hover{background:#1e3a8a;border-color:#1e3a8a}.payment-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #0f766e;background:#0f766e;color:#fff;cursor:pointer}.payment-btn[_ngcontent-%COMP%]:hover{background:#115e59;border-color:#115e59}.payment-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.payment-btn.cancel[_ngcontent-%COMP%]{background:#dc2626;border-color:#dc2626}.payment-btn.cancel[_ngcontent-%COMP%]:hover{background:#b91c1c;border-color:#b91c1c}.delete-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #dc2626;background:#fef2f2;color:#dc2626;cursor:pointer;margin-left:8px}.delete-btn[_ngcontent-%COMP%]:hover{background:#fee2e2}.delete-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.status-pill[_ngcontent-%COMP%]{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#3730a3;font-size:12px;text-transform:capitalize}.status-pill.cancelled[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.empty[_ngcontent-%COMP%]{text-align:center;color:#64748b;padding:18px}.popup-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172a99;display:flex;align-items:center;justify-content:center;z-index:1100}.popup-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;width:min(420px,90vw);border:1px solid #e2e8f0;box-shadow:0 20px 40px #0f172a40}.popup-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px}.popup-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 16px;color:#475569}.popup-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}.popup-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 12px;border-radius:8px;border:1px solid #cbd5f5;background:#fff;cursor:pointer}.popup-actions[_ngcontent-%COMP%]   .danger[_ngcontent-%COMP%]{border-color:#dc2626;background:#dc2626;color:#fff}.popup-actions[_ngcontent-%COMP%]   .danger[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}@media (max-width: 700px){.controls[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:100%}}"]})}}return t})();function gG(t,i){if(1&t){const e=O();l(0,"tr")(1,"td"),u(2),c(),l(3,"td"),u(4),c(),l(5,"td"),u(6),c(),l(7,"td"),u(8),c(),l(9,"td"),u(10),c(),l(11,"td")(12,"button",6),M("click",function(o){const r=_(e).$implicit;return v(f().openEditLocation(r,o))}),u(13,"Edit"),c()()()}if(2&t){const e=i.$implicit,n=f();h(2),N(e.branchName),h(2),N(e.vehicleNo),h(2),N(e.driverPhone),h(2),N(n.formatVehicleStatus(e.vehicleStatus)),h(2),N(n.getVehicleCurrentBranchLabel(e))}}function fG(t,i){1&t&&(l(0,"tr")(1,"td",7),u(2,"No vehicles found."),c()())}function mG(t,i){if(1&t&&(l(0,"option",20),u(1),c()),2&t){const e=i.$implicit;C("value",e.value),h(),k(" ",e.label," ")}}function _G(t,i){1&t&&(l(0,"p"),u(1,"Loading manifests..."),c())}function vG(t,i){1&t&&(l(0,"p"),u(1,"No manifests found."),c())}function bG(t,i){if(1&t&&(l(0,"option",20),u(1),c()),2&t){const e=i.$implicit;C("value",e),h(),N(e)}}function yG(t,i){1&t&&(l(0,"div",30),u(1,"No consignments."),c())}function CG(t,i){1&t&&(l(0,"span"),u(1,"No products."),c())}function MG(t,i){if(1&t&&(l(0,"span",36),u(1),c()),2&t){const e=i.$implicit;h(),Be(" ",e.name," (",e.qty,") ")}}function IG(t,i){if(1&t&&(l(0,"div",31)(1,"div",32)(2,"span"),u(3),c(),l(4,"span",33),u(5),c()(),l(6,"div",34),D(7,CG,2,0,"span",4)(8,MG,2,2,"span",35),c()()),2&t){const e=i.$implicit;h(3),N(e.consignmentNumber),h(2),N(e.shipmentStatus||"-"),h(2),C("ngIf",!e.products.length),h(),C("ngForOf",e.products)}}function wG(t,i){if(1&t){const e=O();l(0,"div",21)(1,"div",22)(2,"div")(3,"strong"),u(4),c(),l(5,"span",23),u(6),c()(),l(7,"div",24),u(8),c()(),l(9,"div",25)(10,"label"),u(11," Change Vehicle "),l(12,"select",26),M("ngModelChange",function(o){const r=_(e).$implicit;return v(f(2).onManifestVehicleChange(r,o))}),l(13,"option",13),u(14,"Select vehicle"),c(),D(15,bG,2,2,"option",14),c()()(),l(16,"div",24),u(17),c(),l(18,"div",24),u(19),c(),l(20,"div",27)(21,"h4"),u(22,"Consignments"),c(),D(23,yG,2,0,"div",28)(24,IG,9,4,"div",29),c()()}if(2&t){const e=i.$implicit,n=f(2);h(4),N(e.manifestNumber||"-"),h(2),N(n.formatVehicleStatus(e.status)),h(2),k("Vehicle: ",e.vehicleNo||"-",""),h(4),C("ngModel",e.vehicleNo)("disabled",n.isUpdatingManifestVehicle),h(3),C("ngForOf",n.getCompanyVehicleOptions()),h(2),k("Pickup: ",e.pickup||"-",""),h(2),k("Drop: ",e.drop||"-",""),h(4),C("ngIf",!e.consignments.length),h(),C("ngForOf",e.consignments)}}function SG(t,i){if(1&t){const e=O();l(0,"div",8)(1,"div",9)(2,"span",10),M("click",function(){return _(e),v(f().closeEditLocationPopup())}),u(3,"\xd7"),c(),l(4,"h3"),u(5,"Edit Vehicle Activity"),c(),l(6,"p",11),u(7),c(),l(8,"label"),u(9," Current Branch "),l(10,"select",12),S("ngModelChange",function(o){_(e);const r=f();return x(r.editLocationValue,o)||(r.editLocationValue=o),v(o)}),l(11,"option",13),u(12,"Select a location"),c(),D(13,mG,2,2,"option",14),c()(),l(14,"div",15)(15,"h4"),u(16,"Scheduled Manifests"),c(),D(17,_G,2,0,"p",4)(18,vG,2,0,"p",4)(19,wG,25,10,"div",16),c(),l(20,"div",17)(21,"button",18),M("click",function(){return _(e),v(f().saveEditLocation())}),u(22,"Save"),c(),l(23,"button",19),M("click",function(){return _(e),v(f().closeEditLocationPopup())}),u(24,"Cancel"),c()()()()}if(2&t){const e=f();h(7),k("Vehicle: ",(null==e.editLocationVehicle?null:e.editLocationVehicle.vehicleNo)||"-",""),h(3),w("ngModel",e.editLocationValue),h(3),C("ngForOf",e.getLocationOptions()),h(4),C("ngIf",e.editManifestsLoading),h(),C("ngIf",!e.editManifestsLoading&&0===e.editVehicleManifests.length),h(),C("ngForOf",e.editVehicleManifests),h(2),C("disabled",!e.editLocationValue)}}let xG=(()=>{class t{constructor(e){this.http=e,this.branches=[],this.hubs=[],this.manifests=[],this.scheduledVehicleSet=new Set,this.latestManifestStatusByVehicle=new Map,this.editManifestsLoading=!1,this.editVehicleManifests=[],this.isUpdatingManifestVehicle=!1,this.isAdmin="admin"===String(localStorage.getItem("role")||"").toLowerCase(),this.vehicles=[],this.originLocId=localStorage.getItem("originLocId")||"all",this.branchName=localStorage.getItem("branch")||"All Branches",this.showEditLocationPopup=!1,this.editLocationVehicle=null,this.editLocationValue="",this.onStorage=n=>{("branch"===n.key||"originLocId"===n.key)&&(this.branchName=localStorage.getItem("branch")||"All Branches",this.originLocId=localStorage.getItem("originLocId")||"all",this.loadBranches(),this.loadHubs(),this.loadManifests())}}ngOnInit(){this.loadBranches(),this.loadHubs(),this.loadManifests(),this.branchCheck=setInterval(()=>{const e=localStorage.getItem("branch")||"All Branches",n=localStorage.getItem("originLocId")||"all";(e!==this.branchName||n!==this.originLocId)&&(this.branchName=e,this.originLocId=n,this.loadManifests(),this.buildVehicles())},1e3),this.refreshTimer=setInterval(()=>{this.loadBranches(),this.loadHubs(),this.loadManifests()},5e3),window.addEventListener("storage",this.onStorage)}ngOnDestroy(){this.branchCheck&&clearInterval(this.branchCheck),this.refreshTimer&&clearInterval(this.refreshTimer),window.removeEventListener("storage",this.onStorage)}loadHubs(){const e=Date.now();this.http.get(`http://localhost:3000/api/hubs?ts=${e}`).subscribe({next:n=>{this.hubs=n||[],this.buildVehicles()},error:n=>console.error("Error loading hubs:",n)})}loadBranches(){const e=Date.now();this.http.get(`http://localhost:3000/api/branches?ts=${e}`).subscribe({next:n=>{this.branches=n||[],this.buildVehicles()},error:n=>console.error("Error loading branches:",n)})}loadManifests(){const e={};this.originLocId&&"all"!==this.originLocId&&"all-hubs"!==this.originLocId&&(e.entityType="branch",e.entityId=this.originLocId),this.http.get("http://localhost:3000/api/manifests",{params:e}).subscribe({next:n=>{this.manifests=Array.isArray(n)?n:[],this.buildScheduledVehicleSet(),this.buildVehicles()},error:n=>console.error("Error loading manifests:",n)})}buildVehicles(){const e=this.originLocId||"all",n=String(this.branchName||"").trim().toLowerCase(),o="all-hubs"===e,r="all"===e,s=this.isAdmin?[]:this.getAssignedoriginLocIds(),a=this.isAdmin?this.branches||[]:s.length?(this.branches||[]).filter(g=>s.includes(String(g?._id||"").trim())):[],d=[];o||(a||[]).forEach(g=>{(Array.isArray(g?.vehicles)?g.vehicles:[]).forEach(b=>{const y=String(b?.vehicleNo||"").trim(),I=String(b?.driverPhone||"").trim(),P=this.normalizeId(g?._id),T=this.normalizeId(b?.currentLocationId||b?.currentBranch),A=String(b?.currentLocationType||"").trim().toLowerCase();!y&&!I||!r&&!this.matchesBranchFilter(P,e,n)||d.push({originLocId:String(g?._id||""),branchName:g?.branchName||"",branchStatus:g?.status||"",vehicleNo:y,vehicleStatus:this.resolveVehicleStatus(y,b?.vehicleStatus),driverPhone:I,currentLocationId:P,vehicleCurrentLocationId:T,vehicleCurrentLocationType:A,sourceType:"branch",sourceId:String(g?._id||"")})})}),((this.isAdmin?this.hubs||[]:s.length?(this.hubs||[]).filter(g=>s.includes(String(g?.originLocId||"").trim())):[])||[]).forEach(g=>{(Array.isArray(g?.deliveryAddresses)?g.deliveryAddresses:[]).forEach(b=>{(Array.isArray(b?.vehicles)?b.vehicles:[]).forEach(I=>{const P=String(I?.vehicleNo||"").trim(),T=String(I?.driverPhone||"").trim(),A=this.normalizeId(g?._id),E=this.normalizeId(I?.currentLocationId||I?.currentBranch),V=String(I?.currentLocationType||"").trim().toLowerCase();!P&&!T||!r&&!o&&!this.matchesBranchFilter(A,e,n)||d.push({originLocId:String(g?._id||""),branchName:g?.hubName||"",branchStatus:g?.status||"",vehicleNo:P,vehicleStatus:this.resolveVehicleStatus(P,I?.vehicleStatus),driverPhone:T,currentLocationId:A,vehicleCurrentLocationId:E,vehicleCurrentLocationType:V,sourceType:"hub",sourceId:String(g?._id||"")})})})}),this.vehicles=d}matchesBranchFilter(e,n,o){const r=String(e||"").trim();if(!r)return!1;const s=String(o||"").trim().toLowerCase();if(r.toLowerCase()===s||String(r)===String(n))return!0;const d=(this.branches||[]).find(g=>String(g?._id||"")===r);if(d?.branchName&&String(d.branchName).trim().toLowerCase()===s)return!0;const p=(this.hubs||[]).find(g=>String(g?._id||"")===r);return!(!p?.hubName||String(p.hubName).trim().toLowerCase()!==s)||this.matchesBranchLabel(r,String(o||""))}matchesBranchLabel(e,n){const o=String(e||"").trim().toLowerCase(),r=String(n||"").trim().toLowerCase();if(!o||!r)return!1;if(r===o||r.startsWith(`${o}-`))return!0;const s=r.split("-")[0].trim();return!!s&&s===o}normalizeId(e){return e?"string"==typeof e?e:String(e?._id?e._id:e?.$oid?e.$oid:e):""}getAssignedoriginLocIds(){try{const e=JSON.parse(localStorage.getItem("originLocIds")||"[]");return Array.isArray(e)?e.map(n=>String(n||"").trim()).filter(n=>n):[]}catch{return[]}}toggleBranchStatus(e){e&&this.http.patch(`http://localhost:3000/api/branches/${e}/status`,{}).subscribe({next:()=>this.loadBranches(),error:n=>console.error("Error updating branch status:",n)})}openEditLocation(e,n){if(n&&n.stopPropagation(),!e?.vehicleNo)return;this.editLocationVehicle=e;const o=this.normalizeId(e?.vehicleCurrentLocationId),r=String(e?.vehicleCurrentLocationType||"").trim().toLowerCase();this.editLocationValue=o&&r?`${r}:${o}`:e?.currentLocationId&&e?.sourceType?`${e.sourceType}:${e.currentLocationId}`:"",this.loadVehicleManifestsForEdit(e.vehicleNo),this.showEditLocationPopup=!0}closeEditLocationPopup(){this.showEditLocationPopup=!1,this.editLocationVehicle=null,this.editLocationValue="",this.editVehicleManifests=[],this.editManifestsLoading=!1,this.isUpdatingManifestVehicle=!1}saveEditLocation(){if(!this.editLocationVehicle||!this.editLocationValue)return;const[e,n]=String(this.editLocationValue).split(":");e&&n&&this.http.patch("hub"===this.editLocationVehicle.sourceType?`http://localhost:3000/api/hubs/${this.editLocationVehicle.sourceId}/vehicle-status`:`http://localhost:3000/api/branches/${this.editLocationVehicle.sourceId}/vehicle-status`,{vehicleNo:this.editLocationVehicle.vehicleNo,vehicleStatus:this.editLocationVehicle.vehicleStatus||"online",currentLocationId:n,currentLocationType:e}).subscribe({next:()=>{this.closeEditLocationPopup(),this.loadBranches(),this.loadHubs(),this.loadManifests()},error:r=>console.error("Error updating vehicle location:",r)})}loadVehicleManifestsForEdit(e){const n=String(e||"").trim().toLowerCase(),o=(this.manifests||[]).filter(r=>String(r?.vehicleNo||"").trim().toLowerCase()===n).filter(r=>"scheduled"===String(r?.status||"").trim().toLowerCase());this.editManifestsLoading=!0,this.editVehicleManifests=[],this.fillManifestDetails(o,r=>{this.editVehicleManifests=r,this.editManifestsLoading=!1})}fillManifestDetails(e,n){if(!e.length)return void n([]);const o=Array.from(new Set(e.flatMap(s=>Array.isArray(s?.items)?s.items:[]).map(s=>String(s?.consignmentNumber||"").trim()).filter(Boolean)));o.length?Pn(o.map(s=>this.http.get("http://localhost:3000/api/newshipments/getConsignment",{params:{consignmentNumber:s}}))).subscribe({next:s=>{const a=s.flatMap(g=>Array.isArray(g)?g:[]),d=new Map(a.map(g=>[String(g?.consignmentNumber||""),g])),p=e.map(g=>{const b=(Array.isArray(g?.items)?g.items:[]).map(y=>{const I=String(y?.consignmentNumber||"").trim(),P=d.get(I),T=this.buildShipmentProductSummary(P);return{consignmentNumber:I,shipmentStatus:String(P?.shipmentStatus||""),products:T}}).filter(y=>y.consignmentNumber);return{id:String(g?._id||""),manifestNumber:String(g?.manifestNumber||""),status:String(g?.status||""),vehicleNo:String(g?.vehicleNo||""),pickup:this.resolveManifestPickup(g),drop:this.resolveManifestDrop(g),consignments:b}});n(p)},error:s=>{console.error("Error loading vehicle manifests",s),n([])}}):n(e.map(s=>({id:String(s?._id||""),manifestNumber:String(s?.manifestNumber||""),status:String(s?.status||""),vehicleNo:String(s?.vehicleNo||""),pickup:this.resolveManifestPickup(s),drop:this.resolveManifestDrop(s),consignments:[]})))}getCurrentBranchLabel(e){const n=this.normalizeId(e);if(!n)return"-";const o=(this.branches||[]).find(d=>String(d?._id||"")===n);if(o?.branchName)return o.branchName;const r=(this.branches||[]).find(d=>String(d?.branchName||"").trim().toLowerCase()===n.toLowerCase());if(r?.branchName)return r.branchName;const s=(this.branches||[]).find(d=>this.matchesBranchLabel(n,String(d?.branchName||"")));if(s?.branchName)return s.branchName;const a=(this.hubs||[]).find(d=>String(d?._id||"")===n);return a?.hubName?a.hubName:n}getVehicleCurrentBranchLabel(e){const n=this.normalizeId(e?.vehicleCurrentLocationId||"");return n?this.getCurrentBranchLabel(n):"-"}getLocationOptions(){const e=[];return(this.branches||[]).forEach(n=>{const o=this.normalizeId(n?._id);if(!o)return;const r=String(n?.branchName||"").trim();e.push({value:`branch:${o}`,label:`Branch: ${r||o}`})}),(this.hubs||[]).forEach(n=>{const o=this.normalizeId(n?._id);if(!o)return;const r=String(n?.hubName||"").trim();e.push({value:`hub:${o}`,label:`Hub: ${r||o}`})}),e}formatVehicleStatus(e){const n=String(e||"").trim().toLowerCase();return n?n.charAt(0).toUpperCase()+n.slice(1):""}buildScheduledVehicleSet(){const e=new Map;(this.manifests||[]).forEach(r=>{const s=String(r?.vehicleNo||"").trim().toLowerCase();if(!s)return;const a=String(r?.status||"").trim().toLowerCase(),d=r?.deliveredAt||r?.updatedAt||r?.createdAt,p=d?new Date(d).getTime():0,g=e.get(s);(!g||p>=g.ts)&&e.set(s,{status:a,ts:p})});const n=new Set,o=new Map;e.forEach((r,s)=>{"scheduled"===r.status&&n.add(s),o.set(s,r.status)}),this.scheduledVehicleSet=n,this.latestManifestStatusByVehicle=o}resolveVehicleStatus(e,n){const o=String(e||"").trim().toLowerCase();if(!o)return String(n||"online");if(this.scheduledVehicleSet.has(o))return"scheduled";const r=this.latestManifestStatusByVehicle.get(o);return r&&"completed"!==r?String(n||"online"):"completed"}resolveManifestPickup(e){const n=String(e?.entityType||"").trim().toLowerCase(),o=this.normalizeId(e?.entityId);return this.resolveLocationName(n,o)}resolveManifestDrop(e){const n=String(e?.deliveryType||"").trim().toLowerCase(),o=this.normalizeId(e?.deliveryId);return n&&o?this.resolveLocationName(n,o):this.resolveManifestPickup(e)}resolveLocationName(e,n){if(!e||!n)return"-";if("hub"===e){const r=(this.hubs||[]).find(s=>this.normalizeId(s?._id)===n);return r?.hubName?String(r.hubName).trim():n}const o=(this.branches||[]).find(r=>this.normalizeId(r?._id)===n);return o?.branchName?String(o.branchName).trim():n}buildShipmentProductSummary(e){if(!e)return[];const o=(Array.isArray(e?.ewaybills)?e.ewaybills.flatMap(s=>s?.invoices||[]):e?.invoices||[]).flatMap(s=>s?.products||[]),r=new Map;return o.forEach(s=>{const a=String(s?.type||s?.productName||"").trim();if(!a)return;const d=Number(s?.amount)||0;r.set(a,(r.get(a)||0)+d)}),Array.from(r.entries()).map(([s,a])=>({name:s,qty:a}))}getCompanyVehicleOptions(){const e=new Set;return(this.branches||[]).forEach(n=>{(n?.vehicles||[]).forEach(o=>{const r=String(o?.vehicleNo||"").trim();r&&e.add(r)})}),(this.hubs||[]).forEach(n=>{(n?.deliveryAddresses||[]).forEach(o=>{(o?.vehicles||[]).forEach(r=>{const s=String(r?.vehicleNo||"").trim();s&&e.add(s)})})}),Array.from(e)}onManifestVehicleChange(e,n){const o=String(e?.id||"").trim(),r=String(n||"").trim();!o||!r||r!==String(e?.vehicleNo||"").trim()&&(this.isUpdatingManifestVehicle=!0,this.http.patch(`http://localhost:3000/api/manifests/${o}/vehicle`,{vehicleNo:r}).subscribe({next:()=>{e.vehicleNo=r,this.loadManifests(),this.isUpdatingManifestVehicle=!1},error:s=>{console.error("Error updating manifest vehicle",s),this.isUpdatingManifestVehicle=!1}}))}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-branch-vehicles"]],standalone:!0,features:[Ae],decls:23,vars:4,consts:[[1,"branch-vehicles-container"],[1,"branch-subtitle"],[1,"vehicles-table-wrapper"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","modal",4,"ngIf"],["type","button",1,"link-button",3,"click"],["colspan","6"],[1,"modal"],[1,"modal-content"],[1,"close",3,"click"],[1,"modal-subtitle"],[3,"ngModelChange","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"manifest-consignments","edit-manifest-list"],["class","manifest-card",4,"ngFor","ngForOf"],[1,"terminal-buttons"],["type","button",3,"click","disabled"],["type","button",3,"click"],[3,"value"],[1,"manifest-card"],[1,"manifest-header"],[1,"manifest-status"],[1,"manifest-meta"],[1,"manifest-meta","manifest-vehicle-select"],[3,"ngModelChange","ngModel","disabled"],[1,"manifest-consignments"],["class","manifest-empty",4,"ngIf"],["class","consignment-row",4,"ngFor","ngForOf"],[1,"manifest-empty"],[1,"consignment-row"],[1,"consignment-header"],[1,"consignment-status"],[1,"consignment-products"],["class","product-pill",4,"ngFor","ngForOf"],[1,"product-pill"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Branch Vehicles"),c(),l(3,"p",1),u(4),c(),l(5,"div",2)(6,"table")(7,"tr")(8,"th"),u(9,"Branch"),c(),l(10,"th"),u(11,"Vehicles num"),c(),l(12,"th"),u(13,"Phone"),c(),l(14,"th"),u(15,"Vehicle Status"),c(),l(16,"th"),u(17,"Current Branch"),c(),l(18,"th"),u(19,"Actions"),c()(),D(20,gG,14,5,"tr",3)(21,fG,3,0,"tr",4),c()()(),D(22,SG,25,7,"div",5)),2&n&&(h(4),N("all"===o.originLocId?"All Branches":"all-hubs"===o.originLocId?"All Hubs":o.branchName),h(16),C("ngForOf",o.vehicles),h(),C("ngIf",0===o.vehicles.length),h(),C("ngIf",o.showEditLocationPopup))},dependencies:[pt,lt,Xe,et,wt,St,vt,We,He,_8],styles:[".branch-vehicles-container[_ngcontent-%COMP%]{padding:20px}.branch-subtitle[_ngcontent-%COMP%]{color:#6b7280;margin-top:4px}.vehicles-table-wrapper[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:12px}.vehicles-table-wrapper[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .vehicles-table-wrapper[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb;padding:8px;text-align:left}.vehicles-table-wrapper[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:480px;max-width:90%;max-height:80vh;overflow-y:auto;border-radius:8px;position:relative}.vehicle-manifest-modal[_ngcontent-%COMP%]{width:720px}.close[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;font-size:24px;cursor:pointer}.terminal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:12px;margin-top:12px}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:6px;cursor:pointer}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#007acc;color:#fff}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#555;color:#fff}.link-button[_ngcontent-%COMP%]{background:#2563eb;border:none;padding:6px 12px;color:#fff;cursor:pointer;border-radius:6px;font-size:13px}.modal-subtitle[_ngcontent-%COMP%]{color:#6b7280;margin:6px 0 12px}.manifest-card[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:8px;padding:12px;margin-top:12px;background:#f9fafb}.manifest-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}.manifest-status[_ngcontent-%COMP%]{margin-left:8px;font-size:12px;color:#6b7280}.manifest-meta[_ngcontent-%COMP%]{font-size:13px;color:#4b5563;margin-top:4px}.manifest-vehicle-select[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin-left:8px;padding:4px 6px}.manifest-consignments[_ngcontent-%COMP%]{margin-top:10px}.edit-manifest-list[_ngcontent-%COMP%]{margin-top:16px;border-top:1px solid #e5e7eb;padding-top:12px}.consignment-row[_ngcontent-%COMP%]{border-top:1px dashed #d1d5db;padding-top:8px;margin-top:8px}.consignment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:600}.consignment-status[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}.consignment-products[_ngcontent-%COMP%]{margin-top:6px;display:flex;flex-wrap:wrap;gap:6px;font-size:12px}.product-pill[_ngcontent-%COMP%]{background:#e0f2fe;color:#0f172a;padding:2px 6px;border-radius:999px}.manifest-empty[_ngcontent-%COMP%]{font-size:12px;color:#6b7280}"]})}}return t})(),PG=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-configuration"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"Configuration"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})(),DG=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-locations"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"locations"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();function NG(t,i){1&t&&(l(0,"p",3),u(1,"Only admins can view audit logs."),c())}function TG(t,i){1&t&&(l(0,"div",15),u(1,"Loading audit logs..."),c())}function kG(t,i){if(1&t&&(l(0,"div",16),u(1),c()),2&t){const e=f(2);h(),N(e.auditError)}}function EG(t,i){if(1&t&&(l(0,"tr")(1,"td"),u(2),hi(3,"date"),c(),l(4,"td"),u(5),c(),l(6,"td"),u(7),c(),l(8,"td")(9,"pre"),u(10),hi(11,"json"),c()(),l(12,"td")(13,"pre"),u(14),hi(15,"json"),c()()()),2&t){const e=i.$implicit;h(2),N(_o(3,5,e.createdAt,"yyyy-MM-dd HH:mm")),h(3),N(e.action),h(2),N(e.actorUsername||e.actorEmail),h(3),N(Dg(11,8,e.before)),h(4),N(Dg(15,10,e.after||e.metadata))}}function AG(t,i){1&t&&(l(0,"tr")(1,"td",21),u(2,"No audit logs found."),c()())}function OG(t,i){if(1&t){const e=O();l(0,"div",17)(1,"div",18)(2,"button",11),M("click",function(){return _(e),v(f(2).changeAuditPage(-1))}),u(3,"Prev"),c(),l(4,"span"),u(5),c(),l(6,"button",11),M("click",function(){return _(e),v(f(2).changeAuditPage(1))}),u(7,"Next"),c(),l(8,"span"),u(9),c()(),l(10,"table")(11,"thead")(12,"tr")(13,"th"),u(14,"Time"),c(),l(15,"th"),u(16,"Action"),c(),l(17,"th"),u(18,"User"),c(),l(19,"th"),u(20,"Before"),c(),l(21,"th"),u(22,"After / Meta"),c()()(),l(23,"tbody"),D(24,EG,16,12,"tr",19)(25,AG,3,0,"tr",20),c()()()}if(2&t){const e=f(2);h(2),C("disabled",e.auditPage<=1),h(3),Be("Page ",e.auditPage," of ",e.auditTotalPages,""),h(),C("disabled",e.auditPage>=e.auditTotalPages),h(3),k("Total: ",e.auditTotal,""),h(15),C("ngForOf",e.auditLogs),h(),C("ngIf",!e.auditLogs.length)}}function LG(t,i){if(1&t){const e=O();l(0,"div",4)(1,"div",5)(2,"label"),u(3,"From "),l(4,"input",6),S("ngModelChange",function(o){_(e);const r=f();return x(r.auditFilters.startDate,o)||(r.auditFilters.startDate=o),v(o)}),c()(),l(5,"label"),u(6,"To "),l(7,"input",6),S("ngModelChange",function(o){_(e);const r=f();return x(r.auditFilters.endDate,o)||(r.auditFilters.endDate=o),v(o)}),c()(),l(8,"label"),u(9,"Action "),l(10,"input",7),S("ngModelChange",function(o){_(e);const r=f();return x(r.auditFilters.action,o)||(r.auditFilters.action=o),v(o)}),c()(),l(11,"label"),u(12,"User "),l(13,"input",8),S("ngModelChange",function(o){_(e);const r=f();return x(r.auditFilters.user,o)||(r.auditFilters.user=o),v(o)}),c()(),l(14,"label"),u(15,"Limit "),l(16,"input",9),S("ngModelChange",function(o){_(e);const r=f();return x(r.auditFilters.limit,o)||(r.auditFilters.limit=o),v(o)}),c()(),l(17,"button",10),M("click",function(){_(e);const o=f();return o.auditPage=1,v(o.loadAuditLogs())}),u(18,"Load Logs"),c(),l(19,"button",10),M("click",function(){return _(e),v(f().clearAuditFilters())}),u(20,"Clear Filters"),c(),l(21,"button",11),M("click",function(){return _(e),v(f().exportAuditLogsJson())}),u(22,"Export JSON"),c(),l(23,"button",11),M("click",function(){return _(e),v(f().exportAuditLogsCsv())}),u(24,"Export CSV"),c()(),D(25,TG,2,0,"div",12)(26,kG,2,1,"div",13)(27,OG,26,7,"div",14),c()}if(2&t){const e=f();h(4),w("ngModel",e.auditFilters.startDate),h(3),w("ngModel",e.auditFilters.endDate),h(3),w("ngModel",e.auditFilters.action),h(3),w("ngModel",e.auditFilters.user),h(3),w("ngModel",e.auditFilters.limit),h(5),C("disabled",!e.auditLogs.length),h(2),C("disabled",!e.auditLogs.length),h(2),C("ngIf",e.auditLoading),h(),C("ngIf",!e.auditLoading&&e.auditError),h(),C("ngIf",!e.auditLoading)}}let RG=(()=>{class t{constructor(e){this.http=e,this.auditLogs=[],this.auditLoading=!1,this.auditError="",this.auditFilters={startDate:"",endDate:"",action:"",user:"",limit:"500"},this.auditPage=1,this.auditTotal=0,this.auditTotalPages=1}ngOnInit(){this.isAdmin()&&this.loadAuditLogs()}isAdmin(){return"admin"===String(localStorage.getItem("role")||"").toLowerCase()}loadAuditLogs(){if(!this.isAdmin())return;this.auditError="",this.auditLoading=!0;const e=localStorage.getItem("token");if(!e)return this.auditError="Missing auth token. Please log in again.",void(this.auditLoading=!1);const n={limit:this.auditFilters.limit||"500",page:String(this.auditPage||1)};this.auditFilters.startDate&&(n.startDate=this.auditFilters.startDate),this.auditFilters.endDate&&(n.endDate=this.auditFilters.endDate),this.auditFilters.action&&(n.action=this.auditFilters.action),this.auditFilters.user&&(n.user=this.auditFilters.user),this.http.get("http://localhost:3000/api/audit-logs",{headers:new tn({Authorization:`Bearer ${e}`}),params:n}).subscribe({next:o=>{this.auditLogs=Array.isArray(o?.logs)?o.logs:[],this.auditTotal=Number(o?.total)||0,this.auditPage=Number(o?.page)||this.auditPage;const r=Number(this.auditFilters.limit)||500;this.auditTotalPages=Math.max(1,Math.ceil(this.auditTotal/r)),this.auditLoading=!1},error:o=>{console.error("Error loading audit logs:",o),this.auditLogs=[],this.auditError=o?.error?.message||"Failed to load audit logs.",this.auditLoading=!1}})}clearAuditFilters(){this.auditFilters={startDate:"",endDate:"",action:"",user:"",limit:"500"},this.auditPage=1,this.loadAuditLogs()}changeAuditPage(e){const o=Math.min(this.auditTotalPages||1,Math.max(1,(this.auditPage||1)+e));o!==this.auditPage&&(this.auditPage=o,this.loadAuditLogs())}exportAuditLogsJson(){const e=JSON.stringify(this.auditLogs||[],null,2);this.downloadBlob(e,"audit-logs.json","application/json")}exportAuditLogsCsv(){const e=(this.auditLogs||[]).map(r=>({time:r.createdAt||"",action:r.action||"",user:r.actorUsername||r.actorEmail||"",before:JSON.stringify(r.before||{}),after:JSON.stringify(r.after||r.metadata||{})})),n=["time","action","user","before","after"],o=[n.join(",")].concat(e.map(r=>n.map(s=>this.escapeCsv(String(r[s]||""))).join(","))).join("\n");this.downloadBlob(o,"audit-logs.csv","text/csv")}escapeCsv(e){const n=e.replace(/\"/g,'""');return/[\",\n]/.test(n)?`"${n}"`:n}downloadBlob(e,n,o){const r=new Blob([e],{type:o}),s=URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=n,a.click(),URL.revokeObjectURL(s)}static{this.\u0275fac=function(n){return new(n||t)(R(Ve))}}static{this.\u0275cmp=pe({type:t,selectors:[["app-logs"]],standalone:!0,features:[Ae],decls:5,vars:2,consts:[[1,"logs-page"],["class","subtitle",4,"ngIf"],["class","audit-section",4,"ngIf"],[1,"subtitle"],[1,"audit-section"],[1,"audit-filters"],["type","date",3,"ngModelChange","ngModel"],["type","text","placeholder","auth.login or businessType",3,"ngModelChange","ngModel"],["type","text","placeholder","username or email",3,"ngModelChange","ngModel"],["type","number","min","1","max","500",3,"ngModelChange","ngModel"],["type","button",3,"click"],["type","button",3,"click","disabled"],["class","audit-status",4,"ngIf"],["class","audit-status error",4,"ngIf"],["class","audit-table",4,"ngIf"],[1,"audit-status"],[1,"audit-status","error"],[1,"audit-table"],[1,"audit-pagination"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","5",1,"empty"]],template:function(n,o){1&n&&(l(0,"div",0)(1,"h2"),u(2,"Audit Logs"),c(),D(3,NG,2,0,"p",1)(4,LG,28,10,"div",2),c()),2&n&&(h(3),C("ngIf",!o.isAdmin()),h(),C("ngIf",o.isAdmin()))},dependencies:[pt,lt,Xe,_0,Fr,et,qe,on,We,Gi,du,He],styles:[".logs-page[_ngcontent-%COMP%]{padding:20px;color:#0f172a}.subtitle[_ngcontent-%COMP%]{margin:6px 0 0;color:#64748b;font-size:13px}.audit-section[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:10px;padding:16px;margin-top:12px}.audit-filters[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px 14px;align-items:flex-end;margin-bottom:12px}.audit-filters[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;font-weight:600;font-size:13px}.audit-filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:6px 8px;border-radius:6px;border:1px solid #cbd5f5;min-width:160px}.audit-filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:8px;border:1px solid #2c3e50;background:#2c3e50;color:#fff;cursor:pointer}.audit-filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#1b2836}.audit-filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.audit-pagination[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:10px;margin-bottom:10px;font-size:13px}.audit-pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;border-radius:6px;border:1px solid #2c3e50;background:#fff;cursor:pointer}.audit-pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.audit-status[_ngcontent-%COMP%]{padding:10px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px}.audit-status.error[_ngcontent-%COMP%]{background:#fef2f2;border-color:#fecaca;color:#991b1b}.audit-table[_ngcontent-%COMP%]{overflow:auto}.audit-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.audit-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .audit-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;padding:8px 10px;text-align:left;vertical-align:top}.audit-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc}.audit-table[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;font-size:12px}"]})}}return t})(),FG=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-changePass"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"changePass"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})(),BG=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275cmp=pe({type:t,selectors:[["app-roles"]],decls:2,vars:0,template:function(n,o){1&n&&(l(0,"h2"),u(1,"roles"),c())},styles:["h2[_ngcontent-%COMP%]{color:#1976d2}"]})}}return t})();const VG=new Set(["Branches","profile","changePass","roles","notifications"]),HG=[{path:"",component:CH},{path:"home",component:TH,canActivateChild:[t=>{const i=F(xn),e=F(Ve);return!!VG.has(t.routeConfig?.path||"")||(localStorage.getItem("token")?e.get("http://localhost:3000/api/branches").pipe(le(r=>(Array.isArray(r)?r.length:0)>0||i.createUrlTree(["/home","Branches"])),wo(()=>Q(i.createUrlTree(["/home","Branches"])))):i.createUrlTree(["/"]))}],children:[{path:"dashboard",component:kH},{path:"new-shipment",component:k7},{path:"shipments",component:Z7},{path:"admin",component:Y7},{path:"Branches",component:gj},{path:"Clients",component:u9},{path:"Guests",component:T9},{path:"Categories",component:k9},{path:"Pkgs",component:V9},{path:"Hubs",component:Oj},{path:"Tpartners",component:Wj},{path:"Logs",component:RG},{path:"Invoiced",component:pG},{path:"Delivered",component:rG},{path:"Manifest",component:Zz},{path:"Stocks",component:Sz},{path:"BranchVehicles",component:xG},{path:"RoleSettings",component:cU},{path:"Payments",component:NU},{path:"Locations",component:DG},{path:"Configuration",component:PG},{path:"Products",component:eU},{path:"settings",component:K7},{path:"profile",component:ij},{path:"roles",component:BG},{path:"changePass",component:FG},{path:"notifications",component:Qj}]}];(function s5(t,i){return CR({rootComponent:t,...j0(i)})})(w8,{providers:[function kB(...t){const i=[Ve,yw,vw,{provide:Md,useExisting:vw},{provide:Id,useFactory:()=>F(Ef,{optional:!0})??F(yw)},{provide:Aa,useValue:TB,multi:!0},{provide:Of,useValue:!0},{provide:Iw,useClass:NB}];for(const e of t)i.push(...e.\u0275providers);return Uo(i)}(function EB(t){return function Mo(t,i){return{\u0275kind:t,\u0275providers:i}}(Vi.Interceptors,t.map(i=>({provide:Aa,useValue:i,multi:!0})))}([(t,i)=>{const e=localStorage.getItem("token");return i(e?t.clone({setHeaders:{Authorization:`Bearer ${e}`}}):t)}])),function l8(t,...i){return Uo([{provide:Kr,multi:!0,useValue:t},[],{provide:qr,useFactory:LS,deps:[xn]},{provide:ba,multi:!0,useFactory:RS},i.map(e=>e.\u0275providers)])}(HG)]}).catch(t=>console.error(t))}},ns=>{ns(ns.s=962)}]);