<div class="form-container">

  <!-- CONSIGNMENT HEADER -->
  <section>
    <h2>New Shipment</h2>
    <div class="grid-2">
      <label>Consignment Number*
        <input [(ngModel)]="consignmentNumber" readonly>
      </label>

      <label>Date*
        <input type="date" [(ngModel)]="date">
      </label>
    </div>
  </section>


  <!-- MULTIPLE E-WAYBILLS -->
  <section>
    <h3>E-Waybills</h3>

    <div *ngFor="let ewb of ewaybills; let e = index" class="ewaybill-block">

      <h4>E-Waybill {{ e + 1 }}</h4>

      <div class="grid-3">
        <label>E-Waybill Number*
          <input [(ngModel)]="ewb.number">
        </label>

        <label>E-Waybill Date
          <input type="date" [(ngModel)]="ewb.date">
        </label>

        <button type="button" (click)="deleteEwaybill(e)">üóëÔ∏è Delete E-Waybill</button>
      </div>



      <!-- INVOICES UNDER THIS E-WAYBILL -->
      <div class="invoice-section">
        <h5>Invoices under E-Waybill {{ e + 1 }}</h5>

        <div *ngFor="let invoice of ewb.invoices; let i = index" class="invoice-block">
          
          <h6>Invoice {{ i + 1 }}</h6>

          <!-- Invoice Header -->
          <div class="grid-3">
            <input placeholder="Invoice Number" [(ngModel)]="invoice.number">
            <input placeholder="Invoice Value" type="number" [(ngModel)]="invoice.value">
            <button type="button" (click)="deleteInvoice(e, i)">üóëÔ∏è</button>
          </div>


          <!-- PRODUCTS -->
          <h6>Products</h6>
          <div *ngFor="let product of invoice.products; let p=index" class="grid-4">
            <select [(ngModel)]="product.type">
              <option *ngFor="let prod of productList" [value]="prod.productName">
                {{ prod.hsnNum }} - {{ prod.productName }}
              </option>
            </select>
            <input type="number" placeholder="Quantity" [(ngModel)]="product.amount">
            <button type="button" (click)="deleteProduct(e, i, p)">üóëÔ∏è</button>
          </div>
          <button type="button" (click)="addProduct(e, i)">+ Add Product</button>


          <!-- PACKAGES -->
          <h6>Packages</h6>
          <div *ngFor="let pkg of invoice.packages; let j=index" class="grid-4">
            <select [(ngModel)]="pkg.type">
              <option *ngFor="let p of pkgList" [value]="p.pkgName">{{ p.pkgName }}</option>
            </select>

            <input type="number" placeholder="Quantity" [(ngModel)]="pkg.amount">
            <button type="button" (click)="deletePackage(e, i, j)">üóëÔ∏è</button>
          </div>
          <button type="button" (click)="addPackage(e, i)">+ Add Package</button>

        </div>

        <!-- Add Invoice Button -->
        <button type="button" (click)="addInvoice(e)">+ Add Invoice</button>
      </div>

    </div>

    <!-- Add E-Waybill Button -->
    <button type="button" (click)="addEwaybill()">+ Add E-Waybill</button>

  </section>



  <!-- CONSIGNOR SECTION -->
  <section>
    <h3>Consignor (Sender Details)</h3>
    <div class="tab-container">

      <div class="tabs">
        <button (click)="consignorTab='consignor'" [class.active]="consignorTab==='consignor'">Consignor</button>
        <button (click)="consignorTab='guest'" [class.active]="consignorTab==='guest'">Guest</button>
      </div>

      <div class="tab-content">

        <!-- Consignor -->
        <div *ngIf="consignorTab==='consignor'">
          <button routerLink="Clients">+ New Client</button>

          <label>Sender Name
            <select [(ngModel)]="consignor" (change)="onConsignorSelect(consignor)">
              <option *ngFor="let c of clientList" [value]="c.clientName">
                {{ c.clientName }} - {{ c.address }}
              </option>
            </select>
          </label>

          <label>GSTIN
            <input [(ngModel)]="consignorGST" readonly>
          </label>
        </div>

        <!-- Guest Consignor -->
        <div *ngIf="consignorTab==='guest'">
          <button routerLink="Guests">+ New Guest</button>

          <label>Guest Sender
            <select [(ngModel)]="consignor" (change)="onConsignorGuestSelect(consignor)">
              <option *ngFor="let g of guestList" [value]="g.guestName">
                {{ g.guestName }} - {{ g.address }}
              </option>
            </select>
          </label>

          <label>Phone
            <input [(ngModel)]="consignorPhone" readonly>
          </label>
        </div>

      </div>
    </div>
  </section>



  <!-- CONSIGNEE SECTION -->
  <section>
    <h3>Consignee (Receiver Details)</h3>
    <div class="tab-container">

      <div class="tabs">
        <button (click)="consigneeTab='consignee'" [class.active]="consigneeTab==='consignee'">Consignee</button>
        <button (click)="consigneeTab='guest'" [class.active]="consigneeTab==='guest'">Guest</button>
      </div>

      <div class="tab-content">

        <!-- Consignee -->
        <div *ngIf="consigneeTab==='consignee'">
          <button routerLink="Clients">+ New Client</button>

          <label>Receiver Name
            <select [(ngModel)]="consignee" (change)="onConsigneeSelect(consignee)">
              <option *ngFor="let c of clientList" [value]="c.clientName">
                {{ c.clientName }} - {{ c.address }}
              </option>
            </select>
          </label>

          <label>GSTIN
            <input [(ngModel)]="consigneeGST" readonly>
          </label>
        </div>

        <!-- Guest Consignee -->
        <div *ngIf="consigneeTab==='guest'">
          <button routerLink="Guests">+ New Guest</button>

          <label>Guest Receiver
            <select [(ngModel)]="consignee" (change)="onConsigneeGuestSelect(consignee)">
              <option *ngFor="let g of guestList" [value]="g.guestName">
                {{ g.guestName }} - {{ g.address }}
              </option>
            </select>
          </label>

          <label>Phone
            <input [(ngModel)]="consigneePhone" readonly>
          </label>
        </div>

      </div>
    </div>
  </section>



  <!-- CHARGES -->
  <section>
    <h3>Charges</h3>
    <div class="grid-3">
      <label>ODC<input type="number" [(ngModel)]="charges.odc"></label>
      <label>Unloading<input type="number" [(ngModel)]="charges.unloading"></label>
      <label>Docket<input type="number" [(ngModel)]="charges.docket"></label>
      <label>Other<input type="number" [(ngModel)]="charges.other"></label>
      <label>CCC<input type="number" [(ngModel)]="charges.ccc"></label>
      <label>Final Amount<input type="number" [(ngModel)]="finalAmount"></label>
    </div>
  </section>


  <!-- FORM ACTIONS -->
  <div class="actions">
    <button (click)="calculateFinalAmount()">Calculate</button>
    <button (click)="resetForm()">Reset</button>
    <button (click)="saveShipment()">Save</button>
  </div>

</div>
