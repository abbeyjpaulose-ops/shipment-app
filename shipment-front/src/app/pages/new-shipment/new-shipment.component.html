<div class="form-container">

  <!-- CONSIGNMENT HEADER -->
  <section>
    <h2>New Shipment</h2>
    <div class="grid-2">
      <label>Consignment Number*
        <input [(ngModel)]="consignmentNumber" readonly>
      </label>

      <label>Date*
        <input type="date" [(ngModel)]="date">
      </label>
    </div>
  </section>


  <!-- MULTIPLE E-WAYBILLS - COMPACT STYLE -->
<section>
  
  <div *ngFor="let ewb of ewaybills; let e = index" class="ewaybill-compact">

    <div class="ewaybill-header">
      <strong>{{ e + 1 }}:- </strong>

      <input placeholder="Customer Eway-bill No:" [(ngModel)]="ewb.number" class="small-input">
      <input type="date" [(ngModel)]="ewb.date" class="small-input">

      <button class="delete-btn" (click)="deleteEwaybill(e)">üóëÔ∏è</button>
    </div>


    <!-- INVOICES -->
    <div *ngFor="let invoice of ewb.invoices; let i = index" class="invoice-compact">

      <div class="invoice-top">
        <span class="invoice-label">Invoice {{ i + 1 }}:- </span>

        <input placeholder="Customer INV No:" [(ngModel)]="invoice.number" class="small-input">
        <span class="invoice-label"> ‚Çπ Value:- </span>
        <input type="number" placeholder="‚Çπ Value" [(ngModel)]="invoice.value" class="small-input">

        <button class="delete-btn" (click)="deleteInvoice(e, i)">üóëÔ∏è</button>
      </div>


      <!-- PRODUCTS TABLE-LIKE -->
      <div class="sub-title">Products</div>
      <div *ngFor="let product of invoice.products; let p=index" class="compact-row">
        
        <select class="small-select" [(ngModel)]="product.type">
          <option *ngFor="let prod of productList" [value]="prod.productName">
            {{ prod.hsnNum }} - {{ prod.productName }}
          </option>
        </select>

        <input type="number" placeholder="Qty" class="extra-small-input" [(ngModel)]="product.amount">

        <button class="delete-btn" (click)="deleteProduct(e, i, p)">üóëÔ∏è</button>
      </div>

      <button class="tiny-btn" (click)="addProduct(e, i)">+ Product</button>


      <!-- PACKAGES TABLE-LIKE -->
      <div class="sub-title">Packages</div>
      <div *ngFor="let pkg of invoice.packages; let j=index" class="compact-row">
        
        <select class="small-select" [(ngModel)]="pkg.type">
          <option *ngFor="let p of pkgList" [value]="p.pkgName">{{ p.pkgName }}</option>
        </select>

        <input type="number" placeholder="Qty" class="extra-small-input" [(ngModel)]="pkg.amount">

        <button class="delete-btn" (click)="deletePackage(e, i, j)">üóëÔ∏è</button>
      </div>

      <button class="tiny-btn" (click)="addPackage(e, i)">+ Package</button>

    </div>

    <!-- Add Invoice -->
    <button class="tiny-btn primary" (click)="addInvoice(e)">+ Invoice</button>

  </div>

  <!-- Add E-Waybill -->
  <button class="tiny-btn success" (click)="addEwaybill()">+ E-Waybill</button>

</section>



 <!-- SENDER & RECEIVER SECTION SIDE-BY-SIDE -->
<section>
  <h3>Sender & Receiver Details</h3>

  <div class="grid-2">

    <!-- CONSIGNOR (LEFT SIDE) -->
    <div class="tab-container">
      <h4>Consignor (Sender)</h4>

      <div class="tabs">
        <button (click)="consignorTab='consignor'" [class.active]="consignorTab==='consignor'">Consignor</button>
        <button (click)="consignorTab='guest'" [class.active]="consignorTab==='guest'">Guest</button>
      </div>

      <div class="tab-content">

        <!-- Saved Consignor -->
        <div *ngIf="consignorTab==='consignor'">
          <button routerLink="Clients">+ New Client</button>

          <label>Sender Name
            <select [(ngModel)]="consignor" (change)="onConsignorSelect(consignor)">
              <option *ngFor="let c of clientList" [value]="c.clientName">
                {{ c.clientName }} - {{ c.address }}
              </option>
            </select>
          </label>

          <label>GSTIN
            <input [(ngModel)]="consignorGST" readonly>
          </label>
        </div>

        <!-- Guest Consignor -->
        <div *ngIf="consignorTab==='guest'">
          <button routerLink="Guests">+ New Guest</button>

          <label>Guest Sender
            <select [(ngModel)]="consignor" (change)="onConsignorGuestSelect(consignor)">
              <option *ngFor="let g of guestList" [value]="g.guestName">
                {{ g.guestName }} - {{ g.address }}
              </option>
            </select>
          </label>

          <label>Phone
            <input [(ngModel)]="consignorPhone" readonly>
          </label>
        </div>

      </div>
    </div>


    <!-- CONSIGNEE (RIGHT SIDE) -->
    <div class="tab-container">
      <h4>Consignee (Receiver)</h4>

      <div class="tabs">
        <button (click)="consigneeTab='consignee'" [class.active]="consigneeTab==='consignee'">Consignee</button>
        <button (click)="consigneeTab='guest'" [class.active]="consigneeTab==='guest'">Guest</button>
      </div>

      <div class="tab-content">

        <!-- Saved Consignee -->
        <div *ngIf="consigneeTab==='consignee'">
          <button routerLink="Clients">+ New Client</button>

          <label>Receiver Name
            <select [(ngModel)]="consignee" (change)="onConsigneeSelect(consignee)">
              <option *ngFor="let c of clientList" [value]="c.clientName">
                {{ c.clientName }} - {{ c.address }}
              </option>
            </select>
          </label>

          <label>GSTIN
            <input [(ngModel)]="consigneeGST" readonly>
          </label>
        </div>

        <!-- Guest Consignee -->
        <div *ngIf="consigneeTab==='guest'">
          <button routerLink="Guests">+ New Guest</button>

          <label>Guest Receiver
            <select [(ngModel)]="consignee" (change)="onConsigneeGuestSelect(consignee)">
              <option *ngFor="let g of guestList" [value]="g.guestName">
                {{ g.guestName }} - {{ g.address }}
              </option>
            </select>
          </label>

          <label>Phone
            <input [(ngModel)]="consigneePhone" readonly>
          </label>
        </div>

      </div>
    </div>

  </div>
</section>


<!-- DELIVERY ADDRESS - COMPACT -->
<section class="delivery-compact">

  <h3>Delivery Address</h3>

  <div class="delivery-options">
    <label>
      <input type="radio" name="delivery" value="consignee" [(ngModel)]="deliveryType">
      Use Consignee Address
    </label>

    <label>
      <input type="radio" name="delivery" value="different" [(ngModel)]="deliveryType">
      Different Address
    </label>
  </div>

  <!-- SHOW ONLY IF DIFFERENT ADDRESS -->
  <div *ngIf="deliveryType === 'different'" class="delivery-fields">
    <div class="grid-2">
      <input class="small-input" [(ngModel)]="deliveryName" placeholder="Delivery Name">
      <input class="small-input" [(ngModel)]="deliveryPhone" placeholder="Phone Number">
    </div>

    <textarea class="small-textarea"
      placeholder="Delivery Address"
      [(ngModel)]="deliveryAddress">
    </textarea>
  </div>

</section>



   <!-- PAYMENT SECTION -->
  <section>
    <h3>Payment Details</h3>
    <div class="grid-3">
      <label>Payment Mode
        <select [(ngModel)]="paymentMode">
          <option>To Pay</option>
          <option>Account Credit</option>
          <option>Paid</option>
        </select>
      </label>

      <label>External Ref ID
        <input [(ngModel)]="externalRefId" placeholder="Optional reference ID">
      </label>
    </div>
    </section>



  <!-- CHARGES -->
  <section>
    <h3>Charges</h3>
    <div class="grid-3">
      <label>ODC
        <input type="number" [(ngModel)]="charges.odc">
      </label>
      <label>Unloading
        <input type="number" [(ngModel)]="charges.unloading">
      </label>
      <label>Docket
        <input type="number" [(ngModel)]="charges.docket">
      </label>
      <label>Other
        <input type="number" [(ngModel)]="charges.other">
      </label>
      <label>CCC
        <input type="number" [(ngModel)]="charges.ccc">
      </label>
      <label>Discount (Consignor)
        <input type="number" [(ngModel)]="charges.consignorDiscount" placeholder="% Discount">
      </label>
      <label>Final Amount
        <input type="number" [(ngModel)]="finalAmount" readonly>
      </label>
    </div>
  </section>



  <!-- FORM ACTIONS -->
  <div class="actions">
    <button (click)="calculateFinalAmount()">Calculate</button>
    <button (click)="resetForm()">Reset</button>
    <button (click)="saveShipment()">Save</button>
  </div>

</div>
