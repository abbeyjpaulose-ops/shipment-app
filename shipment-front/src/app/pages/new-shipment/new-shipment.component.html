<div class="page-shell" [class.all-hubs-lock]="isAllHubsSelectionRequired">
  <header class="page-header">
    <div>
      <p class="eyebrow">Operations</p>
      <h1>New Shipment</h1>
      <p class="subhead">Create and save a shipment with consignor/consignee, items, and charges.</p>
    </div>
    <div class="meta-stack">
      <div class="chip-field">
        <span>Branch</span>
        <strong>{{ branch || 'All Branches' }}</strong>
      </div>
      <div class="chip-field">
        <span>Consignment No.</span>
        <strong>{{ consignmentNumber }}</strong>
      </div>
      <div class="chip-field">
        <span>Date</span>
        <input type="date" [(ngModel)]="date">
      </div>
    </div>
  </header>

  <div class="layout">
    <!-- Left column -->
    <div class="col">
      <div class="card">
        <div class="card-head">
          <div>
            <p class="eyebrow">Shipment</p>
            <h3>Shipment Details</h3>
          </div>
          <div class="head-actions" *ngIf="branch === 'All Hubs'">
            <div class="rate-unit">
              <span>Hub</span>
              <select [(ngModel)]="selectedAllHubId" (change)="onAllHubsSelect(selectedAllHubId)">
                <option value="">Select hub</option>
                <option *ngFor="let h of getAllHubsOptions()" [value]="h._id">{{ h.hubName }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="grid-2">
          <label>Consignment Number*
            <input [(ngModel)]="consignmentNumber" readonly>
          </label>
          <label>External Ref ID
            <input [(ngModel)]="externalRefId" placeholder="Optional reference ID">
          </label>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div>
            <p class="eyebrow">Parties</p>
            <h3>Sender & Receiver</h3>
          </div>
          <div class="pill">Branch scoped</div>
        </div>
        <div class="grid-2 party-grid">
          <!-- CONSIGNOR -->
          <div class="panel">
            <div class="panel-head">
              <h4>Consignor (Sender)</h4>
              <div class="tab-buttons">
                <button (click)="consignorTab='consignor'" [class.active]="consignorTab==='consignor'">Client</button>
                <button (click)="consignorTab='guest'" [class.active]="consignorTab==='guest'">Guest</button>
              </div>
            </div>

            <div *ngIf="consignorTab==='consignor'" class="panel-body">
              <div class="inline-actions">
                <span class="muted">Saved clients</span>
                <button class="tiny-btn" (click)="openClientModal()">+ New Client/Edit Client</button>
              </div>
              <label>Sender Name
                <input
                  type="search"
                  list="consignor-client-list"
                  [(ngModel)]="consignor"
                  (ngModelChange)="onConsignorSelect(consignor)">
                <datalist id="consignor-client-list">
                  <option *ngFor="let c of clientList" [value]="c.clientName">
                    {{ formatClientOption(c) }}
                  </option>
                </datalist>
              </label>
            </div>

            <div *ngIf="consignorTab==='guest'" class="panel-body">
              <div class="inline-actions">
                <span class="muted">Guest senders</span>
                <button class="tiny-btn" (click)="openGuestModal()">+ New Guest</button>
              </div>
              <label>Guest Sender
                <select [(ngModel)]="consignor" (change)="onConsignorGuestSelect(consignor)">
                  <option *ngFor="let g of guestList" [value]="g.guestName">
                    {{ formatGuestOption(g) }}
                  </option>
                </select>
              </label>
            </div>
            <div class="panel soft">
              <div class="panel-head"></div>
              <div *ngIf="pickupType!=='different'" class="panel-body">
                <div class="inline-actions" *ngIf="getPickupSourceClientId()">
                  <span class="muted">Selected client</span>
                  <button class="tiny-btn" (click)="openPickupEditClient()">+ Edit address</button>
                </div>
                <label>Pickup Point
                  <select [(ngModel)]="pickupSource" (change)="onPickupSourceSelect(pickupSource)">
                    <option value="branch">Branch - {{ pickupName || branch || '-' }}</option>
                    <optgroup *ngIf="getPickupConsignorLocations().length" label="Consignor">
                      <option *ngFor="let loc of getPickupConsignorLocations(); let i = index" [value]="'consignor:' + i">
                        Consignor: {{ formatLocation(loc) }}
                      </option>
                    </optgroup>
                    <optgroup *ngIf="getPickupBillingLocations().length" label="Billing">
                      <option *ngFor="let loc of getPickupBillingLocations(); let i = index" [value]="'billing:' + i">
                        Billing: {{ formatLocation(loc) }}
                      </option>
                    </optgroup>
                  </select>
                </label>
              </div>
              <div *ngIf="pickupType==='branch'">
                <div class="field-display">
                  <span class="label">Branch</span>
                  <span class="value">{{ pickupName || branch || '-' }}</span>
                </div>
                <div class="field-display">
                  <span class="label">Pickup Address</span>
                  <span class="value">{{ pickupAddress || '-' }}</span>
                </div>
                <div class="field-display">
                  <span class="label">Pickup Phone</span>
                  <span class="value">{{ pickupPhone || '-' }}</span>
                </div>
                <div class="field-display">
                  <span class="label">Pickup Pincode</span>
                  <span class="value">{{ pickupPincode || '-' }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- CONSIGNEE -->
          <div class="panel">
            <div class="panel-head">
              <h4>Consignee (Receiver)</h4>
              <div class="tab-buttons">
                <button (click)="consigneeTab='consignee'" [class.active]="consigneeTab==='consignee'">Client</button>
                <button (click)="consigneeTab='guest'" [class.active]="consigneeTab==='guest'">Guest</button>
              </div>
            </div>

            <div *ngIf="consigneeTab==='consignee'" class="panel-body">
              <div class="inline-actions">
                <span class="muted">Saved clients</span>
                <button class="tiny-btn" (click)="openClientModal()">+ New Client/Edit Client</button>
              </div>
              <label>Receiver Name
                <input
                  type="search"
                  list="consignee-client-list"
                  [(ngModel)]="consignee"
                  (change)="onConsigneeSelect(consignee)">
                <datalist id="consignee-client-list">
                  <option *ngFor="let c of clientList" [value]="c.clientName">
                    {{ formatClientOption(c) }}
                  </option>
                </datalist>
              </label>
            </div>

            <div *ngIf="consigneeTab==='guest'" class="panel-body">
              <div class="inline-actions">
                <span class="muted">Guest receivers</span>
                <button class="tiny-btn" (click)="openGuestModal()">+ New Guest</button>
              </div>
              <label>Guest Receiver
                <select [(ngModel)]="consignee" (change)="onConsigneeGuestSelect(consignee)">
                  <option *ngFor="let g of guestList" [value]="g.guestName">
                    {{ formatGuestOption(g) }}
                  </option>
                </select>
              </label>
            </div>
            <div class="panel soft">
              <div class="panel-body">
                <div class="inline-actions">
                  <span class="muted">Delivery Point</span>
                  <label class="toggle-inline">
                    <input
                      type="checkbox"
                      [checked]="deliveryType === 'branch'"
                      (change)="onDeliverySelfPickupToggle($event)">
                    <span class="toggle-track">
                      <span class="toggle-thumb"></span>
                    </span>
                    <span>{{ deliveryType === 'branch' ? 'Customer Self Pickup' : 'Out for delivery too' }}</span>
                  </label>
                </div>
                <div class="inline-actions">
                  <button class="tiny-btn" (click)="openClientModal()">+ New Client/Edit Client</button>
                </div>
                <label>Client Name
                  <select [(ngModel)]="deliveryPreviousReceiver" (change)="onDeliveryPreviousReceiverSelect(deliveryPreviousReceiver)">
                    <option value="">Select client</option>
                    <option *ngFor="let c of clientList" [value]="c.clientName">
                      {{ formatClientOption(c) }}
                    </option>
                  </select>
                </label>
                <label>Delivery Address
                  <select
                    [(ngModel)]="deliveryLocationIndex"
                    (change)="onDeliverySelectedLocationSelect(deliveryLocationIndex)"
                    [disabled]="!deliveryPreviousReceiver">
                    <option value="">Select address</option>
                    <option *ngFor="let loc of getDeliverySelectedClientLocations(); let i = index" [value]="i">
                      {{ formatLocation(loc) }}
                    </option>
                  </select>
                </label>
              </div>
              <div class="field-display">
                <span class="label">Delivery Pincode</span>
                <span class="value">{{ deliveryPincode || '-' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div>
            <p class="eyebrow">Addresses</p>
            <h3>Billing</h3>
          </div>
        </div>
        <div class="grid-2">
          <div class="panel soft">
            <div class="panel-head">
              <h4>Billing</h4>
              <div class="tab-buttons ghost">
                <button (click)="setBillingType('consignor')" [class.active]="billingType==='consignor'">Use Consignor</button>
                <button (click)="setBillingType('different')" [class.active]="billingType==='different'">Different</button>
              </div>
          <div class="panel soft span-2">
            <div class="panel-body">
              <div class="grid-2 payment-grid">
                <label>Payment Mode
                  <select [(ngModel)]="paymentMode" [disabled]="!isPaymentModeEnabled()" (change)="onPaymentModeChange()">
                    <option>To Pay</option>
                    <option *ngIf="allowReceiverCredit">To Pay with account credit</option>
                    <option *ngIf="allowAccountCredit">Account Credit</option>
                    <option>Paid</option>
                  </select>
                </label>

              </div>
            </div>
          </div>
            </div>
            <div *ngIf="billingType==='different'" class="panel-body">
              <div class="inline-actions">
                <span class="muted">Saved clients</span>
                <button class="tiny-btn" (click)="openClientModal()">+ New Client/Edit Client</button>
              </div>
              <label>Billing Name
                <select [(ngModel)]="billingSource" (change)="onBillingSourceSelect(billingSource)">
                  <option value="">Select client or hub</option>
                  <optgroup label="Clients">
                    <option *ngFor="let c of clientList" [value]="'client:' + c._id">
                      {{ c.clientName }}
                    </option>
                  </optgroup>
                  <optgroup label="Hubs">
                    <option *ngFor="let h of getAvailableHubs()" [value]="'hub:' + h._id">
                      {{ h.hubName }}
                    </option>
                  </optgroup>
                </select>
              </label>
              <label>Billing Address
                <select
                  [(ngModel)]="billingLocationIndex"
                  (change)="onBillingAddressSelect(billingLocationIndex)"
                  [disabled]="!billingSource">
                  <option value="">Select address</option>
                  <option *ngFor="let addr of billingAddressOptions; let i = index" [value]="i">
                    {{ addr.label }}
                  </option>
                </select>
              </label>
              <div class="field-display">
                <span class="label">GSTIN</span>
                <span class="value">{{ billingGSTIN || '-' }}</span>
              </div>
              <div class="field-display">
                <span class="label">Phone</span>
                <span class="value">{{ billingPhone || '-' }}</span>
              </div>
            </div>
            <div *ngIf="billingType==='consignor' && consignorTab==='consignor'" class="panel-body">
              <label>Consignor Address
                <select [(ngModel)]="billingLocationIndex" (change)="onBillingLocationSelect(billingLocationIndex)">
                  <option value="">Primary address</option>
                  <option *ngFor="let loc of getConsignorLocations(); let i = index" [value]="i">
                    {{ formatLocation(loc) }}
                  </option>
                </select>
              </label>
            </div>
            <div *ngIf="billingType==='consignor' && consignorTab==='guest'" class="muted small-text">
              Using guest consignor details
            </div>
          </div>


        </div>


      </div>
    </div>

    <!-- Right column -->
    <div class="col">
      <div class="card">
      <div class="card-head">
        <div>
          <p class="eyebrow">Items</p>
          <h3>E-Waybills & Invoices</h3>
        </div>
        <div class="head-actions">
          <div class="rate-unit">
            <span>Rate Unit</span>
            <select [(ngModel)]="rateUnit" (change)="onRateUnitChange()">
              <option value="box">Rate / Box</option>
              <option value="cm3">Rate / cmA3</option>
              <option value="kg">Rate / Kg</option>
            </select>
          </div>
          <button class="tiny-btn primary black" (click)="addEwaybill()">+ E-Waybill</button>
        </div>
      </div>

        <div *ngFor="let ewb of ewaybills; let e = index" class="ewaybill">
          <div class="line-header">
            <div class="eyebrow">E-Waybill {{ e + 1 }}</div>
            <button class="icon-btn" (click)="deleteEwaybill(e)">バ</button>
          </div>
          <div class="grid-3 compact">
            <input placeholder="Customer Eway-bill No" [(ngModel)]="ewb.number">
            <input type="date" [(ngModel)]="ewb.date">
          </div>

          <div class="invoice-block" *ngFor="let invoice of ewb.invoices; let i = index">
            <div class="line-header">
              <div>
                <div class="eyebrow">Invoice {{ i + 1 }}</div>
              </div>
              <button class="icon-btn" (click)="deleteInvoice(e, i)">バ</button>
            </div>
            <div class="grid-3 compact">
            <input placeholder="Customer INV No" [(ngModel)]="invoice.number">
              <input type="number" placeholder="Value" [(ngModel)]="invoice.value" (ngModelChange)="scheduleQuote()">
            </div>

            <div class="subsection">
              <div class="subsection-head">
                <div class="subsection-title">Products</div>
                <button class="tiny-btn" (click)="openProductModal()">+ New Product</button>
              </div>
              <div *ngFor="let product of invoice.products; let p=index" class="product-row">
                <div class="compact-row">
                  <select [(ngModel)]="product.type" (change)="onProductTypeChange(product)">
                    <option *ngFor="let prod of productList" [value]="prod.productName">
                      {{ prod.hsnNum }} - {{ prod.productName }}
                    </option>
                  </select>
                  <input type="number" placeholder="Qty" [(ngModel)]="product.amount" (ngModelChange)="scheduleQuote()">
                  <button class="icon-btn" (click)="deleteProduct(e, i, p)">バ</button>
                </div>
                <div class="rate-inline">
                  <input type="number" class="rate-input" placeholder="Rate / Unit" [(ngModel)]="product.ratePer" (ngModelChange)="scheduleQuote()">
                  <span *ngIf="getSuggestedRate(product) !== null" class="suggested-rate">
                    Suggested: {{ getSuggestedRate(product) }}
                  </span>
                </div>
              </div>
              <button class="tiny-btn" (click)="addProduct(e, i)">+ Product</button>
            </div>

            <div class="subsection">
              <div class="subsection-title">Packages</div>
              <div *ngFor="let pkg of invoice.packages; let j=index" class="compact-row">
                <select [(ngModel)]="pkg.type">
                  <option *ngFor="let p of pkgList" [value]="p.pkgName">{{ p.pkgName }}</option>
                </select>
                <input type="number" placeholder="Qty" [(ngModel)]="pkg.amount" (ngModelChange)="scheduleQuote()">
                <button class="icon-btn" (click)="deletePackage(e, i, j)">バ</button>
              </div>
              <button class="tiny-btn" (click)="addPackage(e, i)">+ Package</button>
            </div>
          </div>

          <button class="tiny-btn primary ghost" (click)="addInvoice(e)">+ Invoice</button>
        </div>

        <div class="inline-actions" style="margin-top:8px;">
          <span class="muted">Need another e-waybill?</span>
          <button class="tiny-btn primary black" (click)="addEwaybill()">+ E-Waybill</button>
        </div>
      </div>

      <div class="card">
        <div class="card-head">
          <div>
            <p class="eyebrow">Money</p>
            <h3>Charges & Payment</h3>
          </div>
        </div>


        <div class="charges-grid">
          <label>ODC <input type="number" [(ngModel)]="charges.odc" (ngModelChange)="scheduleQuote()"></label>
          <label>Unloading <input type="number" [(ngModel)]="charges.unloading" (ngModelChange)="scheduleQuote()"></label>
          <label>Docket <input type="number" [(ngModel)]="charges.docket" (ngModelChange)="scheduleQuote()"></label>
          <label>Other <input type="number" [(ngModel)]="charges.other" (ngModelChange)="scheduleQuote()"></label>
          <label>CCC <input type="number" [(ngModel)]="charges.ccc" (ngModelChange)="scheduleQuote()"></label>
          <label>
            <div class="discount-label">
              <span>Discount (Consignor)</span>
              <label class="toggle-inline">
                <input type="checkbox" [(ngModel)]="applyConsignorDiscount" (change)="scheduleQuote()">
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
            </div>
            <div class="discount-row">
              <input type="number" [(ngModel)]="charges.consignorDiscount" placeholder="% Discount"
                [disabled]="!applyConsignorDiscount"
                (change)="onConsignorDiscountChange(charges.consignorDiscount)">
            </div>
          </label>
          <label>Initial Paid <input type="number" [(ngModel)]="initialPaid"></label>
          <label>Final Amount <input type="number" [(ngModel)]="finalAmount"></label>
        </div>
      </div>
    </div>
  </div>

  <!-- ACTION BAR -->
  <div class="action-bar">
    <div class="summary">
      <div><span class="eyebrow">Consignment</span><strong>{{ consignmentNumber }}</strong></div>
      <div><span class="eyebrow">Branch</span><strong>{{ branch }}</strong></div>
      <div><span class="eyebrow">Final Amount</span><strong>{{ finalAmount || 0 }}</strong></div>
    </div>
    <div class="action-buttons">
      <button class="ghost" (click)="resetForm()">Reset</button>
      <button class="ghost" (click)="saveShipment()" [disabled]="isSaving || !hasValidProduct()">
        {{ isSaving ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>
</div>

<!-- Final Amount Modal -->
<div class="modal-backdrop" *ngIf="showFinalAmountModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Final Amount is 0</h3>
      <button class="icon-btn" (click)="cancelFinalAmountSave()">x</button>
    </div>
    <p class="muted small-text">Do you want to continue saving?</p>
    <div class="modal-actions">
      <button (click)="cancelFinalAmountSave()">Cancel</button>
      <button (click)="confirmFinalAmountSave()">Continue</button>
    </div>
  </div>
</div>

<!-- Rate Override Modal -->
<div class="modal-backdrop" *ngIf="showRateOverrideModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Override Suggested Rates</h3>
      <button class="icon-btn" (click)="showRateOverrideModal = false">x</button>
    </div>
    <p class="muted small-text">GSTIN ID: {{ getPricingGstinId() }}</p>
    <div class="override-list">
      <div class="override-head">
        <span>Products</span>
        <span>Save as new suggested</span>
      </div>
      <div class="override-item" *ngFor="let item of rateOverrides">
        <div class="override-meta">
          <strong>{{ item.productName }}</strong>
          <span>Suggested: {{ item.suggestedRate === null || item.suggestedRate === undefined ? '-' : item.suggestedRate }}</span>
          <span>Entered: {{ item.enteredRate }}</span>
        </div>
        <div class="override-action">
          <label class="toggle">
            <input type="checkbox" [checked]="item.action === 'suggest'"
              (change)="item.action = $event.target.checked ? 'suggest' : 'override'">
            <span class="toggle-track">
              <span class="toggle-thumb"></span>
            </span>
          </label>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button (click)="confirmRateOverride()">OK</button>
    </div>
  </div>
</div>

<!-- Add Product Modal -->
<div class="modal-backdrop" *ngIf="showProductModal">
  <div class="modal product-modal">
    <div class="modal-head">
      <h3>Add Product</h3>
      <button class="icon-btn" type="button" (click)="closeProductModal()">x</button>
    </div>
    <label>HSN Number* <input [(ngModel)]="newProduct.hsnNum" /></label>
    <label>Product Name* <input [(ngModel)]="newProduct.productName" /></label>
    <h4>Rates by Route</h4>
    <div *ngFor="let rate of newProduct.rates; let i = index" class="inline-fields">
      <input placeholder="Pickup Address Id" [(ngModel)]="rate.pickupLocationId" list="rate-addresses" />
      <input placeholder="Delivery Address Id" [(ngModel)]="rate.deliveryLocationId" list="rate-addresses" />
      <input type="number" placeholder="Rate / Box" [(ngModel)]="rate.rate.ratePerNum" />
      <input type="number" placeholder="Rate / cmA3" [(ngModel)]="rate.rate.ratePerVolume" />
      <input type="number" placeholder="Rate / Kg" [(ngModel)]="rate.rate.ratePerKg" />
      <button class="tiny-btn" type="button" (click)="removeProductRateRow(i)">Remove</button>
    </div>
    <button class="tiny-btn" type="button" (click)="addProductRateRow()">+ Add Rate</button>
    <datalist id="rate-addresses">
      <option *ngFor="let opt of rateAddressOptions" [value]="opt.id" [label]="opt.label"></option>
    </datalist>
    <div class="modal-actions">
      <button (click)="saveNewProduct()">Save</button>
      <button (click)="closeProductModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Add Client Modal -->
<div class="modal-backdrop" *ngIf="showClientModal">
  <div class="modal">
    <div class="modal-head">
      <h3>{{ showClientAddTab ? 'Add Client' : 'Edit Address' }}</h3>
      <button class="icon-btn" (click)="closeModals()">?</button>
    </div>
    <div class="tab-buttons" style="margin-bottom: 12px;" *ngIf="showClientAddTab">
      <button (click)="setClientModalTab('add')" [class.active]="clientModalTab==='add'">New Client</button>
      <button (click)="setClientModalTab('edit')" [class.active]="clientModalTab==='edit'">Edit Client</button>
    </div>

    <div *ngIf="showClientAddTab && clientModalTab==='add'">
      <label>Name* <input [(ngModel)]="newClient.clientName" /></label>
      <label>GSTIN* <input [(ngModel)]="newClient.GSTIN" /></label>
      <label>Phone* <input [(ngModel)]="newClient.phoneNum" /></label>
      <label>Branch* <input [(ngModel)]="newClient.branch" readonly /></label>
      <label>Address* <textarea [(ngModel)]="newClient.address"></textarea></label>
      <div class="grid-3">
        <input placeholder="City" [(ngModel)]="newClient.city" />
        <input placeholder="State" [(ngModel)]="newClient.state" />
        <input placeholder="PIN" [(ngModel)]="newClient.pinCode" />
      </div>

      <h4>Delivery Locations</h4>
      <div *ngFor="let d of newClient.deliveryLocations; let i = index" class="inline-fields">
        <input class="flex-1" placeholder="Delivery Address" [(ngModel)]="d.address" />
        <input placeholder="City" [(ngModel)]="d.city" />
        <input placeholder="State" [(ngModel)]="d.state" />
        <input placeholder="PIN" [(ngModel)]="d.pinCode" />
        <button class="tiny-btn" (click)="removeDeliveryLocation(i)">Remove</button>
      </div>
      <button class="tiny-btn" (click)="addDeliveryLocation()">+ Add Delivery Location</button>

      <div class="error" *ngIf="clientError">{{ clientError }}</div>
      <div class="modal-actions">
        <button (click)="saveNewClient()">Save</button>
        <button (click)="closeModals()">Cancel</button>
      </div>
    </div>

    <div *ngIf="clientModalTab==='edit'">
      <label>Select Client
        <select [(ngModel)]="selectedEditClientId" (change)="onEditClientSelect(selectedEditClientId)">
          <option value="">Select...</option>
          <option *ngFor="let c of editableClientList" [value]="c._id">{{ formatClientOption(c) }}</option>
        </select>
      </label>

      <div *ngIf="editClient?._id">
        <label>Name <input [ngModel]="editClient.clientName" readonly /></label>
        <label>GSTIN <input [ngModel]="editClient.GSTIN" readonly /></label>
        <label>Phone <input [ngModel]="editClient.phoneNum" readonly /></label>
        <label>Branch <input [ngModel]="editClient.branch" readonly /></label>
        <label>Address <textarea [ngModel]="editClient.address" readonly></textarea></label>

        <h4>Delivery Locations</h4>
        <div *ngFor="let d of editClient.deliveryLocations; let i = index" class="inline-fields">
          <input class="flex-1" placeholder="Delivery Address" [(ngModel)]="d.address" />
          <input placeholder="City" [(ngModel)]="d.city" />
          <input placeholder="State" [(ngModel)]="d.state" />
          <input placeholder="PIN" [(ngModel)]="d.pinCode" />
          <button class="tiny-btn" (click)="removeEditDeliveryLocation(i)">Remove</button>
        </div>
        <button class="tiny-btn" (click)="addEditDeliveryLocation()">+ Add Delivery Location</button>
      </div>

      <div class="error" *ngIf="editClientError">{{ editClientError }}</div>
      <div class="modal-actions">
        <button (click)="saveEditedClient()" [disabled]="!selectedEditClientId">Save</button>
        <button (click)="closeModals()">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Guest Modal -->
<div class="modal-backdrop" *ngIf="showGuestModal">
  <div class="modal">
    <div class="modal-head">
      <h3>Add Guest</h3>
      <button class="icon-btn" (click)="closeModals()">バ</button>
    </div>
    <label>Name* <input [(ngModel)]="newGuest.guestName" /></label>
    <label>Phone* <input [(ngModel)]="newGuest.phoneNum" /></label>
    <label>Discount % <input type="number" [(ngModel)]="newGuest.perDis" /></label>
    <label>Address* <textarea [(ngModel)]="newGuest.address"></textarea></label>
    <div class="grid-3">
      <input placeholder="City" [(ngModel)]="newGuest.city" />
      <input placeholder="State" [(ngModel)]="newGuest.state" />
      <input placeholder="PIN" [(ngModel)]="newGuest.pinCode" />
    </div>
    <div class="error" *ngIf="guestError">{{ guestError }}</div>
    <div class="modal-actions">
      <button (click)="saveNewGuest()">Save</button>
      <button (click)="closeModals()">Cancel</button>
    </div>
  </div>
</div>













