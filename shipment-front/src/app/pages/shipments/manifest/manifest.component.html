<div class="manifest-container">
  <h2>ğŸ“¦ Manifest Records</h2>

  <!-- Filters -->
  <div class="filters">
    <input
      type="text"
      [(ngModel)]="searchText"
      placeholder="ğŸ” Search Consignor / Manifest #"
      (input)="applyFilters()"
    />
    <input type="date" [(ngModel)]="filterDate" (change)="applyFilters()" />
    <input
      type="text"
      [(ngModel)]="filterConsignor"
      placeholder="ğŸ·ï¸ Filter by Consignor"
      (input)="applyFilters()"
    />
  </div>

    <!-- Deliver Button -->
  <div class="actions">
    <button class="delivery-btn" (click)="openDeliveryPopup()">ğŸšš Deliver</button>
    <button class="delete-btn" (click)="openCancelPopup()">ğŸ—‘ï¸ Delete</button>
    <button class="print-btn" (click)="printManifest()">ğŸ–¨ï¸ Print Manifest</button>
  </div>

  <!-- Responsive Table Wrapper -->
  <div class="table-wrapper">
    <table class="manifest-table">
      <thead>
        <tr>
          <th style="width: 50px"><input type="checkbox" (change)="toggleAllSelection($event)" /></th>
          <th>Manifest #</th>
          <th>Status #</th>
          <th>Date</th>
          <th>Consignor / Consignment Details</th>
          <th>Branch</th>
        </tr>
      </thead>
 
      <tbody>
        <tr *ngFor="let manifest of filteredManifests">
          <td><input type="checkbox" [(ngModel)]="manifest.selected" /></td>
          <td>{{ manifest.manifestationNumber }}</td>
          <td>{{ manifest.mshipmentStatus }}</td>
          <td>{{ manifest.date | date: 'mediumDate' }}</td>
          <td>
            <div class="manifest-consignments">
              <div *ngFor="let c of manifest.consignments" class="consignment-card">
                <strong>Consignment:</strong> {{ c.consignmentNumber }}<br />
                <strong>Consignor:</strong> {{ c.consignor }}<br />
                <strong>Invoices:</strong>
                <ul>
                  <li *ngFor="let inv of c.invoices">
                    <b>#{{ inv.number }}</b> (â‚¹{{ inv.value }})
                    <ul>
                      <li *ngFor="let p of inv.products">
                        {{ p.type }} â€” Manifested: {{ p.manifestQty }} / Stock: {{ p.instock }}
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </td>
          <td>{{ manifest.branch }}</td>
          <td>
            <!-- âœï¸ Edit Button -->
            <button class="edit-btn" (click)="openEditPopup(manifest)">âœï¸ Edit</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>



  <!-- Edit Popup -->
  <div class="popup" *ngIf="showEditPopup">
    <div class="popup-content">
      <h3>Edit Manifest</h3>
      <label>Manifest #:</label>
      <input type="text" [(ngModel)]="selectedManifest.manifestationNumber" />
      <label>Status:</label>
      <input type="text" [(ngModel)]="selectedManifest.mshipmentStatus" />
      <label>Date:</label>
      <input type="date" [(ngModel)]="selectedManifest.date" />
      <label>Branch:</label>
      <input type="text" [(ngModel)]="selectedManifest.branch" />

      <!-- You can expand with consignments/invoices editing if needed -->
      <div class="popup-actions">
        <button class="confirm-btn" (click)="finalizeEdit()">âœ… Save</button>
        <button class="cancel-btn" (click)="closeEditPopup()">âŒ Cancel</button>
      </div>
    </div>
  </div>


  <!-- Delivery Popup -->
  <div class="popup" *ngIf="showDeliveryPopup">
    <div class="popup-content">
      <h3>Confirm Delivery</h3>
      <p><b>Selected Manifests:</b></p>
      <ul>
        <li *ngFor="let m of selectedForDelivery">{{ m.manifestationNumber }}</li>
      </ul>

      <div class="popup-actions">
        <button class="confirm-btn" (click)="finalizeDelivery()">âœ… Deliver</button>
        <button class="cancel-btn" (click)="closeDeliveryPopup()">âŒ Cancel</button>
      </div>
    </div>
  </div>

  <!-- Cancel Popup -->
<div class="popup" *ngIf="showCancelPopup">
  <div class="popup-content">
    <h3>Confirm Cancellation</h3>
    <p><b>Selected Manifests:</b></p>
    <ul>
      <li *ngFor="let m of selectedForCancel">{{ m.manifestationNumber }}</li>
    </ul>

    <div class="popup-actions">
      <button class="confirm-btn" (click)="finalizeCancel()">âœ… Confirm Cancel</button>
      <button class="cancel-btn" (click)="closeCancelPopup()">âŒ Close</button>
    </div>
  </div>
</div>

</div>
