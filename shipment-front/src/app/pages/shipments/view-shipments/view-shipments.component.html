<div class="shipments-container">
  <h2>View Shipments</h2>

  <!-- dY"? Search and Filters -->
  <div class="filters">
    <input
      type="text"
      placeholder="Search by consignment no. or consignor"
      [(ngModel)]="searchText"
      (input)="applyFilters()" />

    <input
      type="date"
      [(ngModel)]="filterDate"
      (change)="applyFilters()" />

    <select [(ngModel)]="filterStatus" (change)="applyFilters()">
      <option value="">All Status</option>
      <option value="Pending">Pending</option>
      <option value="In Transit">In Transit</option>
      <option value="Delivered">Delivered</option>
    </select>

    <input
      type="text"
      placeholder="Filter by consignor"
      [(ngModel)]="filterConsignor"
      (input)="applyFilters()" />
  </div>

  <!-- dY"Ä° Shipments Table -->
  <table class="shipments-table">
    <thead>
      <tr>
        <th>Consignment No.</th>
        <th>Status</th>
        <th>Consignor</th>
        <th>Delivery Address</th>
        <th>No. of Products</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of filteredShipments" (click)="openShipmentDetails(s)">
        <td>{{ s.consignmentNumber }}</td>
        <td>{{ s.shipmentStatus }}</td>
        <td>{{ s.consignor }}</td>
        <td>{{ s.deliveryAddress }}</td>
        <td>{{ getInvoiceAmountTotal(s.invoices) }}</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- dY"` Shipment Details Modal -->
<div class="modal details-modal" *ngIf="selectedShipment">
  <div class="modal-content details-content">
    <button class="details-close" type="button" (click)="closeShipmentDetails()">&times;</button>
    <div class="details-header">
      <div>
        <h2>Shipment Details</h2>
        <p class="details-sub">Consignment {{ selectedShipment.consignmentNumber }}</p>
      </div>
      <span class="details-status">{{ selectedShipment.shipmentStatus }}</span>
    </div>

    <div class="shipment-details details-grid">
      <p><strong>Consignment No.:</strong> {{ selectedShipment.consignmentNumber }}</p>
      <p><strong>Status:</strong> {{ selectedShipment.shipmentStatus }}</p>
      <p><strong>Consignor:</strong> {{ selectedShipment.consignor }}</p>
      <p><strong>Consignee:</strong> {{ selectedShipment.consignee }}</p>
      <p><strong>Delivery Address:</strong> {{ selectedShipment.deliveryAddress }}</p>
      <p><strong>Date:</strong> {{ selectedShipment.date | date:'short' }}</p>
      <p><strong>Products in stock:</strong> {{ getInStockAmountTotal(selectedShipment.invoices) }}</p>
      <p><strong>No. of Products:</strong> {{ getInvoiceAmountTotal(selectedShipment.invoices) }}</p>
    </div>

    <h3>Products</h3>
    <div class="details-products">
      <div class="details-invoice" *ngFor="let invoice of selectedShipment.invoices">
        <div class="details-invoice-title">Invoice #{{ invoice.number }}</div>
        <ul class="details-product-list">
          <li *ngFor="let product of invoice.products">
            <span class="product-name">{{ product.type }}</span>
            <span class="product-meta">In Stock: {{ product.instock }}</span>
            <span class="product-meta">Total: {{ product.amount }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
