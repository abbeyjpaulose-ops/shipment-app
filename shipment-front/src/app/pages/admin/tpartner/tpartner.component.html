<div class="tpartner-container">
  <h2>Manage Transport Partners</h2>

  <!-- Add Partner Form -->
  <div class="add-partner-form">

    <input [(ngModel)]="newPartner.partnerName" placeholder="Partner Name" required>

    <!-- Vehicle Number + Phone -->
    <div class="vehicle-entry">
      <input [(ngModel)]="newVehicle.number" placeholder="Vehicle Number" required>
      <input [(ngModel)]="newVehicle.phone" placeholder="Phone Number" required>
      <button (click)="addVehicle()">+ Vehicle</button>
    </div>

    <!-- Show Added Vehicles -->
    <div class="vehicle-tag"
      *ngFor="let v of newPartner.vehicleNumbers; let i=index">
      ðŸšš {{ v.number }} | ðŸ“ž {{ v.phone }}
      <span class="delete-tag" (click)="removeVehicle(i)">âœ–</span>
    </div>

    <!-- Rate -->
    <select [(ngModel)]="newPartner.rateType" required>
      <option value="km">Rate / Km</option>
      <option value="day">Rate / Day</option>
    </select>

    <input type="number" [(ngModel)]="newPartner.rateValue" placeholder="Rate Value" required>

    <!-- Email & Username (Auto from login saved in TS) -->
    <input [(ngModel)]="newPartner.email" placeholder="Email" readonly>
    <input [(ngModel)]="newPartner.username" placeholder="User" readonly>

    <button class="btn-add" (click)="addPartner()">+ Add Partner</button>
  </div>


  <!-- Partner Table -->
  <div class="tpartner-table-wrapper">
    <table>
      <tr>
        <th>Partner Name</th>
        <th>Vehicles & Phone</th>
        <th>Rate Type</th>
        <th>Rate Value</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>

      <tr *ngFor="let p of partners">

        <!-- Partner Name -->
        <td>
          <span *ngIf="editing?._id !== p._id">{{ p.partnerName }}</span>
          <div *ngIf="editing?._id === p._id" class="edit-field">
            <input [(ngModel)]="editing.partnerName">
          </div>
        </td>

        <!-- Vehicles -->
        <td>

          <!-- Normal View -->
          <div *ngIf="editing?._id !== p._id">
            <div class="tag" *ngFor="let v of p.vehicleNumbers">
              ðŸšš {{ v.number }} <br> ðŸ“ž {{ v.phone }}
            </div>
          </div>

          <!-- Edit Mode -->
          <div *ngIf="editing?._id === p._id">
            <div class="tag-edit" *ngFor="let v of editing.vehicleNumbers; let i=index">
              <input [(ngModel)]="editing.vehicleNumbers[i].number" placeholder="Veh">
              <input [(ngModel)]="editing.vehicleNumbers[i].phone" placeholder="Phone">
              <button (click)="removeEditingVehicle(i)">-</button>
            </div>

            <!-- Add More Vehicle -->
            <input [(ngModel)]="editVehicleField.number" placeholder="Veh">
            <input [(ngModel)]="editVehicleField.phone" placeholder="Phone">
            <button class="tiny-btn" (click)="addEditingVehicle()">+ Veh</button>
          </div>

        </td>

        <!-- Rate Type -->
        <td>
          <span *ngIf="editing?._id !== p._id">{{ p.rateType }}</span>
          <select *ngIf="editing?._id === p._id" [(ngModel)]="editing.rateType">
            <option value="km">Rate / Km</option>
            <option value="day">Rate / Day</option>
          </select>
        </td>

        <!-- Rate Value -->
        <td>
          <span *ngIf="editing?._id !== p._id">{{ p.rateValue }}</span>
          <input *ngIf="editing?._id === p._id" type="number"
                 [(ngModel)]="editing.rateValue">
        </td>

        <!-- Status -->
        <td>
          <button
            [class.active]="p.status === 'active'"
            [class.inactive]="p.status !== 'active'"
            (click)="toggleStatus(p)">
            {{ p.status === 'active' ? 'Active' : 'Inactive' }}
          </button>
        </td>

        <!-- Actions -->
        <td>
          <button *ngIf="editing?._id !== p._id" (click)="editPartner(p)">Edit</button>
          <button *ngIf="editing?._id === p._id" (click)="saveEdit()">Save</button>
        </td>

      </tr>
    </table>
  </div>
</div>
