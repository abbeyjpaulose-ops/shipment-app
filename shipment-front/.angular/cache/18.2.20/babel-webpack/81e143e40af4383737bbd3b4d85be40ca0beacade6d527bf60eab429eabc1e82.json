{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let ReportsComponent = /*#__PURE__*/(() => {\n  class ReportsComponent {\n    constructor(http) {\n      this.http = http;\n      this.invoices = [];\n      this.filteredInvoices = [];\n      this.fiscalYear = '';\n      this.searchText = '';\n      this.loading = false;\n    }\n    ngOnInit() {\n      this.loadInvoices();\n    }\n    loadInvoices() {\n      this.loading = true;\n      this.http.get('http://localhost:3000/api/newshipments/generatedInvoices', {\n        params: {\n          fiscalYear: this.fiscalYear || ''\n        }\n      }).subscribe({\n        next: res => {\n          this.fiscalYear = res?.fiscalYear || this.fiscalYear;\n          this.invoices = Array.isArray(res?.invoices) ? res.invoices : [];\n          this.applyFilters();\n          this.loading = false;\n        },\n        error: err => {\n          console.error('Error loading generated invoices:', err);\n          this.invoices = [];\n          this.filteredInvoices = [];\n          this.loading = false;\n        }\n      });\n    }\n    applyFilters() {\n      const q = this.searchText.trim().toLowerCase();\n      if (!q) {\n        this.filteredInvoices = [...this.invoices];\n        return;\n      }\n      this.filteredInvoices = this.invoices.filter(inv => {\n        const matchesHeader = String(inv.invoiceNumber || '').toLowerCase().includes(q) || String(inv.clientName || '').toLowerCase().includes(q) || String(inv.clientGSTIN || '').toLowerCase().includes(q) || String(inv.billingAddress || '').toLowerCase().includes(q);\n        if (matchesHeader) return true;\n        return (inv.consignments || []).some(c => String(c.consignmentNumber || '').toLowerCase().includes(q));\n      });\n    }\n    printInvoice(inv) {\n      const consignments = inv?.consignments || [];\n      const total = consignments.reduce((sum, c) => sum + Number(c.finalAmount || 0), 0);\n      const rows = consignments.map((c, idx) => `\n      <tr>\n        <td>${idx + 1}</td>\n        <td>${c.consignmentNumber || ''}</td>\n        <td>${c.consignor || ''}</td>\n        <td>${c.deliveryAddress || ''}</td>\n        <td style=\"text-align:right\">${Number(c.finalAmount || 0).toFixed(2)}</td>\n      </tr>\n    `).join('');\n      const html = `\n      <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #0f172a; }\n            h2 { margin: 0 0 6px; }\n            .meta { margin-bottom: 16px; font-size: 13px; color: #475569; }\n            table { width: 100%; border-collapse: collapse; margin-top: 12px; }\n            th, td { border: 1px solid #cbd5f5; padding: 8px; text-align: left; }\n            th { background: #f8fafc; }\n            .total { margin-top: 12px; font-weight: 700; text-align: right; }\n          </style>\n        </head>\n        <body>\n          <h2>Invoice #${inv.invoiceNumber || ''}</h2>\n          <div class=\"meta\">\n            <div>Client: ${inv.clientName || ''}</div>\n            <div>GSTIN: ${inv.clientGSTIN || ''}</div>\n            <div>Billing Address: ${inv.billingAddress || ''}</div>\n          </div>\n          <table>\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>Consignment</th>\n                <th>Consignor</th>\n                <th>Delivery Address</th>\n                <th style=\"text-align:right\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows || '<tr><td colspan=\"5\">No consignments</td></tr>'}\n            </tbody>\n          </table>\n          <div class=\"total\">Total: ${total.toFixed(2)}</div>\n        </body>\n      </html>\n    `;\n      const win = window.open('', '_blank');\n      if (win) {\n        win.document.open();\n        win.document.write(html);\n        win.document.close();\n        win.print();\n      }\n    }\n    static {\n      this.ɵfac = function ReportsComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ReportsComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReportsComponent,\n        selectors: [[\"app-reports\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 2,\n        vars: 0,\n        template: function ReportsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\");\n            i0.ɵɵtext(1, \"Reports\");\n            i0.ɵɵelementEnd();\n          }\n        },\n        dependencies: [CommonModule, FormsModule],\n        styles: [\"h2[_ngcontent-%COMP%]{color:#1976d2}\"]\n      });\n    }\n  }\n  return ReportsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}