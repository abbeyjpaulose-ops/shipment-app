{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction InvoiceComponent_tr_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"input\", 27);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_tr_25_Template_input_ngModelChange_2_listener($event) {\n      const inv_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      i0.ɵɵtwoWayBindingSet(inv_r2.selected, $event) || (inv_r2.selected = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"td\", 9);\n    i0.ɵɵlistener(\"click\", function InvoiceComponent_tr_25_Template_td_click_3_listener() {\n      const inv_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.openInvoiceDetails(inv_r2));\n    });\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\")(14, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function InvoiceComponent_tr_25_Template_button_click_14_listener() {\n      const inv_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.editInvoice(inv_r2));\n    });\n    i0.ɵɵtext(15, \"\\u270F\\uFE0F Edit\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const inv_r2 = ctx.$implicit;\n    i0.ɵɵclassProp(\"selected\", inv_r2.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", inv_r2.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r2.consignmentNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r2.shipmentStatus);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r2.consignor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r2.deliveryAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((inv_r2.products == null ? null : inv_r2.products.length) || 0);\n  }\n}\nfunction InvoiceComponent_div_29_li_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r5 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", p_r5.productName, \" \\u2014 Qty: \", p_r5.quantity, \" \");\n  }\n}\nfunction InvoiceComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"div\", 30)(2, \"h3\");\n    i0.ɵɵtext(3, \"Consignment Details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\")(5, \"strong\");\n    i0.ɵɵtext(6, \"Consignment Number:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\")(9, \"strong\");\n    i0.ɵɵtext(10, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"p\")(13, \"strong\");\n    i0.ɵɵtext(14, \"Delivery Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"p\")(17, \"strong\");\n    i0.ɵɵtext(18, \"Status:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"h4\");\n    i0.ɵɵtext(21, \"Products:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"ul\");\n    i0.ɵɵtemplate(23, InvoiceComponent_div_29_li_23_Template, 2, 2, \"li\", 31);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"button\", 9);\n    i0.ɵɵlistener(\"click\", function InvoiceComponent_div_29_Template_button_click_24_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.closeInvoiceDetails());\n    });\n    i0.ɵɵtext(25, \"Close\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedInvoice == null ? null : ctx_r2.selectedInvoice.consignmentNumber, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedInvoice == null ? null : ctx_r2.selectedInvoice.consignor, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedInvoice == null ? null : ctx_r2.selectedInvoice.deliveryAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedInvoice == null ? null : ctx_r2.selectedInvoice.shipmentStatus, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.selectedInvoice == null ? null : ctx_r2.selectedInvoice.products);\n  }\n}\nexport let InvoiceComponent = /*#__PURE__*/(() => {\n  class InvoiceComponent {\n    constructor(http) {\n      this.http = http;\n      this.invoices = [];\n      this.filteredInvoices = [];\n      this.searchText = '';\n      this.filterDate = '';\n      this.filterConsignor = '';\n      this.selectedInvoice = null;\n      this.showInvoiceModal = false;\n      this.editingInvoice = null; // ✅ Track the invoice being edited\n      this.showEditPopup = false; // ✅ Control popup visibility\n    }\n    ngOnInit() {\n      this.loadInvoices();\n    }\n    loadInvoices() {\n      this.http.get('http://localhost:3000/api/newshipments', {\n        params: {\n          email: localStorage.getItem('email') || '',\n          branch: localStorage.getItem('branch') || ''\n        }\n      }).subscribe({\n        next: res => {\n          // ✅ Only show shipments with status 'Delivered'\n          this.invoices = res.filter(s => s.shipmentStatus === 'Delivered');\n          this.filteredInvoices = [...this.invoices];\n        },\n        error: err => console.error('❌ Error loading invoices:', err)\n      });\n    }\n    applyFilters() {\n      this.filteredInvoices = this.invoices.filter(s => (this.searchText ? s.consignmentNumber?.includes(this.searchText) || s.consignor?.includes(this.searchText) : true) && (this.filterDate ? new Date(s.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true));\n    }\n    toggleAllSelection(event) {\n      const checked = event.target.checked;\n      this.filteredInvoices.forEach(i => i.selected = checked);\n    }\n    openInvoiceDetails(invoice) {\n      this.selectedInvoice = invoice;\n      this.showInvoiceModal = true;\n    }\n    closeInvoiceDetails() {\n      this.showInvoiceModal = false;\n      this.selectedInvoice = null;\n    }\n    // ✅ Function to mark selected Delivered consignments as Invoiced\n    invoiceSelected() {\n      const selectedConsignments = this.filteredInvoices.filter(i => i.selected);\n      if (selectedConsignments.length === 0) {\n        console.warn('⚠️ No consignments selected for invoicing.');\n        return;\n      }\n      selectedConsignments.forEach(consignment => {\n        const updatedConsignment = {\n          ...consignment,\n          shipmentStatus: 'Invoiced'\n        };\n        this.http.put(`http://localhost:3000/api/newshipments/${consignment.consignmentNumber}`, updatedConsignment).subscribe({\n          next: () => {\n            console.log(`✅ Consignment ${consignment.consignmentNumber} updated to Invoiced`);\n            this.loadInvoices(); // Refresh data\n          },\n          error: err => {\n            console.error(`❌ Error updating consignment ${consignment.consignmentNumber}:`, err);\n          }\n        });\n      });\n      // Clear selection\n      this.filteredInvoices.forEach(i => i.selected = false);\n    }\n    // ✅ Edit function (opens popup)\n    editInvoice(invoice) {\n      console.log('✏️ Edit invoice:', invoice);\n      this.editingInvoice = {\n        ...invoice\n      }; // Copy invoice data into editing object\n      this.showEditPopup = true; // Show popup\n    }\n    // ✅ Save changes from popup\n    saveInvoiceEdit() {\n      if (!this.editingInvoice) return;\n      this.http.put(`http://localhost:3000/api/newshipments/${this.editingInvoice.consignmentNumber}`, this.editingInvoice).subscribe({\n        next: () => {\n          console.log('✅ Invoice updated successfully');\n          this.loadInvoices();\n          this.editingInvoice = null;\n          this.showEditPopup = false; // Close popup\n        },\n        error: err => console.error('❌ Error updating invoice:', err)\n      });\n    }\n    // ✅ Cancel edit and close popup\n    cancelEdit() {\n      this.editingInvoice = null;\n      this.showEditPopup = false;\n    }\n    static {\n      this.ɵfac = function InvoiceComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || InvoiceComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: InvoiceComponent,\n        selectors: [[\"app-invoice\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 60,\n        vars: 8,\n        consts: [[1, \"invoice-container\"], [1, \"filters\"], [\"type\", \"text\", \"placeholder\", \"Search by Consignment / Consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [\"type\", \"date\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"type\", \"text\", \"placeholder\", \"Filter by Consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [1, \"invoice-table\"], [\"type\", \"checkbox\", 3, \"change\"], [3, \"selected\", 4, \"ngFor\", \"ngForOf\"], [1, \"action-bar\"], [3, \"click\"], [\"class\", \"modal\", 4, \"ngIf\"], [\"id\", \"editPopup\", 1, \"popup-overlay\", 2, \"display\", \"none\"], [1, \"popup-content\"], [\"id\", \"editForm\"], [1, \"form-row\"], [\"for\", \"name\"], [\"type\", \"text\", \"id\", \"name\", \"name\", \"name\", 3, \"ngModelChange\", \"ngModel\"], [\"for\", \"address\"], [\"id\", \"address\", \"name\", \"address\", 3, \"ngModelChange\", \"ngModel\"], [\"for\", \"status\"], [\"id\", \"status\", \"name\", \"status\", 3, \"ngModelChange\", \"ngModel\"], [\"value\", \"Pending\"], [\"value\", \"In Transit\"], [\"value\", \"Delivered\"], [\"value\", \"Invoiced\"], [1, \"button-section\"], [\"type\", \"button\", 3, \"click\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"ngModel\"], [1, \"edit-btn\", 3, \"click\"], [1, \"modal\"], [1, \"modal-content\"], [4, \"ngFor\", \"ngForOf\"]],\n        template: function InvoiceComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n            i0.ɵɵtext(2, \"\\uD83D\\uDCE6 Invoice Management\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"div\", 1)(4, \"input\", 2);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_input_ngModelChange_4_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.searchText, $event) || (ctx.searchText = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function InvoiceComponent_Template_input_input_4_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"input\", 3);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_input_ngModelChange_5_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterDate, $event) || (ctx.filterDate = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function InvoiceComponent_Template_input_change_5_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_input_ngModelChange_6_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterConsignor, $event) || (ctx.filterConsignor = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function InvoiceComponent_Template_input_input_6_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"table\", 5)(8, \"thead\")(9, \"tr\")(10, \"th\")(11, \"input\", 6);\n            i0.ɵɵlistener(\"change\", function InvoiceComponent_Template_input_change_11_listener($event) {\n              return ctx.toggleAllSelection($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"th\");\n            i0.ɵɵtext(13, \"Consignment No.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(14, \"th\");\n            i0.ɵɵtext(15, \"Status\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"th\");\n            i0.ɵɵtext(17, \"Consignor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"th\");\n            i0.ɵɵtext(19, \"Delivery Address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"th\");\n            i0.ɵɵtext(21, \"No. of Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"th\");\n            i0.ɵɵtext(23, \"Actions\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(24, \"tbody\");\n            i0.ɵɵtemplate(25, InvoiceComponent_tr_25_Template, 16, 8, \"tr\", 7);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(26, \"div\", 8)(27, \"button\", 9);\n            i0.ɵɵlistener(\"click\", function InvoiceComponent_Template_button_click_27_listener() {\n              return ctx.invoiceSelected();\n            });\n            i0.ɵɵtext(28, \"\\uD83E\\uDDFE Generate Invoice\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(29, InvoiceComponent_div_29_Template, 26, 5, \"div\", 10);\n            i0.ɵɵelementStart(30, \"div\", 11)(31, \"div\", 12)(32, \"h2\");\n            i0.ɵɵtext(33, \"Edit Details\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(34, \"form\", 13)(35, \"div\", 14)(36, \"label\", 15);\n            i0.ɵɵtext(37, \"Name:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(38, \"input\", 16);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_input_ngModelChange_38_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.editingItem.name, $event) || (ctx.editingItem.name = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(39, \"div\", 14)(40, \"label\", 17);\n            i0.ɵɵtext(41, \"Address:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(42, \"textarea\", 18);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_textarea_ngModelChange_42_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.editingItem.address, $event) || (ctx.editingItem.address = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(43, \"div\", 14)(44, \"label\", 19);\n            i0.ɵɵtext(45, \"Status:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(46, \"select\", 20);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function InvoiceComponent_Template_select_ngModelChange_46_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.editingItem.status, $event) || (ctx.editingItem.status = $event);\n              return $event;\n            });\n            i0.ɵɵelementStart(47, \"option\", 21);\n            i0.ɵɵtext(48, \"Pending\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(49, \"option\", 22);\n            i0.ɵɵtext(50, \"In Transit\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(51, \"option\", 23);\n            i0.ɵɵtext(52, \"Delivered\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(53, \"option\", 24);\n            i0.ɵɵtext(54, \"Invoiced\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(55, \"div\", 25)(56, \"button\", 26);\n            i0.ɵɵlistener(\"click\", function InvoiceComponent_Template_button_click_56_listener() {\n              return ctx.saveEdit();\n            });\n            i0.ɵɵtext(57, \"Save\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(58, \"button\", 26);\n            i0.ɵɵlistener(\"click\", function InvoiceComponent_Template_button_click_58_listener() {\n              return ctx.closePopup();\n            });\n            i0.ɵɵtext(59, \"Cancel\");\n            i0.ɵɵelementEnd()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchText);\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterDate);\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterConsignor);\n            i0.ɵɵadvance(19);\n            i0.ɵɵproperty(\"ngForOf\", ctx.filteredInvoices);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", ctx.showInvoiceModal);\n            i0.ɵɵadvance(9);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.editingItem.name);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.editingItem.address);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.editingItem.status);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.ɵNgNoValidate, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.CheckboxControlValueAccessor, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.NgModel, i3.NgForm],\n        styles: [\".edit-btn[_ngcontent-%COMP%]{background:#ff9800;color:#fff;border:none;padding:4px 8px;border-radius:4px;cursor:pointer}.edit-btn[_ngcontent-%COMP%]:hover{background:#e68900}.modal-actions[_ngcontent-%COMP%]{margin-top:10px;display:flex;justify-content:space-between}.popup-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.popup-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:6px;width:400px;max-width:90%}.form-row[_ngcontent-%COMP%]{margin-bottom:12px}.form-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:4px;font-weight:700}.form-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-row[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:6px;box-sizing:border-box}.button-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px}\"]\n      });\n    }\n  }\n  return InvoiceComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}