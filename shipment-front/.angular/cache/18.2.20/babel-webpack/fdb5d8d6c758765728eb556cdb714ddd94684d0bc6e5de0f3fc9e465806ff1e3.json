{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet ManifestComponent = class ManifestComponent {\n  constructor(http) {\n    this.http = http;\n    this.manifests = [];\n    this.filteredManifests = [];\n    this.searchText = '';\n    this.filterDate = '';\n    this.filterConsignor = '';\n    this.selectedManifest = null;\n    this.showDeliveryPopup = false;\n    this.selectedForDelivery = [];\n    this.email = '';\n    this.username = '';\n    this.branch = localStorage.getItem('branch') || 'All Branches';\n  }\n  ngOnInit() {\n    this.email = localStorage.getItem('email') || '';\n    this.username = localStorage.getItem('username') || '';\n    this.branch = localStorage.getItem('branch') || 'All Branches';\n    this.loadManifests();\n  }\n  // âœ… Load all manifests from backend\n  loadManifests() {\n    this.http.get(`http://localhost:3000/api/manifest?email=${this.email}`).subscribe({\n      next: res => {\n        this.manifests = res;\n        this.filteredManifests = [...this.manifests];\n        console.log('ðŸ“¦ Loaded manifests:', res);\n      },\n      error: err => console.error('âŒ Error loading manifests:', err)\n    });\n  }\n  applyFilters() {\n    this.filteredManifests = this.manifests.filter(m => (this.searchText ? m.manifestationNumber?.includes(this.searchText) || m.consignments?.some(c => c.consignor?.includes(this.searchText)) : true) && (this.filterDate ? new Date(m.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? m.consignments?.some(c => c.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase())) : true));\n  }\n  toggleAllSelection(event) {\n    const checked = event.target.checked;\n    this.filteredManifests.forEach(m => m.selected = checked);\n  }\n  // âœ… Open delivery popup\n  openDeliveryPopup() {\n    this.selectedForDelivery = this.filteredManifests.filter(m => m.selected);\n    if (this.selectedForDelivery.length === 0) {\n      alert('âš ï¸ Please select at least one manifest to deliver.');\n      return;\n    }\n    this.showDeliveryPopup = true;\n  }\n  closeDeliveryPopup() {\n    this.showDeliveryPopup = false;\n  }\n  // âœ… Finalize delivery and update statuses in both DBs\n  finalizeDelivery() {\n    if (this.selectedForDelivery.length === 0) {\n      alert('No manifests selected for delivery.');\n      return;\n    }\n    this.selectedForDelivery.forEach(manifest => {\n      manifest.consignments.forEach(cons => {\n        cons.invoices.forEach(inv => {\n          inv.products.forEach(p => {\n            // update stock â€” if any product left undelivered\n            if (p.instock > 0) {\n              p.instock = 0;\n            }\n          });\n        });\n        // Update consignment in newshipments DB\n        const updatedStatus = 'Delivered';\n        const updatedStock = {\n          ...cons,\n          shipmentStatus: updatedStatus\n        };\n        this.http.put(`http://localhost:3000/api/newshipments/${cons.consignmentNumber}`, updatedStock).subscribe({\n          next: () => {\n            console.log(`âœ… Consignment ${cons.consignmentNumber} marked as Delivered`);\n          },\n          error: err => {\n            console.error(`âŒ Error updating consignment ${cons.consignmentNumber}:`, err);\n          }\n        });\n      });\n    });\n    this.showDeliveryPopup = false;\n    alert('âœ… Delivery completed successfully!');\n    this.filteredManifests.forEach(m => m.selected = false);\n    this.loadManifests();\n  }\n};\nManifestComponent = __decorate([Component({\n  selector: 'app-manifest',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './manifest.component.html',\n  styleUrls: ['./manifest.component.css']\n})], ManifestComponent);\nexport { ManifestComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}