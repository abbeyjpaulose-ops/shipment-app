{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet ViewShipmentsComponent = class ViewShipmentsComponent {\n  constructor(http) {\n    this.http = http;\n    this.shipments = [];\n    this.filteredShipments = [];\n    this.searchText = '';\n    this.filterDate = '';\n    this.filterStatus = '';\n    this.filterConsignor = '';\n    this.selectedShipment = null; // âœ… for modal popup\n  }\n  ngOnInit() {\n    this.loadShipments();\n  }\n  loadShipments() {\n    this.http.get('http://localhost:3000/api/newshipments', {\n      params: {\n        username: localStorage.getItem('username') || '',\n        branch: localStorage.getItem('branch') || 'All Branches'\n      }\n    }).subscribe({\n      next: res => {\n        const normalized = (res || []).map(shipment => ({\n          ...shipment,\n          invoices: this.flattenInvoices(shipment.ewaybills || shipment.invoices || [])\n        }));\n        this.shipments = normalized;\n        this.filteredShipments = normalized;\n      },\n      error: err => console.error('Error loading shipments:', err)\n    });\n  }\n  flattenInvoices(ewaybills) {\n    return (ewaybills || []).flatMap(ewb => ewb.invoices || []);\n  }\n  getProductTotal(invoices, key) {\n    if (!invoices) return 0;\n    return invoices.reduce((total, invoice) => {\n      const productSum = invoice.products?.reduce((sum, prod) => sum + Number(prod[key] || 0), 0) || 0;\n      return total + Number(productSum || 0);\n    }, 0);\n  }\n  getInStockAmountTotal(invoices) {\n    return this.getProductTotal(invoices, 'instock');\n  }\n  getInvoiceAmountTotal(invoices) {\n    return this.getInStockAmountTotal(invoices) + this.getProductTotal(invoices, 'intransitstock') + this.getProductTotal(invoices, 'deliveredstock');\n  }\n  applyFilters() {\n    this.filteredShipments = this.shipments.filter(s => {\n      const matchesSearch = this.searchText ? s.consignmentNumber?.toLowerCase().includes(this.searchText.toLowerCase()) || s.consignor?.toLowerCase().includes(this.searchText.toLowerCase()) : true;\n      const matchesDate = this.filterDate ? new Date(s.date).toDateString() === new Date(this.filterDate).toDateString() : true;\n      const matchesStatus = this.filterStatus ? s.shipmentStatus === this.filterStatus : true;\n      const matchesConsignor = this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true;\n      return matchesSearch && matchesDate && matchesStatus && matchesConsignor;\n    });\n  }\n  // âœ… open details modal\n  openShipmentDetails(shipment) {\n    this.selectedShipment = shipment;\n  }\n  // âœ… close details modal\n  closeShipmentDetails() {\n    this.selectedShipment = null;\n  }\n};\nViewShipmentsComponent = __decorate([Component({\n  selector: 'app-view-shipments',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './view-shipments.component.html',\n  styleUrls: ['./view-shipments.component.css']\n})], ViewShipmentsComponent);\nexport { ViewShipmentsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}