{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ReportsComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtext(1, \"Loading invoices...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ReportsComponent_div_12_tr_17_span_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r2 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r2.consignmentNumber);\n  }\n}\nfunction ReportsComponent_div_12_tr_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\", 12);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\")(10, \"div\", 13);\n    i0.ɵɵtemplate(11, ReportsComponent_div_12_tr_17_span_11_Template, 2, 1, \"span\", 10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"td\")(13, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ReportsComponent_div_12_tr_17_Template_button_click_13_listener() {\n      const inv_r3 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.printInvoice(inv_r3));\n    });\n    i0.ɵɵtext(14, \"Print\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const inv_r3 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r3.invoiceNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r3.clientName || \"-\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r3.clientGSTIN || \"-\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(inv_r3.billingAddress || \"-\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", inv_r3.consignments);\n  }\n}\nfunction ReportsComponent_div_12_tr_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 15);\n    i0.ɵɵtext(2, \"No generated invoices found.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ReportsComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"table\")(2, \"thead\")(3, \"tr\")(4, \"th\");\n    i0.ɵɵtext(5, \"Invoice #\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"th\");\n    i0.ɵɵtext(7, \"Client\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"th\");\n    i0.ɵɵtext(9, \"GSTIN\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"th\");\n    i0.ɵɵtext(11, \"Billing Address\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"th\");\n    i0.ɵɵtext(13, \"Consignments\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"th\");\n    i0.ɵɵtext(15, \"Actions\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(16, \"tbody\");\n    i0.ɵɵtemplate(17, ReportsComponent_div_12_tr_17_Template, 15, 5, \"tr\", 10)(18, ReportsComponent_div_12_tr_18_Template, 3, 0, \"tr\", 11);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(17);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.filteredInvoices);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r3.filteredInvoices.length);\n  }\n}\nexport let ReportsComponent = /*#__PURE__*/(() => {\n  class ReportsComponent {\n    constructor(http) {\n      this.http = http;\n      this.invoices = [];\n      this.filteredInvoices = [];\n      this.fiscalYear = '';\n      this.searchText = '';\n      this.loading = false;\n    }\n    ngOnInit() {\n      this.loadInvoices();\n    }\n    loadInvoices() {\n      this.loading = true;\n      this.http.get('http://localhost:3000/api/newshipments/generatedInvoices', {\n        params: {\n          fiscalYear: this.fiscalYear || ''\n        }\n      }).subscribe({\n        next: res => {\n          this.fiscalYear = res?.fiscalYear || this.fiscalYear;\n          this.invoices = Array.isArray(res?.invoices) ? res.invoices : [];\n          this.applyFilters();\n          this.loading = false;\n        },\n        error: err => {\n          console.error('Error loading generated invoices:', err);\n          this.invoices = [];\n          this.filteredInvoices = [];\n          this.loading = false;\n        }\n      });\n    }\n    applyFilters() {\n      const q = this.searchText.trim().toLowerCase();\n      if (!q) {\n        this.filteredInvoices = [...this.invoices];\n        return;\n      }\n      this.filteredInvoices = this.invoices.filter(inv => {\n        const matchesHeader = String(inv.invoiceNumber || '').toLowerCase().includes(q) || String(inv.clientName || '').toLowerCase().includes(q) || String(inv.clientGSTIN || '').toLowerCase().includes(q) || String(inv.billingAddress || '').toLowerCase().includes(q);\n        if (matchesHeader) return true;\n        return (inv.consignments || []).some(c => String(c.consignmentNumber || '').toLowerCase().includes(q));\n      });\n    }\n    printInvoice(inv) {\n      const consignments = inv?.consignments || [];\n      const total = consignments.reduce((sum, c) => sum + Number(c.finalAmount || 0), 0);\n      const rows = consignments.map((c, idx) => `\n      <tr>\n        <td>${idx + 1}</td>\n        <td>${c.consignmentNumber || ''}</td>\n        <td>${c.consignor || ''}</td>\n        <td>${c.deliveryAddress || ''}</td>\n        <td style=\"text-align:right\">${Number(c.finalAmount || 0).toFixed(2)}</td>\n      </tr>\n    `).join('');\n      const html = `\n      <html>\n        <head>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; color: #0f172a; }\n            h2 { margin: 0 0 6px; }\n            .meta { margin-bottom: 16px; font-size: 13px; color: #475569; }\n            table { width: 100%; border-collapse: collapse; margin-top: 12px; }\n            th, td { border: 1px solid #cbd5f5; padding: 8px; text-align: left; }\n            th { background: #f8fafc; }\n            .total { margin-top: 12px; font-weight: 700; text-align: right; }\n          </style>\n        </head>\n        <body>\n          <h2>Invoice #${inv.invoiceNumber || ''}</h2>\n          <div class=\"meta\">\n            <div>Client: ${inv.clientName || ''}</div>\n            <div>GSTIN: ${inv.clientGSTIN || ''}</div>\n            <div>Billing Address: ${inv.billingAddress || ''}</div>\n          </div>\n          <table>\n            <thead>\n              <tr>\n                <th>#</th>\n                <th>Consignment</th>\n                <th>Consignor</th>\n                <th>Delivery Address</th>\n                <th style=\"text-align:right\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows || '<tr><td colspan=\"5\">No consignments</td></tr>'}\n            </tbody>\n          </table>\n          <div class=\"total\">Total: ${total.toFixed(2)}</div>\n        </body>\n      </html>\n    `;\n      const win = window.open('', '_blank');\n      if (win) {\n        win.document.open();\n        win.document.write(html);\n        win.document.close();\n        win.print();\n      }\n    }\n    static {\n      this.ɵfac = function ReportsComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ReportsComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ReportsComponent,\n        selectors: [[\"app-reports\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 13,\n        vars: 4,\n        consts: [[1, \"reports-page\"], [1, \"header\"], [1, \"subtitle\"], [1, \"controls\"], [\"type\", \"text\", \"placeholder\", \"Search by invoice, client, GSTIN, or consignment\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [\"type\", \"button\", 3, \"click\"], [\"class\", \"status\", 4, \"ngIf\"], [\"class\", \"table-wrap\", 4, \"ngIf\"], [1, \"status\"], [1, \"table-wrap\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"address-cell\"], [1, \"consignment-list\"], [\"type\", \"button\", 1, \"print-btn\", 3, \"click\"], [\"colspan\", \"6\", 1, \"empty\"]],\n        template: function ReportsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\")(3, \"h2\");\n            i0.ɵɵtext(4, \"Generated Invoices\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"p\", 2);\n            i0.ɵɵtext(6);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"div\", 3)(8, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ReportsComponent_Template_input_ngModelChange_8_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.searchText, $event) || (ctx.searchText = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function ReportsComponent_Template_input_input_8_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function ReportsComponent_Template_button_click_9_listener() {\n              return ctx.loadInvoices();\n            });\n            i0.ɵɵtext(10, \"Refresh\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(11, ReportsComponent_div_11_Template, 2, 0, \"div\", 6)(12, ReportsComponent_div_12_Template, 19, 2, \"div\", 7);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate1(\"Fiscal Year: \", ctx.fiscalYear || \"Current\", \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchText);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\".reports-page[_ngcontent-%COMP%]{padding:20px;color:#0f172a}.header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}.subtitle[_ngcontent-%COMP%]{margin:6px 0 0;color:#64748b;font-size:13px}.controls[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;align-items:center}.controls[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #cbd5f5;border-radius:10px;min-width:280px}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid #cbd5f5;background:#fff;cursor:pointer}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:#2563eb;color:#1e3a8a}.status[_ngcontent-%COMP%]{padding:12px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px}.table-wrap[_ngcontent-%COMP%]{overflow:auto;background:#fff;border:1px solid #e2e8f0;border-radius:12px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border-bottom:1px solid #e2e8f0;padding:10px 12px;text-align:left;vertical-align:top}th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600}.address-cell[_ngcontent-%COMP%]{min-width:220px}.consignment-list[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}.consignment-list[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:#eef2ff;color:#3730a3;padding:2px 8px;border-radius:999px;font-size:12px}.print-btn[_ngcontent-%COMP%]{padding:6px 12px;border-radius:8px;border:1px solid #2563eb;background:#2563eb;color:#fff;cursor:pointer}.print-btn[_ngcontent-%COMP%]:hover{background:#1e3a8a;border-color:#1e3a8a}.empty[_ngcontent-%COMP%]{text-align:center;color:#64748b;padding:18px}@media (max-width: 700px){.controls[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{min-width:100%}}\"]\n      });\n    }\n  }\n  return ReportsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}