{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ManifestComponent_tr_21_li_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"li\")(1, \"b\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(3);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const c_r3 = ctx.$implicit;\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(c_r3.consignmentNumber);\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate1(\" \\u2013 \", c_r3.consignor, \" \");\n  }\n}\nfunction ManifestComponent_tr_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\")(2, \"input\", 10);\n    i0.ÉµÉµtwoWayListener(\"ngModelChange\", function ManifestComponent_tr_21_Template_input_ngModelChange_2_listener($event) {\n      const manifest_r2 = i0.ÉµÉµrestoreView(_r1).$implicit;\n      i0.ÉµÉµtwoWayBindingSet(manifest_r2.selected, $event) || (manifest_r2.selected = $event);\n      return i0.ÉµÉµresetView($event);\n    });\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(3, \"td\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"td\");\n    i0.ÉµÉµtext(6);\n    i0.ÉµÉµpipe(7, \"date\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(8, \"td\")(9, \"ul\");\n    i0.ÉµÉµtemplate(10, ManifestComponent_tr_21_li_10_Template, 4, 2, \"li\", 7);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(11, \"td\");\n    i0.ÉµÉµtext(12);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const manifest_r2 = ctx.$implicit;\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtwoWayProperty(\"ngModel\", manifest_r2.selected);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(manifest_r2.manifestationNumber);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(i0.ÉµÉµpipeBind1(7, 5, manifest_r2.date));\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµproperty(\"ngForOf\", manifest_r2.consignments);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(manifest_r2.branch);\n  }\n}\nfunction ManifestComponent_div_24_li_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"li\");\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const m_r5 = ctx.$implicit;\n    i0.ÉµÉµadvance();\n    i0.ÉµÉµtextInterpolate(m_r5.manifestationNumber);\n  }\n}\nfunction ManifestComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\", 11)(1, \"div\", 12)(2, \"h3\");\n    i0.ÉµÉµtext(3, \"Confirm Delivery\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(4, \"p\")(5, \"b\");\n    i0.ÉµÉµtext(6, \"Selected Manifests:\");\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(7, \"ul\");\n    i0.ÉµÉµtemplate(8, ManifestComponent_div_24_li_8_Template, 2, 1, \"li\", 7);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(9, \"div\", 13)(10, \"button\", 14);\n    i0.ÉµÉµlistener(\"click\", function ManifestComponent_div_24_Template_button_click_10_listener() {\n      i0.ÉµÉµrestoreView(_r4);\n      const ctx_r5 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r5.finalizeDelivery());\n    });\n    i0.ÉµÉµtext(11, \"\\u2705 Deliver\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(12, \"button\", 14);\n    i0.ÉµÉµlistener(\"click\", function ManifestComponent_div_24_Template_button_click_12_listener() {\n      i0.ÉµÉµrestoreView(_r4);\n      const ctx_r5 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r5.closeDeliveryPopup());\n    });\n    i0.ÉµÉµtext(13, \"\\u274C Cancel\");\n    i0.ÉµÉµelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(8);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r5.selectedForDelivery);\n  }\n}\nexport let ManifestComponent = /*#__PURE__*/(() => {\n  class ManifestComponent {\n    constructor(http) {\n      this.http = http;\n      this.manifests = [];\n      this.filteredManifests = [];\n      this.searchText = '';\n      this.filterDate = '';\n      this.filterConsignor = '';\n      this.selectedManifest = null;\n      this.showDeliveryPopup = false;\n      this.selectedForDelivery = [];\n      this.email = '';\n      this.username = '';\n      this.branch = localStorage.getItem('branch') || 'All Branches';\n    }\n    ngOnInit() {\n      this.email = localStorage.getItem('email') || '';\n      this.username = localStorage.getItem('username') || '';\n      this.branch = localStorage.getItem('branch') || 'All Branches';\n      this.loadManifests();\n    }\n    // âœ… Load all manifests from backend\n    loadManifests() {\n      this.http.get(`http://localhost:3000/api/manifest?email=${this.email}`).subscribe({\n        next: res => {\n          this.manifests = res;\n          this.filteredManifests = [...this.manifests];\n          console.log('ðŸ“¦ Loaded manifests:', res);\n        },\n        error: err => console.error('âŒ Error loading manifests:', err)\n      });\n    }\n    applyFilters() {\n      this.filteredManifests = this.manifests.filter(m => (this.searchText ? m.manifestationNumber?.includes(this.searchText) || m.consignments?.some(c => c.consignor?.includes(this.searchText)) : true) && (this.filterDate ? new Date(m.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? m.consignments?.some(c => c.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase())) : true));\n    }\n    toggleAllSelection(event) {\n      const checked = event.target.checked;\n      this.filteredManifests.forEach(m => m.selected = checked);\n    }\n    // âœ… Open delivery popup\n    openDeliveryPopup() {\n      this.selectedForDelivery = this.filteredManifests.filter(m => m.selected);\n      if (this.selectedForDelivery.length === 0) {\n        alert('âš ï¸ Please select at least one manifest to deliver.');\n        return;\n      }\n      this.showDeliveryPopup = true;\n    }\n    closeDeliveryPopup() {\n      this.showDeliveryPopup = false;\n    }\n    // âœ… Finalize delivery and update statuses in both DBs\n    finalizeDelivery() {\n      if (this.selectedForDelivery.length === 0) {\n        alert('No manifests selected for delivery.');\n        return;\n      }\n      this.selectedForDelivery.forEach(manifest => {\n        manifest.consignments.forEach(cons => {\n          cons.invoices.forEach(inv => {\n            inv.products.forEach(p => {\n              // update stock â€” if any product left undelivered\n              if (p.instock > 0) {\n                p.instock = 0;\n              }\n            });\n          });\n          // Update consignment in newshipments DB\n          const updatedStatus = 'Delivered';\n          const updatedStock = {\n            ...cons,\n            shipmentStatus: updatedStatus\n          };\n          this.http.put(`http://localhost:3000/api/newshipments/${cons.consignmentNumber}`, updatedStock).subscribe({\n            next: () => {\n              console.log(`âœ… Consignment ${cons.consignmentNumber} marked as Delivered`);\n            },\n            error: err => {\n              console.error(`âŒ Error updating consignment ${cons.consignmentNumber}:`, err);\n            }\n          });\n        });\n      });\n      this.showDeliveryPopup = false;\n      alert('âœ… Delivery completed successfully!');\n      this.filteredManifests.forEach(m => m.selected = false);\n      this.loadManifests();\n    }\n    static {\n      this.Éµfac = function ManifestComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ManifestComponent)(i0.ÉµÉµdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n        type: ManifestComponent,\n        selectors: [[\"app-manifest\"]],\n        standalone: true,\n        features: [i0.ÉµÉµStandaloneFeature],\n        decls: 25,\n        vars: 5,\n        consts: [[1, \"manifest-container\"], [1, \"filters\"], [\"type\", \"text\", \"placeholder\", \"Search Consignor / Manifest #\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [\"type\", \"date\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"type\", \"text\", \"placeholder\", \"Filter by Consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [1, \"manifest-table\"], [\"type\", \"checkbox\", 3, \"change\"], [4, \"ngFor\", \"ngForOf\"], [1, \"delivery-btn\", 3, \"click\"], [\"class\", \"popup\", 4, \"ngIf\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"ngModel\"], [1, \"popup\"], [1, \"popup-content\"], [1, \"popup-actions\"], [3, \"click\"]],\n        template: function ManifestComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"h2\");\n            i0.ÉµÉµtext(2, \"\\uD83D\\uDCE6 Manifest Records\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(3, \"div\", 1)(4, \"input\", 2);\n            i0.ÉµÉµtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_4_listener($event) {\n              i0.ÉµÉµtwoWayBindingSet(ctx.searchText, $event) || (ctx.searchText = $event);\n              return $event;\n            });\n            i0.ÉµÉµlistener(\"input\", function ManifestComponent_Template_input_input_4_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(5, \"input\", 3);\n            i0.ÉµÉµtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_5_listener($event) {\n              i0.ÉµÉµtwoWayBindingSet(ctx.filterDate, $event) || (ctx.filterDate = $event);\n              return $event;\n            });\n            i0.ÉµÉµlistener(\"change\", function ManifestComponent_Template_input_change_5_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(6, \"input\", 4);\n            i0.ÉµÉµtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_6_listener($event) {\n              i0.ÉµÉµtwoWayBindingSet(ctx.filterConsignor, $event) || (ctx.filterConsignor = $event);\n              return $event;\n            });\n            i0.ÉµÉµlistener(\"input\", function ManifestComponent_Template_input_input_6_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ÉµÉµelementEnd()();\n            i0.ÉµÉµelementStart(7, \"table\", 5)(8, \"thead\")(9, \"tr\")(10, \"th\")(11, \"input\", 6);\n            i0.ÉµÉµlistener(\"change\", function ManifestComponent_Template_input_change_11_listener($event) {\n              return ctx.toggleAllSelection($event);\n            });\n            i0.ÉµÉµelementEnd()();\n            i0.ÉµÉµelementStart(12, \"th\");\n            i0.ÉµÉµtext(13, \"Manifest #\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(14, \"th\");\n            i0.ÉµÉµtext(15, \"Date\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(16, \"th\");\n            i0.ÉµÉµtext(17, \"Consignments\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(18, \"th\");\n            i0.ÉµÉµtext(19, \"Branch\");\n            i0.ÉµÉµelementEnd()()();\n            i0.ÉµÉµelementStart(20, \"tbody\");\n            i0.ÉµÉµtemplate(21, ManifestComponent_tr_21_Template, 13, 7, \"tr\", 7);\n            i0.ÉµÉµelementEnd()();\n            i0.ÉµÉµelementStart(22, \"button\", 8);\n            i0.ÉµÉµlistener(\"click\", function ManifestComponent_Template_button_click_22_listener() {\n              return ctx.openDeliveryPopup();\n            });\n            i0.ÉµÉµtext(23, \"\\uD83D\\uDE9A Deliver\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµtemplate(24, ManifestComponent_div_24_Template, 14, 1, \"div\", 9);\n            i0.ÉµÉµelementEnd();\n          }\n          if (rf & 2) {\n            i0.ÉµÉµadvance(4);\n            i0.ÉµÉµtwoWayProperty(\"ngModel\", ctx.searchText);\n            i0.ÉµÉµadvance();\n            i0.ÉµÉµtwoWayProperty(\"ngModel\", ctx.filterDate);\n            i0.ÉµÉµadvance();\n            i0.ÉµÉµtwoWayProperty(\"ngModel\", ctx.filterConsignor);\n            i0.ÉµÉµadvance(15);\n            i0.ÉµÉµproperty(\"ngForOf\", ctx.filteredManifests);\n            i0.ÉµÉµadvance(3);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.showDeliveryPopup);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, i2.DatePipe, FormsModule, i3.DefaultValueAccessor, i3.CheckboxControlValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\".manifest-container[_ngcontent-%COMP%]{padding:1rem}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:10px}.manifest-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.manifest-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .manifest-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:8px}.delivery-btn[_ngcontent-%COMP%]{margin-top:15px;background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:8px;cursor:pointer}.popup[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;justify-content:center;align-items:center}.popup-content[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:12px;width:400px;text-align:center}\"]\n      });\n    }\n  }\n  return ManifestComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}