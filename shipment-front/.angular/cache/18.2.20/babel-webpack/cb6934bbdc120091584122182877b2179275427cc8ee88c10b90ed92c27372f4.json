{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet BranchComponent = class BranchComponent {\n  constructor(http) {\n    this.http = http;\n    this.branches = [];\n    this.showAddBranchPopup = false;\n    this.newBranch = {\n      branchName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      phoneNum: '',\n      vehicles: [{\n        vehicleNo: '',\n        driverPhone: ''\n      }],\n      status: 'active'\n    };\n    this.editingBranch = null;\n  }\n  ngOnInit() {\n    localStorage.setItem('branch', 'All Branches');\n    this.loadBranches();\n  }\n  // Load Branches\n  loadBranches() {\n    this.http.get(`http://localhost:3000/api/branches`).subscribe({\n      next: data => {\n        this.branches = data;\n      },\n      error: err => console.error('Error loading branches:', err)\n    });\n  }\n  openAddBranchPopup() {\n    this.showAddBranchPopup = true;\n  }\n  closeAddBranchPopup() {\n    this.showAddBranchPopup = false;\n  }\n  // Add Vehicle in Add Form\n  addVehicle() {\n    this.newBranch.vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  // Remove Vehicle in Add Form\n  removeVehicle(index) {\n    this.newBranch.vehicles.splice(index, 1);\n  }\n  // Add Vehicle while Editing\n  addVehicleEdit() {\n    this.editingBranch.vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  // Remove Vehicle while Editing\n  removeVehicleEdit(index) {\n    this.editingBranch.vehicles.splice(index, 1);\n  }\n  // Add Branch\n  addBranch() {\n    if (!this.newBranch.branchName || !this.newBranch.address || !this.newBranch.phoneNum) {\n      alert('Branch Name, Address, and Branch Phone are required.');\n      return;\n    }\n    const hasIncompleteVehicle = Array.isArray(this.newBranch.vehicles) && this.newBranch.vehicles.some(v => (v?.vehicleNo || v?.driverPhone) && !(v?.vehicleNo && v?.driverPhone));\n    if (hasIncompleteVehicle) {\n      alert('Each vehicle must have both Vehicle No. and Driver Phone (or leave the row empty).');\n      return;\n    }\n    const vehicles = Array.isArray(this.newBranch.vehicles) ? this.newBranch.vehicles.filter(v => v?.vehicleNo && v?.driverPhone) : [];\n    const payload = {\n      branchName: this.newBranch.branchName,\n      address: this.newBranch.address,\n      city: this.newBranch.city,\n      state: this.newBranch.state,\n      pinCode: this.newBranch.pinCode,\n      phoneNum: this.newBranch.phoneNum,\n      vehicles\n    };\n    this.http.post('http://localhost:3000/api/branches/add', payload, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).subscribe({\n      next: () => {\n        alert('Branch added successfully!');\n        this.loadBranches();\n        this.resetNewBranch();\n        this.closeAddBranchPopup();\n      },\n      error: err => {\n        console.error('Error saving branch:', err);\n        alert('Error: ' + (err?.error?.message || err?.message || 'Bad Request'));\n      }\n    });\n  }\n  // Reset Form\n  resetNewBranch() {\n    this.newBranch = {\n      branchName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      phoneNum: '',\n      vehicles: [{\n        vehicleNo: '',\n        driverPhone: ''\n      }],\n      status: 'active'\n    };\n  }\n  // Edit Branch Mode\n  editBranch(branch) {\n    this.editingBranch = JSON.parse(JSON.stringify(branch)); // deep copy to avoid UI distortions\n  }\n  // Save Edited Branch\n  saveEdit() {\n    this.http.put(`http://localhost:3000/api/branches/${this.editingBranch._id}`, this.editingBranch).subscribe({\n      next: () => {\n        alert('Branch updated successfully!');\n        this.editingBranch = null;\n        this.loadBranches();\n      },\n      error: err => {\n        console.error('Error updating branch:', err);\n        alert('Error: ' + (err?.error?.message || err?.message || 'Bad Request'));\n      }\n    });\n  }\n  // Toggle Status Active / Inactive\n  toggleStatus(branch) {\n    this.http.patch(`http://localhost:3000/api/branches/${branch._id}/status`, {}).subscribe(() => {\n      this.loadBranches();\n    });\n  }\n};\nBranchComponent = __decorate([Component({\n  selector: 'app-branch',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './branch.component.html',\n  styleUrls: ['./branch.component.css']\n})], BranchComponent);\nexport { BranchComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}