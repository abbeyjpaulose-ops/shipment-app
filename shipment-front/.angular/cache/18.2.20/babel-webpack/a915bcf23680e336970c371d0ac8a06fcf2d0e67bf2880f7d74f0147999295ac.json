{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet HubComponent = class HubComponent {\n  constructor(http) {\n    this.http = http;\n    this.hubs = [];\n    this.newHub = this.buildEmptyHub();\n    this.editingHub = null;\n  }\n  ngOnInit() {\n    this.loadHubs();\n  }\n  authInfo() {\n    return {\n      email: localStorage.getItem('email'),\n      username: localStorage.getItem('username')\n    };\n  }\n  buildEmptyClient(parentName = '') {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return {\n      clientName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      GSTIN: '',\n      phoneNum: '',\n      perDis: '',\n      creditType: 'no-credit',\n      status: 'active',\n      branch: parentName,\n      email,\n      username,\n      products: [{\n        hsnNum: '',\n        productName: '',\n        status: 'active',\n        ratePerNum: 0,\n        ratePerVolume: 0,\n        ratePerKg: 0,\n        email,\n        username\n      }],\n      packages: [{\n        pkgName: '',\n        status: 'active',\n        email,\n        username\n      }],\n      deliveryLocations: [{\n        location: ''\n      }]\n    };\n  }\n  buildEmptyHub() {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return {\n      hubName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      GSTIN: '',\n      phoneNum: '',\n      perRev: '',\n      deliveryAddresses: [{\n        location: '',\n        vehicles: [{\n          vehicleNo: '',\n          driverPhone: ''\n        }]\n      }],\n      clients: [this.buildEmptyClient('')],\n      status: 'active',\n      email,\n      username\n    };\n  }\n  populateClientMeta(parentName, clients) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return (clients || []).map(c => ({\n      ...c,\n      branch: parentName,\n      email: c.email || email,\n      username: c.username || username,\n      products: (c.products || []).map(p => ({\n        status: 'active',\n        ...p,\n        email: p.email || email,\n        username: p.username || username\n      })),\n      packages: (c.packages || []).map(p => ({\n        status: 'active',\n        ...p,\n        email: p.email || email,\n        username: p.username || username\n      })),\n      deliveryLocations: c.deliveryLocations && c.deliveryLocations.length ? c.deliveryLocations : [{\n        location: ''\n      }]\n    }));\n  }\n  loadHubs() {\n    const email = localStorage.getItem('email');\n    this.http.get(`http://localhost:3000/api/hubs?email=${email}`).subscribe({\n      next: data => {\n        console.log('Hubs loaded:', data);\n        this.hubs = data;\n      },\n      error: err => console.error('Error loading hubs:', err)\n    });\n  }\n  addHub() {\n    const payload = {\n      ...this.newHub,\n      clients: this.populateClientMeta(this.newHub.hubName, this.newHub.clients)\n    };\n    this.http.post('http://localhost:3000/api/hubs/add', payload).subscribe({\n      next: () => {\n        alert('Hub added successfully!');\n        this.loadHubs();\n        this.resetForm();\n      },\n      error: err => {\n        console.error('Error saving hub:', err);\n        alert('Error: ' + err.error?.message);\n      }\n    });\n  }\n  resetForm() {\n    this.newHub = this.buildEmptyHub();\n  }\n  /** dY\"1 Add / Remove Address in Add Mode */\n  addAddress() {\n    this.newHub.deliveryAddresses.push({\n      location: '',\n      vehicles: [{\n        vehicleNo: '',\n        driverPhone: ''\n      }]\n    });\n  }\n  removeAddress(i) {\n    this.newHub.deliveryAddresses.splice(i, 1);\n  }\n  /** dY\"1 Add / Remove Vehicles in Add Mode */\n  addVehicle(addrIndex) {\n    this.newHub.deliveryAddresses[addrIndex].vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  removeVehicle(addrIndex, vIndex) {\n    this.newHub.deliveryAddresses[addrIndex].vehicles.splice(vIndex, 1);\n  }\n  /** dY\"1 Edit Mode */\n  editHub(hub) {\n    this.editingHub = JSON.parse(JSON.stringify(hub)); // Deep clone\n  }\n  addAddressEdit() {\n    this.editingHub.deliveryAddresses.push({\n      location: '',\n      vehicles: [{\n        vehicleNo: '',\n        driverPhone: ''\n      }]\n    });\n  }\n  removeAddressEdit(i) {\n    this.editingHub.deliveryAddresses.splice(i, 1);\n  }\n  addVehicleEdit(addrIndex) {\n    this.editingHub.deliveryAddresses[addrIndex].vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  removeVehicleEdit(addrIndex, vIndex) {\n    this.editingHub.deliveryAddresses[addrIndex].vehicles.splice(vIndex, 1);\n  }\n  saveEdit() {\n    const payload = {\n      ...this.editingHub,\n      clients: this.populateClientMeta(this.editingHub.hubName, this.editingHub.clients)\n    };\n    this.http.put(`http://localhost:3000/api/hubs/${this.editingHub._id}`, payload).subscribe({\n      next: () => {\n        this.loadHubs();\n        this.editingHub = null;\n      },\n      error: () => alert('Update failed!')\n    });\n  }\n  /** dY\"1 Toggle Active/Inactive */\n  toggleStatus(hub) {\n    this.http.patch(`http://localhost:3000/api/hubs/${hub._id}/status`, {\n      status: hub.status === 'active' ? 'inactive' : 'active'\n    }).subscribe(() => this.loadHubs());\n  }\n  // Client helpers (Add mode)\n  addClient() {\n    this.newHub.clients.push(this.buildEmptyClient(this.newHub.hubName));\n  }\n  removeClient(index) {\n    this.newHub.clients.splice(index, 1);\n  }\n  addClientProduct(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.newHub.clients[cIndex].products.push({\n      hsnNum: '',\n      productName: '',\n      status: 'active',\n      ratePerNum: 0,\n      ratePerVolume: 0,\n      ratePerKg: 0,\n      email,\n      username\n    });\n  }\n  removeClientProduct(cIndex, pIndex) {\n    this.newHub.clients[cIndex].products.splice(pIndex, 1);\n  }\n  addClientPackage(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.newHub.clients[cIndex].packages.push({\n      pkgName: '',\n      status: 'active',\n      email,\n      username\n    });\n  }\n  removeClientPackage(cIndex, pIndex) {\n    this.newHub.clients[cIndex].packages.splice(pIndex, 1);\n  }\n  addClientDelivery(cIndex) {\n    this.newHub.clients[cIndex].deliveryLocations.push({\n      location: ''\n    });\n  }\n  removeClientDelivery(cIndex, dIndex) {\n    this.newHub.clients[cIndex].deliveryLocations.splice(dIndex, 1);\n  }\n  // Client helpers (Edit mode)\n  addClientEdit() {\n    this.editingHub.clients.push(this.buildEmptyClient(this.editingHub.hubName));\n  }\n  removeClientEdit(index) {\n    this.editingHub.clients.splice(index, 1);\n  }\n  addClientProductEdit(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.editingHub.clients[cIndex].products.push({\n      hsnNum: '',\n      productName: '',\n      status: 'active',\n      ratePerNum: 0,\n      ratePerVolume: 0,\n      ratePerKg: 0,\n      email,\n      username\n    });\n  }\n  removeClientProductEdit(cIndex, pIndex) {\n    this.editingHub.clients[cIndex].products.splice(pIndex, 1);\n  }\n  addClientPackageEdit(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.editingHub.clients[cIndex].packages.push({\n      pkgName: '',\n      status: 'active',\n      email,\n      username\n    });\n  }\n  removeClientPackageEdit(cIndex, pIndex) {\n    this.editingHub.clients[cIndex].packages.splice(pIndex, 1);\n  }\n  addClientDeliveryEdit(cIndex) {\n    this.editingHub.clients[cIndex].deliveryLocations.push({\n      location: ''\n    });\n  }\n  removeClientDeliveryEdit(cIndex, dIndex) {\n    this.editingHub.clients[cIndex].deliveryLocations.splice(dIndex, 1);\n  }\n};\nHubComponent = __decorate([Component({\n  selector: 'app-hub',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './hub.component.html',\n  styleUrls: ['./hub.component.css']\n})], HubComponent);\nexport { HubComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}