{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet BranchComponent = class BranchComponent {\n  constructor(http) {\n    this.http = http;\n    this.branches = [];\n    this.newBranch = this.buildEmptyBranch();\n    this.editingBranch = null;\n  }\n  ngOnInit() {\n    this.loadBranches();\n  }\n  authInfo() {\n    return {\n      email: localStorage.getItem('email'),\n      username: localStorage.getItem('username')\n    };\n  }\n  buildEmptyClient() {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return {\n      clientName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      GSTIN: '',\n      phoneNum: '',\n      perDis: '',\n      creditType: 'no-credit',\n      status: 'active',\n      branch: '',\n      email,\n      username,\n      products: [{\n        hsnNum: '',\n        productName: '',\n        status: 'active',\n        ratePerNum: 0,\n        ratePerVolume: 0,\n        ratePerKg: 0,\n        email,\n        username\n      }],\n      packages: [{\n        pkgName: '',\n        status: 'active',\n        email,\n        username\n      }],\n      deliveryLocations: [{\n        location: ''\n      }]\n    };\n  }\n  buildEmptyBranch() {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return {\n      branchName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      GSTIN: '',\n      phoneNum: '',\n      vehicles: [{\n        vehicleNo: '',\n        driverPhone: ''\n      }],\n      clients: [this.buildEmptyClient()],\n      status: 'active',\n      email,\n      username\n    };\n  }\n  populateClientMeta(parentName, clients) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    return (clients || []).map(c => ({\n      ...c,\n      branch: parentName,\n      email: c.email || email,\n      username: c.username || username,\n      products: (c.products || []).map(p => ({\n        status: 'active',\n        ...p,\n        email: p.email || email,\n        username: p.username || username\n      })),\n      packages: (c.packages || []).map(p => ({\n        status: 'active',\n        ...p,\n        email: p.email || email,\n        username: p.username || username\n      })),\n      deliveryLocations: c.deliveryLocations && c.deliveryLocations.length ? c.deliveryLocations : [{\n        location: ''\n      }]\n    }));\n  }\n  // Load Branches\n  loadBranches() {\n    const email = localStorage.getItem('email');\n    this.http.get(`http://localhost:3000/api/branches?email=${email}`).subscribe({\n      next: data => {\n        console.log('Branches Loaded:', data);\n        this.branches = data;\n      },\n      error: err => console.error('Error loading branches:', err)\n    });\n  }\n  // Vehicle management (Add mode)\n  addVehicle() {\n    this.newBranch.vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  removeVehicle(index) {\n    this.newBranch.vehicles.splice(index, 1);\n  }\n  // Vehicle management (Edit mode)\n  addVehicleEdit() {\n    this.editingBranch.vehicles.push({\n      vehicleNo: '',\n      driverPhone: ''\n    });\n  }\n  removeVehicleEdit(index) {\n    this.editingBranch.vehicles.splice(index, 1);\n  }\n  // Add Branch\n  addBranch() {\n    const payload = {\n      ...this.newBranch,\n      clients: this.populateClientMeta(this.newBranch.branchName, this.newBranch.clients)\n    };\n    this.http.post('http://localhost:3000/api/branches/add', payload, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).subscribe({\n      next: () => {\n        alert('Branch added successfully!');\n        this.loadBranches();\n        this.resetNewBranch();\n      },\n      error: err => {\n        console.error('Error saving branch:', err);\n        alert('Error: ' + err.error.message);\n      }\n    });\n  }\n  // Reset Form\n  resetNewBranch() {\n    this.newBranch = this.buildEmptyBranch();\n  }\n  // Edit Branch Mode\n  editBranch(branch) {\n    this.editingBranch = JSON.parse(JSON.stringify(branch)); // deep copy to avoid UI distortions\n  }\n  // Save Edited Branch\n  saveEdit() {\n    const payload = {\n      ...this.editingBranch,\n      clients: this.populateClientMeta(this.editingBranch.branchName, this.editingBranch.clients)\n    };\n    this.http.put(`http://localhost:3000/api/branches/${this.editingBranch._id}`, payload).subscribe({\n      next: () => {\n        alert('Branch updated successfully!');\n        this.editingBranch = null;\n        this.loadBranches();\n      },\n      error: err => {\n        console.error('Error updating branch:', err);\n        alert('Error: ' + err.error.message);\n      }\n    });\n  }\n  // Toggle Status Active / Inactive\n  toggleStatus(branch) {\n    const email = localStorage.getItem('email');\n    this.http.patch(`http://localhost:3000/api/branches/${branch._id}/status?email=${email}`, {}).subscribe(() => {\n      this.loadBranches();\n    });\n  }\n  // Client helpers (Add mode)\n  addClient() {\n    this.newBranch.clients.push(this.buildEmptyClient());\n  }\n  removeClient(index) {\n    this.newBranch.clients.splice(index, 1);\n  }\n  addClientProduct(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.newBranch.clients[cIndex].products.push({\n      hsnNum: '',\n      productName: '',\n      status: 'active',\n      ratePerNum: 0,\n      ratePerVolume: 0,\n      ratePerKg: 0,\n      email,\n      username\n    });\n  }\n  removeClientProduct(cIndex, pIndex) {\n    this.newBranch.clients[cIndex].products.splice(pIndex, 1);\n  }\n  addClientPackage(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.newBranch.clients[cIndex].packages.push({\n      pkgName: '',\n      status: 'active',\n      email,\n      username\n    });\n  }\n  removeClientPackage(cIndex, pIndex) {\n    this.newBranch.clients[cIndex].packages.splice(pIndex, 1);\n  }\n  addClientDelivery(cIndex) {\n    this.newBranch.clients[cIndex].deliveryLocations.push({\n      location: ''\n    });\n  }\n  removeClientDelivery(cIndex, dIndex) {\n    this.newBranch.clients[cIndex].deliveryLocations.splice(dIndex, 1);\n  }\n  // Client helpers (Edit mode)\n  addClientEdit() {\n    const client = this.buildEmptyClient();\n    client.branch = this.editingBranch.branchName;\n    this.editingBranch.clients.push(client);\n  }\n  removeClientEdit(index) {\n    this.editingBranch.clients.splice(index, 1);\n  }\n  addClientProductEdit(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.editingBranch.clients[cIndex].products.push({\n      hsnNum: '',\n      productName: '',\n      status: 'active',\n      ratePerNum: 0,\n      ratePerVolume: 0,\n      ratePerKg: 0,\n      email,\n      username\n    });\n  }\n  removeClientProductEdit(cIndex, pIndex) {\n    this.editingBranch.clients[cIndex].products.splice(pIndex, 1);\n  }\n  addClientPackageEdit(cIndex) {\n    const {\n      email,\n      username\n    } = this.authInfo();\n    this.editingBranch.clients[cIndex].packages.push({\n      pkgName: '',\n      status: 'active',\n      email,\n      username\n    });\n  }\n  removeClientPackageEdit(cIndex, pIndex) {\n    this.editingBranch.clients[cIndex].packages.splice(pIndex, 1);\n  }\n  addClientDeliveryEdit(cIndex) {\n    this.editingBranch.clients[cIndex].deliveryLocations.push({\n      location: ''\n    });\n  }\n  removeClientDeliveryEdit(cIndex, dIndex) {\n    this.editingBranch.clients[cIndex].deliveryLocations.splice(dIndex, 1);\n  }\n};\nBranchComponent = __decorate([Component({\n  selector: 'app-branch',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './branch.component.html',\n  styleUrls: ['./branch.component.css']\n})], BranchComponent);\nexport { BranchComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}