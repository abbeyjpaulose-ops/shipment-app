{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ManifestComponent_tr_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"input\", 4);\n    i0.ɵɵlistener(\"change\", function ManifestComponent_tr_21_Template_input_change_2_listener() {\n      const c_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.toggleSelection(c_r2._id));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\")(14, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_tr_21_Template_button_click_14_listener() {\n      const c_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.editConsignment(c_r2));\n    });\n    i0.ɵɵtext(15, \"Edit\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const c_r2 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(c_r2.consignmentNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r2.shipmentStatus);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r2.consignor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(c_r2.deliveryAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((c_r2.products == null ? null : c_r2.products.length) || 0);\n  }\n}\nfunction ManifestComponent_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7)(2, \"h3\");\n    i0.ɵɵtext(3, \"Edit Consignment\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"Consignment No:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"input\", 8);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_22_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingConsignment.consignmentNumber, $event) || (ctx_r2.editingConsignment.consignmentNumber = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Status:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"input\", 8);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_22_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingConsignment.shipmentStatus, $event) || (ctx_r2.editingConsignment.shipmentStatus = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"input\", 8);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_22_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingConsignment.consignor, $event) || (ctx_r2.editingConsignment.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"label\");\n    i0.ɵɵtext(14, \"Delivery Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"input\", 8);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_22_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingConsignment.deliveryAddress, $event) || (ctx_r2.editingConsignment.deliveryAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_div_22_Template_button_click_16_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.saveConsignmentEdit());\n    });\n    i0.ɵɵtext(17, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_div_22_Template_button_click_18_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cancelEdit());\n    });\n    i0.ɵɵtext(19, \"Cancel\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingConsignment.consignmentNumber);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingConsignment.shipmentStatus);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingConsignment.consignor);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingConsignment.deliveryAddress);\n  }\n}\nexport let ManifestComponent = /*#__PURE__*/(() => {\n  class ManifestComponent {\n    constructor(http) {\n      this.http = http;\n      this.consignments = [];\n      this.filteredConsignments = [];\n      this.searchText = '';\n      this.filterDate = '';\n      this.filterConsignor = '';\n      this.selectedConsignment = null;\n      this.editingConsignment = null; // ✅ track which consignment is being edited\n    }\n    ngOnInit() {\n      this.loadConsignments();\n    }\n    loadConsignments() {\n      const email = localStorage.getItem('email');\n      this.http.get(`http://localhost:3000/api/newshipments?email=${email}`).subscribe({\n        next: res => {\n          // filter only IN TRANSIT consignments\n          this.consignments = res.filter(c => c.shipmentStatus === 'In Transit');\n          console.log(this.consignments);\n          this.filteredConsignments = [...this.consignments];\n        },\n        error: err => console.error('❌ Error loading consignments:', err)\n      });\n    }\n    applyFilters() {\n      this.filteredConsignments = this.consignments.filter(c => (this.searchText ? c.consignmentNumber?.includes(this.searchText) || c.consignor?.includes(this.searchText) : true) && (this.filterDate ? new Date(c.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? c.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true));\n    }\n    toggleAllSelection(event) {\n      const checked = event.target.checked;\n      this.filteredConsignments.forEach(c => c.selected = checked);\n    }\n    markAsDelivered() {\n      const selectedConsignments = this.filteredConsignments.filter(c => c.selected);\n      if (selectedConsignments.length === 0) {\n        console.warn('⚠️ No consignments selected for delivery.');\n        return;\n      }\n      selectedConsignments.forEach(consignment => {\n        const updatedConsignment = {\n          ...consignment,\n          shipmentStatus: 'Delivered'\n        };\n        this.http.put(`http://localhost:3000/api/newshipments/${consignment.consignmentNumber}`, updatedConsignment).subscribe({\n          next: () => {\n            console.log(`✅ Consignment ${consignment.consignmentNumber} marked as Delivered`);\n            this.loadConsignments(); // Refresh data\n          },\n          error: err => {\n            console.error(`❌ Error updating consignment ${consignment.consignmentNumber}:`, err);\n          }\n        });\n      });\n      // Optionally clear selection after update\n      this.filteredConsignments.forEach(c => c.selected = false);\n    }\n    openConsignmentDetails(consignment) {\n      this.selectedConsignment = consignment;\n    }\n    closeConsignmentDetails() {\n      this.selectedConsignment = null;\n    }\n    editConsignment(consignment) {\n      console.log('✏️ Edit consignment:', consignment);\n      this.editingConsignment = {\n        ...consignment\n      }; // ✅ copy so we don’t mutate directly\n    }\n    saveConsignmentEdit() {\n      if (!this.editingConsignment) return;\n      this.http.put(`http://localhost:3000/api/newshipments/${this.editingConsignment.consignmentNumber}`, this.editingConsignment).subscribe({\n        next: () => {\n          console.log('✅ Consignment updated');\n          this.loadConsignments(); // reload updated data\n          this.editingConsignment = null; // close modal\n        },\n        error: err => console.error('❌ Error updating consignment:', err)\n      });\n    }\n    cancelEdit() {\n      this.editingConsignment = null;\n    }\n    static {\n      this.ɵfac = function ManifestComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ManifestComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ManifestComponent,\n        selectors: [[\"app-manifestation\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 23,\n        vars: 3,\n        consts: [[1, \"manifestation-container\"], [3, \"click\", \"disabled\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"modal\", 4, \"ngIf\"], [\"type\", \"checkbox\", 3, \"change\"], [3, \"click\"], [1, \"modal\"], [1, \"modal-content\"], [3, \"ngModelChange\", \"ngModel\"]],\n        template: function ManifestComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n            i0.ɵɵtext(2, \"Manifestation (In Transit \\u2192 Delivered)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"button\", 1);\n            i0.ɵɵlistener(\"click\", function ManifestComponent_Template_button_click_3_listener() {\n              return ctx.markAsDelivered();\n            });\n            i0.ɵɵtext(4, \" \\u2705 Mark Delivered \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"table\")(6, \"tr\")(7, \"th\");\n            i0.ɵɵtext(8, \"Select\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(9, \"th\");\n            i0.ɵɵtext(10, \"Consignment No\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"th\");\n            i0.ɵɵtext(12, \"Status\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"th\");\n            i0.ɵɵtext(14, \"Consignor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"th\");\n            i0.ɵɵtext(16, \"Delivery Address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"th\");\n            i0.ɵɵtext(18, \"Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"th\");\n            i0.ɵɵtext(20, \"Actions\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(21, ManifestComponent_tr_21_Template, 16, 5, \"tr\", 2);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(22, ManifestComponent_div_22_Template, 20, 4, \"div\", 3);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"disabled\", ctx.selectedConsignments.size === 0);\n            i0.ɵɵadvance(18);\n            i0.ɵɵproperty(\"ngForOf\", ctx.consignments);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.editingConsignment);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\".manifestation-container[_ngcontent-%COMP%]{padding:1rem}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:1rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:8px}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:5px;width:400px}\"]\n      });\n    }\n  }\n  return ManifestComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}