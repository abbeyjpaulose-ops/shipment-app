{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet ViewShipmentsComponent = class ViewShipmentsComponent {\n  constructor(http, branchService) {\n    this.http = http;\n    this.branchService = branchService;\n    this.shipments = [];\n    this.filteredShipments = [];\n    this.branch = '';\n    this.searchText = '';\n    this.filterDate = '';\n    this.filterStatus = '';\n    this.filterConsignor = '';\n    this.selectedShipment = null; // ƒo. for modal popup\n  }\n  ngOnInit() {\n    this.branch = this.branchService.currentBranch;\n    this.branchSub = this.branchService.branch$.subscribe(branch => {\n      this.branch = branch;\n      this.loadShipments();\n    });\n    this.loadShipments();\n  }\n  ngOnDestroy() {\n    this.branchSub?.unsubscribe();\n  }\n  loadShipments() {\n    this.http.get('http://localhost:3000/api/newshipments', {\n      params: {\n        email: localStorage.getItem('email') || '',\n        branch: this.branch || 'All Branches'\n      }\n    }).subscribe({\n      next: res => {\n        this.shipments = res;\n        this.applyFilters();\n      },\n      error: err => console.error('ƒ?O Error loading shipments:', err)\n    });\n  }\n  getProductTotal(ewaybills, field) {\n    let total = 0;\n    ewaybills.forEach(ewaybill => {\n      ewaybill.invoices.forEach(invoice => {\n        invoice.products.forEach(product => {\n          total += product[field] || 0;\n        });\n      });\n    });\n    return total;\n  }\n  applyFilters() {\n    this.filteredShipments = this.shipments.filter(s => {\n      const matchesSearch = this.searchText ? s.consignmentNumber?.toLowerCase().includes(this.searchText.toLowerCase()) || s.consignor?.toLowerCase().includes(this.searchText.toLowerCase()) : true;\n      const matchesDate = this.filterDate ? new Date(s.date).toDateString() === new Date(this.filterDate).toDateString() : true;\n      const matchesStatus = this.filterStatus ? s.shipmentStatus === this.filterStatus : true;\n      const matchesConsignor = this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true;\n      return matchesSearch && matchesDate && matchesStatus && matchesConsignor;\n    });\n  }\n  // ƒo. open details modal\n  openShipmentDetails(shipment) {\n    this.selectedShipment = shipment;\n  }\n  // ƒo. close details modal\n  closeShipmentDetails() {\n    this.selectedShipment = null;\n  }\n};\nViewShipmentsComponent = __decorate([Component({\n  selector: 'app-view-shipments',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './view-shipments.component.html',\n  styleUrls: ['./view-shipments.component.css']\n})], ViewShipmentsComponent);\nexport { ViewShipmentsComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}