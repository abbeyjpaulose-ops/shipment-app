{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ManifestComponent_tr_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_tr_26_Template_tr_click_0_listener() {\n      const s_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.openManifestDetails(s_r2));\n    });\n    i0.ɵɵelementStart(1, \"td\")(2, \"input\", 11);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_tr_26_Template_input_ngModelChange_2_listener($event) {\n      const s_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      i0.ɵɵtwoWayBindingSet(s_r2.selected, $event) || (s_r2.selected = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"click\", function ManifestComponent_tr_26_Template_input_click_2_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\")(12, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_tr_26_Template_button_click_12_listener($event) {\n      const s_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const ctx_r2 = i0.ɵɵnextContext();\n      ctx_r2.editManifest(s_r2);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵtext(13, \"Edit\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const s_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", s_r2.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r2.consignmentNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r2.consignor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r2.deliveryAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate((s_r2.products == null ? null : s_r2.products.length) || 0);\n  }\n}\nfunction ManifestComponent_div_27_li_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r5 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", p_r5.name, \" (Qty: \", p_r5.quantity, \") \");\n  }\n}\nfunction ManifestComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13)(2, \"span\", 14);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_div_27_Template_span_click_2_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.closeManifestDetails());\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"h2\");\n    i0.ɵɵtext(5, \"Manifest Details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 15)(7, \"p\")(8, \"strong\");\n    i0.ɵɵtext(9, \"Consignment No.:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"p\")(12, \"strong\");\n    i0.ɵɵtext(13, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"p\")(16, \"strong\");\n    i0.ɵɵtext(17, \"Consignee:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"p\")(20, \"strong\");\n    i0.ɵɵtext(21, \"Delivery Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"p\")(24, \"strong\");\n    i0.ɵɵtext(25, \"Date:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(26);\n    i0.ɵɵpipe(27, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(28, \"p\")(29, \"strong\");\n    i0.ɵɵtext(30, \"No. of Products:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(31);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(32, \"h3\");\n    i0.ɵɵtext(33, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"ul\");\n    i0.ɵɵtemplate(35, ManifestComponent_div_27_li_35_Template, 2, 2, \"li\", 16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedManifest.consignmentNumber, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedManifest.consignor, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedManifest.consignee, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.selectedManifest.deliveryAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(27, 7, ctx_r2.selectedManifest.date, \"short\"), \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", (ctx_r2.selectedManifest.products == null ? null : ctx_r2.selectedManifest.products.length) || 0, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.selectedManifest.products);\n  }\n}\nfunction ManifestComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"div\", 13)(2, \"h3\");\n    i0.ɵɵtext(3, \"Edit Manifest\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"input\", 17);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_28_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingManifest.consignor, $event) || (ctx_r2.editingManifest.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Delivery Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"input\", 17);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_div_28_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r2.editingManifest.deliveryAddress, $event) || (ctx_r2.editingManifest.deliveryAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_div_28_Template_button_click_13_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.saveManifestEdit());\n    });\n    i0.ɵɵtext(14, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function ManifestComponent_div_28_Template_button_click_15_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cancelEdit());\n    });\n    i0.ɵɵtext(16, \"Cancel\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate2(\"Consignment No:\", ctx_r2.editingManifest.consignmentNumber, \" Status:\", ctx_r2.editingManifest.shipmentStatus, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingManifest.consignor);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r2.editingManifest.deliveryAddress);\n  }\n}\nexport let ManifestComponent = /*#__PURE__*/(() => {\n  class ManifestComponent {\n    constructor(http) {\n      this.http = http;\n      this.manifest = [];\n      this.filteredManifest = [];\n      this.searchText = '';\n      this.filterDate = '';\n      this.filterConsignor = '';\n      this.selectedManifest = null;\n      this.editingManifest = null; // ✅ track which manifest is being edited\n    }\n    ngOnInit() {\n      this.loadManifest();\n    }\n    loadManifest() {\n      const email = localStorage.getItem('email');\n      this.http.get(`http://localhost:3000/api/manifest?email=${email}`).subscribe({\n        next: res => {\n          // filter only In Tansit shipments\n          this.manifest = res.filter(s => s.shipmentStatus === 'In Transit');\n          console.log(this.manifest);\n          this.filteredManifest = [...this.manifest];\n        },\n        error: err => console.error('❌ Error loading manifest:', err)\n      });\n    }\n    applyFilters() {\n      this.filteredManifest = this.manifest.filter(s => (this.searchText ? s.consignmentNumber?.includes(this.searchText) || s.consignor?.includes(this.searchText) : true) && (this.filterDate ? new Date(s.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true));\n    }\n    toggleAllSelection(event) {\n      const checked = event.target.checked;\n      this.filteredManifest.forEach(s => s.selected = checked);\n    }\n    manifestSelected() {\n      const selectedConsignments = this.filteredManifest.filter(s => s.selected);\n      if (selectedConsignments.length === 0) {\n        console.warn('⚠️ No consignments selected for manifestation.');\n        return;\n      }\n      selectedConsignments.forEach(manifest => {\n        const updatedManifest = {\n          ...manifest,\n          shipmentStatus: 'Delivered'\n        };\n        console.log(\"sqsqsqsqsqsqsqsqsqs\" + manifest.shipmentStatus);\n        this.http.put(`http://localhost:3000/api/newshipments/${manifest.consignmentNumber}`, updatedManifest).subscribe({\n          next: () => {\n            console.log(`✅ Consignment ${manifest.consignmentNumber} updated to Delivered`);\n            this.loadManifest(); // Refresh data\n          },\n          error: err => {\n            console.error(`❌ Error updating consignment ${manifest.consignmentNumber}:`, err);\n          }\n        });\n      });\n      // Optionally clear selection after update\n      this.filteredManifest.forEach(s => s.selected = false);\n    }\n    openManifestDetails(manifest) {\n      this.selectedManifest = manifest;\n    }\n    closeManifestDetails() {\n      this.selectedManifest = null;\n    }\n    editManifest(manifest) {\n      console.log('✏️ Edit manifest:', manifest);\n      this.editingManifest = {\n        ...manifest\n      }; // ✅ copy so we don’t mutate directly\n    }\n    saveManifestEdit() {\n      if (!this.editingManifest) return;\n      console.log(\"kkkkkkkkkkklllllllllllllllll\" + this.editingManifest.consignmentNumber);\n      this.http.put(`http://localhost:3000/api/newshipments/${this.editingManifest.consignmentNumber}`, this.editingManifest).subscribe({\n        next: () => {\n          console.log('✅ Manifest updated');\n          this.loadManifest(); // reload updated data\n          this.editingManifest = null; // close modal\n        },\n        error: err => console.error('❌ Error updating manifest:', err)\n      });\n    }\n    cancelEdit() {\n      this.editingManifest = null;\n    }\n    static {\n      this.ɵfac = function ManifestComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ManifestComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ManifestComponent,\n        selectors: [[\"app-manifest\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 29,\n        vars: 6,\n        consts: [[1, \"manifest-container\"], [1, \"filters\"], [\"type\", \"text\", \"placeholder\", \"Search by consignment no. or consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [\"type\", \"date\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"type\", \"text\", \"placeholder\", \"Filter by consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [3, \"click\"], [1, \"actions\"], [1, \"manifest-table\"], [\"type\", \"checkbox\", 3, \"change\"], [3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"modal\", 4, \"ngIf\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"click\", \"ngModel\"], [1, \"modal\"], [1, \"modal-content\"], [1, \"close\", 3, \"click\"], [1, \"manifest-details\"], [4, \"ngFor\", \"ngForOf\"], [3, \"ngModelChange\", \"ngModel\"]],\n        template: function ManifestComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n            i0.ɵɵtext(2, \"Manifest\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"div\", 1)(4, \"input\", 2);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_4_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.searchText, $event) || (ctx.searchText = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function ManifestComponent_Template_input_input_4_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"input\", 3);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_5_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterDate, $event) || (ctx.filterDate = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function ManifestComponent_Template_input_change_5_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"input\", 4);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ManifestComponent_Template_input_ngModelChange_6_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterConsignor, $event) || (ctx.filterConsignor = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function ManifestComponent_Template_input_input_6_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function ManifestComponent_Template_button_click_7_listener() {\n              return ctx.manifestSelected();\n            });\n            i0.ɵɵtext(8, \"Manifestation\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(9, \"div\", 6);\n            i0.ɵɵelementStart(10, \"table\", 7)(11, \"thead\")(12, \"tr\")(13, \"th\")(14, \"input\", 8);\n            i0.ɵɵlistener(\"change\", function ManifestComponent_Template_input_change_14_listener($event) {\n              return ctx.toggleAllSelection($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(15, \"th\");\n            i0.ɵɵtext(16, \"Consignment No.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"th\");\n            i0.ɵɵtext(18, \"Consignor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"th\");\n            i0.ɵɵtext(20, \"Delivery Address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"th\");\n            i0.ɵɵtext(22, \"No. of Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(23, \"th\");\n            i0.ɵɵtext(24, \"Actions\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(25, \"tbody\");\n            i0.ɵɵtemplate(26, ManifestComponent_tr_26_Template, 14, 5, \"tr\", 9);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(27, ManifestComponent_div_27_Template, 36, 10, \"div\", 10)(28, ManifestComponent_div_28_Template, 17, 4, \"div\", 10);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchText);\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterDate);\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterConsignor);\n            i0.ɵɵadvance(20);\n            i0.ɵɵproperty(\"ngForOf\", ctx.filteredManifest);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedManifest);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.editingManifest);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, i2.DatePipe, FormsModule, i3.DefaultValueAccessor, i3.CheckboxControlValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\".manifestation-container[_ngcontent-%COMP%]{padding:1rem}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:1rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{border:1px solid #ddd;padding:8px}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:5px;width:400px}\"]\n      });\n    }\n  }\n  return ManifestComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}