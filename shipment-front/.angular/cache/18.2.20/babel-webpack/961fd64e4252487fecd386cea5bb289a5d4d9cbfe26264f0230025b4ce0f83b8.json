{"ast":null,"code":"import { NgIf } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nfunction RoleSettingsComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h2\");\n    i0.ɵɵtext(2, \"Roles Settings\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Create/manage users for this company here.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction RoleSettingsComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\");\n    i0.ɵɵtext(1, \"No privileges\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"Only admins can access Roles Settings.\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let RoleSettingsComponent = /*#__PURE__*/(() => {\n  class RoleSettingsComponent {\n    constructor(http) {\n      this.http = http;\n      this.isAdmin = String(localStorage.getItem('role') || '').toLowerCase() === 'admin';\n      this.email = localStorage.getItem('email') || '';\n      this.branches = [];\n      this.users = [];\n      this.newUser = {\n        branch: '',\n        email: '',\n        username: '',\n        password: '',\n        role: 'user'\n      };\n      this.editId = null;\n      this.editUser = {\n        branch: '',\n        email: '',\n        username: '',\n        password: '',\n        role: 'user'\n      };\n    }\n    ngOnInit() {\n      if (!this.isAdmin) return;\n      this.loadBranches();\n      this.loadUsers();\n    }\n    loadBranches() {\n      this.http.get(`http://localhost:3000/api/branches?email=${encodeURIComponent(this.email)}`).subscribe({\n        next: data => {\n          this.branches = data || [];\n        },\n        error: () => {\n          this.branches = [];\n        }\n      });\n    }\n    loadUsers() {\n      this.http.get('http://localhost:3000/api/admin/users').subscribe({\n        next: data => {\n          this.users = data || [];\n        },\n        error: () => {\n          this.users = [];\n        }\n      });\n    }\n    onNewRoleChange() {\n      if (String(this.newUser.role).toLowerCase() === 'admin') {\n        this.newUser.branch = 'All Branches';\n      }\n    }\n    createUser() {\n      if (!this.newUser.email || !this.newUser.username || !this.newUser.password) {\n        alert('Email, username, and password are required');\n        return;\n      }\n      if (String(this.newUser.role).toLowerCase() !== 'admin' && !this.newUser.branch) {\n        alert('Branch is required');\n        return;\n      }\n      this.http.post('http://localhost:3000/api/admin/users', this.newUser).subscribe({\n        next: () => {\n          this.newUser = {\n            branch: '',\n            email: '',\n            username: '',\n            password: '',\n            role: 'user'\n          };\n          this.loadUsers();\n        },\n        error: err => {\n          alert(err?.error?.message || 'Failed to create user');\n        }\n      });\n    }\n    startEdit(row) {\n      this.editId = Number(row?._id);\n      this.editUser = {\n        branch: row?.branch || '',\n        email: row?.email || '',\n        username: row?.username || '',\n        password: '',\n        role: row?.role || 'user'\n      };\n    }\n    cancelEdit() {\n      this.editId = null;\n      this.editUser = {\n        branch: '',\n        email: '',\n        username: '',\n        password: '',\n        role: 'user'\n      };\n    }\n    onEditRoleChange() {\n      if (String(this.editUser.role).toLowerCase() === 'admin') {\n        this.editUser.branch = 'All Branches';\n      }\n    }\n    saveEdit() {\n      if (this.editId === null) return;\n      const payload = {\n        branch: this.editUser.branch,\n        email: this.editUser.email,\n        username: this.editUser.username,\n        role: this.editUser.role\n      };\n      if (this.editUser.password) payload.password = this.editUser.password;\n      this.http.put(`http://localhost:3000/api/admin/users/${this.editId}`, payload).subscribe({\n        next: () => {\n          this.cancelEdit();\n          this.loadUsers();\n        },\n        error: err => {\n          alert(err?.error?.message || 'Failed to update user');\n        }\n      });\n    }\n    deleteUser(id) {\n      const userId = Number(id);\n      if (!Number.isFinite(userId)) return;\n      if (!confirm('Delete this user?')) return;\n      this.http.delete(`http://localhost:3000/api/admin/users/${userId}`).subscribe({\n        next: () => this.loadUsers(),\n        error: err => alert(err?.error?.message || 'Failed to delete user')\n      });\n    }\n    static {\n      this.ɵfac = function RoleSettingsComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || RoleSettingsComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: RoleSettingsComponent,\n        selectors: [[\"app-roleSettings\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 3,\n        vars: 2,\n        consts: [[\"noPrivileges\", \"\"], [4, \"ngIf\", \"ngIfElse\"]],\n        template: function RoleSettingsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵtemplate(0, RoleSettingsComponent_ng_container_0_Template, 5, 0, \"ng-container\", 1)(1, RoleSettingsComponent_ng_template_1_Template, 4, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n          }\n          if (rf & 2) {\n            const noPrivileges_r1 = i0.ɵɵreference(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.isAdmin)(\"ngIfElse\", noPrivileges_r1);\n          }\n        },\n        dependencies: [NgIf, FormsModule],\n        styles: [\"h2[_ngcontent-%COMP%]{color:#1976d2}\"]\n      });\n    }\n  }\n  return RoleSettingsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}