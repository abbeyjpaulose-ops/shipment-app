{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let LogsComponent = /*#__PURE__*/(() => {\n  class LogsComponent {\n    constructor(http) {\n      this.http = http;\n      this.auditLogs = [];\n      this.auditLoading = false;\n      this.auditFilters = {\n        startDate: '',\n        endDate: '',\n        action: '',\n        user: '',\n        limit: '100'\n      };\n      this.auditPage = 1;\n      this.auditTotal = 0;\n    }\n    ngOnInit() {\n      if (this.isAdmin()) {\n        this.loadAuditLogs();\n      }\n    }\n    isAdmin() {\n      const role = String(localStorage.getItem('role') || '').toLowerCase();\n      return role === 'admin';\n    }\n    loadAuditLogs() {\n      if (!this.isAdmin()) return;\n      this.auditLoading = true;\n      this.http.get('http://localhost:3000/api/audit-logs', {\n        params: {\n          startDate: this.auditFilters.startDate || '',\n          endDate: this.auditFilters.endDate || '',\n          action: this.auditFilters.action || '',\n          user: this.auditFilters.user || '',\n          limit: this.auditFilters.limit || '100',\n          page: String(this.auditPage || 1)\n        }\n      }).subscribe({\n        next: res => {\n          this.auditLogs = Array.isArray(res?.logs) ? res.logs : [];\n          this.auditTotal = Number(res?.total) || 0;\n          this.auditPage = Number(res?.page) || this.auditPage;\n          this.auditLoading = false;\n        },\n        error: err => {\n          console.error('Error loading audit logs:', err);\n          this.auditLogs = [];\n          this.auditLoading = false;\n        }\n      });\n    }\n    changeAuditPage(delta) {\n      const limitNum = Number(this.auditFilters.limit) || 100;\n      const totalPages = Math.max(1, Math.ceil(this.auditTotal / limitNum));\n      const next = Math.min(totalPages, Math.max(1, (this.auditPage || 1) + delta));\n      if (next === this.auditPage) return;\n      this.auditPage = next;\n      this.loadAuditLogs();\n    }\n    exportAuditLogsJson() {\n      const content = JSON.stringify(this.auditLogs || [], null, 2);\n      this.downloadBlob(content, 'audit-logs.json', 'application/json');\n    }\n    exportAuditLogsCsv() {\n      const rows = (this.auditLogs || []).map(log => ({\n        time: log.createdAt || '',\n        action: log.action || '',\n        user: log.actorUsername || log.actorEmail || '',\n        before: JSON.stringify(log.before || {}),\n        after: JSON.stringify(log.after || log.metadata || {})\n      }));\n      const header = ['time', 'action', 'user', 'before', 'after'];\n      const csv = [header.join(',')].concat(rows.map(r => header.map(h => this.escapeCsv(String(r[h] || ''))).join(','))).join('\\n');\n      this.downloadBlob(csv, 'audit-logs.csv', 'text/csv');\n    }\n    escapeCsv(value) {\n      const escaped = value.replace(/\\\"/g, '\"\"');\n      if (/[\\\",\\n]/.test(escaped)) return `\"${escaped}\"`;\n      return escaped;\n    }\n    downloadBlob(content, filename, type) {\n      const blob = new Blob([content], {\n        type\n      });\n      const url = URL.createObjectURL(blob);\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = filename;\n      link.click();\n      URL.revokeObjectURL(url);\n    }\n    static {\n      this.ɵfac = function LogsComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || LogsComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LogsComponent,\n        selectors: [[\"app-logs\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 2,\n        vars: 0,\n        template: function LogsComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\");\n            i0.ɵɵtext(1, \"Logs\");\n            i0.ɵɵelementEnd();\n          }\n        },\n        dependencies: [CommonModule, FormsModule],\n        styles: [\"h2[_ngcontent-%COMP%]{color:#1976d2}\"]\n      });\n    }\n  }\n  return LogsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}