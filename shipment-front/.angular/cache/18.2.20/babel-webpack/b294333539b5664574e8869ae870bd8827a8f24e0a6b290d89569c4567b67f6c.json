{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { forkJoin, of } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../../../services/branch.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction StocksComponent_select_12_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", h_r3._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(h_r3.hubName);\n  }\n}\nfunction StocksComponent_select_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"select\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_select_12_Template_select_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedHubFilterId, $event) || (ctx_r1.selectedHubFilterId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function StocksComponent_select_12_Template_select_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onHubFilterChange($event));\n    });\n    i0.ɵɵtemplate(1, StocksComponent_select_12_option_1_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedHubFilterId);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getAllHubsFilterOptions());\n  }\n}\nfunction StocksComponent_tr_40_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_tr_40_Template_tr_click_0_listener() {\n      const s_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openStockDetails(s_r5));\n    });\n    i0.ɵɵelementStart(1, \"td\")(2, \"input\", 21);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_tr_40_Template_input_ngModelChange_2_listener($event) {\n      const s_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      i0.ɵɵtwoWayBindingSet(s_r5.selected, $event) || (s_r5.selected = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"click\", function StocksComponent_tr_40_Template_input_click_2_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\")(16, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_tr_40_Template_button_click_16_listener($event) {\n      const s_r5 = i0.ɵɵrestoreView(_r4).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext();\n      ctx_r1.editStock(s_r5);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵtext(17, \"Edit\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const s_r5 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", s_r5.selected);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r5.consignmentNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r5.consignor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r5.deliveryAddress);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.getInvoiceAmountTotal(s_r5.invoices));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.getOriginBranchLabel(s_r5));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.getCurrentBranchLabel(s_r5));\n  }\n}\nfunction StocksComponent_div_41_div_169_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\")(1, \"span\", 35);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"span\", 36);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 36);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const product_r7 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r7.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"In Stock: \", product_r7.instock, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Total: \", product_r7.amount, \"\");\n  }\n}\nfunction StocksComponent_div_41_div_169_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ul\", 33);\n    i0.ɵɵtemplate(4, StocksComponent_div_41_div_169_li_4_Template, 7, 3, \"li\", 34);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const invoice_r8 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Invoice #\", invoice_r8.number, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r8.products);\n  }\n}\nfunction StocksComponent_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 22)(1, \"div\", 23)(2, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_41_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeStockDetails());\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 25)(5, \"div\")(6, \"h2\");\n    i0.ɵɵtext(7, \"Shipment Details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 26);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"span\", 27);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 28)(13, \"p\")(14, \"strong\");\n    i0.ɵɵtext(15, \"Consignment No.:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p\")(18, \"strong\");\n    i0.ɵɵtext(19, \"Status:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"p\")(22, \"strong\");\n    i0.ɵɵtext(23, \"Branch:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"p\")(26, \"strong\");\n    i0.ɵɵtext(27, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"p\")(30, \"strong\");\n    i0.ɵɵtext(31, \"Consignor GST:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(32);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"p\")(34, \"strong\");\n    i0.ɵɵtext(35, \"Consignor Phone:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"p\")(38, \"strong\");\n    i0.ɵɵtext(39, \"Consignor Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(40);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"p\")(42, \"strong\");\n    i0.ɵɵtext(43, \"Consignee:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(44);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"p\")(46, \"strong\");\n    i0.ɵɵtext(47, \"Consignee GST:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(48);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(49, \"p\")(50, \"strong\");\n    i0.ɵɵtext(51, \"Consignee Phone:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(52);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(53, \"p\")(54, \"strong\");\n    i0.ɵɵtext(55, \"Consignee Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(56);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(57, \"p\")(58, \"strong\");\n    i0.ɵɵtext(59, \"Payment Mode:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(60);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(61, \"p\")(62, \"strong\");\n    i0.ɵɵtext(63, \"External Ref ID:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(64);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(65, \"p\")(66, \"strong\");\n    i0.ɵɵtext(67, \"Billing Type:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(68);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(69, \"p\")(70, \"strong\");\n    i0.ɵɵtext(71, \"Billing Name:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(72);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(73, \"p\")(74, \"strong\");\n    i0.ɵɵtext(75, \"Billing GSTIN:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(76);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(77, \"p\")(78, \"strong\");\n    i0.ɵɵtext(79, \"Billing Phone:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(80);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(81, \"p\")(82, \"strong\");\n    i0.ɵɵtext(83, \"Billing Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(84);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(85, \"p\")(86, \"strong\");\n    i0.ɵɵtext(87, \"Pickup Type:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(88);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(89, \"p\")(90, \"strong\");\n    i0.ɵɵtext(91, \"Pickup Name:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(92);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(93, \"p\")(94, \"strong\");\n    i0.ɵɵtext(95, \"Pickup Phone:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(96);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(97, \"p\")(98, \"strong\");\n    i0.ɵɵtext(99, \"Pickup Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(100);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(101, \"p\")(102, \"strong\");\n    i0.ɵɵtext(103, \"Pickup Pincode:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(104);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(105, \"p\")(106, \"strong\");\n    i0.ɵɵtext(107, \"Delivery Type:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(108);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(109, \"p\")(110, \"strong\");\n    i0.ɵɵtext(111, \"Delivery To:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(112);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(113, \"p\")(114, \"strong\");\n    i0.ɵɵtext(115, \"Delivery Phone:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(116);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(117, \"p\")(118, \"strong\");\n    i0.ɵɵtext(119, \"Delivery Address:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(120);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(121, \"p\")(122, \"strong\");\n    i0.ɵɵtext(123, \"Delivery Pincode:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(124);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(125, \"p\")(126, \"strong\");\n    i0.ɵɵtext(127, \"Date:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(128);\n    i0.ɵɵpipe(129, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(130, \"p\")(131, \"strong\");\n    i0.ɵɵtext(132, \"Final Amount:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(133);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(134, \"p\")(135, \"strong\");\n    i0.ɵɵtext(136, \"Charges - ODC:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(138, \"p\")(139, \"strong\");\n    i0.ɵɵtext(140, \"Charges - Unloading:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(141);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(142, \"p\")(143, \"strong\");\n    i0.ɵɵtext(144, \"Charges - Docket:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(145);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(146, \"p\")(147, \"strong\");\n    i0.ɵɵtext(148, \"Charges - Other:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(149);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(150, \"p\")(151, \"strong\");\n    i0.ɵɵtext(152, \"Charges - CCC:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(153);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(154, \"p\")(155, \"strong\");\n    i0.ɵɵtext(156, \"Charges - Consignor Discount:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(157);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(158, \"p\")(159, \"strong\");\n    i0.ɵɵtext(160, \"Products in stock:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(161);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(162, \"p\")(163, \"strong\");\n    i0.ɵɵtext(164, \"No. of Products:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(165);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(166, \"h3\");\n    i0.ɵɵtext(167, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(168, \"div\", 29);\n    i0.ɵɵtemplate(169, StocksComponent_div_41_div_169_Template, 5, 2, \"div\", 30);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate1(\"Consignment \", ctx_r1.selectedStock.consignmentNumber, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r1.selectedStock.shipmentStatus);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignmentNumber, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.shipmentStatus, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getOriginBranchLabel(ctx_r1.selectedStock), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignor, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignorGST, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignorPhone, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignorAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consignee, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consigneeGST, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consigneePhone, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.consigneeAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.paymentMode, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.externalRefId, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.billingType, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.billingName, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.billingGSTIN, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.billingPhone, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.billingAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.pickupType, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.pickupName, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.pickupPhone, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.pickupAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.pickupPincode, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.deliveryType, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getDeliveryDisplayName(ctx_r1.selectedStock), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.deliveryPhone, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.deliveryAddress, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.deliveryPincode, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(129, 41, ctx_r1.selectedStock.date, \"short\"), \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock.finalAmount, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.odc, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.unloading, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.docket, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.other, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.ccc, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.selectedStock == null ? null : ctx_r1.selectedStock.charges == null ? null : ctx_r1.selectedStock.charges.consignorDiscount, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getInStockAmountTotal(ctx_r1.selectedStock.invoices), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getInvoiceAmountTotal(ctx_r1.selectedStock.invoices), \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.selectedStock.invoices);\n  }\n}\nfunction StocksComponent_div_42_div_24_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const client_r11 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", client_r11.clientName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", client_r11.clientName, \", \", client_r11.address, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"label\");\n    i0.ɵɵtext(2, \"Consignor: \");\n    i0.ɵɵelementStart(3, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_24_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignor, $event) || (ctx_r1.editingStock.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_24_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onConsignorSelect(ctx_r1.editingStock.consignor));\n    });\n    i0.ɵɵtemplate(4, StocksComponent_div_42_div_24_option_4_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"label\");\n    i0.ɵɵtext(6, \"GSTIN: \");\n    i0.ɵɵelementStart(7, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_24_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignorGST, $event) || (ctx_r1.editingStock.consignorGST = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"Address: \");\n    i0.ɵɵelementStart(10, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_24_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignorAddress, $event) || (ctx_r1.editingStock.consignorAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"label\");\n    i0.ɵɵtext(12, \"Phone: \");\n    i0.ɵɵelementStart(13, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_24_Template_input_ngModelChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignorPhone, $event) || (ctx_r1.editingStock.consignorPhone = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignor);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.clientList);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignorGST);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignorAddress);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignorPhone);\n  }\n}\nfunction StocksComponent_div_42_div_25_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const guest_r13 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", guest_r13.guestName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", guest_r13.guestName, \", \", guest_r13.address, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"label\");\n    i0.ɵɵtext(2, \"Guest Name: \");\n    i0.ɵɵelementStart(3, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_25_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignor, $event) || (ctx_r1.editingStock.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_25_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onConsignorGuestSelect(ctx_r1.editingStock.consignor));\n    });\n    i0.ɵɵtemplate(4, StocksComponent_div_42_div_25_option_4_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"label\");\n    i0.ɵɵtext(6, \"Address: \");\n    i0.ɵɵelementStart(7, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_25_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignorAddress, $event) || (ctx_r1.editingStock.consignorAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"Phone: \");\n    i0.ɵɵelementStart(10, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_25_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignorPhone, $event) || (ctx_r1.editingStock.consignorPhone = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignor);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.guestList);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignorAddress);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignorPhone);\n  }\n}\nfunction StocksComponent_div_42_div_34_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const client_r15 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", client_r15.clientName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", client_r15.clientName, \", \", client_r15.address, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"label\");\n    i0.ɵɵtext(2, \"Consignee: \");\n    i0.ɵɵelementStart(3, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_34_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignee, $event) || (ctx_r1.editingStock.consignee = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_34_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onConsigneeSelect(ctx_r1.editingStock.consignee));\n    });\n    i0.ɵɵtemplate(4, StocksComponent_div_42_div_34_option_4_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"label\");\n    i0.ɵɵtext(6, \"GSTIN: \");\n    i0.ɵɵelementStart(7, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_34_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consigneeGST, $event) || (ctx_r1.editingStock.consigneeGST = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"Address: \");\n    i0.ɵɵelementStart(10, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_34_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consigneeAddress, $event) || (ctx_r1.editingStock.consigneeAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"label\");\n    i0.ɵɵtext(12, \"Phone: \");\n    i0.ɵɵelementStart(13, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_34_Template_input_ngModelChange_13_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consigneePhone, $event) || (ctx_r1.editingStock.consigneePhone = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignee);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.clientList);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consigneeGST);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consigneeAddress);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consigneePhone);\n  }\n}\nfunction StocksComponent_div_42_div_35_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const guest_r17 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", guest_r17.guestName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", guest_r17.guestName, \", \", guest_r17.address, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"label\");\n    i0.ɵɵtext(2, \"Guest Name: \");\n    i0.ɵɵelementStart(3, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_35_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consignee, $event) || (ctx_r1.editingStock.consignee = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_35_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onConsigneeGuestSelect(ctx_r1.editingStock.consignee));\n    });\n    i0.ɵɵtemplate(4, StocksComponent_div_42_div_35_option_4_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"label\");\n    i0.ɵɵtext(6, \"Address: \");\n    i0.ɵɵelementStart(7, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_35_Template_input_ngModelChange_7_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consigneeAddress, $event) || (ctx_r1.editingStock.consigneeAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"Phone: \");\n    i0.ɵɵelementStart(10, \"input\", 56);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_35_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.consigneePhone, $event) || (ctx_r1.editingStock.consigneePhone = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consignee);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.guestList);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consigneeAddress);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.consigneePhone);\n  }\n}\nfunction StocksComponent_div_42_div_59_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 42)(1, \"label\");\n    i0.ɵɵtext(2, \"Name: \");\n    i0.ɵɵelementStart(3, \"input\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_59_Template_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.billingName, $event) || (ctx_r1.editingStock.billingName = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"GSTIN: \");\n    i0.ɵɵelementStart(6, \"input\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_59_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.billingGSTIN, $event) || (ctx_r1.editingStock.billingGSTIN = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Address: \");\n    i0.ɵɵelementStart(9, \"textarea\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_59_Template_textarea_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.billingAddress, $event) || (ctx_r1.editingStock.billingAddress = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.billingName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.billingGSTIN);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.billingAddress);\n  }\n}\nfunction StocksComponent_div_42_div_63_div_8_option_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const pkgItem_r24 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", pkgItem_r24.pkgName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(pkgItem_r24.pkgName);\n  }\n}\nfunction StocksComponent_div_42_div_63_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 63)(1, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_div_8_Template_select_ngModelChange_1_listener($event) {\n      const pkg_r23 = i0.ɵɵrestoreView(_r22).$implicit;\n      i0.ɵɵtwoWayBindingSet(pkg_r23.type, $event) || (pkg_r23.type = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_63_div_8_Template_select_change_1_listener() {\n      const pkg_r23 = i0.ɵɵrestoreView(_r22).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onPackageList(pkg_r23.pkgName));\n    });\n    i0.ɵɵtemplate(2, StocksComponent_div_42_div_63_div_8_option_2_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 64);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_div_8_Template_input_ngModelChange_3_listener($event) {\n      const pkg_r23 = i0.ɵɵrestoreView(_r22).$implicit;\n      i0.ɵɵtwoWayBindingSet(pkg_r23.amount, $event) || (pkg_r23.amount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 61);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_div_63_div_8_Template_button_click_4_listener() {\n      const j_r25 = i0.ɵɵrestoreView(_r22).index;\n      const i_r21 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.deletePackage(i_r21, j_r25));\n    });\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const pkg_r23 = ctx.$implicit;\n    const j_r25 = ctx.index;\n    const i_r21 = i0.ɵɵnextContext().index;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", pkg_r23.type);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.pkgList);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", pkg_r23.amount);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"dY-`\\uFFFD,? Delete Package \", i_r21, \"/\", j_r25, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_63_div_13_option_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const productItem_r28 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", productItem_r28.productName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", productItem_r28.hsnNum, \" - \", productItem_r28.productName, \" \");\n  }\n}\nfunction StocksComponent_div_42_div_63_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 63)(1, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_div_13_Template_select_ngModelChange_1_listener($event) {\n      const product_r27 = i0.ɵɵrestoreView(_r26).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r27.type, $event) || (product_r27.type = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_div_63_div_13_Template_select_change_1_listener() {\n      const product_r27 = i0.ɵɵrestoreView(_r26).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onPackageList(product_r27.productName));\n    });\n    i0.ɵɵtemplate(2, StocksComponent_div_42_div_63_div_13_option_2_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 65);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_div_13_Template_input_ngModelChange_3_listener($event) {\n      const product_r27 = i0.ɵɵrestoreView(_r26).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r27.amount, $event) || (product_r27.amount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"focus\", function StocksComponent_div_42_div_63_div_13_Template_input_focus_3_listener() {\n      const product_r27 = i0.ɵɵrestoreView(_r26).$implicit;\n      const ctx_r28 = i0.ɵɵnextContext();\n      const invoice_r20 = ctx_r28.$implicit;\n      const i_r21 = ctx_r28.index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onProductAmountFocus(invoice_r20, product_r27, i_r21));\n    })(\"ngModelChange\", function StocksComponent_div_42_div_63_div_13_Template_input_ngModelChange_3_listener($event) {\n      const product_r27 = i0.ɵɵrestoreView(_r26).$implicit;\n      const ctx_r28 = i0.ɵɵnextContext();\n      const invoice_r20 = ctx_r28.$implicit;\n      const i_r21 = ctx_r28.index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onProductAmountChange(invoice_r20, product_r27, $event, i_r21));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 61);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_div_63_div_13_Template_button_click_4_listener() {\n      const k_r30 = i0.ɵɵrestoreView(_r26).index;\n      const i_r21 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.deleteProduct(i_r21, k_r30));\n    });\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const product_r27 = ctx.$implicit;\n    const k_r30 = ctx.index;\n    const i_r21 = i0.ɵɵnextContext().index;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r27.type);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.productList);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r27.amount);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"dY-`\\uFFFD,? Delete Product \", i_r21, \"/\", k_r30, \"\");\n  }\n}\nfunction StocksComponent_div_42_div_63_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 57)(1, \"div\", 58)(2, \"input\", 59);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_Template_input_ngModelChange_2_listener($event) {\n      const invoice_r20 = i0.ɵɵrestoreView(_r19).$implicit;\n      i0.ɵɵtwoWayBindingSet(invoice_r20.number, $event) || (invoice_r20.number = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 60);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_div_63_Template_input_ngModelChange_3_listener($event) {\n      const invoice_r20 = i0.ɵɵrestoreView(_r19).$implicit;\n      i0.ɵɵtwoWayBindingSet(invoice_r20.value, $event) || (invoice_r20.value = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 61);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_div_63_Template_button_click_4_listener() {\n      const i_r21 = i0.ɵɵrestoreView(_r19).index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.deleteInvoice(i_r21));\n    });\n    i0.ɵɵtext(5, \"Delete Invoice\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"h4\");\n    i0.ɵɵtext(7, \"Packages\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, StocksComponent_div_42_div_63_div_8_Template, 6, 5, \"div\", 62);\n    i0.ɵɵelementStart(9, \"button\", 51);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_div_63_Template_button_click_9_listener() {\n      const i_r21 = i0.ɵɵrestoreView(_r19).index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.addPackage(i_r21));\n    });\n    i0.ɵɵtext(10, \"+ Add Package\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"h4\");\n    i0.ɵɵtext(12, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, StocksComponent_div_42_div_63_div_13_Template, 6, 5, \"div\", 62);\n    i0.ɵɵelementStart(14, \"button\", 51);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_div_63_Template_button_click_14_listener() {\n      const i_r21 = i0.ɵɵrestoreView(_r19).index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.addProduct(i_r21));\n    });\n    i0.ɵɵtext(15, \"+ Add Product\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const invoice_r20 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", invoice_r20.number);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", invoice_r20.value);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r20.packages);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r20.products);\n  }\n}\nfunction StocksComponent_div_42_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 37)(1, \"div\", 38)(2, \"div\", 39)(3, \"div\")(4, \"h3\");\n    i0.ɵɵtext(5, \"Edit Stock\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 40);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(8, \"div\", 41)(9, \"div\", 42)(10, \"label\");\n    i0.ɵɵtext(11, \"E-way Bill No: \");\n    i0.ɵɵelementStart(12, \"input\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.ewaybillNumber, $event) || (ctx_r1.editingStock.ewaybillNumber = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"label\");\n    i0.ɵɵtext(14, \"Date: \");\n    i0.ɵɵelementStart(15, \"input\", 43);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.date, $event) || (ctx_r1.editingStock.date = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(16, \"div\", 41)(17, \"h4\");\n    i0.ɵɵtext(18, \"Consignor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 44)(20, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_20_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.editingStock.consignorTab = \"consignor\");\n    });\n    i0.ɵɵtext(21, \"Consignor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_22_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.editingStock.consignorTab = \"guest\");\n    });\n    i0.ɵɵtext(23, \"Guest\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(24, StocksComponent_div_42_div_24_Template, 14, 5, \"div\", 45)(25, StocksComponent_div_42_div_25_Template, 11, 4, \"div\", 45);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 41)(27, \"h4\");\n    i0.ɵɵtext(28, \"Consignee\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 44)(30, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_30_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.editingStock.consigneeTab = \"consignee\");\n    });\n    i0.ɵɵtext(31, \"Consignee\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_32_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.editingStock.consigneeTab = \"guest\");\n    });\n    i0.ɵɵtext(33, \"Guest\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(34, StocksComponent_div_42_div_34_Template, 14, 5, \"div\", 45)(35, StocksComponent_div_42_div_35_Template, 11, 4, \"div\", 45);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 41)(37, \"div\", 42)(38, \"label\");\n    i0.ɵɵtext(39, \"Payment Mode: \");\n    i0.ɵɵelementStart(40, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_select_ngModelChange_40_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.paymentMode, $event) || (ctx_r1.editingStock.paymentMode = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_42_Template_select_change_40_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onEditingPaymentModeChange());\n    });\n    i0.ɵɵelementStart(41, \"option\");\n    i0.ɵɵtext(42, \"Account Credit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"option\");\n    i0.ɵɵtext(44, \"Paid\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(45, \"option\");\n    i0.ɵɵtext(46, \"To Pay\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(47, \"label\");\n    i0.ɵɵtext(48, \"External Ref ID: \");\n    i0.ɵɵelementStart(49, \"input\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_49_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.externalRefId, $event) || (ctx_r1.editingStock.externalRefId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(50, \"h4\");\n    i0.ɵɵtext(51, \"Billing Type\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(52, \"div\", 47)(53, \"label\")(54, \"input\", 48);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_54_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.billingType, $event) || (ctx_r1.editingStock.billingType = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(55, \" Consignor's GST Address\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(56, \"label\")(57, \"input\", 49);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_57_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.billingType, $event) || (ctx_r1.editingStock.billingType = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(58, \" Different Address\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(59, StocksComponent_div_42_div_59_Template, 10, 3, \"div\", 45);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(60, \"section\", 41)(61, \"h3\");\n    i0.ɵɵtext(62, \"4. Invoice\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(63, StocksComponent_div_42_div_63_Template, 16, 4, \"div\", 50);\n    i0.ɵɵelementStart(64, \"button\", 51);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_64_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addInvoice());\n    });\n    i0.ɵɵtext(65, \"+ Add Invoice\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(66, \"div\", 41)(67, \"h4\");\n    i0.ɵɵtext(68, \"Charges\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(69, \"div\", 42)(70, \"label\");\n    i0.ɵɵtext(71, \"ODC: \");\n    i0.ɵɵelementStart(72, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_72_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.charges.odc, $event) || (ctx_r1.editingStock.charges.odc = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(73, \"label\");\n    i0.ɵɵtext(74, \"Unloading: \");\n    i0.ɵɵelementStart(75, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_75_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.charges.unloading, $event) || (ctx_r1.editingStock.charges.unloading = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(76, \"label\");\n    i0.ɵɵtext(77, \"Docket: \");\n    i0.ɵɵelementStart(78, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_78_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.charges.docket, $event) || (ctx_r1.editingStock.charges.docket = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(79, \"label\");\n    i0.ɵɵtext(80, \"Other: \");\n    i0.ɵɵelementStart(81, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_81_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.charges.other, $event) || (ctx_r1.editingStock.charges.other = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(82, \"label\");\n    i0.ɵɵtext(83, \"CCC: \");\n    i0.ɵɵelementStart(84, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_84_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.charges.ccc, $event) || (ctx_r1.editingStock.charges.ccc = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(85, \"label\");\n    i0.ɵɵtext(86, \"Final Amount: \");\n    i0.ɵɵelementStart(87, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_42_Template_input_ngModelChange_87_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.editingStock.finalAmount, $event) || (ctx_r1.editingStock.finalAmount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(88, \"div\", 53)(89, \"button\", 54);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_89_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.calculateFinalAmount());\n    });\n    i0.ɵɵtext(90, \"Calculate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(91, \"button\", 55);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_91_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveStockEdit());\n    });\n    i0.ɵɵtext(92, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(93, \"button\", 54);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_42_Template_button_click_93_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.cancelEdit());\n    });\n    i0.ɵɵtext(94, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate2(\"Consignment No: \", ctx_r1.editingStock.consignmentNumber, \" | Status: \", ctx_r1.editingStock.shipmentStatus, \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.ewaybillNumber);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.date);\n    i0.ɵɵadvance(5);\n    i0.ɵɵclassProp(\"active\", ctx_r1.editingStock.consignorTab === \"consignor\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r1.editingStock.consignorTab === \"guest\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editingStock.consignorTab === \"consignor\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editingStock.consignorTab === \"guest\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵclassProp(\"active\", ctx_r1.editingStock.consigneeTab === \"consignee\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r1.editingStock.consigneeTab === \"guest\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editingStock.consigneeTab === \"consignee\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editingStock.consigneeTab === \"guest\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.paymentMode);\n    i0.ɵɵadvance(9);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.externalRefId);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.billingType);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.billingType);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editingStock.billingType === \"different\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.editingStock.invoices);\n    i0.ɵɵadvance(9);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.charges.odc);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.charges.unloading);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.charges.docket);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.charges.other);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.charges.ccc);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.editingStock.finalAmount);\n  }\n}\nfunction StocksComponent_div_43_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r32 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Consignment:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\")(6, \"strong\");\n    i0.ɵɵtext(7, \"Product:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\")(10, \"strong\");\n    i0.ɵɵtext(11, \"New Total Qty:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"p\")(14, \"strong\");\n    i0.ɵɵtext(15, \"In Stock Qty:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"input\", 71);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_43_div_4_Template_input_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.pendingManifestAdjustment.popupInstock, $event) || (ctx_r1.pendingManifestAdjustment.popupInstock = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function StocksComponent_div_43_div_4_Template_input_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r32);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onPopupInstockChange($event));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.pendingManifestAdjustment.consignmentNumber, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.pendingManifestAdjustment.productType, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getPopupTargetTotal(), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.pendingManifestAdjustment.popupInstock);\n  }\n}\nfunction StocksComponent_div_43_table_5_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\")(9, \"input\", 71);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_43_table_5_tr_12_Template_input_ngModelChange_9_listener($event) {\n      const line_r34 = i0.ɵɵrestoreView(_r33).$implicit;\n      i0.ɵɵtwoWayBindingSet(line_r34.newManifestQty, $event) || (line_r34.newManifestQty = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function StocksComponent_div_43_table_5_tr_12_Template_input_ngModelChange_9_listener() {\n      const line_r34 = i0.ɵɵrestoreView(_r33).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onManifestQtyChange(line_r34));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const line_r34 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(line_r34.manifestationNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 4, line_r34.date, \"short\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(line_r34.invoiceNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", line_r34.newManifestQty);\n  }\n}\nfunction StocksComponent_div_43_table_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 12)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Manifest No.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Invoice\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Qty\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"tbody\");\n    i0.ɵɵtemplate(12, StocksComponent_div_43_table_5_tr_12_Template, 10, 7, \"tr\", 34);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.manifestAdjustmentLines);\n  }\n}\nfunction StocksComponent_div_43_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r31 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 66)(1, \"div\", 67)(2, \"h3\");\n    i0.ɵɵtext(3, \"Adjust Manifest Quantities\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, StocksComponent_div_43_div_4_Template, 17, 4, \"div\", 68)(5, StocksComponent_div_43_table_5_Template, 13, 1, \"table\", 69);\n    i0.ɵɵelementStart(6, \"p\")(7, \"strong\");\n    i0.ɵɵtext(8, \"Manifest Total:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9);\n    i0.ɵɵelementStart(10, \"strong\");\n    i0.ɵɵtext(11, \"Delivered Total:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 70)(14, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_43_Template_button_click_14_listener() {\n      i0.ɵɵrestoreView(_r31);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.applyManifestAdjustments());\n    });\n    i0.ɵɵtext(15, \"Apply\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_43_Template_button_click_16_listener() {\n      i0.ɵɵrestoreView(_r31);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.cancelManifestAdjustments());\n    });\n    i0.ɵɵtext(17, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.pendingManifestAdjustment);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.manifestAdjustmentLines.length > 0);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getManifestLineTotal(), \" | \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getPopupDeliveredTotal(), \"\");\n  }\n}\nfunction StocksComponent_div_44_option_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const status_r36 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", status_r36);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(status_r36);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r38 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 82)(1, \"label\", 83)(2, \"input\", 84);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_2_div_3_Template_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r38);\n      const consignment_r39 = i0.ɵɵnextContext().$implicit;\n      i0.ɵɵtwoWayBindingSet(consignment_r39.hubWillPickedUp, $event) || (consignment_r39.hubWillPickedUp = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_2_div_3_Template_input_change_2_listener() {\n      i0.ɵɵrestoreView(_r38);\n      const consignment_r39 = i0.ɵɵnextContext().$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onHubPickedUpToggle(consignment_r39));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"span\");\n    i0.ɵɵtext(4, \"Will picked-up from the location\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"div\", 85)(6, \"label\");\n    i0.ɵɵtext(7, \" Hub charge \");\n    i0.ɵɵelementStart(8, \"input\", 86);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_2_div_3_Template_input_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r38);\n      const consignment_r39 = i0.ɵɵnextContext().$implicit;\n      i0.ɵɵtwoWayBindingSet(consignment_r39.hubPerRevAmount, $event) || (consignment_r39.hubPerRevAmount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"span\", 87);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const consignment_r39 = i0.ɵɵnextContext().$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", consignment_r39.hubWillPickedUp);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", consignment_r39.hubPerRevAmount);\n    i0.ɵɵproperty(\"disabled\", consignment_r39.hubWillPickedUp);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Suggested: \", ctx_r1.getHubChargeSuggestion(consignment_r39), \"\");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r40 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"label\", 88)(2, \"input\", 89);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_2_ng_container_5_Template_input_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r40);\n      const consignment_r39 = i0.ɵɵnextContext().$implicit;\n      i0.ɵɵtwoWayBindingSet(consignment_r39.ewayBillRequired, $event) || (consignment_r39.ewayBillRequired = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"span\", 90);\n    i0.ɵɵelementStart(4, \"span\", 91);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const consignment_r39 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", consignment_r39.ewayBillRequired);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", consignment_r39.ewayBillRequired ? \"Eway Bill will be created\" : \"Eway Bill not required\", \" \");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\")(1, \"strong\");\n    i0.ɵɵtext(2, \"Customer created Eway Bill No:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const consignment_r39 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", consignment_r39.ewaybillNumber, \"\");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_li_13_li_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r41 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\")(1, \"div\", 92)(2, \"span\")(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"span\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"span\")(8, \"input\", 93);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_2_li_13_li_5_Template_input_ngModelChange_8_listener($event) {\n      const product_r42 = i0.ɵɵrestoreView(_r41).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r42.manifestQty, $event) || (product_r42.manifestQty = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const product_r42 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(product_r42.type);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Total: \", product_r42.amount, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"max\", product_r42.instock);\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r42.manifestQty);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_li_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\")(1, \"strong\");\n    i0.ɵɵtext(2, \"Invoice:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementStart(4, \"ul\");\n    i0.ɵɵtemplate(5, StocksComponent_div_44_div_12_div_2_li_13_li_5_Template, 9, 4, \"li\", 34);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const invoice_r43 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", invoice_r43.number, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r43.products);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 79)(1, \"h4\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, StocksComponent_div_44_div_12_div_2_div_3_Template, 11, 4, \"div\", 80);\n    i0.ɵɵelementStart(4, \"div\", 81);\n    i0.ɵɵtemplate(5, StocksComponent_div_44_div_12_div_2_ng_container_5_Template, 6, 2, \"ng-container\", 76)(6, StocksComponent_div_44_div_12_div_2_ng_template_6_Template, 4, 1, \"ng-template\", null, 1, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\")(9, \"strong\");\n    i0.ɵɵtext(10, \"Consignor:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"ul\");\n    i0.ɵɵtemplate(13, StocksComponent_div_44_div_12_div_2_li_13_Template, 6, 2, \"li\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"hr\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const consignment_r39 = ctx.$implicit;\n    const showEwaybill_r44 = i0.ɵɵreference(7);\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Consignment: \", consignment_r39.consignmentNumber, \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.isSelectedNextDeliveryPointHub());\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", consignment_r39.ewaybillNumber === \"\")(\"ngIfElse\", showEwaybill_r44);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" \", consignment_r39.consignor, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", consignment_r39.invoices);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_ng_container_10_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const v_r47 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", v_r47);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(v_r47);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_ng_container_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r46 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"select\", 101)(2, \"option\", 102);\n    i0.ɵɵtext(3, \"Select transport partner\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_3_ng_container_10_Template_select_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r46);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedRouteVehicle, $event) || (ctx_r1.selectedRouteVehicle = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_3_ng_container_10_Template_select_change_4_listener() {\n      i0.ɵɵrestoreView(_r46);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.onRouteVehicleChange());\n    });\n    i0.ɵɵelementStart(5, \"option\", 102);\n    i0.ɵɵtext(6, \"Select Vehicle\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, StocksComponent_div_44_div_12_div_3_ng_container_10_option_7_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedRouteVehicle);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getBranchVehicles());\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_ng_template_11_option_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r49 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", p_r49._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(p_r49.partnerName);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_ng_template_11_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const v_r50 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", v_r50);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(v_r50);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_ng_template_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r48 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_3_ng_template_11_Template_select_ngModelChange_0_listener($event) {\n      i0.ɵɵrestoreView(_r48);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedTransportPartnerId, $event) || (ctx_r1.selectedTransportPartnerId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_3_ng_template_11_Template_select_change_0_listener() {\n      i0.ɵɵrestoreView(_r48);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.onTransportPartnerChange());\n    });\n    i0.ɵɵelementStart(1, \"option\", 102);\n    i0.ɵɵtext(2, \"Select transport partner\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, StocksComponent_div_44_div_12_div_3_ng_template_11_option_3_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_3_ng_template_11_Template_select_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r48);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedRouteVehicle, $event) || (ctx_r1.selectedRouteVehicle = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_3_ng_template_11_Template_select_change_4_listener() {\n      i0.ɵɵrestoreView(_r48);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.onRouteVehicleChange());\n    });\n    i0.ɵɵelementStart(5, \"option\", 102);\n    i0.ɵɵtext(6, \"Select Vehicle\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, StocksComponent_div_44_div_12_div_3_ng_template_11_option_7_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedTransportPartnerId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.transportPartners);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedRouteVehicle);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getTransportPartnerVehicles());\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_label_13_option_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const point_r52 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", point_r52.name);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", point_r52.name, \" (\", point_r52.type, \") \");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_label_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r51 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\");\n    i0.ɵɵtext(1, \" Next delivery point \");\n    i0.ɵɵelementStart(2, \"select\", 46);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_3_label_13_Template_select_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r51);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedNextDeliveryPoint, $event) || (ctx_r1.selectedNextDeliveryPoint = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_3_label_13_Template_select_change_2_listener() {\n      i0.ɵɵrestoreView(_r51);\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.onNextDeliveryPointChange());\n    });\n    i0.ɵɵelementStart(3, \"option\", 102);\n    i0.ɵɵtext(4, \"Select next point\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, StocksComponent_div_44_div_12_div_3_label_13_option_5_Template, 2, 3, \"option\", 19);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedNextDeliveryPoint);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.availableRoutePoints);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 103);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Hub charge total: \", ctx_r1.getHubChargeTotal(), \" \");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_li_16_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const point_r54 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"- \", point_r54.vehicleNo, \"\");\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_li_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r53 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵtemplate(2, StocksComponent_div_44_div_12_div_3_li_16_span_2_Template, 2, 1, \"span\", 68);\n    i0.ɵɵelementStart(3, \"button\", 104);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_44_div_12_div_3_li_16_Template_button_click_3_listener() {\n      const i_r55 = i0.ɵɵrestoreView(_r53).index;\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.removeRoutePoint(i_r55));\n    });\n    i0.ɵɵtext(4, \"x\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const point_r54 = ctx.$implicit;\n    const i_r55 = ctx.index;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", i_r55 + 1, \". \", point_r54.name, \" (\", point_r54.type, \") \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", point_r54.vehicleNo);\n  }\n}\nfunction StocksComponent_div_44_div_12_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r45 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 94)(1, \"div\", 95)(2, \"h3\");\n    i0.ɵɵtext(3, \"Transportation Vehicle\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"label\", 96)(5, \"input\", 97);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_div_12_div_3_Template_input_ngModelChange_5_listener($event) {\n      i0.ɵɵrestoreView(_r45);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.isExternalTransport, $event) || (ctx_r1.isExternalTransport = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function StocksComponent_div_44_div_12_div_3_Template_input_change_5_listener() {\n      i0.ɵɵrestoreView(_r45);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onExternalTransportToggle());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"span\", 90);\n    i0.ɵɵelementStart(7, \"span\", 91);\n    i0.ɵɵtext(8, \"External\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(9, \"div\", 98);\n    i0.ɵɵtemplate(10, StocksComponent_div_44_div_12_div_3_ng_container_10_Template, 8, 2, \"ng-container\", 76)(11, StocksComponent_div_44_div_12_div_3_ng_template_11_Template, 8, 4, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor)(13, StocksComponent_div_44_div_12_div_3_label_13_Template, 6, 2, \"label\", 68)(14, StocksComponent_div_44_div_12_div_3_div_14_Template, 2, 1, \"div\", 99);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"ul\", 100);\n    i0.ɵɵtemplate(16, StocksComponent_div_44_div_12_div_3_li_16_Template, 5, 4, \"li\", 34);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const externalTransport_r56 = i0.ɵɵreference(12);\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.isExternalTransport);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.isExternalTransport)(\"ngIfElse\", externalTransport_r56);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.manifestationStatus === \"Manifestation\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.manifestationStatus === \"Manifestation\" && ctx_r1.isSelectedNextDeliveryPointHub());\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.shipmentRoute);\n  }\n}\nfunction StocksComponent_div_44_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r37 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"hr\");\n    i0.ɵɵtemplate(2, StocksComponent_div_44_div_12_div_2_Template, 15, 6, \"div\", 77)(3, StocksComponent_div_44_div_12_div_3_Template, 17, 6, \"div\", 78);\n    i0.ɵɵelementStart(4, \"div\", 70)(5, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_44_div_12_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r37);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.finalizeManifestation());\n    });\n    i0.ɵɵtext(6, \"Manifest\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_44_div_12_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r37);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.closeManifestationPopup());\n    });\n    i0.ɵɵtext(8, \"Cancel\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.selectedForManifestation);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.manifestationStatus !== \"Will be Picked-Up\");\n  }\n}\nfunction StocksComponent_div_44_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r57 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"No consignments selected for manifestation.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"button\", 5);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_44_ng_template_13_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r57);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.closeManifestationPopup());\n    });\n    i0.ɵɵtext(3, \"Close\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction StocksComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r35 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 66)(1, \"div\", 72)(2, \"span\", 73);\n    i0.ɵɵlistener(\"click\", function StocksComponent_div_44_Template_span_click_2_listener() {\n      i0.ɵɵrestoreView(_r35);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeManifestationPopup());\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 74)(5, \"h2\");\n    i0.ɵɵtext(6, \"Manifestation Terminal\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\", 75)(8, \"span\");\n    i0.ɵɵtext(9, \"Status\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"select\", 18);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_div_44_Template_select_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r35);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.manifestationStatus, $event) || (ctx_r1.manifestationStatus = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵtemplate(11, StocksComponent_div_44_option_11_Template, 2, 2, \"option\", 19);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(12, StocksComponent_div_44_div_12_Template, 9, 2, \"div\", 76)(13, StocksComponent_div_44_ng_template_13_Template, 4, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const noSelection_r58 = i0.ɵɵreference(14);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.manifestationStatus);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.manifestationStatusOptions);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.selectedForManifestation.length > 0)(\"ngIfElse\", noSelection_r58);\n  }\n}\nexport let StocksComponent = /*#__PURE__*/(() => {\n  class StocksComponent {\n    constructor(http, branchService) {\n      this.http = http;\n      this.branchService = branchService;\n      this.allStocks = [];\n      this.stocks = [];\n      this.filteredStocks = [];\n      this.activeTab = 'stocks';\n      this.searchText = '';\n      this.filterDate = '';\n      this.filterConsignor = '';\n      this.selectedHubFilterId = null;\n      this.selectedHubFilterName = '';\n      this.selectedStock = null;\n      this.editingStock = null; // track which stock is being edited\n      // Billing\n      this.billingType = 'consignor';\n      this.billingName = '';\n      this.billingAddress = '';\n      this.billingGSTIN = '';\n      this.billingPhone = '';\n      this.clientList = [];\n      this.guestList = [];\n      this.pkgList = [];\n      this.productList = [];\n      this.transportPartners = [];\n      this.selectedTransportPartnerId = '';\n      // Pickup\n      this.pickupType = 'consignor';\n      this.pickupName = '';\n      this.pickupAddress = '';\n      this.pickupPhone = '';\n      // Delivery\n      this.deliveryType = 'consignee';\n      this.deliveryName = '';\n      this.deliveryAddress = '';\n      this.deliveryPhone = '';\n      this.consignorTab = 'consignor';\n      this.consigneeTab = 'consignee';\n      this.email = '';\n      this.username = '';\n      this.isAdmin = String(localStorage.getItem('role') || '').toLowerCase() === 'admin';\n      this.branch = localStorage.getItem('branch') || 'All Branches';\n      this.branchId = localStorage.getItem('branchId') || 'all';\n      this.consignmentNumber = localStorage.getItem('consignmentNumber') || '-999'; // will be loaded asynchronously\n      this.date = new Date().toISOString().split('T')[0];\n      this.ewaybillNumber = '';\n      this.consignor = '';\n      this.consignorGST = '';\n      this.consignorAddress = '';\n      this.consignorPhone = '';\n      this.consignee = '';\n      this.consigneeGST = '';\n      this.consigneeAddress = '';\n      this.consigneePhone = '';\n      this.paymentMode = 'Account Credit';\n      this.externalRefId = '';\n      this.invoices = [{\n        number: '',\n        value: 0\n      }];\n      this.packages = [{\n        type: '',\n        amount: 1\n      }];\n      this.products = [{\n        type: '',\n        amount: 1\n      }];\n      this.charges = {\n        odc: 0,\n        unloading: 0,\n        docket: 0,\n        other: 0,\n        ccc: 0\n      };\n      this.finalAmount = 0;\n      this.shipmentStatus = 'Pending';\n      this.shipmentStatusDetails = '';\n      this.manifestationStatusOptions = ['Manifestation', 'Out for Delivery', 'Will be Picked-Up'];\n      this.manifestationStatus = 'Manifestation';\n      this.isExternalTransport = false;\n      this.branches = [];\n      this.hubs = [];\n      this.availableRoutePoints = [];\n      this.shipmentRoute = [];\n      this.selectedRoutePoint = null;\n      this.selectedRouteVehicle = '';\n      this.selectedNextDeliveryPoint = '';\n      this.routeBaskets = [];\n      this.onStorageChange = e => {\n        if (e.key === 'branch' || e.key === 'branchId') {\n          const current = localStorage.getItem('branch') || 'All Branches';\n          const currentId = localStorage.getItem('branchId') || 'all';\n          if (current !== this.branch || currentId !== this.branchId) {\n            this.branch = current;\n            this.branchId = currentId;\n            if (this.branchId !== 'all-hubs') {\n              this.selectedHubFilterId = null;\n              this.selectedHubFilterName = '';\n            }\n            this.loadStocks();\n          }\n        }\n      };\n      this.showManifestAdjustmentPopup = false;\n      this.pendingManifestAdjustment = null;\n      this.manifestAdjustments = [];\n      this.manifestAdjustmentLines = [];\n      this.manifestEditsById = {};\n      this.showManifestationPopup = false;\n      this.selectedForManifestation = [];\n      this.manifestationNumber = '';\n    }\n    // --- Methods ---\n    addInvoice() {\n      this.editingStock.invoices.push({\n        number: '',\n        value: 0,\n        packages: [],\n        products: []\n      });\n    }\n    deleteInvoice(index) {\n      this.editingStock.invoices.splice(index, 1);\n    }\n    addPackage(invoiceIndex) {\n      const invoice = this.editingStock.invoices[invoiceIndex];\n      if (!invoice.packages) {\n        invoice.packages = [];\n      }\n      invoice.packages.push({\n        type: '',\n        amount: 1\n      });\n    }\n    deletePackage(invoiceIndex, packageIndex) {\n      const invoice = this.editingStock.invoices[invoiceIndex];\n      if (invoice.packages && invoice.packages.length > packageIndex) {\n        invoice.packages.splice(packageIndex, 1);\n      }\n    }\n    addProduct(invoiceIndex) {\n      const invoice = this.editingStock.invoices[invoiceIndex];\n      if (!invoice.products) {\n        invoice.products = [];\n      }\n      invoice.products.push({\n        type: '',\n        amount: 1,\n        instock: 0,\n        intransitstock: 0,\n        deliveredstock: 0\n      });\n    }\n    deleteProduct(invoiceIndex, productIndex) {\n      const invoice = this.editingStock.invoices[invoiceIndex];\n      if (invoice.products && invoice.products.length > productIndex) {\n        const product = invoice.products[productIndex];\n        if (this.isProductManifested(product)) {\n          alert('This product has been manifested and cannot be deleted.');\n          return;\n        }\n        invoice.products.splice(productIndex, 1);\n      }\n    }\n    calculateFinalAmount() {\n      const invoiceTotal = this.editingStock.invoices.reduce((sum, i) => sum + (i.value || 0), 0);\n      const packageTotal = this.editingStock.packages.reduce((sum, p) => sum + (p.amount || 0), 0);\n      const chargeTotal = Object.values(this.charges).reduce((sum, c) => sum + (Number(c) || 0), 0);\n      this.editingStock.finalAmount = invoiceTotal + packageTotal + chargeTotal;\n    }\n    loadStocks() {\n      const username = this.username || localStorage.getItem('username') || '';\n      const branchId = this.branchId || localStorage.getItem('branchId') || 'all';\n      if (!username) {\n        console.error('Missing username for loading stocks');\n        return;\n      }\n      const branchParamRaw = this.activeTab === 'stocks' ? branchId : 'all';\n      const branchParam = branchParamRaw === 'all-hubs' ? 'all' : branchParamRaw;\n      this.http.get('http://localhost:3000/api/newshipments', {\n        params: {\n          username,\n          branchId: branchParam\n        }\n      }).subscribe({\n        next: res => {\n          console.log('[stocks][load]', {\n            branchId,\n            branchParam,\n            activeTab: this.activeTab,\n            count: Array.isArray(res) ? res.length : 0\n          });\n          const normalized = (res || []).map(stock => ({\n            ...stock,\n            branch: stock.branch || stock.branchName || '',\n            invoices: this.flattenInvoices(stock.ewaybills || stock.invoices || [])\n          }));\n          this.allStocks = normalized;\n          this.refreshStocksView();\n        },\n        error: err => console.error('Error loading shipments:', err)\n      });\n    }\n    flattenInvoices(ewaybills) {\n      return (ewaybills || []).flatMap(ewb => ewb.invoices || []);\n    }\n    getInStockAmountTotal(invoices) {\n      let total = 0;\n      (invoices || []).forEach(inv => {\n        (inv.products || []).forEach(prod => {\n          total += Number(prod.instock || 0);\n        });\n      });\n      return total;\n    }\n    getInvoiceAmountTotal(invoices) {\n      let total = 0;\n      (invoices || []).forEach(inv => {\n        (inv.products || []).forEach(prod => {\n          total += Number(prod.amount || 0);\n        });\n      });\n      return total;\n    }\n    getProductTotal(ewaybills, field) {\n      let total = 0;\n      ewaybills.forEach(ewaybill => {\n        ewaybill.invoices.forEach(invoice => {\n          invoice.products.forEach(product => {\n            total += product[field] || 0;\n          });\n        });\n      });\n      return total;\n    }\n    isDeliveryStatus(status) {\n      return status === 'DPending' || status === 'DManifestation' || status === 'D-Out for Delivery' || status === 'D-Will be Picked-Up';\n    }\n    isDeliveryStatusForOthers(status) {\n      return status === 'DPending' || status === 'DManifestation' || status === 'D-Out for Delivery' || status === 'D-Will be Picked-Up';\n    }\n    isCompanyMatch(stock) {\n      const gstinId = String(localStorage.getItem('GSTIN_ID') || '').trim();\n      if (!gstinId) return true;\n      const stockGstin = String(stock?.GSTIN_ID ?? stock?.gstinId ?? '').trim();\n      if (!stockGstin) return false;\n      return stockGstin === gstinId;\n    }\n    getBaseStocks() {\n      const branchId = this.branchId || localStorage.getItem('branchId') || 'all';\n      if (this.activeTab === 'other-branch') {\n        if (!branchId || branchId === 'all') return [];\n        if (branchId === 'all-hubs') {\n          return (this.allStocks || []).filter(stock => {\n            const status = String(stock.shipmentStatus || '').trim();\n            if (status !== 'DPending') return false;\n            const originBranchId = this.normalizeId(stock.branchId) || this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n            const currentBranchId = this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n            return originBranchId && currentBranchId && originBranchId !== currentBranchId && this.isHubLinkedToAssignedBranch(originBranchId);\n          });\n        }\n        return (this.allStocks || []).filter(stock => {\n          const status = String(stock.shipmentStatus || '').trim();\n          if (status !== 'DPending') return false;\n          const selectedBranchId = this.normalizeId(branchId);\n          const originBranchId = this.normalizeId(stock.branchId);\n          const currentBranchId = this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n          return originBranchId && selectedBranchId && originBranchId === selectedBranchId && originBranchId !== currentBranchId;\n        });\n      }\n      if (this.activeTab === 'others-in-branch') {\n        if (!branchId || branchId === 'all') return [];\n        if (branchId === 'all-hubs') {\n          return (this.allStocks || []).filter(stock => {\n            const status = String(stock.shipmentStatus || '').trim();\n            if (status !== 'DPending') return false;\n            const currentBranchId = this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n            const originBranchId = this.normalizeId(stock.branchId) || this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n            const selectedHubId = this.normalizeId(this.selectedHubFilterId);\n            const selectedHubName = selectedHubId ? String((this.hubs || []).find(h => this.normalizeId(h?._id) === selectedHubId)?.hubName || '').trim() : '';\n            const currentBranchLabel = String(stock.currentBranch || '').trim();\n            const matchesSelectedHub = Boolean(selectedHubId) && (currentBranchId === selectedHubId || String(currentBranchLabel).toLowerCase() === String(selectedHubName).toLowerCase() || this.matchesBranchLabel(currentBranchLabel, selectedHubName));\n            return selectedHubId && originBranchId && originBranchId !== selectedHubId && matchesSelectedHub;\n          });\n        }\n        return (this.allStocks || []).filter(stock => {\n          const currentBranchId = this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n          const originBranchId = this.normalizeId(stock.branchId);\n          const status = String(stock.shipmentStatus || '').trim();\n          if (status !== 'DPending') return false;\n          const selectedBranchId = this.normalizeId(branchId);\n          return currentBranchId && selectedBranchId && currentBranchId === selectedBranchId && originBranchId && originBranchId !== currentBranchId;\n        });\n      }\n      return (this.allStocks || []).filter(stock => {\n        const status = String(stock.shipmentStatus || '').trim();\n        if (status !== 'Pending') return false;\n        if (!branchId || branchId === 'all') {\n          return true;\n        }\n        if (branchId === 'all-hubs') {\n          const hubId = this.normalizeId(stock.branchId) || this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n          return this.isHubLinkedToAssignedBranch(hubId);\n        }\n        const currentBranchId = this.normalizeId(stock.currentLocationId || stock.currentBranchId || stock.currentBranch);\n        const selectedBranchId = this.normalizeId(branchId);\n        return currentBranchId && selectedBranchId && currentBranchId === selectedBranchId;\n      });\n    }\n    refreshStocksView() {\n      this.stocks = this.getBaseStocks().sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n      this.applyFilters();\n    }\n    setActiveTab(tab) {\n      if (this.activeTab === tab) return;\n      this.activeTab = tab;\n      this.loadStocks();\n    }\n    applyFilters() {\n      const branchId = this.branchId || localStorage.getItem('branchId') || 'all';\n      const hubFilterId = this.normalizeId(this.selectedHubFilterId);\n      const useHubFilter = branchId === 'all-hubs';\n      if (useHubFilter && !hubFilterId) {\n        const storedHubId = this.normalizeId(localStorage.getItem('hubId'));\n        const storedHubName = String(localStorage.getItem('hubName') || '').trim();\n        if (storedHubId) {\n          const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === storedHubId);\n          this.selectedHubFilterId = storedHubId;\n          this.selectedHubFilterName = String(hub?.hubName || storedHubName || '').trim();\n        } else {\n          const options = this.getAllHubsFilterOptions();\n          const firstHubId = this.normalizeId(options?.[0]?._id);\n          this.selectedHubFilterId = firstHubId || null;\n          this.selectedHubFilterName = String(options?.[0]?.hubName || '').trim();\n        }\n      }\n      const effectiveHubFilterId = this.normalizeId(this.selectedHubFilterId);\n      if (effectiveHubFilterId && !this.selectedHubFilterName) {\n        const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === effectiveHubFilterId);\n        this.selectedHubFilterName = String(hub?.hubName || '').trim();\n      }\n      const effectiveHubName = this.selectedHubFilterName;\n      this.filteredStocks = this.stocks.filter(s => (this.searchText ? s.consignmentNumber?.includes(this.searchText) || s.consignor?.includes(this.searchText) : true) && (this.filterDate ? new Date(s.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true) && (!useHubFilter || effectiveHubFilterId && this.matchesHubFilter(s, effectiveHubFilterId, effectiveHubName)));\n    }\n    onHubFilterChange(value) {\n      this.selectedHubFilterId = value;\n      const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === this.normalizeId(value));\n      this.selectedHubFilterName = String(hub?.hubName || '').trim();\n      if (value) {\n        localStorage.setItem('hubId', String(value));\n        localStorage.setItem('hubName', this.selectedHubFilterName);\n      }\n      this.refreshStocksView();\n    }\n    matchesHubFilter(stock, hubId, hubName) {\n      if (!hubId) return false;\n      const hasHubName = Boolean(hubName);\n      if (this.activeTab === 'others-in-branch') {\n        const currentBranchId = this.normalizeId(stock?.currentLocationId || stock?.currentBranchId || stock?.currentBranch);\n        const currentBranchLabel = String(stock?.currentBranch || '').trim();\n        return currentBranchId === hubId || hasHubName && currentBranchLabel.toLowerCase() === hubName.toLowerCase() || hasHubName && this.matchesBranchLabel(currentBranchLabel, hubName);\n      }\n      return this.getStockHubId(stock) === hubId;\n    }\n    getAllHubsFilterOptions() {\n      if (this.isAdmin) return this.hubs || [];\n      return (this.hubs || []).filter(h => this.isHubLinkedToAssignedBranch(this.normalizeId(h?._id)));\n    }\n    getStockHubId(stock) {\n      return this.normalizeId(stock?.branchId) || this.normalizeId(stock?.currentLocationId || stock?.currentBranchId || stock?.currentBranch);\n    }\n    getStockCurrentHubId(stock) {\n      const currentBranchId = this.normalizeId(stock?.currentLocationId || stock?.currentBranchId || stock?.currentBranch);\n      if (!currentBranchId) return '';\n      const hubById = (this.hubs || []).find(h => this.normalizeId(h?._id) === currentBranchId);\n      if (hubById?._id) return this.normalizeId(hubById._id);\n      const currentName = String(stock?.currentBranch || '').trim().toLowerCase();\n      if (!currentName) return '';\n      const hubByName = (this.hubs || []).find(h => String(h?.hubName || '').trim().toLowerCase() === currentName);\n      return hubByName?._id ? this.normalizeId(hubByName._id) : '';\n    }\n    normalizeId(value) {\n      if (!value) return '';\n      if (typeof value === 'string') return value;\n      if (value?._id) return String(value._id);\n      if (value?.$oid) return String(value.$oid);\n      return String(value);\n    }\n    getBranchIdByName(name) {\n      const target = String(name || '').trim().toLowerCase();\n      if (!target) return '';\n      const branch = (this.branches || []).find(b => String(b?.branchName || '').trim().toLowerCase() === target);\n      return branch?._id ? String(branch._id) : '';\n    }\n    getBranchNameById(id) {\n      const target = this.normalizeId(id);\n      if (!target) return '';\n      const branch = (this.branches || []).find(b => this.normalizeId(b?._id) === target);\n      return branch?.branchName ? String(branch.branchName) : '';\n    }\n    isCurrentBranchMatch(currentBranchId, uiBranchId) {\n      if (!currentBranchId || !uiBranchId) return false;\n      if (this.normalizeId(currentBranchId) === this.normalizeId(uiBranchId)) return true;\n      const uiBranchName = this.getBranchNameById(uiBranchId);\n      if (uiBranchName && String(currentBranchId || '').trim().toLowerCase() === String(uiBranchName).trim().toLowerCase()) {\n        return true;\n      }\n      if (this.matchesBranchLabel(String(currentBranchId || ''), String(uiBranchName || ''))) {\n        return true;\n      }\n      const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === this.normalizeId(currentBranchId));\n      if (!hub?.branch) return false;\n      const branchId = this.getBranchIdByName(hub.branch);\n      return branchId ? this.normalizeId(branchId) === this.normalizeId(uiBranchId) : false;\n    }\n    getDeliveryDisplayName(stock) {\n      const name = String(stock?.deliveryName || '').trim();\n      if (name) return name;\n      const deliveryId = this.normalizeId(stock?.deliveryID);\n      if (!deliveryId) return '-';\n      const branch = (this.branches || []).find(b => this.normalizeId(b?._id) === deliveryId);\n      if (branch?.branchName) return branch.branchName;\n      const client = (this.clientList || []).find(c => this.normalizeId(c?._id) === deliveryId);\n      if (client?.clientName) return client.clientName;\n      const guest = (this.guestList || []).find(g => this.normalizeId(g?._id) === deliveryId);\n      if (guest?.guestName) return guest.guestName;\n      return deliveryId;\n    }\n    getCurrentBranchLabel(stock) {\n      const currentBranchId = this.normalizeId(stock?.currentLocationId || stock?.currentBranchId || stock?.currentBranch);\n      if (currentBranchId) {\n        const branch = (this.branches || []).find(b => this.normalizeId(b?._id) === currentBranchId);\n        if (branch?.branchName) return branch.branchName;\n        const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === currentBranchId);\n        if (hub?.hubName) return hub.hubName;\n      }\n      const current = this.resolveBranchByIdOrName(stock?.currentLocationId || stock?.currentBranchId, stock?.currentBranch);\n      return this.firstNonEmpty(current?.branchName, stock?.currentBranch);\n    }\n    getOriginBranchLabel(stock) {\n      const branchId = this.normalizeId(stock?.branchId);\n      if (branchId) {\n        const branch = (this.branches || []).find(b => this.normalizeId(b?._id) === branchId);\n        if (branch?.branchName) return branch.branchName;\n        const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === branchId);\n        if (hub?.hubName) return hub.hubName;\n      }\n      const name = this.firstNonEmpty(stock?.branch, stock?.branchName);\n      return name || branchId || '-';\n    }\n    firstNonEmpty(...values) {\n      for (const value of values) {\n        if (value === undefined || value === null) continue;\n        const text = String(value).trim();\n        if (text) return text;\n      }\n      return '-';\n    }\n    resolveClientByIdOrName(id, name) {\n      const normId = this.normalizeId(id);\n      const normName = String(name || '').trim().toLowerCase();\n      return (this.clientList || []).find(c => normId && this.normalizeId(c?._id) === normId || normName && String(c?.clientName || '').trim().toLowerCase() === normName) || null;\n    }\n    resolveGuestByIdOrName(id, name) {\n      const normId = this.normalizeId(id);\n      const normName = String(name || '').trim().toLowerCase();\n      return (this.guestList || []).find(g => normId && this.normalizeId(g?._id) === normId || normName && String(g?.guestName || '').trim().toLowerCase() === normName) || null;\n    }\n    resolveBranchByIdOrName(id, name) {\n      const normId = this.normalizeId(id);\n      const normName = String(name || '').trim().toLowerCase();\n      return (this.branches || []).find(b => normId && this.normalizeId(b?._id) === normId || normName && String(b?.branchName || '').trim().toLowerCase() === normName) || null;\n    }\n    resolveHubByIdOrName(id, name) {\n      const normId = this.normalizeId(id);\n      const normName = String(name || '').trim().toLowerCase();\n      return (this.hubs || []).find(h => normId && this.normalizeId(h?._id) === normId || normName && String(h?.hubName || '').trim().toLowerCase() === normName) || null;\n    }\n    isHubLinkedToAssignedBranch(hubId) {\n      if (this.isAdmin) {\n        return Boolean(String(hubId || '').trim());\n      }\n      const assignedBranchIds = this.getAssignedBranchIds();\n      if (!assignedBranchIds.length) return false;\n      const hub = this.resolveHubByIdOrName(hubId, hubId);\n      if (!hub) return false;\n      return assignedBranchIds.includes(this.normalizeId(hub?.branchId));\n    }\n    getAssignedBranchIds() {\n      try {\n        const storedIds = JSON.parse(localStorage.getItem('branchIds') || '[]');\n        if (!Array.isArray(storedIds)) return [];\n        return storedIds.map(id => String(id || '').trim()).filter(id => id);\n      } catch {\n        return [];\n      }\n    }\n    resolveBranchByName(name) {\n      const target = String(name || '').trim().toLowerCase();\n      if (!target) return null;\n      return (this.branches || []).find(b => String(b?.branchName || '').trim().toLowerCase() === target) || null;\n    }\n    resolveHubByName(name) {\n      const target = String(name || '').trim().toLowerCase();\n      if (!target) return null;\n      return (this.hubs || []).find(h => String(h?.hubName || '').trim().toLowerCase() === target) || null;\n    }\n    resolveBranchByVehicle(vehicleNo) {\n      const target = String(vehicleNo || '').trim().toLowerCase();\n      if (!target) return null;\n      return (this.branches || []).find(b => (b?.vehicles || []).some(v => String(v?.vehicleNo || '').trim().toLowerCase() === target)) || null;\n    }\n    resolveHubByVehicle(vehicleNo) {\n      const target = String(vehicleNo || '').trim().toLowerCase();\n      if (!target) return null;\n      return (this.hubs || []).find(h => (h?.deliveryAddresses || []).some(addr => (addr?.vehicles || []).some(v => String(v?.vehicleNo || '').trim().toLowerCase() === target))) || null;\n    }\n    resolveClientLocation(client, locationId) {\n      if (!client) return null;\n      const normId = this.normalizeId(locationId);\n      const locations = client?.deliveryLocations || [];\n      if (!normId) return locations[0] || null;\n      return locations.find(loc => this.normalizeId(loc?.delivery_id) === normId) || null;\n    }\n    getNextDeliveryPointId(name) {\n      const target = String(name || '').trim();\n      if (!target) return '';\n      const branch = (this.branches || []).find(b => String(b?.branchName || '').trim() === target);\n      if (branch?._id) return String(branch._id);\n      const hub = (this.hubs || []).find(h => String(h?.hubName || '').trim() === target);\n      if (hub?._id) return String(hub._id);\n      return '';\n    }\n    enrichShipmentDetails(stock) {\n      const enriched = {\n        ...stock\n      };\n      const branchName = this.firstNonEmpty(stock?.branchName, stock?.branch);\n      const branch = this.resolveBranchByIdOrName(stock?.branchId, branchName);\n      enriched.branch = this.firstNonEmpty(branch?.branchName, branchName);\n      const consignor = stock?.consignorTab === 'guest' ? this.resolveGuestByIdOrName(stock?.consignorId, stock?.consignor) : this.resolveClientByIdOrName(stock?.consignorId, stock?.consignor);\n      const consignee = stock?.consigneeTab === 'guest' ? this.resolveGuestByIdOrName(stock?.consigneeId, stock?.consignee) : this.resolveClientByIdOrName(stock?.consigneeId, stock?.consignee);\n      enriched.consignor = this.firstNonEmpty(enriched.consignor, consignor?.clientName, consignor?.guestName);\n      enriched.consignorGST = this.firstNonEmpty(enriched.consignorGST, consignor?.GSTIN, stock?.consignorTab === 'guest' ? 'GUEST' : '');\n      enriched.consignorPhone = this.firstNonEmpty(enriched.consignorPhone, consignor?.phoneNum);\n      enriched.consignorAddress = this.firstNonEmpty(enriched.consignorAddress, consignor?.address);\n      enriched.consignee = this.firstNonEmpty(enriched.consignee, consignee?.clientName, consignee?.guestName);\n      enriched.consigneeGST = this.firstNonEmpty(enriched.consigneeGST, consignee?.GSTIN, stock?.consigneeTab === 'guest' ? 'GUEST' : '');\n      enriched.consigneePhone = this.firstNonEmpty(enriched.consigneePhone, consignee?.phoneNum);\n      enriched.consigneeAddress = this.firstNonEmpty(enriched.consigneeAddress, consignee?.address);\n      if (stock?.billingType === 'consignor') {\n        enriched.billingName = this.firstNonEmpty(enriched.billingName, enriched.consignor);\n        enriched.billingGSTIN = this.firstNonEmpty(enriched.billingGSTIN, enriched.consignorGST);\n        enriched.billingPhone = this.firstNonEmpty(enriched.billingPhone, enriched.consignorPhone);\n        enriched.billingAddress = this.firstNonEmpty(enriched.billingAddress, enriched.consignorAddress);\n      } else {\n        const billingClient = this.resolveClientByIdOrName(stock?.billingClientId, stock?.billingName);\n        enriched.billingName = this.firstNonEmpty(enriched.billingName, billingClient?.clientName);\n        enriched.billingGSTIN = this.firstNonEmpty(enriched.billingGSTIN, billingClient?.GSTIN);\n        enriched.billingPhone = this.firstNonEmpty(enriched.billingPhone, billingClient?.phoneNum);\n        enriched.billingAddress = this.firstNonEmpty(enriched.billingAddress, billingClient?.address);\n      }\n      if (stock?.pickupType === 'branch') {\n        const pickupBranch = this.resolveBranchByIdOrName(stock?.pickupLocationId, stock?.pickupName) || this.resolveBranchByIdOrName(null, stock?.branch);\n        enriched.pickupName = this.firstNonEmpty(enriched.pickupName, pickupBranch?.branchName);\n        enriched.pickupAddress = this.firstNonEmpty(enriched.pickupAddress, pickupBranch?.address);\n        enriched.pickupPhone = this.firstNonEmpty(enriched.pickupPhone, pickupBranch?.phoneNum);\n        enriched.pickupPincode = this.firstNonEmpty(enriched.pickupPincode, pickupBranch?.pinCode);\n      } else if (stock?.pickupType === 'consignor') {\n        enriched.pickupName = this.firstNonEmpty(enriched.pickupName, enriched.consignor);\n        enriched.pickupAddress = this.firstNonEmpty(enriched.pickupAddress, enriched.consignorAddress);\n        enriched.pickupPhone = this.firstNonEmpty(enriched.pickupPhone, enriched.consignorPhone);\n        enriched.pickupPincode = this.firstNonEmpty(enriched.pickupPincode, consignor?.pinCode);\n      }\n      const isSelfPickup = stock?.deliveryType === 'Customer self pick up' || stock?.deliveryType === 'branch' || stock?.deliveryType === 'hub';\n      if (isSelfPickup) {\n        const deliveryBranch = this.resolveBranchByIdOrName(stock?.deliveryID, stock?.deliveryName);\n        const deliveryHub = deliveryBranch ? null : this.resolveHubByIdOrName(stock?.deliveryID, stock?.deliveryName);\n        enriched.deliveryName = this.firstNonEmpty(enriched.deliveryName, deliveryBranch?.branchName, deliveryHub?.hubName);\n        enriched.deliveryAddress = this.firstNonEmpty(enriched.deliveryAddress, deliveryBranch?.address, deliveryHub?.address);\n        enriched.deliveryPhone = this.firstNonEmpty(enriched.deliveryPhone, deliveryBranch?.phoneNum, deliveryHub?.phoneNum);\n        enriched.deliveryPincode = this.firstNonEmpty(enriched.deliveryPincode, deliveryBranch?.pinCode, deliveryHub?.pinCode);\n      } else {\n        const deliveryClient = this.resolveClientByIdOrName(stock?.deliveryID, stock?.deliveryName);\n        const deliveryGuest = this.resolveGuestByIdOrName(stock?.deliveryID, stock?.deliveryName);\n        const deliveryLocation = this.resolveClientLocation(deliveryClient, stock?.deliveryLocationId);\n        enriched.deliveryName = this.firstNonEmpty(enriched.deliveryName, deliveryClient?.clientName, deliveryGuest?.guestName, enriched.consignee);\n        enriched.deliveryAddress = this.firstNonEmpty(enriched.deliveryAddress, deliveryLocation?.address, deliveryClient?.address, deliveryGuest?.address, enriched.consigneeAddress);\n        enriched.deliveryPhone = this.firstNonEmpty(enriched.deliveryPhone, deliveryClient?.phoneNum, deliveryGuest?.phoneNum, enriched.consigneePhone);\n        enriched.deliveryPincode = this.firstNonEmpty(enriched.deliveryPincode, deliveryLocation?.pinCode, deliveryClient?.pinCode, deliveryGuest?.pinCode);\n      }\n      return enriched;\n    }\n    toggleAllSelection(event) {\n      const checked = event.target.checked;\n      this.filteredStocks.forEach(s => {\n        s.selected = checked;\n      });\n    }\n    openStockDetails(stock) {\n      this.selectedStock = this.enrichShipmentDetails(stock);\n    }\n    closeStockDetails() {\n      this.selectedStock = null;\n    }\n    editStock(stock) {\n      console.log('Edit stock:', stock);\n      const cloned = JSON.parse(JSON.stringify(stock));\n      cloned.invoices = this.flattenInvoices(cloned.ewaybills || cloned.invoices || []);\n      this.editingStock = cloned;\n      this.manifestEditsById = {};\n      this.pendingManifestAdjustment = null;\n      this.manifestAdjustmentLines = [];\n      this.showManifestAdjustmentPopup = false;\n      this.captureOriginalProductValues(this.editingStock);\n    }\n    saveStockEdit() {\n      if (!this.editingStock) return;\n      if (this.pendingManifestAdjustment || this.showManifestAdjustmentPopup) {\n        this.applyManifestAdjustments();\n        if (this.pendingManifestAdjustment || this.showManifestAdjustmentPopup) {\n          return;\n        }\n      }\n      if (this.editingStock.paymentMode === 'To Pay') {\n        this.editingStock.shipmentStatus = 'To Pay';\n      } else {\n        this.editingStock.shipmentStatus = 'Pending';\n      }\n      this.syncEwaybillsFromInvoices();\n      const payload = this.buildShipmentPayload();\n      payload.paymentMode = this.editingStock.paymentMode;\n      payload.shipmentStatus = this.editingStock.shipmentStatus;\n      payload.shipmentStatusDetails = this.editingStock.shipmentStatusDetails;\n      const manifestUpdates = Object.values(this.manifestEditsById || {});\n      const updateManifests$ = manifestUpdates.length ? forkJoin(manifestUpdates.map(m => this.http.put(`http://localhost:3000/api/manifest/${m._id}`, m))) : of([]);\n      updateManifests$.subscribe({\n        next: () => {\n          const consignmentNumber = this.editingStock?.consignmentNumber;\n          const shipmentId = this.editingStock?._id;\n          console.log('[stocks:update] payload', {\n            consignmentNumber,\n            paymentMode: payload.paymentMode,\n            shipmentStatus: payload.shipmentStatus\n          });\n          const shipmentParam = shipmentId ? `?shipmentId=${encodeURIComponent(shipmentId)}` : '';\n          this.http.put(`http://localhost:3000/api/newshipments/${consignmentNumber}${shipmentParam}`, payload).subscribe({\n            next: res => {\n              console.log('[stocks:update] response', {\n                shipmentStatus: res?.shipmentStatus,\n                paymentMode: res?.paymentMode\n              });\n              this.loadStocks(); // reload updated data\n              this.editingStock = null; // close modal\n            },\n            error: err => console.error('Error updating stock:', err)\n          });\n        },\n        error: err => {\n          console.error('Error updating manifests:', err);\n          alert('Failed to update manifests. Please try again.');\n        }\n      });\n    }\n    cancelEdit() {\n      this.editingStock = null;\n      this.pendingManifestAdjustment = null;\n      this.manifestAdjustmentLines = [];\n      this.showManifestAdjustmentPopup = false;\n    }\n    captureOriginalProductValues(stock) {\n      (stock?.invoices || []).forEach(inv => {\n        (inv.products || []).forEach(prod => {\n          prod._originalAmount = Number(prod.amount) || 0;\n          prod._originalInstock = Number(prod.instock) || 0;\n          prod._originalIntransit = Number(prod.intransitstock) || 0;\n          prod._originalDelivered = Number(prod.deliveredstock) || 0;\n        });\n      });\n    }\n    resetProductToOriginal(product) {\n      product.amount = Number(product._originalAmount) || 0;\n      product.instock = Number(product._originalInstock) || 0;\n      product.intransitstock = Number(product._originalIntransit) || 0;\n      product.deliveredstock = Number(product._originalDelivered) || 0;\n    }\n    normalizeInvoiceNumber(invoice) {\n      return String(invoice?.number || invoice?.invoicenum || '').trim();\n    }\n    normalizeProductType(product) {\n      return String(product?.type || '').trim();\n    }\n    getManifestTotals() {\n      const lines = this.manifestAdjustmentLines || [];\n      const deliveredTotal = lines.filter(line => line?.isDelivered).reduce((sum, line) => sum + (Number(line.newManifestQty) || 0), 0);\n      const manifestTotal = lines.reduce((sum, line) => sum + (Number(line.newManifestQty) || 0), 0);\n      const intransitTotal = Math.max(0, manifestTotal - deliveredTotal);\n      return {\n        manifestTotal,\n        deliveredTotal,\n        intransitTotal\n      };\n    }\n    syncEwaybillsFromInvoices() {\n      if (!this.editingStock?.ewaybills?.length || !this.editingStock?.invoices?.length) return;\n      for (const flatInv of this.editingStock.invoices || []) {\n        const flatInvNumber = this.normalizeInvoiceNumber(flatInv);\n        for (const ewb of this.editingStock.ewaybills || []) {\n          for (const inv of ewb.invoices || []) {\n            if (this.normalizeInvoiceNumber(inv) !== flatInvNumber) continue;\n            for (const prod of inv.products || []) {\n              const flatProd = (flatInv.products || []).find(p => this.normalizeProductType(p) === this.normalizeProductType(prod));\n              if (!flatProd) continue;\n              prod.amount = flatProd.amount;\n              prod.instock = flatProd.instock;\n              prod.intransitstock = flatProd.intransitstock;\n              prod.deliveredstock = flatProd.deliveredstock;\n              if (flatProd.manifestQty !== undefined) {\n                prod.manifestQty = flatProd.manifestQty;\n              }\n            }\n          }\n        }\n      }\n    }\n    applyProductUpdate(invoices, invoiceNumber, productType, update) {\n      const normalizedInvoice = String(invoiceNumber || '').trim();\n      const normalizedProduct = String(productType || '').trim();\n      (invoices || []).forEach(inv => {\n        const invNumber = this.normalizeInvoiceNumber(inv);\n        if (normalizedInvoice && invNumber !== normalizedInvoice) return;\n        (inv.products || []).forEach(prod => {\n          if (this.normalizeProductType(prod) !== normalizedProduct) return;\n          update(prod);\n        });\n      });\n    }\n    isProductManifested(product) {\n      return Number(product?._originalIntransit ?? product?.intransitstock ?? 0) > 0;\n    }\n    onProductAmountFocus(invoice, product, invoiceIndex) {\n      if (!this.isProductManifested(product)) return;\n      this.openManifestAdjustmentPopup(invoice, product, product.amount, invoiceIndex);\n    }\n    onProductAmountChange(invoice, product, rawValue, invoiceIndex) {\n      if (!this.editingStock) return;\n      let newAmount = Number(rawValue);\n      if (!Number.isFinite(newAmount)) newAmount = 0;\n      if (newAmount < 0) newAmount = 0;\n      const originalAmount = Number(product._originalAmount) || 0;\n      const originalInstock = Number(product._originalInstock) || 0;\n      const originalIntransit = Number(product._originalIntransit) || 0;\n      const originalDelivered = Number(product._originalDelivered) || 0;\n      if (!this.isProductManifested(product)) {\n        if (newAmount >= originalAmount) {\n          const delta = newAmount - originalAmount;\n          product.amount = newAmount;\n          product.instock = originalInstock + delta;\n          product.intransitstock = originalIntransit;\n          product.deliveredstock = originalDelivered;\n          return;\n        }\n        const reduction = originalAmount - newAmount;\n        if (reduction <= originalInstock) {\n          product.amount = newAmount;\n          product.instock = originalInstock - reduction;\n          product.intransitstock = originalIntransit;\n          product.deliveredstock = originalDelivered;\n          return;\n        }\n        alert('Reduction exceeds available in-stock quantity.');\n        this.resetProductToOriginal(product);\n        return;\n      }\n      const reduction = originalAmount - newAmount;\n      if (reduction > originalInstock + originalIntransit) {\n        alert('Reduction exceeds available in-stock and manifested quantity.');\n        this.resetProductToOriginal(product);\n        return;\n      }\n      if (!this.pendingManifestAdjustment || this.pendingManifestAdjustment.productRef !== product) {\n        this.openManifestAdjustmentPopup(invoice, product, newAmount, invoiceIndex);\n        return;\n      }\n      this.pendingManifestAdjustment.targetAmount = newAmount;\n      product.amount = newAmount;\n    }\n    openManifestAdjustmentPopup(invoice, product, targetAmount, invoiceIndex) {\n      const consignmentNumber = this.editingStock?.consignmentNumber;\n      if (!consignmentNumber) return;\n      let invoiceNumber = this.normalizeInvoiceNumber(invoice);\n      if (!invoiceNumber && Number.isFinite(invoiceIndex)) {\n        invoiceNumber = `MAN-${String(consignmentNumber || '').trim()}-${Number(invoiceIndex) + 1}`;\n      }\n      this.pendingManifestAdjustment = {\n        consignmentNumber,\n        invoiceNumber,\n        productType: this.normalizeProductType(product),\n        targetAmount: Number(targetAmount) || 0,\n        popupInstock: Number(product._originalInstock) || 0,\n        originalAmount: Number(product._originalAmount) || 0,\n        originalInstock: Number(product._originalInstock) || 0,\n        originalIntransit: Number(product._originalIntransit) || 0,\n        originalDelivered: Number(product._originalDelivered) || 0,\n        productRef: product\n      };\n      this.http.get(`http://localhost:3000/api/manifest/by-consignment/${encodeURIComponent(consignmentNumber)}`).subscribe({\n        next: res => {\n          this.manifestAdjustments = res || [];\n          this.buildManifestAdjustmentLines();\n        },\n        error: err => {\n          console.error('Error loading manifests:', err);\n          alert('Failed to load manifests for adjustment.');\n          this.cancelManifestAdjustments();\n        }\n      });\n    }\n    buildManifestAdjustmentLines() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      const productType = pending.productType;\n      const consignmentNumber = pending.consignmentNumber;\n      const lines = [];\n      for (const manifest of this.manifestAdjustments || []) {\n        for (const cons of manifest.consignments || []) {\n          if (String(cons.consignmentNumber || '').trim() !== consignmentNumber) continue;\n          for (const inv of cons.invoices || []) {\n            const invNumber = this.normalizeInvoiceNumber(inv);\n            if (pending.invoiceNumber && invNumber !== pending.invoiceNumber) continue;\n            for (const prod of inv.products || []) {\n              if (this.normalizeProductType(prod) !== productType) continue;\n              const originalManifestQty = Number(prod.manifestQty) || 0;\n              lines.push({\n                manifestId: manifest._id,\n                manifestationNumber: manifest.manifestationNumber,\n                date: manifest.date,\n                manifestStatus: manifest.mshipmentStatus,\n                consignmentNumber,\n                invoiceNumber: invNumber,\n                productType,\n                originalManifestQty,\n                newManifestQty: originalManifestQty,\n                isDelivered: String(manifest.mshipmentStatus || '').toLowerCase() === 'delivered'\n              });\n            }\n          }\n        }\n      }\n      if (!lines.length) {\n        alert('No manifest lines found for this product.');\n        this.cancelManifestAdjustments();\n        return;\n      }\n      this.manifestAdjustmentLines = lines;\n      this.syncPopupInstockWithTarget();\n      this.showManifestAdjustmentPopup = true;\n    }\n    onManifestQtyChange(line) {\n      let value = Number(line.newManifestQty);\n      if (!Number.isFinite(value)) value = 0;\n      if (value < 0) value = 0;\n      line.newManifestQty = value;\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      const totals = this.getManifestTotals();\n      pending.targetAmount = (Number(pending.popupInstock) || 0) + totals.manifestTotal;\n      if (pending.productRef) {\n        pending.productRef.amount = Number(pending.targetAmount) || 0;\n      }\n    }\n    getManifestLineTotal() {\n      return this.getManifestTotals().manifestTotal;\n    }\n    getPopupTargetTotal() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return 0;\n      return Number(pending.targetAmount) || 0;\n    }\n    getPopupDeliveredTotal() {\n      return this.getManifestTotals().deliveredTotal;\n    }\n    getPopupInstockTotal() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return 0;\n      const totals = this.getManifestTotals();\n      return (Number(pending.targetAmount) || 0) - totals.manifestTotal;\n    }\n    syncPopupInstockWithTarget() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      const totals = this.getManifestTotals();\n      const targetAmount = Number(pending.targetAmount) || 0;\n      const computedInstock = targetAmount - totals.manifestTotal;\n      pending.popupInstock = Math.max(0, computedInstock);\n      pending.targetAmount = pending.popupInstock + totals.manifestTotal;\n    }\n    syncTargetFromInstock() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      const popupInstock = Math.max(0, Number(pending.popupInstock) || 0);\n      pending.popupInstock = popupInstock;\n      const totals = this.getManifestTotals();\n      pending.targetAmount = popupInstock + totals.manifestTotal;\n    }\n    onPopupTargetAmountChange(rawValue) {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      let newAmount = Number(rawValue);\n      if (!Number.isFinite(newAmount)) newAmount = 0;\n      if (newAmount < 0) newAmount = 0;\n      pending.targetAmount = newAmount;\n      this.syncPopupInstockWithTarget();\n      if (pending.productRef) {\n        pending.productRef.amount = newAmount;\n      }\n    }\n    onPopupInstockChange(rawValue) {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      let newInstock = Number(rawValue);\n      if (!Number.isFinite(newInstock)) newInstock = 0;\n      if (newInstock < 0) newInstock = 0;\n      pending.popupInstock = newInstock;\n      this.syncTargetFromInstock();\n      if (pending.productRef) {\n        pending.productRef.amount = Number(pending.targetAmount) || 0;\n      }\n    }\n    applyManifestAdjustments() {\n      const pending = this.pendingManifestAdjustment;\n      if (!pending) return;\n      const totals = this.getManifestTotals();\n      const instockTotal = Math.max(0, Number(pending.popupInstock) || 0);\n      const targetAmount = instockTotal + totals.manifestTotal;\n      if (instockTotal < 0) {\n        alert('New Total Qty must be at least manifest + delivered quantities.');\n        return;\n      }\n      for (const line of this.manifestAdjustmentLines || []) {\n        line.updatedAmount = targetAmount;\n        line.updatedInstock = instockTotal;\n        line.updatedIntransit = totals.intransitTotal;\n        line.updatedDelivered = totals.deliveredTotal;\n      }\n      for (const line of this.manifestAdjustmentLines || []) {\n        this.queueManifestUpdate(line);\n      }\n      const updateTotals = prod => {\n        prod.amount = targetAmount;\n        prod.instock = instockTotal;\n        prod.intransitstock = totals.intransitTotal;\n        prod.deliveredstock = totals.deliveredTotal;\n        prod.manifestQty = totals.manifestTotal;\n      };\n      if (pending.productRef) {\n        updateTotals(pending.productRef);\n      }\n      this.applyProductUpdate(this.editingStock?.invoices || [], pending.invoiceNumber, pending.productType, updateTotals);\n      (this.editingStock?.ewaybills || []).forEach(ewb => {\n        this.applyProductUpdate(ewb.invoices || [], pending.invoiceNumber, pending.productType, updateTotals);\n      });\n      this.pendingManifestAdjustment = null;\n      this.manifestAdjustmentLines = [];\n      this.showManifestAdjustmentPopup = false;\n    }\n    cancelManifestAdjustments() {\n      const pending = this.pendingManifestAdjustment;\n      if (pending?.productRef) this.resetProductToOriginal(pending.productRef);\n      this.pendingManifestAdjustment = null;\n      this.manifestAdjustmentLines = [];\n      this.showManifestAdjustmentPopup = false;\n    }\n    queueManifestUpdate(line) {\n      const manifest = (this.manifestAdjustments || []).find(m => m._id === line.manifestId);\n      if (!manifest) return;\n      for (const cons of manifest.consignments || []) {\n        if (String(cons.consignmentNumber || '').trim() !== line.consignmentNumber) continue;\n        for (const inv of cons.invoices || []) {\n          const invNumber = this.normalizeInvoiceNumber(inv);\n          if (invNumber !== line.invoiceNumber) continue;\n          for (const prod of inv.products || []) {\n            if (this.normalizeProductType(prod) !== line.productType) continue;\n            prod.manifestQty = Number(line.newManifestQty) || 0;\n            if (line.updatedAmount !== undefined) {\n              prod.amount = Number(line.updatedAmount) || 0;\n              prod.instock = Number(line.updatedInstock) || 0;\n              prod.intransitstock = Number(line.updatedIntransit) || 0;\n              prod.deliveredstock = Number(line.updatedDelivered) || 0;\n            }\n          }\n        }\n      }\n      this.manifestEditsById[manifest._id] = manifest;\n    }\n    buildShipmentPayload() {\n      const payload = JSON.parse(JSON.stringify(this.editingStock));\n      delete payload._id;\n      delete payload.consignmentNumber;\n      delete payload.GSTIN_ID;\n      delete payload.branchId;\n      delete payload.branchName;\n      const cleanProduct = prod => {\n        delete prod._originalAmount;\n        delete prod._originalInstock;\n        delete prod._originalIntransit;\n        delete prod._originalDelivered;\n      };\n      (payload.ewaybills || []).forEach(ewb => {\n        (ewb.invoices || []).forEach(inv => {\n          (inv.products || []).forEach(prod => cleanProduct(prod));\n        });\n      });\n      (payload.invoices || []).forEach(inv => {\n        (inv.products || []).forEach(prod => cleanProduct(prod));\n      });\n      return payload;\n    }\n    onConsignorSelect(name) {\n      const selectedconignor = this.clientList.find(c => c.clientName === name);\n      if (selectedconignor) {\n        this.editingStock.consignorGST = selectedconignor.GSTIN;\n        this.editingStock.consignorAddress = selectedconignor.address;\n        this.editingStock.consignorPhone = selectedconignor.phoneNum;\n      }\n    }\n    onConsigneeSelect(name) {\n      const selectedconignee = this.clientList.find(c => c.clientName === name);\n      if (selectedconignee) {\n        this.editingStock.consigneeGST = selectedconignee.GSTIN;\n        this.editingStock.consigneeAddress = selectedconignee.address;\n        this.editingStock.consigneePhone = selectedconignee.phoneNum;\n      }\n    }\n    onConsignorGuestSelect(name) {\n      const selectedguestconignor = this.guestList.find(c => c.guestName === name);\n      if (selectedguestconignor) {\n        this.editingStock.consignorGST = 'GUEST';\n        this.editingStock.consignorAddress = selectedguestconignor.address;\n        this.editingStock.consignorPhone = selectedguestconignor.phoneNum;\n      }\n    }\n    onConsigneeGuestSelect(name) {\n      const selectedguestconignee = this.guestList.find(c => c.guestName === name);\n      if (selectedguestconignee) {\n        this.editingStock.consigneeGST = 'GUEST';\n        this.editingStock.editingStock.consigneeAddress = selectedguestconignee.address;\n        this.editingStock.editingStock.consigneePhone = selectedguestconignee.phoneNum;\n      }\n    }\n    onPackageList(name) {\n      const selectedpackage = this.pkgList.find(c => c.pkgName === name);\n    }\n    onProductList(name) {\n      const selectedproduct = this.productList.find(c => c.productName === name);\n    }\n    addRoutePoint() {\n      if (!this.selectedRoutePoint) return;\n      const vehicleNo = this.selectedRouteVehicle || '';\n      this.shipmentRoute.push({\n        name: this.selectedRoutePoint.name,\n        type: this.selectedRoutePoint.type,\n        vehicleNo\n      });\n      this.selectedRoutePoint = null;\n      this.selectedRouteVehicle = '';\n    }\n    removeRoutePoint(index) {\n      this.shipmentRoute.splice(index, 1);\n    }\n    loadBranches() {\n      const email = localStorage.getItem('email');\n      this.http.get(`http://localhost:3000/api/branches?email=${email}&vehicleStatusNot=offline`).subscribe({\n        next: data => {\n          console.log(\"Branches loaded:\", data);\n          this.branches = data;\n          this.updateAvailableRoutePoints(); // Refresh route options\n          this.refreshStocksView();\n        },\n        error: err => console.error(\"Error loading branches:\", err)\n      });\n    }\n    loadHubs() {\n      const email = localStorage.getItem('email');\n      this.http.get(`http://localhost:3000/api/hubs?email=${email}&vehicleStatusNot=offline`).subscribe({\n        next: data => {\n          console.log(\"Hubs loaded:\", data);\n          this.hubs = data;\n          this.updateAvailableRoutePoints(); // Refresh route options\n          this.refreshStocksView();\n        },\n        error: err => console.error(\"Error loading hubs:\", err)\n      });\n    }\n    updateAvailableRoutePoints() {\n      const branchFilterId = this.normalizeId(this.branchId || localStorage.getItem('branchId'));\n      const isAllHubs = branchFilterId === 'all-hubs';\n      const hubFilterId = this.normalizeId(this.selectedHubFilterId || localStorage.getItem('hubId'));\n      const locationFilterId = isAllHubs ? hubFilterId : branchFilterId;\n      const shouldFilterVehicles = Boolean(locationFilterId) && locationFilterId !== 'all' && locationFilterId !== 'all-hubs';\n      const filterVehicles = vehicles => {\n        if (!shouldFilterVehicles) return vehicles;\n        return (vehicles || []).filter(v => this.normalizeId(v?.currentLocationId || v?.currentBranch) === locationFilterId);\n      };\n      this.availableRoutePoints = [...this.branches.map(b => ({\n        name: b.branchName,\n        type: \"Branch\",\n        vehicles: filterVehicles(b.vehicles || []).map(v => v.vehicleNo).filter(Boolean)\n      })), ...this.hubs.map(h => ({\n        name: h.hubName,\n        type: \"Hub\",\n        vehicles: (h.deliveryAddresses || []).flatMap(addr => filterVehicles(addr.vehicles || []).map(v => v.vehicleNo)).filter(Boolean)\n      }))];\n    }\n    onRoutePointChange() {\n      this.selectedRouteVehicle = this.selectedRoutePoint?.vehicles?.[0] || '';\n    }\n    onNextDeliveryPointChange() {\n      this.ensureHubChargesForSelectedConsignments();\n      if (this.isExternalTransport) return;\n      this.onRouteVehicleChange();\n    }\n    getSelectedNextHub() {\n      const name = String(this.selectedNextDeliveryPoint || '').trim();\n      if (!name) return null;\n      return (this.hubs || []).find(h => String(h?.hubName || '').trim() === name) || null;\n    }\n    getSelectedNextRoutePoint() {\n      const name = String(this.selectedNextDeliveryPoint || '').trim();\n      if (!name) return null;\n      return (this.availableRoutePoints || []).find(p => String(p?.name || '').trim() === name) || null;\n    }\n    getNextDeliveryPointVehicles() {\n      const point = this.getSelectedNextRoutePoint();\n      if (point?.vehicles?.length) return point.vehicles;\n      return [];\n    }\n    isSelectedNextDeliveryPointHub() {\n      const name = String(this.selectedNextDeliveryPoint || '').trim();\n      if (!name) return false;\n      const point = this.getSelectedNextRoutePoint();\n      return point?.type === 'Hub';\n    }\n    getHubChargeTotal() {\n      if (!this.isSelectedNextDeliveryPointHub()) return 0;\n      return (this.selectedForManifestation || []).reduce((sum, consignment) => {\n        return sum + (Number(consignment?.hubPerRevAmount) || 0);\n      }, 0);\n    }\n    getHubChargeSuggestion(consignment) {\n      const hub = this.getSelectedNextHub();\n      if (!hub) return 0;\n      const perRev = Number(hub?.perRev) || 0;\n      const finalAmount = Number(consignment?.finalAmount) || 0;\n      const raw = finalAmount * perRev / 100;\n      return Math.round(raw * 100) / 100;\n    }\n    ensureHubChargesForSelectedConsignments() {\n      if (!this.isSelectedNextDeliveryPointHub()) return;\n      const hub = this.getSelectedNextHub();\n      if (!hub) return;\n      for (const consignment of this.selectedForManifestation || []) {\n        if (consignment?.hubWillPickedUp) {\n          consignment.hubPerRevAmount = 0;\n          continue;\n        }\n        const suggested = this.getHubChargeSuggestion(consignment);\n        consignment.hubPerRevAmount = suggested;\n      }\n    }\n    onHubPickedUpToggle(consignment) {\n      if (!consignment) return;\n      if (consignment.hubWillPickedUp) {\n        consignment.hubPerRevAmount = 0;\n        return;\n      }\n      consignment.hubPerRevAmount = this.getHubChargeSuggestion(consignment);\n    }\n    onTransportPartnerChange() {\n      this.selectedRouteVehicle = '';\n      this.shipmentRoute = [];\n    }\n    onExternalTransportToggle() {\n      this.selectedTransportPartnerId = '';\n      this.selectedRouteVehicle = '';\n      this.shipmentRoute = [];\n    }\n    onRouteVehicleChange() {\n      const vehicle = String(this.selectedRouteVehicle || '').trim();\n      if (!vehicle) {\n        this.shipmentRoute = [];\n        return;\n      }\n      if (this.isExternalTransport) {\n        const partner = this.transportPartners.find(p => String(p._id) === String(this.selectedTransportPartnerId));\n        const partnerName = String(partner?.partnerName || '').trim();\n        this.shipmentRoute = [{\n          name: partnerName || 'Transport Partner',\n          type: 'Transport Partner',\n          vehicleNo: vehicle\n        }];\n        return;\n      }\n      const routePoint = this.getSelectedNextRoutePoint();\n      const pointName = routePoint?.name || this.branch || 'Branch';\n      const pointType = routePoint?.type || 'Branch';\n      this.shipmentRoute = [{\n        name: pointName,\n        type: pointType,\n        vehicleNo: vehicle\n      }];\n    }\n    getTransportPartnerVehicles() {\n      const partner = this.transportPartners.find(p => String(p._id) === String(this.selectedTransportPartnerId));\n      const vehicles = partner?.vehicleNumbers || partner?.vehicles || [];\n      return vehicles.filter(v => {\n        if (typeof v === 'string') return true;\n        const status = String(v?.vehicleStatus || 'online').toLowerCase();\n        return status === 'online' || status === 'scheduled';\n      }).map(v => {\n        if (typeof v === 'string') return v;\n        return v?.number || v?.vehicleNo || v?.vehicleNumber || v?.regNo || '';\n      }).filter(Boolean);\n    }\n    getBranchVehicles() {\n      const currentBranchId = this.normalizeId(this.branchId || localStorage.getItem('branchId'));\n      const currentBranchName = String(this.branch || localStorage.getItem('branch') || '').trim();\n      const currentBranchNameLower = currentBranchName.toLowerCase();\n      const isAllHubsSelection = currentBranchId === 'all-hubs' || currentBranchNameLower === 'all hubs';\n      const manifestTarget = this.getManifestationTargetBranch();\n      const selectedHubId = isAllHubsSelection ? this.normalizeId(this.selectedHubFilterId) || this.normalizeId(this.getSelectedNextHub()?._id) : '';\n      const targetBranchId = manifestTarget?.id || '';\n      const targetBranchName = manifestTarget?.name || '';\n      const selectedHubName = isAllHubsSelection && selectedHubId ? String((this.hubs || []).find(h => this.normalizeId(h?._id) === selectedHubId)?.hubName || '').trim() : '';\n      const branchVehicles = (this.branches || []).flatMap(b => b?.vehicles || []);\n      const hubVehicles = (this.hubs || []).flatMap(h => (h?.deliveryAddresses || []).flatMap(addr => addr?.vehicles || []));\n      const vehicles = [...branchVehicles, ...hubVehicles];\n      const seen = new Set();\n      return vehicles.filter(v => {\n        const currentBranch = String(v?.currentBranch || '').trim();\n        if (!currentBranch) return false;\n        if (targetBranchId || targetBranchName) {\n          const currentBranchIdOrName = this.normalizeId(currentBranch);\n          const matchesById = targetBranchId && currentBranchIdOrName === targetBranchId;\n          const matchesByName = targetBranchName && this.matchesBranchLabel(currentBranch, targetBranchName);\n          const matchesByNormalizedName = targetBranchName && this.matchesBranchLabel(String(currentBranchIdOrName || ''), targetBranchName);\n          return matchesById || matchesByName || matchesByNormalizedName;\n        }\n        if (isAllHubsSelection) {\n          const currentBranchIdOrName = this.normalizeId(currentBranch);\n          const matchesById = Boolean(selectedHubId) && currentBranchIdOrName === selectedHubId;\n          const matchesByName = selectedHubName && this.matchesBranchLabel(currentBranch, selectedHubName);\n          return matchesById || matchesByName;\n        }\n        const currentBranchIdOrName = this.normalizeId(currentBranch);\n        const matchesById = currentBranchId && this.isCurrentBranchMatch(currentBranchIdOrName, currentBranchId);\n        const matchesByName = currentBranchNameLower && this.matchesBranchLabel(currentBranch, currentBranchName);\n        const matchesByNormalizedName = currentBranchNameLower && this.matchesBranchLabel(String(currentBranchIdOrName || ''), currentBranchName);\n        return matchesById || matchesByName || matchesByNormalizedName;\n      }).map(v => {\n        if (typeof v === 'string') return v;\n        return v?.vehicleNo || v?.number || v?.vehicleNumber || '';\n      }).filter(vehicle => {\n        if (!vehicle) return false;\n        if (seen.has(vehicle)) return false;\n        seen.add(vehicle);\n        return true;\n      });\n    }\n    getManifestationTargetBranch() {\n      const first = (this.selectedForManifestation || [])[0];\n      if (!first) return null;\n      const currentBranchId = this.normalizeId(first?.currentLocationId || first?.currentBranchId || first?.currentBranch);\n      if (currentBranchId) {\n        const branch = (this.branches || []).find(b => this.normalizeId(b?._id) === currentBranchId);\n        if (branch?.branchName) return {\n          id: currentBranchId,\n          name: String(branch.branchName).trim()\n        };\n        const hub = (this.hubs || []).find(h => this.normalizeId(h?._id) === currentBranchId);\n        if (hub?.hubName) return {\n          id: currentBranchId,\n          name: String(hub.hubName).trim()\n        };\n        return {\n          id: currentBranchId,\n          name: ''\n        };\n      }\n      const currentBranchName = String(first?.currentBranch || '').trim();\n      if (!currentBranchName) return null;\n      const hub = (this.hubs || []).find(h => String(h?.hubName || '').trim().toLowerCase() === currentBranchName.toLowerCase());\n      if (hub?._id) return {\n        id: this.normalizeId(hub._id),\n        name: String(hub.hubName).trim()\n      };\n      const branch = (this.branches || []).find(b => String(b?.branchName || '').trim().toLowerCase() === currentBranchName.toLowerCase());\n      if (branch?._id) return {\n        id: this.normalizeId(branch._id),\n        name: String(branch.branchName).trim()\n      };\n      return {\n        id: '',\n        name: currentBranchName\n      };\n    }\n    matchesBranchLabel(currentBranch, branchLabel) {\n      const current = String(currentBranch || '').trim().toLowerCase();\n      const label = String(branchLabel || '').trim().toLowerCase();\n      if (!current || !label) return false;\n      if (label === current) return true;\n      if (label.startsWith(`${current}-`)) return true;\n      const labelPrefix = label.split('-')[0].trim();\n      return Boolean(labelPrefix) && labelPrefix === current;\n    }\n    onEditingPaymentModeChange() {\n      if (!this.editingStock) return;\n      if (this.editingStock.paymentMode === 'To Pay') {\n        this.editingStock.shipmentStatus = 'To Pay';\n      } else {\n        this.editingStock.shipmentStatus = 'Pending';\n      }\n    }\n    buildRouteString() {\n      if (!this.shipmentRoute.length) return '';\n      if (this.manifestationStatus === 'Will be Picked-Up') {\n        return '$$Will be Picked-Up';\n      }\n      const hasBaskets = (this.routeBaskets || []).length > 0;\n      const prefix = hasBaskets ? `$$${this.buildBasketDescriptor()}$$` : '$$';\n      const route = prefix + this.shipmentRoute.map(p => {\n        const vehicle = String(p.vehicleNo || '').trim();\n        return vehicle ? `${p.name} (${p.type})|${vehicle}` : `${p.name} (${p.type})`;\n      }).join(' -> ');\n      if (this.manifestationStatus === 'Out for Delivery') {\n        return `${route}|Out for Delivery`;\n      }\n      return route;\n    }\n    buildBasketDescriptor() {\n      return (this.routeBaskets || []).filter(b => b && String(b.labelKey || '').trim() && Number(b.qty) > 0).map(b => {\n        const key = String(b.labelKey || '').trim();\n        const parts = key.split('|');\n        const labelType = parts.shift() || '';\n        const labelValue = parts.join('|');\n        const label = labelValue ? `${labelType}:${labelValue}` : labelType;\n        return `${label}-${Number(b.qty)}`;\n      }).join('|');\n    }\n    addRouteBasket() {\n      const options = this.getBasketOptions();\n      const firstKey = options.length ? options[0].key : '';\n      this.routeBaskets.push({\n        labelKey: firstKey,\n        qty: 0\n      });\n    }\n    removeRouteBasket(index) {\n      if (index < 0 || index >= this.routeBaskets.length) return;\n      this.routeBaskets.splice(index, 1);\n    }\n    getBasketOptions() {\n      const consignment = (this.selectedForManifestation || [])[0];\n      if (!consignment) return [];\n      const options = [];\n      const consNum = consignment.consignmentNumber || '';\n      if (consNum) {\n        options.push({\n          key: `Consignment|${consNum}`,\n          text: `Consignment: ${consNum}`\n        });\n      }\n      const ewaybills = consignment.ewaybills || [];\n      if (ewaybills.length) {\n        ewaybills.forEach((ewb, eIdx) => {\n          const eNum = ewb.number || ewb.ewaybillNumber || `EWB-${eIdx + 1}`;\n          options.push({\n            key: `Ewaybill|${eNum}`,\n            text: `Ewaybill: ${eNum}`\n          });\n          (ewb.invoices || []).forEach((inv, iIdx) => {\n            const invNum = inv.number || inv.invoicenum || `INV-${iIdx + 1}`;\n            options.push({\n              key: `Invoice|${invNum}`,\n              text: `Invoice: ${invNum}`\n            });\n            (inv.products || []).forEach((prod, pIdx) => {\n              const pType = prod.type || prod.productName || `Product-${pIdx + 1}`;\n              options.push({\n                key: `Product|${invNum}:${pType}`,\n                text: `Product: ${invNum} - ${pType}`\n              });\n            });\n          });\n        });\n        return options;\n      }\n      (consignment.invoices || []).forEach((inv, iIdx) => {\n        const invNum = inv.number || inv.invoicenum || `INV-${iIdx + 1}`;\n        options.push({\n          key: `Invoice|${invNum}`,\n          text: `Invoice: ${invNum}`\n        });\n        (inv.products || []).forEach((prod, pIdx) => {\n          const pType = prod.type || prod.productName || `Product-${pIdx + 1}`;\n          options.push({\n            key: `Product|${invNum}:${pType}`,\n            text: `Product: ${invNum} - ${pType}`\n          });\n        });\n      });\n      return options;\n    }\n    ngOnInit() {\n      this.email = localStorage.getItem('email') || '';\n      this.username = localStorage.getItem('username') || '';\n      this.branch = this.branchService.currentBranch || localStorage.getItem('branch') || 'All Branches';\n      this.branchId = localStorage.getItem('branchId') || 'all';\n      this.branchSub = this.branchService.branch$.subscribe(branch => {\n        this.branch = branch;\n        this.branchId = localStorage.getItem('branchId') || 'all';\n        if (this.branchId !== 'all-hubs') {\n          this.selectedHubFilterId = null;\n          this.selectedHubFilterName = '';\n        }\n        this.loadStocks();\n      });\n      // react to branch changes (same tab)\n      this.branchCheck = setInterval(() => {\n        const current = localStorage.getItem('branch') || 'All Branches';\n        const currentId = localStorage.getItem('branchId') || 'all';\n        if (current !== this.branch || currentId !== this.branchId) {\n          this.branch = current;\n          this.branchId = currentId;\n          if (this.branchId !== 'all-hubs') {\n            this.selectedHubFilterId = null;\n            this.selectedHubFilterName = '';\n          }\n          this.loadStocks();\n        }\n      }, 1000);\n      // react to branch changes (other tabs)\n      window.addEventListener('storage', this.onStorageChange);\n      // Clients list\n      this.http.get(`http://localhost:3000/api/clients/clientslist?emailId=${this.email}`).subscribe({\n        next: data => this.clientList = data,\n        error: err => console.error('Error fetching client list', err),\n        complete: () => console.log('Client list fetch complete')\n      });\n      // Guests list\n      this.http.get(`http://localhost:3000/api/guests/guestslist?emailId=${this.email}`).subscribe({\n        next: data => this.guestList = data,\n        error: err => console.error('Error fetching guest list', err),\n        complete: () => console.log('Guest list fetch complete')\n      });\n      // Packages list\n      this.http.get(`http://localhost:3000/api/pkgs/pkglist?emailId=${this.email}`).subscribe({\n        next: data => this.pkgList = data,\n        error: err => console.error('Error fetching package list', err),\n        complete: () => console.log('Package list fetch complete')\n      });\n      // Products list\n      this.http.get(`http://localhost:3000/api/products/productlist?branchId=${encodeURIComponent(this.branchId)}&branch=${encodeURIComponent(this.branch)}`).subscribe({\n        next: data => this.productList = data,\n        error: err => console.error('Error fetching product list', err),\n        complete: () => console.log('Product list fetch complete')\n      });\n      // Transport partners list\n      this.http.get(`http://localhost:3000/api/tpartners/tpartnerslist?branchId=${encodeURIComponent(this.branchId || 'all')}`).subscribe({\n        next: data => this.transportPartners = Array.isArray(data) ? data : data?.value || [],\n        error: err => console.error('Error fetching transport partners', err),\n        complete: () => console.log('Transport partners fetch complete')\n      });\n      this.loadBranches();\n      this.loadHubs();\n      this.loadStocks();\n    }\n    ngOnDestroy() {\n      this.branchSub?.unsubscribe();\n      if (this.branchCheck) clearInterval(this.branchCheck);\n      window.removeEventListener('storage', this.onStorageChange);\n    }\n    getEwaybillNumberFromDB(consignmentNumber) {\n      const record = this.stocks.find(shipment => shipment.consignmentNumber === consignmentNumber);\n      return record?.ewaybillNumber || '';\n    }\n    openManifestationPopup() {\n      if (this.branchId === 'all' || !this.branchId) {\n        alert('Please select a specific branch before manifesting consignments.');\n        return;\n      }\n      // Filter selected consignments\n      this.selectedForManifestation = this.filteredStocks.filter(s => s.selected);\n      // Guard clause: ensure at least one consignment is selected\n      if (this.selectedForManifestation.length === 0) {\n        alert('Please select at least one consignment to manifest.');\n        return;\n      }\n      const manifestBranchIds = new Set(this.selectedForManifestation.map(c => this.normalizeId(c?.currentLocationId || c?.currentBranchId || c?.currentBranch)).filter(Boolean));\n      if (manifestBranchIds.size > 1) {\n        alert('Selected consignments are in different branches/hubs.');\n        return;\n      }\n      this.manifestationStatus = 'Manifestation';\n      this.routeBaskets = [];\n      this.selectedNextDeliveryPoint = '';\n      // Initialize manifestQty and eway bill fields\n      this.selectedForManifestation = this.selectedForManifestation.map(consignment => {\n        // Set eway bill fields\n        const updatedConsignment = {\n          ...consignment,\n          ewayBillRequired: false,\n          ewaybillNumber: this.getEwaybillNumberFromDB(consignment.consignmentNumber)\n        };\n        // Set manifestQty = instock for each product\n        updatedConsignment.invoices?.forEach(invoice => {\n          invoice.products?.forEach(product => {\n            const amount = Number(product.amount) || 0;\n            const inTransit = Number(product.intransitstock) || 0;\n            const delivered = Number(product.deliveredstock) || 0;\n            const available = Math.max(0, amount - inTransit - delivered);\n            const currentInstock = Number(product.instock) || 0;\n            if (!currentInstock && available > 0) {\n              product.instock = available;\n            }\n            product.manifestQty = Number(product.instock) || available;\n            product.manifestQtyTouched = false;\n          });\n        });\n        return updatedConsignment;\n      });\n      // Show the popup\n      this.showManifestationPopup = true;\n    }\n    closeManifestationPopup() {\n      this.showManifestationPopup = false;\n    }\n    finalizeManifestation() {\n      if (this.selectedForManifestation.length === 0) {\n        alert('No consignments selected.');\n        return;\n      }\n      const requiresRoute = this.manifestationStatus !== 'Will be Picked-Up';\n      if (requiresRoute && this.shipmentRoute.some(p => !String(p.vehicleNo || '').trim())) {\n        alert('Please select a vehicle for each route point.');\n        return;\n      }\n      if (requiresRoute && this.routeBaskets.length && !this.buildBasketDescriptor()) {\n        alert('Please add at least one basket with a quantity.');\n        return;\n      }\n      const routeString = requiresRoute ? this.buildRouteString() : '';\n      if (requiresRoute && !routeString) {\n        alert('Please add at least one route point.');\n        return;\n      }\n      if (this.manifestationStatus === 'Manifestation' && !String(this.selectedNextDeliveryPoint || '').trim()) {\n        alert('Please select a next delivery point.');\n        return;\n      }\n      const updates = (this.selectedForManifestation || []).map(consignment => {\n        const updatedEwaybills = (consignment.ewaybills || []).map(ewb => routeString ? (() => {\n          const existingRoutes = String(ewb?.routes || '').trim();\n          const nextRoutes = String(routeString || '').trim();\n          if (!existingRoutes) return {\n            ...ewb,\n            routes: nextRoutes\n          };\n          const normalizedNext = nextRoutes.replace(/^\\$\\$\\s*/, '');\n          return {\n            ...ewb,\n            routes: `${existingRoutes}$$${normalizedNext}`\n          };\n        })() : {\n          ...ewb\n        });\n        const nextPointName = String(this.selectedNextDeliveryPoint || '').trim();\n        const nextPointId = nextPointName ? this.getNextDeliveryPointId(nextPointName) : '';\n        const nextPoint = nextPointId ? `$$${nextPointId}` : '';\n        const routePoint = this.getSelectedNextRoutePoint();\n        const vehicleNo = String(this.selectedRouteVehicle || '').trim();\n        const vehicleOwnerType = routePoint?.type ? String(routePoint.type).toLowerCase() : '';\n        const vehicleOwnerId = nextPointId;\n        const selectedHub = this.getSelectedNextHub();\n        const hubId = selectedHub?._id ? String(selectedHub._id) : '';\n        const hubCharge = this.isSelectedNextDeliveryPointHub() ? Number(consignment?.hubPerRevAmount) || 0 : 0;\n        const currentStatus = String(consignment?.shipmentStatus || '').trim();\n        let nextStatus = this.manifestationStatus || 'Manifestation';\n        if (currentStatus === 'DPending') {\n          if (nextStatus === 'Manifestation') {\n            nextStatus = 'DManifestation';\n          } else if (nextStatus === 'Out for Delivery') {\n            nextStatus = 'D-Out for Delivery';\n          } else if (nextStatus === 'Will be Picked-Up') {\n            nextStatus = 'D-Will be Picked-Up';\n          }\n        }\n        const shouldAttachVehicle = requiresRoute && vehicleNo && vehicleOwnerType && vehicleOwnerId && ['Manifestation', 'DManifestation', 'Out for Delivery', 'D-Out for Delivery'].includes(nextStatus);\n        const payload = {\n          shipmentId: consignment?._id || '',\n          shipmentStatus: nextStatus,\n          shipmentStatusDetails: `${consignment.shipmentStatusDetails || ''}${nextPoint}`,\n          ewaybills: updatedEwaybills,\n          ...(hubId ? {\n            hubId,\n            hubCharge\n          } : {}),\n          ...(shouldAttachVehicle ? {\n            currentVehicleNo: vehicleNo,\n            currentVehicleOwnerType: vehicleOwnerType,\n            currentVehicleOwnerId: vehicleOwnerId\n          } : {})\n        };\n        const shipmentId = consignment?._id ? encodeURIComponent(consignment._id) : '';\n        const shipmentParam = shipmentId ? `?shipmentId=${shipmentId}` : '';\n        return this.http.put(`http://localhost:3000/api/newshipments/${consignment.consignmentNumber}${shipmentParam}`, payload);\n      });\n      if (!updates.length) return;\n      forkJoin(updates).subscribe({\n        next: () => {\n          this.createTpartnerActivityFromManifest();\n          if (this.manifestationStatus === 'Manifestation' || this.manifestationStatus === 'Out for Delivery') {\n            this.updateInternalVehicleStatuses('scheduled');\n          }\n          this.showManifestationPopup = false;\n          this.selectedForManifestation = [];\n          this.filteredStocks.forEach(s => s.selected = false);\n          this.loadStocks();\n        },\n        error: err => {\n          console.error('Error updating consignment status:', err);\n          alert('Failed to update consignment status.');\n        }\n      });\n    }\n    updateInternalVehicleStatuses(status) {\n      if (this.isExternalTransport) return;\n      let routePoints = (this.shipmentRoute || []).filter(p => p && p.type !== 'Transport Partner');\n      if (!routePoints.length) {\n        const vehicleNo = String(this.selectedRouteVehicle || '').trim();\n        const point = this.getSelectedNextRoutePoint();\n        if (vehicleNo && point) {\n          routePoints = [{\n            name: point.name,\n            type: point.type,\n            vehicleNo\n          }];\n        } else if (vehicleNo) {\n          routePoints = [{\n            name: this.branch || 'Branch',\n            type: 'Branch',\n            vehicleNo\n          }];\n        }\n      }\n      if (!routePoints.length) return;\n      const calls = [];\n      const seen = new Set();\n      routePoints.forEach(point => {\n        const vehicleNo = String(point?.vehicleNo || '').trim();\n        if (!vehicleNo) return;\n        if (point.type === 'Branch') {\n          const branch = this.resolveBranchByName(point.name) || this.resolveBranchByVehicle(vehicleNo);\n          const branchId = branch?._id ? String(branch._id) : '';\n          if (!branchId) return;\n          const key = `branch:${branchId}:${vehicleNo}`;\n          if (seen.has(key)) return;\n          seen.add(key);\n          calls.push(this.http.patch(`http://localhost:3000/api/branches/${branchId}/vehicle-status`, {\n            vehicleNo,\n            vehicleStatus: status\n          }));\n        } else if (point.type === 'Hub') {\n          const hub = this.resolveHubByName(point.name) || this.resolveHubByVehicle(vehicleNo);\n          const hubId = hub?._id ? String(hub._id) : '';\n          if (!hubId) return;\n          const key = `hub:${hubId}:${vehicleNo}`;\n          if (seen.has(key)) return;\n          seen.add(key);\n          calls.push(this.http.patch(`http://localhost:3000/api/hubs/${hubId}/vehicle-status`, {\n            vehicleNo,\n            vehicleStatus: status\n          }));\n        } else {\n          const branch = this.resolveBranchByVehicle(vehicleNo);\n          if (branch?._id) {\n            const branchId = String(branch._id);\n            const key = `branch:${branchId}:${vehicleNo}`;\n            if (!seen.has(key)) {\n              seen.add(key);\n              calls.push(this.http.patch(`http://localhost:3000/api/branches/${branchId}/vehicle-status`, {\n                vehicleNo,\n                vehicleStatus: status\n              }));\n            }\n            return;\n          }\n          const hub = this.resolveHubByVehicle(vehicleNo);\n          if (hub?._id) {\n            const hubId = String(hub._id);\n            const key = `hub:${hubId}:${vehicleNo}`;\n            if (!seen.has(key)) {\n              seen.add(key);\n              calls.push(this.http.patch(`http://localhost:3000/api/hubs/${hubId}/vehicle-status`, {\n                vehicleNo,\n                vehicleStatus: status\n              }));\n            }\n          }\n        }\n      });\n      if (!calls.length) return;\n      forkJoin(calls).subscribe({\n        error: err => console.error('Error updating internal vehicle status:', err)\n      });\n    }\n    buildManifestationPincodeDirections(consignments) {\n      return (consignments || []).map(consignment => {\n        const enriched = this.enrichShipmentDetails(consignment);\n        const pickup = String(enriched?.pickupPincode || '').trim();\n        const delivery = String(enriched?.deliveryPincode || '').trim();\n        if (!pickup && !delivery) return '';\n        return `$$${pickup}-${delivery}`;\n      }).filter(Boolean);\n    }\n    createTpartnerActivityFromManifest() {\n      if (!this.isExternalTransport) return;\n      if (!String(this.selectedTransportPartnerId || '').trim()) return;\n      if (!String(this.selectedRouteVehicle || '').trim()) return;\n      const partner = this.transportPartners.find(p => String(p?._id) === String(this.selectedTransportPartnerId));\n      const tpartnerName = String(partner?.partnerName || '').trim();\n      if (!tpartnerName) return;\n      const consignmentIds = (this.selectedForManifestation || []).map(c => c?._id).filter(Boolean).map(id => `$$${id}`);\n      const pincodeDirections = this.buildManifestationPincodeDirections(this.selectedForManifestation);\n      if (!consignmentIds.length || !pincodeDirections.length) return;\n      const payload = {\n        tpartnerId: this.selectedTransportPartnerId,\n        tpartnerName,\n        vehicleNumbers: [this.selectedRouteVehicle],\n        consignmentIds,\n        pincodeDirections\n      };\n      this.http.post('http://localhost:3000/api/tpartner-activity', payload).subscribe({\n        error: err => console.error('Error creating transport partner activity:', err)\n      });\n    }\n    validateManifestQty(product) {\n      product.manifestQtyTouched = true;\n      if (product.manifestQty > product.instock) {\n        alert(`Manifest quantity cannot exceed available stock (${product.instock}).`);\n        product.manifestQty = product.instock;\n      }\n      if (product.manifestQty < 0) {\n        alert('Manifest quantity cannot be negative.');\n        product.manifestQty = 0;\n      }\n    }\n    printReceipts() {\n      const selected = this.filteredStocks?.filter(s => s.selected) || [];\n      if (selected.length === 0) {\n        alert('No consignments selected.');\n        return;\n      }\n      fetch('assets/receipt-template.html').then(res => res.text()).then(template => {\n        let fullHtml = `\n        <html>\n          <head>\n            <style>\n              body { font-family: Arial, sans-serif; padding: 20px; }\n              h2 { margin-bottom: 0; }\n              table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n              th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }\n              th { background-color: #f2f2f2; }\n              .page-break { page-break-after: always; }\n            </style>\n          </head>\n          <body>\n      `;\n        selected.forEach((consignment, index) => {\n          const rows = consignment.invoices.flatMap(inv => inv.products.map(p => `\n            <tr>\n              <td>${inv.number}</td>\n              <td>${p.type}</td>\n              <td>${p.instock}</td>\n              <td>${p.manifestQty}</td>\n              <td>${p.amount}</td>\n            </tr>\n          `)).join('');\n          const htmlContent = template.replace('{{consignmentNumber}}', consignment.consignmentNumber).replace('{{consignor}}', consignment.consignor).replace('{{rows}}', rows);\n          fullHtml += htmlContent;\n          // Add page break after each consignment except the last one\n          if (index < selected.length - 1) {\n            fullHtml += `<div class=\"page-break\"></div>`;\n          }\n        });\n        fullHtml += `</body></html>`;\n        const printWindow = window.open('', '_blank');\n        if (printWindow) {\n          printWindow.document.open();\n          printWindow.document.write(fullHtml); // use write instead of body.innerHTML\n          printWindow.document.close();\n          printWindow.print();\n        }\n      });\n    }\n    static {\n      this.ɵfac = function StocksComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || StocksComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.BranchService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: StocksComponent,\n        selectors: [[\"app-stocks\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 45,\n        vars: 15,\n        consts: [[\"noSelection\", \"\"], [\"showEwaybill\", \"\"], [\"externalTransport\", \"\"], [1, \"stocks-container\"], [1, \"stocks-tabs\"], [3, \"click\"], [1, \"filters\"], [\"type\", \"text\", \"placeholder\", \"Search by consignment no. or consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [3, \"ngModel\", \"ngModelChange\", 4, \"ngIf\"], [\"type\", \"date\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"type\", \"text\", \"placeholder\", \"Filter by consignor\", 3, \"ngModelChange\", \"input\", \"ngModel\"], [1, \"actions\"], [1, \"stocks-table\"], [\"type\", \"checkbox\", 3, \"change\"], [3, \"click\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"modal details-modal\", 4, \"ngIf\"], [\"class\", \"modal edit-stock-modal\", 4, \"ngIf\"], [\"class\", \"modal\", 4, \"ngIf\"], [3, \"ngModelChange\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"value\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"click\", \"ngModel\"], [1, \"modal\", \"details-modal\"], [1, \"modal-content\", \"details-content\"], [\"type\", \"button\", 1, \"details-close\", 3, \"click\"], [1, \"details-header\"], [1, \"details-sub\"], [1, \"details-status\"], [1, \"stock-details\", \"details-grid\"], [1, \"details-products\"], [\"class\", \"details-invoice\", 4, \"ngFor\", \"ngForOf\"], [1, \"details-invoice\"], [1, \"details-invoice-title\"], [1, \"details-product-list\"], [4, \"ngFor\", \"ngForOf\"], [1, \"product-name\"], [1, \"product-meta\"], [1, \"modal\", \"edit-stock-modal\"], [1, \"modal-content\", \"edit-stock-content\"], [1, \"edit-stock-header\"], [1, \"edit-stock-meta\"], [1, \"edit-stock-section\"], [1, \"edit-stock-grid\"], [\"type\", \"date\", 3, \"ngModelChange\", \"ngModel\"], [1, \"tabs\", \"edit-stock-tabs\"], [\"class\", \"edit-stock-grid\", 4, \"ngIf\"], [3, \"ngModelChange\", \"change\", \"ngModel\"], [1, \"edit-stock-radio\"], [\"type\", \"radio\", \"name\", \"billing\", \"value\", \"consignor\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"radio\", \"name\", \"billing\", \"value\", \"different\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"invoice-block\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"ghost\", 3, \"click\"], [\"type\", \"number\", 3, \"ngModelChange\", \"ngModel\"], [1, \"edit-stock-actions\"], [1, \"ghost\", 3, \"click\"], [1, \"primary\", 3, \"click\"], [\"readonly\", \"\", 3, \"ngModelChange\", \"ngModel\"], [1, \"invoice-block\"], [1, \"grid-3\"], [\"placeholder\", \"Invoice Number\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"Invoice Value\", \"type\", \"number\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"button\", 1, \"danger\", 3, \"click\"], [\"class\", \"grid-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"grid-4\"], [\"placeholder\", \"Amount*\", \"type\", \"number\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"Amount*\", \"type\", \"number\", 3, \"ngModelChange\", \"focus\", \"ngModel\"], [1, \"modal\"], [1, \"modal-content\"], [4, \"ngIf\"], [\"class\", \"stocks-table\", 4, \"ngIf\"], [1, \"terminal-buttons\"], [\"type\", \"number\", \"min\", \"0\", 3, \"ngModelChange\", \"ngModel\"], [1, \"modal-content\", \"terminal-style\"], [1, \"close\", 3, \"click\"], [1, \"terminal-header\"], [1, \"terminal-status\"], [4, \"ngIf\", \"ngIfElse\"], [\"class\", \"consignment-block\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"routing-section\", 4, \"ngIf\"], [1, \"consignment-block\"], [\"class\", \"hub-charge-wrapper\", 4, \"ngIf\"], [1, \"ewaybill-section\"], [1, \"hub-charge-wrapper\"], [1, \"hub-pickup-toggle\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [1, \"hub-charge-row\"], [\"type\", \"number\", \"min\", \"0\", 3, \"ngModelChange\", \"ngModel\", \"disabled\"], [1, \"hint\"], [1, \"eway-toggle-label\"], [\"type\", \"checkbox\", 1, \"eway-toggle-input\", 3, \"ngModelChange\", \"ngModel\"], [1, \"eway-toggle-slider\"], [1, \"eway-toggle-text\"], [1, \"product-line\"], [\"type\", \"number\", \"min\", \"0\", \"readonly\", \"\", \"disabled\", \"\", 1, \"manifest-input\", 3, \"ngModelChange\", \"max\", \"ngModel\"], [1, \"routing-section\"], [1, \"routing-header\"], [1, \"eway-toggle-label\", \"external-toggle\"], [\"type\", \"checkbox\", 1, \"eway-toggle-input\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [1, \"routing-controls\"], [\"class\", \"hub-charge-total\", 4, \"ngIf\"], [1, \"route-list\"], [\"disabled\", \"\"], [\"value\", \"\"], [1, \"hub-charge-total\"], [1, \"remove-btn\", 3, \"click\"]],\n        template: function StocksComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 3)(1, \"h2\");\n            i0.ɵɵtext(2, \"Stocks\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"div\", 4)(4, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_4_listener() {\n              return ctx.setActiveTab(\"stocks\");\n            });\n            i0.ɵɵtext(5, \" Stocks \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_6_listener() {\n              return ctx.setActiveTab(\"other-branch\");\n            });\n            i0.ɵɵtext(7, \" Stocks in Other branch \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_8_listener() {\n              return ctx.setActiveTab(\"others-in-branch\");\n            });\n            i0.ɵɵtext(9, \" Others stocks in our branch \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(10, \"div\", 6)(11, \"input\", 7);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_Template_input_ngModelChange_11_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.searchText, $event) || (ctx.searchText = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function StocksComponent_Template_input_input_11_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(12, StocksComponent_select_12_Template, 2, 2, \"select\", 8);\n            i0.ɵɵelementStart(13, \"input\", 9);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_Template_input_ngModelChange_13_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterDate, $event) || (ctx.filterDate = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function StocksComponent_Template_input_change_13_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(14, \"input\", 10);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function StocksComponent_Template_input_ngModelChange_14_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.filterConsignor, $event) || (ctx.filterConsignor = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"input\", function StocksComponent_Template_input_input_14_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_15_listener() {\n              return ctx.openManifestationPopup();\n            });\n            i0.ɵɵtext(16, \"Manifestation\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function StocksComponent_Template_button_click_17_listener() {\n              return ctx.printReceipts();\n            });\n            i0.ɵɵtext(18, \"\\uD83D\\uDDA8\\uFE0F Print Receipts\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(19, \"div\", 11);\n            i0.ɵɵelementStart(20, \"table\", 12)(21, \"thead\")(22, \"tr\")(23, \"th\")(24, \"input\", 13);\n            i0.ɵɵlistener(\"change\", function StocksComponent_Template_input_change_24_listener($event) {\n              return ctx.toggleAllSelection($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(25, \"th\");\n            i0.ɵɵtext(26, \"Consignment No.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(27, \"th\");\n            i0.ɵɵtext(28, \"Consignor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"th\");\n            i0.ɵɵtext(30, \"Delivery Address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(31, \"th\");\n            i0.ɵɵtext(32, \"No. of Products\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"th\");\n            i0.ɵɵtext(34, \"Branch\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(35, \"th\");\n            i0.ɵɵtext(36, \"Current Branch\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(37, \"th\");\n            i0.ɵɵtext(38, \"Actions\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(39, \"tbody\");\n            i0.ɵɵtemplate(40, StocksComponent_tr_40_Template, 18, 7, \"tr\", 14);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(41, StocksComponent_div_41_Template, 170, 44, \"div\", 15)(42, StocksComponent_div_42_Template, 95, 28, \"div\", 16)(43, StocksComponent_div_43_Template, 18, 4, \"div\", 17)(44, StocksComponent_div_44_Template, 15, 4, \"div\", 17);\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.activeTab === \"stocks\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.activeTab === \"other-branch\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.activeTab === \"others-in-branch\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchText);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.branchId === \"all-hubs\");\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterDate);\n            i0.ɵɵadvance();\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.filterConsignor);\n            i0.ɵɵadvance(26);\n            i0.ɵɵproperty(\"ngForOf\", ctx.filteredStocks);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedStock);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.editingStock);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showManifestAdjustmentPopup);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showManifestationPopup);\n          }\n        },\n        dependencies: [CommonModule, i3.NgForOf, i3.NgIf, i3.DatePipe, FormsModule, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.CheckboxControlValueAccessor, i4.SelectControlValueAccessor, i4.RadioControlValueAccessor, i4.NgControlStatus, i4.MinValidator, i4.MaxValidator, i4.NgModel],\n        styles: [\".stocks-container[_ngcontent-%COMP%]{padding:20px;color:var(--stock-text)}[_nghost-%COMP%]{--stock-bg: #f6f8fb;--stock-card: #ffffff;--stock-border: #e5e7eb;--stock-text: #0f172a;--stock-muted: #6b7280;--stock-primary: #2563eb;--stock-primary-strong: #1e3a8a;--stock-danger: #dc2626}.filters[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}.stocks-tabs[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:12px}.stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 14px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.stocks-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid var(--stock-border);border-radius:10px;background:#fff;color:var(--stock-text);flex:1 1 190px;min-width:0}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 14px;border-radius:10px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-text);cursor:pointer;flex:0 0 auto}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:var(--stock-primary);color:var(--stock-primary-strong)}.stocks-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;overflow:hidden}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid var(--stock-border);padding:8px;text-align:left}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f8fafc;font-weight:600}.stocks-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:10px;border:1px solid var(--stock-primary);background:var(--stock-primary);color:#fff;cursor:pointer}.stocks-table[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:var(--stock-primary-strong);border-color:var(--stock-primary-strong)}.actions[_ngcontent-%COMP%]{margin-top:15px}.modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0009;display:flex;align-items:center;justify-content:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:500px;max-height:80vh;overflow-y:auto;border-radius:8px;position:relative}.details-modal[_ngcontent-%COMP%]{background:#0f172a8c}.details-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(860px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.details-close[_ngcontent-%COMP%]{position:absolute;right:18px;top:12px;background:transparent;border:none;font-size:24px;cursor:pointer;color:var(--stock-muted)}.details-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}.details-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:22px}.details-sub[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.details-status[_ngcontent-%COMP%]{background:#e0f2fe;color:#0ea5e9;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:600;white-space:nowrap}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 16px;background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px;margin-bottom:16px}.details-products[_ngcontent-%COMP%]{display:grid;gap:12px}.details-invoice[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:12px}.details-invoice-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:8px}.details-product-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:8px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;border-bottom:1px solid var(--stock-border);padding-bottom:6px}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.product-name[_ngcontent-%COMP%]{font-weight:600}.product-meta[_ngcontent-%COMP%]{color:var(--stock-muted);font-size:13px}@media (max-width: 700px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.details-product-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 1200px){.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:7px 9px;font-size:13px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:7px 12px;font-size:13px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:7px;font-size:13px}}@media (max-width: 992px){.filters[_ngcontent-%COMP%]{gap:8px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 10px;font-size:12px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:6px;font-size:12px}}@media (max-width: 768px){.filters[_ngcontent-%COMP%]{gap:6px}.filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .filters[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:5px 7px;font-size:11px}.filters[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .stocks-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 8px;font-size:11px}.stocks-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .stocks-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px;font-size:11px}}.edit-stock-modal[_ngcontent-%COMP%]{background:#0f172a8c}.edit-stock-content[_ngcontent-%COMP%]{background:var(--stock-bg);color:var(--stock-text);width:min(1100px,92vw);max-height:85vh;border-radius:16px;border:1px solid var(--stock-border);box-shadow:0 18px 40px #0f172a33}.edit-stock-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px}.edit-stock-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:22px;color:var(--stock-text)}.edit-stock-meta[_ngcontent-%COMP%]{margin:6px 0 0;color:var(--stock-muted);font-size:13px}.edit-stock-section[_ngcontent-%COMP%]{background:var(--stock-card);border:1px solid var(--stock-border);border-radius:12px;padding:14px;margin-bottom:14px}.edit-stock-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 10px;font-size:15px}.edit-stock-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.edit-stock-content[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:13px;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid var(--stock-border);border-radius:10px;padding:8px 10px;font-size:13px;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{min-height:80px;resize:vertical}.edit-stock-tabs[_ngcontent-%COMP%]{display:flex;gap:8px;margin-bottom:12px}.edit-stock-tabs[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:999px;border:1px solid var(--stock-border);background:#fff;color:var(--stock-muted);cursor:pointer}.edit-stock-tabs[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#eef2ff;border-color:#c7d2fe;color:var(--stock-primary-strong);font-weight:600}.edit-stock-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;margin:10px 0 4px;color:var(--stock-muted);font-size:13px}.edit-stock-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}.edit-stock-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:10px;border:1px solid var(--stock-border);padding:8px 14px;font-size:13px;cursor:pointer;background:#fff;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.primary[_ngcontent-%COMP%]{background:var(--stock-primary);border-color:var(--stock-primary);color:#fff}.edit-stock-content[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]{background:#f8fafc;color:var(--stock-text)}.edit-stock-content[_ngcontent-%COMP%]   button.danger[_ngcontent-%COMP%]{border-color:#fecaca;background:#fef2f2;color:var(--stock-danger)}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{gap:10px}.edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr))}@media (max-width: 900px){.edit-stock-grid[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-3[_ngcontent-%COMP%], .edit-stock-content[_ngcontent-%COMP%]   .grid-4[_ngcontent-%COMP%]{grid-template-columns:1fr}.edit-stock-actions[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}.close[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;font-size:24px;cursor:pointer}.terminal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px}.terminal-status[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-size:12px}.terminal-status[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background:#2a2a2a;color:#d4d4d4;border:1px solid #444;border-radius:6px;padding:4px 8px}.modal-content.terminal-style[_ngcontent-%COMP%]{background-color:#1e1e1e;color:#d4d4d4;font-family:Courier New,monospace;border-radius:10px;padding:20px;width:80%;max-height:80vh;overflow-y:auto}.consignment-block[_ngcontent-%COMP%]{background:#2a2a2a;padding:10px;border-radius:6px;margin-bottom:10px}.terminal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 20px;border:none;border-radius:6px;cursor:pointer}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#007acc;color:#fff}.terminal-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:#555;color:#fff}.product-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:4px 0}.hub-charge-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:6px;margin:6px 0 10px}.hub-charge-row[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:12px}.hub-pickup-toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px}.hub-charge-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px}.hub-charge-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80px;padding:4px;background-color:#333;color:#fff;border:1px solid #555;border-radius:4px;text-align:right}.hub-charge-row[_ngcontent-%COMP%]   .hint[_ngcontent-%COMP%]{color:#9ca3af;font-size:12px}.manifest-input[_ngcontent-%COMP%]{width:60px;padding:4px;margin-left:4px;background-color:#333;color:#fff;border:1px solid #555;border-radius:4px;text-align:right}.eway-toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;position:relative;cursor:pointer;-webkit-user-select:none;user-select:none}.eway-toggle-input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.eway-toggle-slider[_ngcontent-%COMP%]{position:relative;width:40px;height:20px;background-color:#ccc;border-radius:20px;transition:background-color .3s}.eway-toggle-slider[_ngcontent-%COMP%]:before{content:\\\"\\\";position:absolute;height:16px;width:16px;left:2px;bottom:2px;background-color:#fff;border-radius:50%;transition:transform .3s}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]{background-color:#4caf50}.eway-toggle-input[_ngcontent-%COMP%]:checked + .eway-toggle-slider[_ngcontent-%COMP%]:before{transform:translate(20px)}.eway-toggle-text[_ngcontent-%COMP%]{font-weight:500}.routing-section[_ngcontent-%COMP%]{margin-top:20px}.routing-controls[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:10px}.route-list[_ngcontent-%COMP%]{list-style:none;padding-left:0}.route-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.remove-btn[_ngcontent-%COMP%]{background:none;border:none;color:red;cursor:pointer}.routing-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}.external-toggle[_ngcontent-%COMP%]{margin-left:auto}\"]\n      });\n    }\n  }\n  return StocksComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}