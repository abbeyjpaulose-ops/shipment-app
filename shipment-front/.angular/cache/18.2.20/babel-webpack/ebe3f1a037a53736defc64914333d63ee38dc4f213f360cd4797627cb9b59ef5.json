{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { of } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction NewShipmentComponent_div_33_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", h_r3._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(h_r3.hubName);\n  }\n}\nfunction NewShipmentComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 43)(1, \"div\", 44)(2, \"span\");\n    i0.ɵɵtext(3, \"Hub\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_33_Template_select_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedAllHubId, $event) || (ctx_r1.selectedAllHubId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_33_Template_select_change_4_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onAllHubsSelect(ctx_r1.selectedAllHubId));\n    });\n    i0.ɵɵelementStart(5, \"option\", 33);\n    i0.ɵɵtext(6, \"Select hub\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, NewShipmentComponent_div_33_option_7_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedAllHubId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getAllHubsOptions());\n  }\n}\nfunction NewShipmentComponent_div_60_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r5 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", c_r5.clientName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatClientOption(c_r5), \" \");\n  }\n}\nfunction NewShipmentComponent_div_60_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3, \"Saved clients\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_60_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openClientModal());\n    });\n    i0.ɵɵtext(5, \"+ New Client/Edit Client\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Sender Name \");\n    i0.ɵɵelementStart(8, \"input\", 64);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_60_Template_input_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.consignor, $event) || (ctx_r1.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_div_60_Template_input_ngModelChange_8_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onConsignorSelect(ctx_r1.consignor));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"datalist\", 65);\n    i0.ɵɵtemplate(10, NewShipmentComponent_div_60_option_10_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.consignor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.clientList);\n  }\n}\nfunction NewShipmentComponent_div_61_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const g_r7 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", g_r7.guestName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatGuestOption(g_r7), \" \");\n  }\n}\nfunction NewShipmentComponent_div_61_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3, \"Guest senders\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_61_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openGuestModal());\n    });\n    i0.ɵɵtext(5, \"+ New Guest\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Guest Sender \");\n    i0.ɵɵelementStart(8, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_61_Template_select_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.consignor, $event) || (ctx_r1.consignor = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_61_Template_select_change_8_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onConsignorGuestSelect(ctx_r1.consignor));\n    });\n    i0.ɵɵtemplate(9, NewShipmentComponent_div_61_option_9_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.consignor);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.guestList);\n  }\n}\nfunction NewShipmentComponent_div_64_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 25)(1, \"span\", 26);\n    i0.ɵɵtext(2, \"Selected client\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_64_div_1_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.openPickupEditClient());\n    });\n    i0.ɵɵtext(4, \"+ Edit address\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction NewShipmentComponent_div_64_optgroup_7_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loc_r10 = ctx.$implicit;\n    const i_r11 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"value\", \"consignor:\" + i_r11);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Consignor: \", ctx_r1.formatLocation(loc_r10), \" \");\n  }\n}\nfunction NewShipmentComponent_div_64_optgroup_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"optgroup\", 70);\n    i0.ɵɵtemplate(1, NewShipmentComponent_div_64_optgroup_7_option_1_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getPickupConsignorLocations());\n  }\n}\nfunction NewShipmentComponent_div_64_optgroup_8_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loc_r12 = ctx.$implicit;\n    const i_r13 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"value\", \"billing:\" + i_r13);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Billing: \", ctx_r1.formatLocation(loc_r12), \" \");\n  }\n}\nfunction NewShipmentComponent_div_64_optgroup_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"optgroup\", 71);\n    i0.ɵɵtemplate(1, NewShipmentComponent_div_64_optgroup_8_option_1_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getPickupBillingLocations());\n  }\n}\nfunction NewShipmentComponent_div_64_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtemplate(1, NewShipmentComponent_div_64_div_1_Template, 5, 0, \"div\", 66);\n    i0.ɵɵelementStart(2, \"label\");\n    i0.ɵɵtext(3, \"Pickup Point \");\n    i0.ɵɵelementStart(4, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_64_Template_select_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.pickupSource, $event) || (ctx_r1.pickupSource = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_64_Template_select_change_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onPickupSourceSelect(ctx_r1.pickupSource));\n    });\n    i0.ɵɵelementStart(5, \"option\", 67);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, NewShipmentComponent_div_64_optgroup_7_Template, 2, 1, \"optgroup\", 68)(8, NewShipmentComponent_div_64_optgroup_8_Template, 2, 1, \"optgroup\", 69);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.getPickupSourceClientId());\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.pickupSource);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Branch - \", ctx_r1.pickupName || ctx_r1.branch || \"-\", \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.getPickupConsignorLocations().length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.getPickupBillingLocations().length);\n  }\n}\nfunction NewShipmentComponent_div_65_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 36)(2, \"span\", 37);\n    i0.ɵɵtext(3, \"Branch\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 38);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 36)(7, \"span\", 37);\n    i0.ɵɵtext(8, \"Pickup Address\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"span\", 38);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 36)(12, \"span\", 37);\n    i0.ɵɵtext(13, \"Pickup Phone\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"span\", 38);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 36)(17, \"span\", 37);\n    i0.ɵɵtext(18, \"Pickup Pincode\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"span\", 38);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.pickupName || ctx_r1.branch || \"-\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.pickupAddress || \"-\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.pickupPhone || \"-\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.pickupPincode || \"-\");\n  }\n}\nfunction NewShipmentComponent_div_75_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r15 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", c_r15.clientName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatClientOption(c_r15), \" \");\n  }\n}\nfunction NewShipmentComponent_div_75_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3, \"Saved clients\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_75_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openClientModal());\n    });\n    i0.ɵɵtext(5, \"+ New Client/Edit Client\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Receiver Name \");\n    i0.ɵɵelementStart(8, \"input\", 72);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_75_Template_input_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.consignee, $event) || (ctx_r1.consignee = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_75_Template_input_change_8_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onConsigneeSelect(ctx_r1.consignee));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"datalist\", 73);\n    i0.ɵɵtemplate(10, NewShipmentComponent_div_75_option_10_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.consignee);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.clientList);\n  }\n}\nfunction NewShipmentComponent_div_76_option_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const g_r17 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"value\", g_r17.guestName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatGuestOption(g_r17), \" \");\n  }\n}\nfunction NewShipmentComponent_div_76_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3, \"Guest receivers\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_76_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openGuestModal());\n    });\n    i0.ɵɵtext(5, \"+ New Guest\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Guest Receiver \");\n    i0.ɵɵelementStart(8, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_76_Template_select_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.consignee, $event) || (ctx_r1.consignee = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_76_Template_select_change_8_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onConsigneeGuestSelect(ctx_r1.consignee));\n    });\n    i0.ɵɵtemplate(9, NewShipmentComponent_div_76_option_9_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.consignee);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.guestList);\n  }\n}\nfunction NewShipmentComponent_option_96_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r18 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"value\", c_r18.clientName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatClientOption(c_r18), \" \");\n  }\n}\nfunction NewShipmentComponent_option_102_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loc_r19 = ctx.$implicit;\n    const i_r20 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"value\", i_r20);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatLocation(loc_r19), \" \");\n  }\n}\nfunction NewShipmentComponent_option_133_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\");\n    i0.ɵɵtext(1, \"To Pay with account credit\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NewShipmentComponent_option_134_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\");\n    i0.ɵɵtext(1, \"Account Credit\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NewShipmentComponent_div_137_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r22 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", \"client:\" + c_r22._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", c_r22.clientName, \" \");\n  }\n}\nfunction NewShipmentComponent_div_137_option_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const h_r23 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", \"hub:\" + h_r23._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", h_r23.hubName, \" \");\n  }\n}\nfunction NewShipmentComponent_div_137_option_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const addr_r24 = ctx.$implicit;\n    const i_r25 = ctx.index;\n    i0.ɵɵproperty(\"value\", i_r25);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", addr_r24.label, \" \");\n  }\n}\nfunction NewShipmentComponent_div_137_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 25)(2, \"span\", 26);\n    i0.ɵɵtext(3, \"Saved clients\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_137_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.openClientModal());\n    });\n    i0.ɵɵtext(5, \"+ New Client/Edit Client\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Billing Name \");\n    i0.ɵɵelementStart(8, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_137_Template_select_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.billingSource, $event) || (ctx_r1.billingSource = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_137_Template_select_change_8_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onBillingSourceSelect(ctx_r1.billingSource));\n    });\n    i0.ɵɵelementStart(9, \"option\", 33);\n    i0.ɵɵtext(10, \"Select client or hub\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"optgroup\", 74);\n    i0.ɵɵtemplate(12, NewShipmentComponent_div_137_option_12_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"optgroup\", 75);\n    i0.ɵɵtemplate(14, NewShipmentComponent_div_137_option_14_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(15, \"label\");\n    i0.ɵɵtext(16, \"Billing Address \");\n    i0.ɵɵelementStart(17, \"select\", 35);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_137_Template_select_ngModelChange_17_listener($event) {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.billingLocationIndex, $event) || (ctx_r1.billingLocationIndex = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_137_Template_select_change_17_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onBillingAddressSelect(ctx_r1.billingLocationIndex));\n    });\n    i0.ɵɵelementStart(18, \"option\", 33);\n    i0.ɵɵtext(19, \"Select address\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(20, NewShipmentComponent_div_137_option_20_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(21, \"div\", 36)(22, \"span\", 37);\n    i0.ɵɵtext(23, \"GSTIN\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"span\", 38);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(26, \"div\", 36)(27, \"span\", 37);\n    i0.ɵɵtext(28, \"Phone\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"span\", 38);\n    i0.ɵɵtext(30);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.billingSource);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.clientList);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getAvailableHubs());\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.billingLocationIndex);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.billingSource);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.billingAddressOptions);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.billingGSTIN || \"-\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r1.billingPhone || \"-\");\n  }\n}\nfunction NewShipmentComponent_div_138_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 33);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.consignorAddress || \"\");\n  }\n}\nfunction NewShipmentComponent_div_138_optgroup_5_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loc_r27 = ctx.$implicit;\n    const i_r28 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"value\", \"consignor:\" + i_r28);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatLocation(loc_r27), \" \");\n  }\n}\nfunction NewShipmentComponent_div_138_optgroup_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"optgroup\", 70);\n    i0.ɵɵtemplate(1, NewShipmentComponent_div_138_optgroup_5_option_1_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getConsignorLocations());\n  }\n}\nfunction NewShipmentComponent_div_138_optgroup_6_option_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const loc_r29 = ctx.$implicit;\n    const i_r30 = ctx.index;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"value\", \"consignee:\" + i_r30);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.formatLocation(loc_r29), \" \");\n  }\n}\nfunction NewShipmentComponent_div_138_optgroup_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"optgroup\", 78);\n    i0.ɵɵtemplate(1, NewShipmentComponent_div_138_optgroup_6_option_1_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.getConsigneeLocations());\n  }\n}\nfunction NewShipmentComponent_div_138_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"label\");\n    i0.ɵɵtext(2, \"Address \");\n    i0.ɵɵelementStart(3, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_138_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.billingLocationIndex, $event) || (ctx_r1.billingLocationIndex = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_138_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onBillingLocationSelect(ctx_r1.billingLocationIndex));\n    });\n    i0.ɵɵtemplate(4, NewShipmentComponent_div_138_option_4_Template, 2, 1, \"option\", 76)(5, NewShipmentComponent_div_138_optgroup_5_Template, 2, 1, \"optgroup\", 68)(6, NewShipmentComponent_div_138_optgroup_6_Template, 2, 1, \"optgroup\", 77);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.billingLocationIndex);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.getConsignorLocations().length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.getConsignorLocations().length);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.consigneeTab === \"consignee\" && ctx_r1.getConsigneeLocations().length);\n  }\n}\nfunction NewShipmentComponent_div_139_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 79);\n    i0.ɵɵtext(1, \" Using guest consignor details \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_div_16_option_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const prod_r39 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", prod_r39.productName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", prod_r39.hsnNum, \" - \", prod_r39.productName, \" \");\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_div_16_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 101);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const product_r38 = i0.ɵɵnextContext().$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Suggested: \", ctx_r1.getSuggestedRate(product_r38), \" \");\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r37 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 95)(1, \"div\", 96)(2, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_16_Template_select_ngModelChange_2_listener($event) {\n      const product_r38 = i0.ɵɵrestoreView(_r37).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r38.type, $event) || (product_r38.type = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_161_div_9_div_16_Template_select_change_2_listener() {\n      const product_r38 = i0.ɵɵrestoreView(_r37).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.onProductTypeChange(product_r38));\n    });\n    i0.ɵɵtemplate(3, NewShipmentComponent_div_161_div_9_div_16_option_3_Template, 2, 3, \"option\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 97);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_16_Template_input_ngModelChange_4_listener($event) {\n      const product_r38 = i0.ɵɵrestoreView(_r37).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r38.amount, $event) || (product_r38.amount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_16_Template_input_ngModelChange_4_listener() {\n      i0.ɵɵrestoreView(_r37);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.scheduleQuote());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_div_16_Template_button_click_5_listener() {\n      const p_r40 = i0.ɵɵrestoreView(_r37).index;\n      const i_r35 = i0.ɵɵnextContext().index;\n      const e_r32 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.deleteProduct(e_r32, i_r35, p_r40));\n    });\n    i0.ɵɵtext(6, \"\\u30D0\\u0007\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 98)(8, \"input\", 99);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_16_Template_input_ngModelChange_8_listener($event) {\n      const product_r38 = i0.ɵɵrestoreView(_r37).$implicit;\n      i0.ɵɵtwoWayBindingSet(product_r38.ratePer, $event) || (product_r38.ratePer = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_16_Template_input_ngModelChange_8_listener() {\n      i0.ɵɵrestoreView(_r37);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.scheduleQuote());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, NewShipmentComponent_div_161_div_9_div_16_span_9_Template, 2, 1, \"span\", 100);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const product_r38 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r38.type);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.productList);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r38.amount);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", product_r38.ratePer);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.getSuggestedRate(product_r38) !== null);\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_div_22_option_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r43 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", p_r43.pkgName);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(p_r43.pkgName);\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r41 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 96)(1, \"select\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_22_Template_select_ngModelChange_1_listener($event) {\n      const pkg_r42 = i0.ɵɵrestoreView(_r41).$implicit;\n      i0.ɵɵtwoWayBindingSet(pkg_r42.type, $event) || (pkg_r42.type = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵtemplate(2, NewShipmentComponent_div_161_div_9_div_22_option_2_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 97);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_22_Template_input_ngModelChange_3_listener($event) {\n      const pkg_r42 = i0.ɵɵrestoreView(_r41).$implicit;\n      i0.ɵɵtwoWayBindingSet(pkg_r42.amount, $event) || (pkg_r42.amount = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_div_22_Template_input_ngModelChange_3_listener() {\n      i0.ɵɵrestoreView(_r41);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.scheduleQuote());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_div_22_Template_button_click_4_listener() {\n      const j_r44 = i0.ɵɵrestoreView(_r41).index;\n      const i_r35 = i0.ɵɵnextContext().index;\n      const e_r32 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.deletePackage(e_r32, i_r35, j_r44));\n    });\n    i0.ɵɵtext(5, \"\\u30D0\\u0007\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const pkg_r42 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", pkg_r42.type);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.pkgList);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", pkg_r42.amount);\n  }\n}\nfunction NewShipmentComponent_div_161_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r34 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 87)(1, \"div\", 81)(2, \"div\")(3, \"div\", 2);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_Template_button_click_5_listener() {\n      const i_r35 = i0.ɵɵrestoreView(_r34).index;\n      const e_r32 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.deleteInvoice(e_r32, i_r35));\n    });\n    i0.ɵɵtext(6, \"\\u30D0\\u0007\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 83)(8, \"input\", 88);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_Template_input_ngModelChange_8_listener($event) {\n      const invoice_r36 = i0.ɵɵrestoreView(_r34).$implicit;\n      i0.ɵɵtwoWayBindingSet(invoice_r36.number, $event) || (invoice_r36.number = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"input\", 89);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_Template_input_ngModelChange_9_listener($event) {\n      const invoice_r36 = i0.ɵɵrestoreView(_r34).$implicit;\n      i0.ɵɵtwoWayBindingSet(invoice_r36.value, $event) || (invoice_r36.value = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_div_161_div_9_Template_input_ngModelChange_9_listener() {\n      i0.ɵɵrestoreView(_r34);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.scheduleQuote());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 90)(11, \"div\", 91)(12, \"div\", 92);\n    i0.ɵɵtext(13, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_Template_button_click_14_listener() {\n      i0.ɵɵrestoreView(_r34);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.openProductModal());\n    });\n    i0.ɵɵtext(15, \"+ New Product\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(16, NewShipmentComponent_div_161_div_9_div_16_Template, 10, 5, \"div\", 93);\n    i0.ɵɵelementStart(17, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_Template_button_click_17_listener() {\n      const i_r35 = i0.ɵɵrestoreView(_r34).index;\n      const e_r32 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addProduct(e_r32, i_r35));\n    });\n    i0.ɵɵtext(18, \"+ Product\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"div\", 90)(20, \"div\", 92);\n    i0.ɵɵtext(21, \"Packages\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(22, NewShipmentComponent_div_161_div_9_div_22_Template, 6, 3, \"div\", 94);\n    i0.ɵɵelementStart(23, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_div_9_Template_button_click_23_listener() {\n      const i_r35 = i0.ɵɵrestoreView(_r34).index;\n      const e_r32 = i0.ɵɵnextContext().index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addPackage(e_r32, i_r35));\n    });\n    i0.ɵɵtext(24, \"+ Package\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const invoice_r36 = ctx.$implicit;\n    const i_r35 = ctx.index;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"Invoice \", i_r35 + 1, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", invoice_r36.number);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", invoice_r36.value);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r36.products);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngForOf\", invoice_r36.packages);\n  }\n}\nfunction NewShipmentComponent_div_161_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r31 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 80)(1, \"div\", 81)(2, \"div\", 2);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_Template_button_click_4_listener() {\n      const e_r32 = i0.ɵɵrestoreView(_r31).index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.deleteEwaybill(e_r32));\n    });\n    i0.ɵɵtext(5, \"\\u30D0\\u0007\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 83)(7, \"input\", 84);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_Template_input_ngModelChange_7_listener($event) {\n      const ewb_r33 = i0.ɵɵrestoreView(_r31).$implicit;\n      i0.ɵɵtwoWayBindingSet(ewb_r33.number, $event) || (ewb_r33.number = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"input\", 6);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_161_Template_input_ngModelChange_8_listener($event) {\n      const ewb_r33 = i0.ɵɵrestoreView(_r31).$implicit;\n      i0.ɵɵtwoWayBindingSet(ewb_r33.date, $event) || (ewb_r33.date = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(9, NewShipmentComponent_div_161_div_9_Template, 25, 5, \"div\", 85);\n    i0.ɵɵelementStart(10, \"button\", 86);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_161_Template_button_click_10_listener() {\n      const e_r32 = i0.ɵɵrestoreView(_r31).index;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addInvoice(e_r32));\n    });\n    i0.ɵɵtext(11, \"+ Invoice\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ewb_r33 = ctx.$implicit;\n    const e_r32 = ctx.index;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"E-Waybill \", e_r32 + 1, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ewb_r33.number);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ewb_r33.date);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ewb_r33.invoices);\n  }\n}\nfunction NewShipmentComponent_div_228_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r45 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 103)(1, \"div\", 104)(2, \"div\", 105)(3, \"h3\");\n    i0.ɵɵtext(4, \"Final Amount is 0\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_228_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r45);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.cancelFinalAmountSave());\n    });\n    i0.ɵɵtext(6, \"x\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"p\", 79);\n    i0.ɵɵtext(8, \"Do you want to continue saving?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 106)(10, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_228_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r45);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.cancelFinalAmountSave());\n    });\n    i0.ɵɵtext(11, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_228_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r45);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.confirmFinalAmountSave());\n    });\n    i0.ɵɵtext(13, \"Continue\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nfunction NewShipmentComponent_div_229_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r47 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 110)(1, \"div\", 111)(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 112)(9, \"label\", 113)(10, \"input\", 28);\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_229_div_15_Template_input_change_10_listener($event) {\n      const item_r48 = i0.ɵɵrestoreView(_r47).$implicit;\n      return i0.ɵɵresetView(item_r48.action = $event.target.checked ? \"suggest\" : \"override\");\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"span\", 29);\n    i0.ɵɵelement(12, \"span\", 30);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const item_r48 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(item_r48.productName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Suggested: \", item_r48.suggestedRate === null || item_r48.suggestedRate === undefined ? \"-\" : item_r48.suggestedRate, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Entered: \", item_r48.enteredRate, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"checked\", item_r48.action === \"suggest\");\n  }\n}\nfunction NewShipmentComponent_div_229_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r46 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 103)(1, \"div\", 104)(2, \"div\", 105)(3, \"h3\");\n    i0.ɵɵtext(4, \"Override Suggested Rates\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_229_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r46);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.showRateOverrideModal = false);\n    });\n    i0.ɵɵtext(6, \"x\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"p\", 79);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 107)(10, \"div\", 108)(11, \"span\");\n    i0.ɵɵtext(12, \"Products\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"span\");\n    i0.ɵɵtext(14, \"Save as new suggested\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(15, NewShipmentComponent_div_229_div_15_Template, 13, 4, \"div\", 109);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 106)(17, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_229_Template_button_click_17_listener() {\n      i0.ɵɵrestoreView(_r46);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.confirmRateOverride());\n    });\n    i0.ɵɵtext(18, \"OK\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵtextInterpolate1(\"GSTIN ID: \", ctx_r1.getPricingGstinId(), \"\");\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.rateOverrides);\n  }\n}\nfunction NewShipmentComponent_div_230_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r50 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 120)(1, \"input\", 121);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_div_15_Template_input_ngModelChange_1_listener($event) {\n      const rate_r51 = i0.ɵɵrestoreView(_r50).$implicit;\n      i0.ɵɵtwoWayBindingSet(rate_r51.pickupLocationId, $event) || (rate_r51.pickupLocationId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"input\", 122);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_div_15_Template_input_ngModelChange_2_listener($event) {\n      const rate_r51 = i0.ɵɵrestoreView(_r50).$implicit;\n      i0.ɵɵtwoWayBindingSet(rate_r51.deliveryLocationId, $event) || (rate_r51.deliveryLocationId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 123);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_div_15_Template_input_ngModelChange_3_listener($event) {\n      const rate_r51 = i0.ɵɵrestoreView(_r50).$implicit;\n      i0.ɵɵtwoWayBindingSet(rate_r51.rate.ratePerNum, $event) || (rate_r51.rate.ratePerNum = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 124);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_div_15_Template_input_ngModelChange_4_listener($event) {\n      const rate_r51 = i0.ɵɵrestoreView(_r50).$implicit;\n      i0.ɵɵtwoWayBindingSet(rate_r51.rate.ratePerVolume, $event) || (rate_r51.rate.ratePerVolume = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 125);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_div_15_Template_input_ngModelChange_5_listener($event) {\n      const rate_r51 = i0.ɵɵrestoreView(_r50).$implicit;\n      i0.ɵɵtwoWayBindingSet(rate_r51.rate.ratePerKg, $event) || (rate_r51.rate.ratePerKg = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 117);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_230_div_15_Template_button_click_6_listener() {\n      const i_r52 = i0.ɵɵrestoreView(_r50).index;\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.removeProductRateRow(i_r52));\n    });\n    i0.ɵɵtext(7, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const rate_r51 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", rate_r51.pickupLocationId);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", rate_r51.deliveryLocationId);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", rate_r51.rate.ratePerNum);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", rate_r51.rate.ratePerVolume);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", rate_r51.rate.ratePerKg);\n  }\n}\nfunction NewShipmentComponent_div_230_option_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"option\", 126);\n  }\n  if (rf & 2) {\n    const opt_r53 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", opt_r53.id)(\"label\", opt_r53.label);\n  }\n}\nfunction NewShipmentComponent_div_230_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r49 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 103)(1, \"div\", 114)(2, \"div\", 105)(3, \"h3\");\n    i0.ɵɵtext(4, \"Add Product\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 115);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_230_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeProductModal());\n    });\n    i0.ɵɵtext(6, \"x\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"HSN Number* \");\n    i0.ɵɵelementStart(9, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newProduct.hsnNum, $event) || (ctx_r1.newProduct.hsnNum = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Product Name* \");\n    i0.ɵɵelementStart(12, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_230_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newProduct.productName, $event) || (ctx_r1.newProduct.productName = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"h4\");\n    i0.ɵɵtext(14, \"Rates by Route\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, NewShipmentComponent_div_230_div_15_Template, 8, 5, \"div\", 116);\n    i0.ɵɵelementStart(16, \"button\", 117);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_230_Template_button_click_16_listener() {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addProductRateRow());\n    });\n    i0.ɵɵtext(17, \"+ Add Rate\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"datalist\", 118);\n    i0.ɵɵtemplate(19, NewShipmentComponent_div_230_option_19_Template, 1, 2, \"option\", 119);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"div\", 106)(21, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_230_Template_button_click_21_listener() {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveNewProduct());\n    });\n    i0.ɵɵtext(22, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_230_Template_button_click_23_listener() {\n      i0.ɵɵrestoreView(_r49);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeProductModal());\n    });\n    i0.ɵɵtext(24, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newProduct.hsnNum);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newProduct.productName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.newProduct.rates);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.rateAddressOptions);\n  }\n}\nfunction NewShipmentComponent_div_231_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r55 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 128)(1, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_7_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r55);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.setClientModalTab(\"add\"));\n    });\n    i0.ɵɵtext(2, \"New Client\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_7_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r55);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.setClientModalTab(\"edit\"));\n    });\n    i0.ɵɵtext(4, \"Edit Client\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵclassProp(\"active\", ctx_r1.clientModalTab === \"add\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r1.clientModalTab === \"edit\");\n  }\n}\nfunction NewShipmentComponent_div_231_div_8_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r57 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 120)(1, \"input\", 134);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_div_22_Template_input_ngModelChange_1_listener($event) {\n      const d_r58 = i0.ɵɵrestoreView(_r57).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r58.address, $event) || (d_r58.address = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"input\", 130);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_div_22_Template_input_ngModelChange_2_listener($event) {\n      const d_r58 = i0.ɵɵrestoreView(_r57).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r58.city, $event) || (d_r58.city = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 131);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_div_22_Template_input_ngModelChange_3_listener($event) {\n      const d_r58 = i0.ɵɵrestoreView(_r57).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r58.state, $event) || (d_r58.state = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 132);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_div_22_Template_input_ngModelChange_4_listener($event) {\n      const d_r58 = i0.ɵɵrestoreView(_r57).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r58.pinCode, $event) || (d_r58.pinCode = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_8_div_22_Template_button_click_5_listener() {\n      const i_r59 = i0.ɵɵrestoreView(_r57).index;\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.removeDeliveryLocation(i_r59));\n    });\n    i0.ɵɵtext(6, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const d_r58 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r58.address);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r58.city);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r58.state);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r58.pinCode);\n  }\n}\nfunction NewShipmentComponent_div_231_div_8_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 135);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.clientError);\n  }\n}\nfunction NewShipmentComponent_div_231_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r56 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\");\n    i0.ɵɵtext(2, \"Name* \");\n    i0.ɵɵelementStart(3, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.clientName, $event) || (ctx_r1.newClient.clientName = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"GSTIN* \");\n    i0.ɵɵelementStart(6, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.GSTIN, $event) || (ctx_r1.newClient.GSTIN = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Phone* \");\n    i0.ɵɵelementStart(9, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.phoneNum, $event) || (ctx_r1.newClient.phoneNum = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Branch* \");\n    i0.ɵɵelementStart(12, \"input\", 13);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.branch, $event) || (ctx_r1.newClient.branch = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"label\");\n    i0.ɵɵtext(14, \"Address* \");\n    i0.ɵɵelementStart(15, \"textarea\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_textarea_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.address, $event) || (ctx_r1.newClient.address = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 129)(17, \"input\", 130);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_17_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.city, $event) || (ctx_r1.newClient.city = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"input\", 131);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_18_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.state, $event) || (ctx_r1.newClient.state = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"input\", 132);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_8_Template_input_ngModelChange_19_listener($event) {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newClient.pinCode, $event) || (ctx_r1.newClient.pinCode = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"h4\");\n    i0.ɵɵtext(21, \"Delivery Locations\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(22, NewShipmentComponent_div_231_div_8_div_22_Template, 7, 4, \"div\", 116);\n    i0.ɵɵelementStart(23, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_8_Template_button_click_23_listener() {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.addDeliveryLocation());\n    });\n    i0.ɵɵtext(24, \"+ Add Delivery Location\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, NewShipmentComponent_div_231_div_8_div_25_Template, 2, 1, \"div\", 133);\n    i0.ɵɵelementStart(26, \"div\", 106)(27, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_8_Template_button_click_27_listener() {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.saveNewClient());\n    });\n    i0.ɵɵtext(28, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_8_Template_button_click_29_listener() {\n      i0.ɵɵrestoreView(_r56);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.closeModals());\n    });\n    i0.ɵɵtext(30, \"Cancel\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.clientName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.GSTIN);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.phoneNum);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.branch);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.address);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.city);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.state);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newClient.pinCode);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.newClient.deliveryLocations);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.clientError);\n  }\n}\nfunction NewShipmentComponent_div_231_div_9_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 63);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r61 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"value\", c_r61._id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.formatClientOption(c_r61));\n  }\n}\nfunction NewShipmentComponent_div_231_div_9_div_7_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r63 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 120)(1, \"input\", 134);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_9_div_7_div_18_Template_input_ngModelChange_1_listener($event) {\n      const d_r64 = i0.ɵɵrestoreView(_r63).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r64.address, $event) || (d_r64.address = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"input\", 130);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_9_div_7_div_18_Template_input_ngModelChange_2_listener($event) {\n      const d_r64 = i0.ɵɵrestoreView(_r63).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r64.city, $event) || (d_r64.city = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 131);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_9_div_7_div_18_Template_input_ngModelChange_3_listener($event) {\n      const d_r64 = i0.ɵɵrestoreView(_r63).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r64.state, $event) || (d_r64.state = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 132);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_9_div_7_div_18_Template_input_ngModelChange_4_listener($event) {\n      const d_r64 = i0.ɵɵrestoreView(_r63).$implicit;\n      i0.ɵɵtwoWayBindingSet(d_r64.pinCode, $event) || (d_r64.pinCode = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_9_div_7_div_18_Template_button_click_5_listener() {\n      const i_r65 = i0.ɵɵrestoreView(_r63).index;\n      const ctx_r1 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r1.removeEditDeliveryLocation(i_r65));\n    });\n    i0.ɵɵtext(6, \"Remove\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const d_r64 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r64.address);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r64.city);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r64.state);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", d_r64.pinCode);\n  }\n}\nfunction NewShipmentComponent_div_231_div_9_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r62 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\");\n    i0.ɵɵtext(2, \"Name \");\n    i0.ɵɵelement(3, \"input\", 137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"GSTIN \");\n    i0.ɵɵelement(6, \"input\", 137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Phone \");\n    i0.ɵɵelement(9, \"input\", 137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Branch \");\n    i0.ɵɵelement(12, \"input\", 137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"label\");\n    i0.ɵɵtext(14, \"Address \");\n    i0.ɵɵelement(15, \"textarea\", 137);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"h4\");\n    i0.ɵɵtext(17, \"Delivery Locations\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(18, NewShipmentComponent_div_231_div_9_div_7_div_18_Template, 7, 4, \"div\", 116);\n    i0.ɵɵelementStart(19, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_9_div_7_Template_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r62);\n      const ctx_r1 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r1.addEditDeliveryLocation());\n    });\n    i0.ɵɵtext(20, \"+ Add Delivery Location\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.editClient.clientName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.editClient.GSTIN);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.editClient.phoneNum);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.editClient.branch);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.editClient.address);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.editClient.deliveryLocations);\n  }\n}\nfunction NewShipmentComponent_div_231_div_9_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 135);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.editClientError);\n  }\n}\nfunction NewShipmentComponent_div_231_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r60 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\");\n    i0.ɵɵtext(2, \"Select Client \");\n    i0.ɵɵelementStart(3, \"select\", 32);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_231_div_9_Template_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r60);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      i0.ɵɵtwoWayBindingSet(ctx_r1.selectedEditClientId, $event) || (ctx_r1.selectedEditClientId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function NewShipmentComponent_div_231_div_9_Template_select_change_3_listener() {\n      i0.ɵɵrestoreView(_r60);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onEditClientSelect(ctx_r1.selectedEditClientId));\n    });\n    i0.ɵɵelementStart(4, \"option\", 33);\n    i0.ɵɵtext(5, \"Select...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, NewShipmentComponent_div_231_div_9_option_6_Template, 2, 2, \"option\", 34);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(7, NewShipmentComponent_div_231_div_9_div_7_Template, 21, 6, \"div\", 23)(8, NewShipmentComponent_div_231_div_9_div_8_Template, 2, 1, \"div\", 133);\n    i0.ɵɵelementStart(9, \"div\", 106)(10, \"button\", 136);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_9_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r60);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.saveEditedClient());\n    });\n    i0.ɵɵtext(11, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_div_9_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r60);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.closeModals());\n    });\n    i0.ɵɵtext(13, \"Cancel\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.selectedEditClientId);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.editableClientList);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editClient == null ? null : ctx_r1.editClient._id);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.editClientError);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.selectedEditClientId);\n  }\n}\nfunction NewShipmentComponent_div_231_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r54 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 103)(1, \"div\", 104)(2, \"div\", 105)(3, \"h3\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_231_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r54);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeModals());\n    });\n    i0.ɵɵtext(6, \"?\\u0007\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(7, NewShipmentComponent_div_231_div_7_Template, 5, 4, \"div\", 127)(8, NewShipmentComponent_div_231_div_8_Template, 31, 10, \"div\", 23)(9, NewShipmentComponent_div_231_div_9_Template, 14, 5, \"div\", 23);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r1.showClientAddTab ? \"Add Client\" : \"Edit Address\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.showClientAddTab);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.showClientAddTab && ctx_r1.clientModalTab === \"add\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.clientModalTab === \"edit\");\n  }\n}\nfunction NewShipmentComponent_div_232_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 135);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.guestError);\n  }\n}\nfunction NewShipmentComponent_div_232_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r66 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 103)(1, \"div\", 104)(2, \"div\", 105)(3, \"h3\");\n    i0.ɵɵtext(4, \"Add Guest\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 82);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_232_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeModals());\n    });\n    i0.ɵɵtext(6, \"\\u30D0\\u0007\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Name* \");\n    i0.ɵɵelementStart(9, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_9_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.guestName, $event) || (ctx_r1.newGuest.guestName = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵtext(11, \"Phone* \");\n    i0.ɵɵelementStart(12, \"input\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.phoneNum, $event) || (ctx_r1.newGuest.phoneNum = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"label\");\n    i0.ɵɵtext(14, \"Discount % \");\n    i0.ɵɵelementStart(15, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_15_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.perDis, $event) || (ctx_r1.newGuest.perDis = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"label\");\n    i0.ɵɵtext(17, \"Address* \");\n    i0.ɵɵelementStart(18, \"textarea\", 102);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_textarea_ngModelChange_18_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.address, $event) || (ctx_r1.newGuest.address = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"div\", 129)(20, \"input\", 130);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_20_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.city, $event) || (ctx_r1.newGuest.city = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"input\", 131);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_21_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.state, $event) || (ctx_r1.newGuest.state = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"input\", 132);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_div_232_Template_input_ngModelChange_22_listener($event) {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newGuest.pinCode, $event) || (ctx_r1.newGuest.pinCode = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(23, NewShipmentComponent_div_232_div_23_Template, 2, 1, \"div\", 133);\n    i0.ɵɵelementStart(24, \"div\", 106)(25, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_232_Template_button_click_25_listener() {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveNewGuest());\n    });\n    i0.ɵɵtext(26, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function NewShipmentComponent_div_232_Template_button_click_27_listener() {\n      i0.ɵɵrestoreView(_r66);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.closeModals());\n    });\n    i0.ɵɵtext(28, \"Cancel\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.guestName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.phoneNum);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.perDis);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.address);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.city);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.state);\n    i0.ɵɵadvance();\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newGuest.pinCode);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.guestError);\n  }\n}\nexport let NewShipmentComponent = /*#__PURE__*/(() => {\n  class NewShipmentComponent {\n    constructor(http) {\n      this.http = http;\n      this.DRAFT_PREFIX = 'newShipmentDraft';\n      this.showClientModal = false;\n      this.showGuestModal = false;\n      this.showProductModal = false;\n      this.clientError = '';\n      this.guestError = '';\n      this.productError = '';\n      this.clientModalTab = 'add';\n      this.showClientAddTab = true;\n      this.editClientError = '';\n      this.newClient = {\n        clientName: '',\n        address: '',\n        city: '',\n        state: '',\n        pinCode: '',\n        GSTIN: '',\n        phoneNum: '',\n        perDis: 0,\n        creditType: 'no-credit',\n        products: [],\n        deliveryLocations: [{\n          address: '',\n          city: '',\n          state: '',\n          pinCode: ''\n        }],\n        status: 'active',\n        branch: '',\n        originLocId: ''\n      };\n      this.editableClientList = [];\n      this.selectedEditClientId = '';\n      this.editClient = {\n        _id: '',\n        clientName: '',\n        GSTIN: '',\n        phoneNum: '',\n        address: '',\n        city: '',\n        state: '',\n        pinCode: '',\n        branch: '',\n        deliveryLocations: []\n      };\n      this.newGuest = {\n        guestName: '',\n        address: '',\n        city: '',\n        state: '',\n        pinCode: '',\n        phoneNum: '',\n        perDis: 0\n      };\n      this.newProduct = {\n        hsnNum: '',\n        productName: '',\n        status: 'active',\n        originLocId: '',\n        rates: [{\n          pickupLocationId: '',\n          deliveryLocationId: '',\n          rate: {\n            ratePerNum: 0,\n            ratePerVolume: 0,\n            ratePerKg: 0\n          }\n        }]\n      };\n      // Billing\n      this.billingType = 'consignor';\n      this.billingName = '';\n      this.billingAddress = '';\n      this.billingGSTIN = '';\n      this.billingPhone = '';\n      this.billingLocationIndex = '';\n      this.billingLocationId = null;\n      this.billingPreviousSender = '';\n      this.billingClientId = null;\n      this.billingSource = '';\n      this.billingAddressOptions = [];\n      this.clientList = [];\n      this.rateAddressClients = [];\n      this.guestList = [];\n      this.pkgList = [];\n      this.productList = [];\n      this.rateAddressOptions = [];\n      this.rateAddressLabelById = new Map();\n      // Pickup\n      this.pickupType = 'branch';\n      this.pickupName = '';\n      this.pickupAddress = '';\n      this.pickupPhone = '';\n      this.pickupPincode = '';\n      this.pickupLocationIndex = '';\n      this.pickupLocationId = null;\n      this.pickupPreviousSender = '';\n      this.pickupSource = 'branch';\n      // Delivery\n      this.deliveryType = 'different';\n      this.deliveryTypeName = '';\n      this.deliveryName = '';\n      this.deliveryAddress = '';\n      this.deliveryPhone = '';\n      this.deliveryPincode = '';\n      this.deliveryLocationIndex = '';\n      this.deliveryLocationId = null;\n      this.deliveryPreviousReceiver = '';\n      this.lastConsigneeName = '';\n      this.deliveryID = null;\n      this.deliveryBranch = '';\n      this.deliveryHub = '';\n      this.deliveryHubLocationIndex = '';\n      this.consignorTab = 'consignor';\n      this.consigneeTab = 'consignee';\n      this.username = '';\n      this.isAdmin = String(localStorage.getItem('role') || '').toLowerCase() === 'admin';\n      this.branch = localStorage.getItem('branch') || 'All Branches';\n      this.selectedConsignorId = null;\n      this.consignorId = null;\n      this.consigneeId = null;\n      this.consignmentNumber = 'nil';\n      this.date = new Date().toISOString().split('T')[0];\n      this.consignor = '';\n      this.consignorGST = '';\n      this.consignorAddress = '';\n      this.consignorPhone = '';\n      this.consignee = '';\n      this.consigneeGST = '';\n      this.consigneeAddress = '';\n      this.consigneePhone = '';\n      this.paymentMode = 'To Pay';\n      this.rateUnit = 'box';\n      this.allowAccountCredit = false;\n      this.allowReceiverCredit = false;\n      this.externalRefId = '';\n      this.suggestedRates = {};\n      this.isQuoteLoading = false;\n      this.quoteTimer = null;\n      this.quoteRequestId = 0;\n      this.showRateOverrideModal = false;\n      this.suggestionRequestKey = '';\n      this.suggestionRetryHandle = null;\n      this.suggestionMaxRetries = 2;\n      this.branchDetails = null;\n      this.branches = [];\n      this.hubs = [];\n      this.selectedAllHubId = '';\n      this.rateOverrides = [];\n      this.ewaybills = [{\n        number: '',\n        date: this.date,\n        invoices: [{\n          number: '',\n          value: 0,\n          packages: [{\n            type: '',\n            amount: 0\n          }],\n          products: [{\n            type: '',\n            amount: 1,\n            ratePer: 0,\n            instock: 1,\n            intransitstock: 0,\n            deliveredstock: 0\n          }]\n        }]\n      }];\n      this.charges = {\n        odc: 0,\n        unloading: 0,\n        docket: 0,\n        other: 0,\n        ccc: 0,\n        consignorDiscount: 0\n      };\n      this.applyConsignorDiscount = true;\n      this.maxConsignorDiscount = 0;\n      this.finalAmount = 0;\n      this.initialPaid = 0;\n      this.showFinalAmountModal = false;\n      this.shipmentStatus = 'Pending';\n      this.shipmentStatusDetails = '';\n      this.isSaving = false;\n      this.pendingPricingUpdates = [];\n      this.retryPricingAfterSave = false;\n      this.onStorageChange = e => {\n        if (e.key === 'branch' && e.newValue) {\n          this.handleBranchChange(e.newValue, e.oldValue || this.branch);\n        }\n      };\n    }\n    ngOnInit() {\n      if (typeof window === 'undefined') return;\n      this.username = localStorage.getItem('username') || '';\n      this.branch = localStorage.getItem('branch') || 'All Branches';\n      this.newClient.branch = this.branch;\n      this.newClient.originLocId = localStorage.getItem('originLocId') || 'all';\n      this.deliveryBranch = this.branch;\n      this.loadDraft(this.branch);\n      this.getCurrentConsignmentNumber();\n      this.loadLists();\n      this.loadBranchDetails();\n      this.loadHubDetails();\n      // React to branch change (same tab)\n      this.branchCheckInterval = setInterval(() => {\n        const current = localStorage.getItem('branch') || 'All Branches';\n        if (current !== this.branch) {\n          const oldBranch = this.branch;\n          this.handleBranchChange(current, oldBranch);\n        }\n      }, 1000);\n      // React to branch change (other tab)\n      window.addEventListener('storage', this.onStorageChange);\n    }\n    ngOnDestroy() {\n      if (this.branchCheckInterval) {\n        clearInterval(this.branchCheckInterval);\n      }\n      window.removeEventListener('storage', this.onStorageChange);\n    }\n    onBeforeUnload() {\n      this.saveDraft(this.branch);\n    }\n    handleBranchChange(newBranch, oldBranch) {\n      // Save draft for the previous branch\n      if (oldBranch) {\n        this.saveDraft(oldBranch);\n      }\n      this.branch = newBranch || 'All Branches';\n      if (this.branch !== 'All Hubs') {\n        this.selectedAllHubId = '';\n      }\n      this.newClient.branch = this.branch;\n      this.newClient.originLocId = localStorage.getItem('originLocId') || 'all';\n      this.editClient.branch = this.branch;\n      if (this.deliveryType === 'branch') {\n        this.deliveryBranch = this.branch;\n      }\n      if (this.deliveryType === 'hub') {\n        this.deliveryHub = '';\n      }\n      this.loadDraft(this.branch);\n      this.getCurrentConsignmentNumber();\n      this.loadLists();\n      this.loadBranchDetails();\n      this.loadHubDetails();\n    }\n    draftKey(branch) {\n      return `${this.DRAFT_PREFIX}:${branch || 'All Branches'}`;\n    }\n    saveDraft(branch) {\n      if (typeof window === 'undefined') return;\n      const key = this.draftKey(branch);\n      const draft = {\n        billingType: this.billingType,\n        billingName: this.billingName,\n        billingAddress: this.billingAddress,\n        billingGSTIN: this.billingGSTIN,\n        billingPhone: this.billingPhone,\n        billingLocationId: this.billingLocationId,\n        billingPreviousSender: this.billingPreviousSender,\n        billingClientId: this.billingClientId,\n        billingSource: this.billingSource,\n        pickupType: this.pickupType,\n        pickupName: this.pickupName,\n        pickupAddress: this.pickupAddress,\n        pickupPhone: this.pickupPhone,\n        pickupPincode: this.pickupPincode,\n        pickupLocationId: this.pickupLocationId,\n        pickupPreviousSender: this.pickupPreviousSender,\n        pickupSource: this.pickupSource,\n        deliveryType: this.deliveryType,\n        deliveryTypeName: this.getDeliveryTypeForSave(),\n        deliveryBranch: this.deliveryBranch,\n        deliveryHub: this.deliveryHub,\n        deliveryID: this.deliveryID,\n        deliveryName: this.deliveryName,\n        deliveryAddress: this.deliveryAddress,\n        deliveryPhone: this.deliveryPhone,\n        deliveryPincode: this.deliveryPincode,\n        deliveryHubLocationIndex: this.deliveryHubLocationIndex,\n        deliveryLocationId: this.deliveryLocationId,\n        deliveryPreviousReceiver: this.deliveryPreviousReceiver,\n        consignorTab: this.consignorTab,\n        consigneeTab: this.consigneeTab,\n        consignor: this.consignor,\n        consignorGST: this.consignorGST,\n        consignorAddress: this.consignorAddress,\n        consignorPhone: this.consignorPhone,\n        consignorId: this.consignorId,\n        consignee: this.consignee,\n        consigneeGST: this.consigneeGST,\n        consigneeAddress: this.consigneeAddress,\n        consigneePhone: this.consigneePhone,\n        consigneeId: this.consigneeId,\n        paymentMode: this.paymentMode,\n        rateUnit: this.rateUnit,\n        externalRefId: this.externalRefId,\n        ewaybills: this.ewaybills,\n        charges: this.charges,\n        applyConsignorDiscount: this.applyConsignorDiscount,\n        finalAmount: this.finalAmount,\n        initialPaid: this.initialPaid,\n        selectedConsignorId: this.selectedConsignorId,\n        consignmentNumber: this.consignmentNumber,\n        date: this.date\n      };\n      localStorage.setItem(key, JSON.stringify(draft));\n    }\n    loadDraft(branch) {\n      if (typeof window === 'undefined') return;\n      const raw = localStorage.getItem(this.draftKey(branch));\n      if (!raw) return;\n      try {\n        const draft = JSON.parse(raw);\n        Object.assign(this, {\n          billingType: draft.billingType ?? this.billingType,\n          billingName: draft.billingName ?? this.billingName,\n          billingAddress: draft.billingAddress ?? this.billingAddress,\n          billingGSTIN: draft.billingGSTIN ?? this.billingGSTIN,\n          billingPhone: draft.billingPhone ?? this.billingPhone,\n          billingLocationId: draft.billingLocationId ?? this.billingLocationId,\n          billingPreviousSender: draft.billingPreviousSender ?? this.billingPreviousSender,\n          billingClientId: draft.billingClientId ?? this.billingClientId,\n          billingSource: draft.billingSource ?? this.billingSource,\n          pickupType: draft.pickupType ?? this.pickupType,\n          pickupName: draft.pickupName ?? this.pickupName,\n          pickupAddress: draft.pickupAddress ?? this.pickupAddress,\n          pickupPhone: draft.pickupPhone ?? this.pickupPhone,\n          pickupPincode: draft.pickupPincode ?? this.pickupPincode,\n          pickupLocationId: draft.pickupLocationId ?? this.pickupLocationId,\n          pickupPreviousSender: draft.pickupPreviousSender ?? this.pickupPreviousSender,\n          pickupSource: draft.pickupSource ?? this.pickupSource,\n          deliveryType: draft.deliveryType ?? this.deliveryType,\n          deliveryTypeName: draft.deliveryTypeName ?? this.deliveryTypeName,\n          deliveryBranch: draft.deliveryBranch ?? this.deliveryBranch,\n          deliveryHub: draft.deliveryHub ?? this.deliveryHub,\n          deliveryID: draft.deliveryID ?? this.deliveryID,\n          deliveryName: draft.deliveryName ?? this.deliveryName,\n          deliveryAddress: draft.deliveryAddress ?? this.deliveryAddress,\n          deliveryPhone: draft.deliveryPhone ?? this.deliveryPhone,\n          deliveryPincode: draft.deliveryPincode ?? this.deliveryPincode,\n          deliveryHubLocationIndex: draft.deliveryHubLocationIndex ?? this.deliveryHubLocationIndex,\n          deliveryLocationId: draft.deliveryLocationId ?? this.deliveryLocationId,\n          deliveryPreviousReceiver: draft.deliveryPreviousReceiver ?? this.deliveryPreviousReceiver,\n          consignorTab: draft.consignorTab ?? this.consignorTab,\n          consigneeTab: draft.consigneeTab ?? this.consigneeTab,\n          consignor: draft.consignor ?? this.consignor,\n          consignorGST: draft.consignorGST ?? this.consignorGST,\n          consignorAddress: draft.consignorAddress ?? this.consignorAddress,\n          consignorPhone: draft.consignorPhone ?? this.consignorPhone,\n          consignorId: draft.consignorId ?? this.consignorId,\n          consignee: draft.consignee ?? this.consignee,\n          consigneeGST: draft.consigneeGST ?? this.consigneeGST,\n          consigneeAddress: draft.consigneeAddress ?? this.consigneeAddress,\n          consigneePhone: draft.consigneePhone ?? this.consigneePhone,\n          consigneeId: draft.consigneeId ?? this.consigneeId,\n          paymentMode: draft.paymentMode ?? this.paymentMode,\n          rateUnit: draft.rateUnit ?? this.rateUnit,\n          externalRefId: draft.externalRefId ?? this.externalRefId,\n          ewaybills: draft.ewaybills ?? this.ewaybills,\n          charges: draft.charges ?? this.charges,\n          applyConsignorDiscount: draft.applyConsignorDiscount ?? this.applyConsignorDiscount,\n          finalAmount: draft.finalAmount ?? this.finalAmount,\n          initialPaid: draft.initialPaid ?? this.initialPaid,\n          selectedConsignorId: draft.selectedConsignorId ?? null,\n          consignmentNumber: draft.consignmentNumber ?? this.consignmentNumber,\n          date: draft.date ?? this.date\n        });\n        if (this.pickupSource === 'consignor-primary') {\n          this.pickupSource = 'consignor:0';\n        }\n        if (this.billingType === 'different' && this.billingSource) {\n          this.onBillingSourceSelect(this.billingSource, true);\n          if (this.billingLocationIndex !== '') {\n            this.onBillingAddressSelect(this.billingLocationIndex, true);\n          }\n        }\n        this.onPaymentModeChange();\n        this.updatePickupFromBranch();\n        if (this.deliveryType === 'branch') {\n          this.updateDeliveryFromBranch();\n        } else if (this.deliveryType === 'hub') {\n          this.updateDeliveryFromHub();\n        } else if (this.deliveryType === 'consignee') {\n          this.updateDeliveryFromConsignee();\n        }\n        this.scheduleQuote();\n      } catch {\n        /* ignore bad draft */\n      }\n    }\n    clearDraft(branch) {\n      localStorage.removeItem(this.draftKey(branch));\n    }\n    loadLists() {\n      // Client list\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      const productsoriginLocId = originLocId === 'all-hubs' ? 'all' : originLocId;\n      this.http.get(`http://localhost:3000/api/clients/clientslist?originLocId=${encodeURIComponent(originLocId)}`).subscribe(res => {\n        this.clientList = res;\n        this.rebuildRateAddressOptions();\n        this.syncConsignorDiscount();\n        this.updatePaymentModeAvailability();\n      });\n      this.http.get('http://localhost:3000/api/clients/clientslist?originLocId=all').subscribe(res => {\n        this.rateAddressClients = res || [];\n        this.rebuildRateAddressOptions();\n      });\n      // Guest list\n      this.http.get(`http://localhost:3000/api/guests/guestslist`).subscribe(res => this.guestList = res);\n      // Package list\n      this.http.get(`http://localhost:3000/api/pkgs/pkglist`).subscribe(res => this.pkgList = res);\n      // Product list (defaults)\n      const branch = localStorage.getItem('branch') || '';\n      const originFilter = this.getOriginFilterFromoriginLocId(originLocId);\n      const params = {\n        branch\n      };\n      if (originFilter) {\n        params.originType = originFilter.originType;\n        params.originLocId = originFilter.originLocId;\n      } else {\n        params.originLocId = productsoriginLocId;\n      }\n      this.http.get('http://localhost:3000/api/products/productlist', {\n        params\n      }).subscribe(res => this.productList = res);\n    }\n    getOriginFilterFromoriginLocId(originLocId) {\n      if (!originLocId) return null;\n      const lower = String(originLocId).trim().toLowerCase();\n      if (!lower || lower === 'all') return null;\n      if (lower === 'all-hubs') {\n        const hubId = this.normalizeHubId(localStorage.getItem('hubId'));\n        return hubId ? {\n          originType: 'hub',\n          originLocId: hubId\n        } : null;\n      }\n      const normalized = this.normalizeHubId(originLocId);\n      return normalized ? {\n        originType: 'branch',\n        originLocId: normalized\n      } : null;\n    }\n    normalizeHubId(value) {\n      if (!value) return '';\n      if (typeof value === 'string') return value;\n      if (value?._id) return String(value._id);\n      if (value?.$oid) return String(value.$oid);\n      return String(value);\n    }\n    loadHubDetails() {\n      this.http.get('http://localhost:3000/api/hubs').subscribe({\n        next: hubs => {\n          this.hubs = hubs || [];\n          this.rebuildRateAddressOptions();\n          if (this.deliveryType === 'hub') {\n            this.updateDeliveryFromHub();\n          }\n        },\n        error: () => {\n          this.hubs = [];\n        }\n      });\n    }\n    // E-WAYBILL HELPERS\n    addEwaybill() {\n      this.ewaybills.push({\n        number: '',\n        date: this.date,\n        invoices: []\n      });\n      this.scheduleQuote();\n    }\n    deleteEwaybill(index) {\n      this.ewaybills.splice(index, 1);\n      this.scheduleQuote();\n    }\n    addInvoice(ewaybillIndex) {\n      this.ewaybills[ewaybillIndex].invoices.push({\n        number: '',\n        value: 0,\n        packages: [],\n        products: []\n      });\n      this.scheduleQuote();\n    }\n    deleteInvoice(ewaybillIndex, invoiceIndex) {\n      this.ewaybills[ewaybillIndex].invoices.splice(invoiceIndex, 1);\n      this.scheduleQuote();\n    }\n    addPackage(ewaybillIndex, invoiceIndex) {\n      this.ewaybills[ewaybillIndex].invoices[invoiceIndex].packages.push({\n        type: '',\n        amount: 0\n      });\n      this.scheduleQuote();\n    }\n    deletePackage(ewaybillIndex, invoiceIndex, packageIndex) {\n      this.ewaybills[ewaybillIndex].invoices[invoiceIndex].packages.splice(packageIndex, 1);\n      this.scheduleQuote();\n    }\n    addProduct(ewaybillIndex, invoiceIndex) {\n      this.ewaybills[ewaybillIndex].invoices[invoiceIndex].products.push({\n        type: '',\n        amount: 1,\n        ratePer: 0,\n        instock: 1,\n        intransitstock: 0,\n        deliveredstock: 0\n      });\n      this.scheduleQuote();\n    }\n    deleteProduct(ewaybillIndex, invoiceIndex, productIndex) {\n      this.ewaybills[ewaybillIndex].invoices[invoiceIndex].products.splice(productIndex, 1);\n      this.scheduleQuote();\n    }\n    // CALCULATIONS\n    scheduleQuote() {\n      if (this.quoteTimer) {\n        clearTimeout(this.quoteTimer);\n      }\n      this.quoteTimer = setTimeout(() => this.requestQuote(), 200);\n    }\n    requestQuote() {\n      const requestId = ++this.quoteRequestId;\n      this.isQuoteLoading = true;\n      const payload = {\n        ewaybills: this.ewaybills,\n        charges: this.charges,\n        applyConsignorDiscount: this.applyConsignorDiscount\n      };\n      this.http.post('http://localhost:3000/api/newshipments/quote', payload).subscribe({\n        next: res => {\n          if (requestId !== this.quoteRequestId) return;\n          this.finalAmount = Number(res?.finalAmount) || 0;\n          this.isQuoteLoading = false;\n        },\n        error: () => {\n          if (requestId !== this.quoteRequestId) return;\n          this.isQuoteLoading = false;\n        }\n      });\n    }\n    resetForm() {\n      this.billingType = 'consignor';\n      this.billingName = '';\n      this.billingAddress = '';\n      this.billingGSTIN = '';\n      this.billingPhone = '';\n      this.billingLocationIndex = '';\n      this.billingLocationId = null;\n      this.billingPreviousSender = '';\n      this.billingClientId = null;\n      this.billingSource = '';\n      this.billingAddressOptions = [];\n      this.pickupType = 'branch';\n      this.pickupName = '';\n      this.pickupAddress = '';\n      this.pickupPhone = '';\n      this.pickupPincode = '';\n      this.pickupLocationIndex = '';\n      this.pickupLocationId = null;\n      this.pickupPreviousSender = '';\n      this.pickupSource = 'branch';\n      this.deliveryType = 'different';\n      this.deliveryTypeName = '';\n      this.deliveryBranch = '';\n      this.deliveryHub = '';\n      this.deliveryName = '';\n      this.deliveryAddress = '';\n      this.deliveryPhone = '';\n      this.deliveryPincode = '';\n      this.deliveryLocationIndex = '';\n      this.deliveryLocationId = null;\n      this.deliveryPreviousReceiver = '';\n      this.deliveryID = null;\n      this.deliveryHubLocationIndex = '';\n      this.consignorTab = 'consignor';\n      this.consigneeTab = 'consignee';\n      this.selectedConsignorId = null;\n      this.consignor = '';\n      this.consignorGST = '';\n      this.consignorAddress = '';\n      this.consignorPhone = '';\n      this.consignorId = null;\n      this.consignee = '';\n      this.consigneeGST = '';\n      this.consigneeAddress = '';\n      this.consigneePhone = '';\n      this.consigneeId = null;\n      this.paymentMode = 'To Pay';\n      this.rateUnit = 'box';\n      this.allowAccountCredit = false;\n      this.allowReceiverCredit = false;\n      this.externalRefId = '';\n      this.ewaybills = [{\n        number: '',\n        date: this.date,\n        invoices: [{\n          number: '',\n          value: 0,\n          packages: [{\n            type: '',\n            amount: 0\n          }],\n          products: [{\n            type: '',\n            amount: 1,\n            ratePer: 0,\n            instock: 1,\n            intransitstock: 0,\n            deliveredstock: 0\n          }]\n        }]\n      }];\n      this.charges = {\n        odc: 0,\n        unloading: 0,\n        docket: 0,\n        other: 0,\n        ccc: 0,\n        consignorDiscount: 0\n      };\n      this.applyConsignorDiscount = true;\n      this.maxConsignorDiscount = 0;\n      this.finalAmount = 0;\n      this.initialPaid = 0;\n      this.suggestedRates = {};\n      this.saveDraft(this.branch);\n      this.scheduleQuote();\n      this.updatePickupFromBranch();\n    }\n    // CONSIGNMENT NUMBER\n    getCurrentConsignmentNumber() {\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      if (!this.branch || this.branch === 'All Branches' || originLocId === 'all') {\n        this.consignmentNumber = 'nil';\n        return;\n      }\n      if (this.branch === 'All Hubs' || originLocId === 'all-hubs') {\n        const hubId = String(this.selectedAllHubId || '').trim();\n        if (!hubId) {\n          this.consignmentNumber = 'nil';\n          return;\n        }\n        this.http.get(`http://localhost:3000/api/newshipments/nextConsignment?username=${encodeURIComponent(this.username)}&originLocId=${encodeURIComponent(hubId)}&originType=hub`).subscribe({\n          next: res => {\n            this.consignmentNumber = res.nextNumber.toString();\n            localStorage.setItem('consignmentNumber', this.consignmentNumber);\n          },\n          error: err => console.error('Error fetching consignment number', err)\n        });\n        return;\n      }\n      this.http.get(`http://localhost:3000/api/newshipments/nextConsignment?username=${encodeURIComponent(this.username)}&originLocId=${encodeURIComponent(originLocId)}&originType=branch`).subscribe({\n        next: res => {\n          this.consignmentNumber = res.nextNumber.toString();\n          localStorage.setItem('consignmentNumber', this.consignmentNumber);\n        },\n        error: err => console.error('Error fetching consignment number', err)\n      });\n    }\n    // SAVE SHIPMENT\n    saveShipment() {\n      if (this.isSaving) return;\n      if (!this.ensureProductAmounts()) return;\n      if (Number(this.finalAmount || 0) === 0) {\n        this.showFinalAmountModal = true;\n        return;\n      }\n      this.beginSaveFlow();\n    }\n    confirmFinalAmountSave() {\n      this.showFinalAmountModal = false;\n      this.beginSaveFlow();\n    }\n    cancelFinalAmountSave() {\n      this.showFinalAmountModal = false;\n    }\n    beginSaveFlow() {\n      const branch = localStorage.getItem('branch') || '';\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      const isAllHubs = branch === 'All Hubs' || originLocId === 'all-hubs';\n      if (isAllHubs) {\n        this.rateOverrides = [];\n        this.showRateOverrideModal = false;\n        this.performSave();\n        return;\n      }\n      const overrides = this.collectRateOverrides();\n      if (overrides.length) {\n        this.rateOverrides = overrides;\n        this.showRateOverrideModal = true;\n        return;\n      }\n      this.performSave();\n    }\n    performSave() {\n      this.isSaving = true;\n      this.shipmentStatus = 'Pending';\n      const branch = localStorage.getItem('branch') || '';\n      let originLocId = localStorage.getItem('originLocId') || 'all';\n      const isAllHubs = branch === 'All Hubs' || originLocId === 'all-hubs';\n      let effectiveoriginLocId = originLocId;\n      let effectiveCurrentoriginLocId = originLocId;\n      if (isAllHubs) {\n        const hub = this.getSelectedAllHub();\n        if (!hub) {\n          this.isSaving = false;\n          alert('Select at least one hub before saving.');\n          return;\n        }\n        originLocId = String(hub?._id || '').trim();\n        effectiveoriginLocId = originLocId;\n        effectiveCurrentoriginLocId = originLocId;\n        if (!effectiveoriginLocId) {\n          this.isSaving = false;\n          alert('Selected hub is invalid.');\n          return;\n        }\n      }\n      const statusDetailsoriginLocId = effectiveCurrentoriginLocId && effectiveCurrentoriginLocId !== 'all' ? `$$${effectiveCurrentoriginLocId}` : '';\n      const shipmentData = {\n        username: localStorage.getItem('username'),\n        branch,\n        currentLocationId: effectiveCurrentoriginLocId,\n        shipmentStatus: this.shipmentStatus,\n        shipmentStatusDetails: statusDetailsoriginLocId,\n        consignmentNumber: this.consignmentNumber,\n        date: this.date,\n        paymentMode: this.paymentMode,\n        externalRefId: this.externalRefId,\n        consignorTab: this.consignorTab,\n        consignor: this.consignor,\n        consignorGST: this.consignorGST,\n        consignorAddress: this.consignorAddress,\n        consignorPhone: this.consignorPhone,\n        consignorId: this.consignorId,\n        consigneeTab: this.consigneeTab,\n        consignee: this.consignee,\n        consigneeGST: this.consigneeGST,\n        consigneeAddress: this.consigneeAddress,\n        consigneePhone: this.consigneePhone,\n        consigneeId: this.consigneeId,\n        originLocId: effectiveoriginLocId,\n        billingType: this.billingType,\n        billingName: this.billingName,\n        billingGSTIN: this.billingGSTIN,\n        billingAddress: this.billingAddress,\n        billingPhone: this.billingPhone,\n        billingLocationId: this.billingLocationId,\n        billingClientId: this.billingClientId,\n        pickupType: this.pickupType,\n        pickupName: this.pickupName,\n        pickupAddress: this.pickupAddress,\n        pickupPhone: this.pickupPhone,\n        pickupPincode: this.pickupPincode,\n        pickupLocationId: this.pickupLocationId,\n        deliveryType: this.getDeliveryTypeForSave(),\n        deliveryID: this.deliveryID,\n        deliveryName: this.deliveryName,\n        deliveryAddress: this.deliveryAddress,\n        deliveryPhone: this.deliveryPhone,\n        deliveryPincode: this.deliveryPincode,\n        deliveryLocationId: this.deliveryLocationId,\n        ewaybills: this.ewaybills,\n        charges: this.charges,\n        applyConsignorDiscount: this.applyConsignorDiscount,\n        finalAmount: this.finalAmount,\n        initialPaid: this.initialPaid\n      };\n      if (isAllHubs) {\n        shipmentData.allHubs = true;\n        shipmentData.originLocId = originLocId;\n      }\n      if (this.consignorTab === 'guest') shipmentData.consignorGST = 'GUEST';\n      if (this.consigneeTab === 'guest') shipmentData.consigneeGST = 'GUEST';\n      if (this.billingType === 'consignor') {\n        shipmentData.billingName = this.consignor;\n        shipmentData.billingAddress = this.consignorAddress;\n        shipmentData.billingGSTIN = this.consignorGST;\n        shipmentData.billingPhone = this.consignorPhone;\n        shipmentData.billingClientId = this.consignorId;\n      }\n      if (this.pickupType === 'branch') {\n        shipmentData.pickupName = this.pickupName;\n        shipmentData.pickupAddress = this.pickupAddress;\n        shipmentData.pickupPhone = this.pickupPhone;\n      }\n      if (this.deliveryType === 'consignee') {\n        shipmentData.deliveryName = this.consignee;\n        shipmentData.deliveryAddress = this.consigneeAddress;\n        shipmentData.deliveryPhone = this.consigneePhone;\n      }\n      if (shipmentData.branch !== 'All Branches') {\n        shipmentData.ewaybills = this.sanitizeEwaybills(shipmentData.ewaybills);\n        this.http.post('http://localhost:3000/api/newshipments/add?summary=true', shipmentData, {\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        }).subscribe({\n          next: () => {\n            alert(`Shipment ${this.consignmentNumber} saved successfully!`);\n            if (this.retryPricingAfterSave && this.pendingPricingUpdates.length) {\n              this.updateClientPricing(this.pendingPricingUpdates).subscribe({\n                next: () => {\n                  this.pendingPricingUpdates = [];\n                  this.retryPricingAfterSave = false;\n                },\n                error: () => {\n                  this.pendingPricingUpdates = [];\n                  this.retryPricingAfterSave = false;\n                }\n              });\n            }\n            this.getCurrentConsignmentNumber();\n            this.resetForm();\n            this.clearDraft(this.branch);\n            this.isSaving = false;\n          },\n          error: err => {\n            const msg = err?.error?.message || err?.message || 'Bad Request';\n            if (msg.includes('E11000')) {\n              alert('Consignment number already used. Refreshing number and please try again.');\n              this.getCurrentConsignmentNumber();\n            } else {\n              alert('Error: ' + msg);\n            }\n            this.isSaving = false;\n          }\n        });\n      } else {\n        alert('Please select a branch before saving.');\n        this.isSaving = false;\n      }\n    }\n    collectRateOverrides() {\n      const overrides = [];\n      if (!this.selectedConsignorId) {\n        return overrides;\n      }\n      for (const ewb of this.ewaybills) {\n        for (const inv of ewb.invoices || []) {\n          for (const prod of inv.products || []) {\n            const name = String(prod.type || '').trim();\n            if (!name) continue;\n            const suggested = this.suggestedRates[name];\n            const entered = Number(prod.ratePer) || 0;\n            const hasValue = prod.ratePer !== null && prod.ratePer !== undefined && String(prod.ratePer).trim() !== '' && entered !== 0;\n            if (!hasValue) continue;\n            if (suggested === null || suggested === undefined || entered !== Number(suggested)) {\n              const match = this.productList.find(p => p.productName === name);\n              const suggestedValue = suggested === null || suggested === undefined ? null : Number(suggested);\n              overrides.push({\n                productName: name,\n                hsnNum: match?.hsnNum,\n                enteredRate: entered,\n                suggestedRate: suggestedValue,\n                action: 'override'\n              });\n            }\n          }\n        }\n      }\n      return overrides;\n    }\n    confirmRateOverride() {\n      this.showRateOverrideModal = false;\n      const updates = this.rateOverrides.filter(item => item.action === 'suggest');\n      if (!updates.length) {\n        this.performSave();\n        return;\n      }\n      this.ensureRouteLocationIds();\n      this.pendingPricingUpdates = updates.map(item => ({\n        productName: item.productName,\n        hsnNum: item.hsnNum,\n        enteredRate: item.enteredRate\n      }));\n      this.retryPricingAfterSave = false;\n      this.updateClientPricing(this.pendingPricingUpdates).subscribe({\n        next: () => {\n          this.pendingPricingUpdates = [];\n          this.retryPricingAfterSave = false;\n          this.performSave();\n        },\n        error: () => {\n          this.retryPricingAfterSave = true;\n          this.performSave();\n        }\n      });\n    }\n    updateClientPricing(overrides) {\n      const clientId = this.getClientIdForPricing();\n      if (!clientId) {\n        return of(void 0);\n      }\n      this.ensureRouteLocationIds();\n      const pickupLocationId = String(this.pickupLocationId || '').trim();\n      const deliveryLocationId = String(this.deliveryLocationId || '').trim();\n      const updates = new Map();\n      overrides.forEach(item => {\n        updates.set(item.productName, {\n          productName: item.productName,\n          hsnNum: item.hsnNum,\n          ratePer: item.enteredRate\n        });\n      });\n      const payloadBase = {\n        consignmentNumber: String(this.consignmentNumber || '').trim(),\n        rateUnit: this.rateUnit,\n        updates: Array.from(updates.values())\n      };\n      const postPricing = (pickupId, deliveryId) => this.http.post(`http://localhost:3000/api/clients/${clientId}/pricing`, {\n        pickupLocationId: pickupId,\n        deliveryLocationId: deliveryId,\n        ...payloadBase\n      });\n      if (pickupLocationId && deliveryLocationId || this.pickupType !== 'branch' && this.deliveryType !== 'branch') {\n        return postPricing(pickupLocationId, deliveryLocationId);\n      }\n      return this.http.get('http://localhost:3000/api/branches').pipe(switchMap(branches => {\n        const branchList = branches || [];\n        const pickupSource = this.branchDetails || branchList.find(b => b.branchName === this.branch) || null;\n        const pickupId = pickupLocationId || this.getSelectedBranchAddressId(pickupSource) || '';\n        const target = this.deliveryBranch || this.branch;\n        const deliverySource = branchList.find(b => b.branchName === target) || (this.branchDetails?.branchName === target ? this.branchDetails : null);\n        const deliveryId = deliveryLocationId || this.getSelectedBranchAddressId(deliverySource) || '';\n        return postPricing(pickupId, deliveryId);\n      }));\n    }\n    ensureRouteLocationIds() {\n      if (!this.pickupLocationId) {\n        if (this.pickupType === 'branch') {\n          const source = this.branchDetails || (this.branches || []).find(b => b.branchName === this.branch) || null;\n          this.pickupLocationId = this.getSelectedBranchAddressId(source);\n        } else if (this.pickupSource.startsWith('consignor:')) {\n          const locations = this.getPickupConsignorLocations();\n          const byIndex = locations[Number(this.pickupLocationIndex)];\n          this.pickupLocationId = this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        } else if (this.pickupSource.startsWith('billing:')) {\n          const locations = this.getPickupBillingLocations();\n          const byIndex = locations[Number(this.pickupLocationIndex)];\n          this.pickupLocationId = this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        } else if (this.pickupSource.startsWith('different:')) {\n          const locations = this.getPickupDifferentLocations();\n          const byIndex = locations[Number(this.pickupLocationIndex)];\n          this.pickupLocationId = this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        } else if (this.pickupType === 'consignor') {\n          const locations = this.getPickupConsignorLocations();\n          const byIndex = locations[Number(this.pickupLocationIndex)];\n          this.pickupLocationId = this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        } else if (this.pickupType === 'different') {\n          const locations = this.getPickupDifferentLocations();\n          const byIndex = locations[Number(this.pickupLocationIndex)];\n          this.pickupLocationId = this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        }\n      }\n      if (!this.deliveryLocationId) {\n        if (this.deliveryType === 'branch') {\n          const target = this.deliveryBranch || this.branch;\n          const selected = (this.branches || []).find(b => b.branchName === target);\n          const source = selected || (this.branchDetails?.branchName === target ? this.branchDetails : null);\n          this.deliveryLocationId = this.getSelectedBranchAddressId(source);\n        } else if (this.deliveryType === 'different') {\n          const locations = this.getClientLocationsByName(this.deliveryPreviousReceiver);\n          const byId = this.getLocationById(locations, this.deliveryLocationId);\n          this.deliveryLocationId = this.getLocationId(byId) || this.deliveryLocationId || null;\n        } else if (this.deliveryType === 'hub') {\n          const addresses = this.getSelectedHubAddresses();\n          const selected = addresses[Number(this.deliveryHubLocationIndex)];\n          this.deliveryLocationId = this.getLocationId(selected);\n        } else {\n          const locations = this.getConsigneeLocations();\n          const byId = this.getLocationById(locations, this.deliveryLocationId);\n          const byIndex = locations[Number(this.deliveryLocationIndex)];\n          this.deliveryLocationId = this.getLocationId(byId) || this.getLocationId(byIndex) || this.getLocationId(locations[0]) || null;\n        }\n      }\n    }\n    sanitizeEwaybills(ewaybills) {\n      return (ewaybills || []).map(ewb => ({\n        ...ewb,\n        invoices: (ewb.invoices || []).map(inv => ({\n          ...inv,\n          packages: (inv.packages || []).filter(p => p?.type && Number(p?.amount) > 0),\n          products: (inv.products || []).filter(p => p?.type && Number(p?.amount) > 0)\n        }))\n      }));\n    }\n    ensureProductAmounts() {\n      let hasAnyProduct = false;\n      for (const ewb of this.ewaybills) {\n        let ewbHasProduct = false;\n        for (const inv of ewb.invoices || []) {\n          const validProducts = (inv.products || []).filter(prod => String(prod?.type || '').trim() && Number(prod?.amount) > 0);\n          if (!validProducts.length) {\n            alert('Please add at least one product to each invoice.');\n            return false;\n          }\n          for (const prod of inv.products || []) {\n            const type = String(prod?.type || '').trim();\n            const amount = Number(prod?.amount || 0);\n            if (!type && !amount) continue;\n            if (!type) {\n              alert('Please select a product type for all products.');\n              return false;\n            }\n            if (amount <= 0) {\n              alert('Please enter a quantity greater than 0 for all products.');\n              return false;\n            }\n            ewbHasProduct = true;\n            hasAnyProduct = true;\n            if (!prod.instock || prod.instock <= 0) {\n              prod.instock = amount;\n            }\n          }\n        }\n        if (!ewbHasProduct) {\n          alert('Please add at least one product to each e-waybill.');\n          return false;\n        }\n      }\n      if (!hasAnyProduct) {\n        alert('Please add at least one product before saving.');\n        return false;\n      }\n      return true;\n    }\n    hasValidProduct() {\n      for (const ewb of this.ewaybills) {\n        for (const inv of ewb.invoices || []) {\n          for (const prod of inv.products || []) {\n            const type = String(prod?.type || '').trim();\n            const amount = Number(prod?.amount || 0);\n            if (type && amount > 0) {\n              return true;\n            }\n          }\n        }\n      }\n      return false;\n    }\n    setPincodeIfEmpty(target, value) {\n      const pin = String(value || '').trim();\n      if (!pin) return;\n      if (target === 'pickup') {\n        if (this.pickupPincode) return;\n        this.pickupPincode = pin;\n      } else {\n        if (this.deliveryPincode) return;\n        this.deliveryPincode = pin;\n      }\n      this.onRouteChange();\n    }\n    getClientLocationsByName(name) {\n      const client = this.clientList.find(x => x.clientName === name);\n      return Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n    }\n    normalizeClientName(value) {\n      return String(value || '').trim().toLowerCase();\n    }\n    getPickupDifferentClients() {\n      const exclude = new Set();\n      if (this.consignorTab === 'consignor') {\n        const name = this.normalizeClientName(this.consignor);\n        if (name) exclude.add(name);\n      }\n      if (this.consigneeTab === 'consignee') {\n        const name = this.normalizeClientName(this.consignee);\n        if (name) exclude.add(name);\n      }\n      return (this.clientList || []).filter(c => {\n        const name = this.normalizeClientName(c?.clientName);\n        return name && !exclude.has(name);\n      });\n    }\n    getPickupDifferentLocations() {\n      const client = this.clientList.find(x => x.clientName === this.pickupPreviousSender);\n      if (!client) return [];\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      if (locations.length) return locations;\n      if (client?.address) {\n        return [{\n          address: client.address,\n          city: client.city,\n          state: client.state,\n          pinCode: client.pinCode\n        }];\n      }\n      return [];\n    }\n    getDeliveryDifferentClients() {\n      return this.getPickupDifferentClients();\n    }\n    getDeliverySelectedClientLocations() {\n      const client = this.clientList.find(x => x.clientName === this.deliveryPreviousReceiver);\n      if (!client) return [];\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      if (locations.length) return locations;\n      if (client?.address) {\n        return [{\n          address: client.address,\n          city: client.city,\n          state: client.state,\n          pinCode: client.pinCode\n        }];\n      }\n      return [];\n    }\n    getBillingConsignorClient() {\n      if (this.billingType === 'consignor') {\n        if (this.consignorTab !== 'consignor') return null;\n        return this.clientList.find(x => x.clientName === this.consignor) || null;\n      }\n      if (this.billingClientId) {\n        return this.clientList.find(x => String(x?._id) === String(this.billingClientId)) || null;\n      }\n      if (this.billingPreviousSender) {\n        return this.clientList.find(x => x.clientName === this.billingPreviousSender) || null;\n      }\n      return null;\n    }\n    getConsignorLocations() {\n      return this.getClientLocationsByName(this.consignor);\n    }\n    getBillingConsignorLocations() {\n      const client = this.getBillingConsignorClient();\n      return Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n    }\n    getPickupConsignorLocations() {\n      if (this.consignorTab !== 'consignor') return [];\n      return this.getConsignorLocations();\n    }\n    getPickupBillingLocations() {\n      if (this.billingType !== 'different') return [];\n      const resolved = this.getBillingSourceEntity(this.billingSource);\n      if (!resolved) return [];\n      if (resolved.kind === 'client') {\n        const locations = Array.isArray(resolved.entity?.deliveryLocations) ? resolved.entity.deliveryLocations : [];\n        if (locations.length) return locations;\n        if (resolved.entity?.address) {\n          return [{\n            address: resolved.entity.address,\n            city: resolved.entity.city,\n            state: resolved.entity.state,\n            pinCode: resolved.entity.pinCode\n          }];\n        }\n        return [];\n      }\n      if (resolved.kind === 'hub') {\n        return [{\n          _id: resolved.entity?._id,\n          address: resolved.entity?.address,\n          city: resolved.entity?.city,\n          state: resolved.entity?.state,\n          pinCode: resolved.entity?.pinCode\n        }];\n      }\n      return [];\n    }\n    getPickupSourceClientId() {\n      if (this.pickupSource.startsWith('consignor:')) {\n        const client = this.clientList.find(x => x.clientName === this.consignor);\n        return client?._id ? String(client._id) : null;\n      }\n      if (this.pickupSource.startsWith('billing:')) {\n        const resolved = this.getBillingSourceEntity(this.billingSource);\n        if (resolved?.kind === 'client' && resolved.entity?._id) {\n          return String(resolved.entity._id);\n        }\n      }\n      return null;\n    }\n    getConsigneeLocations() {\n      return this.getClientLocationsByName(this.consignee);\n    }\n    formatLocation(loc) {\n      const address = loc?.address || loc?.location;\n      const parts = [address, loc?.city, loc?.state, this.getLocationPin(loc)].filter(Boolean);\n      return parts.join(', ');\n    }\n    getLocationPin(loc) {\n      return String(loc?.pinCode ?? loc?.pincode ?? loc?.pin ?? '').trim();\n    }\n    getLocationId(loc) {\n      const id = loc?.delivery_id || loc?._id || loc?.id;\n      return id ? String(id) : null;\n    }\n    getPrimaryLocationId(locations) {\n      if (!Array.isArray(locations) || !locations.length) return null;\n      return this.getLocationId(locations[0]);\n    }\n    getLocationById(locations, id) {\n      if (!id || !Array.isArray(locations)) return null;\n      return locations.find(loc => this.getLocationId(loc) === id) || null;\n    }\n    getClientPinByName(name) {\n      const client = this.clientList.find(x => x.clientName === name);\n      const pin = String(client?.pinCode ?? client?.pincode ?? client?.pin ?? '').trim();\n      if (pin) return pin;\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      return this.getLocationPin(locations[0]);\n    }\n    getGuestPinByName(name) {\n      const guest = this.guestList.find(x => x.guestName === name);\n      return String(guest?.pinCode ?? guest?.pincode ?? '').trim();\n    }\n    updatePickupFromConsignor() {\n      const client = this.getBillingConsignorClient();\n      if (!client) return;\n      this.pickupName = client.clientName || '';\n      this.pickupPhone = client.phoneNum || '';\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.pickupAddress = primaryLocation ? this.formatLocation(primaryLocation) : client.address || '';\n      const pin = primaryLocation ? this.getLocationPin(primaryLocation) : this.getClientPinByName(client.clientName);\n      if (pin) {\n        this.pickupPincode = pin;\n        this.onRouteChange();\n      }\n      this.pickupLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      this.pickupLocationIndex = '';\n      if (!this.pickupSource || this.pickupSource === 'branch' || this.pickupSource === 'consignor-guest') {\n        this.pickupSource = locations.length ? 'consignor:0' : 'branch';\n      }\n    }\n    updateBillingFromConsignor() {\n      if (this.consignorTab === 'guest') {\n        const guest = this.guestList.find(x => x.guestName === this.consignor);\n        if (!guest) return;\n        this.billingName = guest.guestName || '';\n        this.billingGSTIN = 'GUEST';\n        this.billingPhone = guest.phoneNum || '';\n        this.billingAddress = guest.address || '';\n        this.billingLocationId = null;\n        this.billingLocationIndex = '';\n        this.billingClientId = null;\n        this.updatePaymentModeAvailability();\n        return;\n      }\n      const client = this.clientList.find(x => x.clientName === this.consignor);\n      if (!client) return;\n      this.billingName = client.clientName || '';\n      this.billingGSTIN = client.GSTIN || '';\n      this.billingPhone = client.phoneNum || '';\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.billingAddress = primaryLocation ? this.formatLocation(primaryLocation) : client.address || '';\n      this.billingLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      this.billingLocationIndex = locations.length ? '0' : '';\n      this.billingClientId = client._id || null;\n      this.updatePaymentModeAvailability();\n      this.refreshPricingSuggestions();\n    }\n    updateDeliveryFromConsignee() {\n      if (this.consigneeTab === 'guest') {\n        const guest = this.guestList.find(x => x.guestName === this.consignee);\n        if (!guest) return;\n        this.deliveryAddress = guest.address || '';\n        this.deliveryPincode = String(guest?.pinCode ?? guest?.pincode ?? '').trim();\n        this.deliveryLocationId = null;\n        this.deliveryLocationIndex = '';\n        this.deliveryID = guest._id || null;\n        this.onRouteChange();\n        this.updateReceiverCreditAvailability();\n        return;\n      }\n      const client = this.clientList.find(x => x.clientName === this.consignee);\n      if (!client) return;\n      const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.deliveryAddress = primaryLocation ? this.formatLocation(primaryLocation) : client.address || '';\n      const pin = primaryLocation ? this.getLocationPin(primaryLocation) : this.getClientPinByName(client.clientName);\n      if (pin) {\n        this.deliveryPincode = pin;\n        this.onRouteChange();\n      }\n      this.deliveryLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      this.deliveryLocationIndex = '';\n      this.deliveryID = client._id || null;\n      this.updateReceiverCreditAvailability();\n    }\n    setPickupType(type) {\n      this.pickupType = type;\n      if (type === 'branch') {\n        this.updatePickupFromBranch();\n        return;\n      }\n      if (type === 'consignor') {\n        this.updatePickupFromConsignor();\n        return;\n      }\n      if (this.pickupPreviousSender) {\n        this.onPickupPreviousSenderSelect(this.pickupPreviousSender);\n      }\n    }\n    activatePickupPrimary() {\n      this.pickupSource = 'branch';\n      this.setPickupType('branch');\n    }\n    onPickupSourceSelect(value) {\n      this.pickupSource = value;\n      if (value === 'branch') {\n        this.setPickupType('branch');\n        return;\n      }\n      if (value === 'consignor-guest') {\n        this.setPickupType('consignor');\n        this.updatePickupFromConsignor();\n        return;\n      }\n      if (value.startsWith('consignor:')) {\n        const index = value.split(':')[1] || '';\n        this.setPickupType('consignor');\n        this.pickupLocationIndex = index;\n        this.onPickupLocationSelect(index);\n        return;\n      }\n      if (value.startsWith('billing:')) {\n        const index = value.split(':')[1] || '';\n        this.setPickupType('consignor');\n        this.pickupLocationIndex = index;\n        this.onPickupBillingLocationSelect(index);\n      }\n    }\n    setBillingType(type) {\n      this.billingType = type;\n      if (type === 'consignor') {\n        this.updateBillingFromConsignor();\n        if (this.pickupType === 'consignor' && this.pickupSource.startsWith('consignor:')) {\n          this.updatePickupFromConsignor();\n        }\n        return;\n      }\n      this.billingSource = '';\n      this.billingAddressOptions = [];\n      this.billingLocationIndex = '';\n      this.billingLocationId = null;\n      this.billingPreviousSender = '';\n      this.billingClientId = null;\n      this.billingName = '';\n      this.billingGSTIN = '';\n      this.billingPhone = '';\n      this.billingAddress = '';\n      this.updatePaymentModeAvailability();\n    }\n    onDeliverySelfPickupToggle(event) {\n      const enabled = Boolean(event?.target?.checked);\n      if (enabled) {\n        this.deliveryType = 'branch';\n        this.deliveryTypeName = 'Customer Self Pickup';\n        this.deliveryBranch = this.branch || '';\n        this.deliveryHub = '';\n        this.deliveryPreviousReceiver = '';\n        this.deliveryLocationIndex = '';\n        this.deliveryLocationId = null;\n        this.deliveryID = null;\n        this.updateDeliveryFromBranch();\n        this.updateReceiverCreditAvailability();\n        return;\n      }\n      this.deliveryType = 'different';\n      this.deliveryTypeName = 'Out for delivery too';\n      this.deliveryBranch = '';\n      this.deliveryHub = '';\n      this.deliveryPreviousReceiver = '';\n      this.deliveryLocationIndex = '';\n      this.deliveryLocationId = null;\n      this.deliveryID = null;\n      this.deliveryName = '';\n      this.deliveryAddress = '';\n      this.deliveryPhone = '';\n      this.deliveryPincode = '';\n      this.onRouteChange();\n      this.updateReceiverCreditAvailability();\n    }\n    setDeliveryType(type) {\n      this.deliveryType = type;\n      if (type === 'branch') {\n        if (!this.deliveryBranch) this.deliveryBranch = this.branch;\n        this.deliveryHubLocationIndex = '';\n        this.updateDeliveryFromBranch();\n        return;\n      }\n      if (type === 'hub') {\n        this.deliveryHubLocationIndex = '';\n        if (!this.deliveryHub) {\n          const hubs = this.getAvailableHubs();\n          if (hubs.length === 1) {\n            this.deliveryHub = hubs[0].hubName;\n          }\n        }\n        this.updateDeliveryFromHub();\n        return;\n      }\n      if (type === 'consignee') {\n        this.updateDeliveryFromConsignee();\n        return;\n      }\n      if (this.deliveryPreviousReceiver) {\n        this.onDeliveryPreviousReceiverSelect(this.deliveryPreviousReceiver);\n      }\n    }\n    setDeliveryPickupTab() {\n      if (this.deliveryType === 'branch' || this.deliveryType === 'hub') return;\n      this.deliveryType = 'branch';\n      if (!this.deliveryBranch) this.deliveryBranch = this.branch;\n      this.deliveryHubLocationIndex = '';\n      this.updateDeliveryFromBranch();\n    }\n    onDeliveryBranchSelect(name) {\n      this.deliveryBranch = name;\n      this.updateDeliveryFromBranch();\n    }\n    onDeliveryHubSelect(name) {\n      this.deliveryHub = name;\n      this.updateDeliveryFromHub();\n    }\n    onDeliveryPickupSelect(value) {\n      if (!value) return;\n      const [kind, name] = value.split(':');\n      if (kind === 'hub') {\n        this.deliveryType = 'hub';\n        this.deliveryHub = name || '';\n        this.deliveryHubLocationIndex = '';\n        this.updateDeliveryFromHub();\n        return;\n      }\n      if (kind === 'branch') {\n        this.deliveryType = 'branch';\n        this.deliveryBranch = name || '';\n        this.deliveryHubLocationIndex = '';\n        this.updateDeliveryFromBranch();\n      }\n    }\n    onHubDeliveryAddressSelect(index) {\n      if (index === '') return;\n      this.deliveryHubLocationIndex = index;\n      const hub = this.getSelectedHub();\n      if (!hub) return;\n      const options = this.getSelectedHubAddresses();\n      const selected = options[Number(index)];\n      if (!selected) return;\n      this.deliveryAddress = this.formatLocation(selected);\n      this.deliveryPincode = String(this.getLocationPin(selected) || hub.pinCode || '').trim();\n      this.deliveryLocationId = this.getLocationId(selected);\n      this.onRouteChange();\n    }\n    getDeliveryTypeForSave() {\n      if (this.deliveryType === 'branch' || this.deliveryType === 'hub') {\n        return 'Customer self pick up';\n      }\n      if (this.deliveryType === 'different') {\n        return 'Out for Delivery';\n      }\n      return this.deliveryType;\n    }\n    getBillingSourceEntity(value) {\n      if (!value) return null;\n      const [kind, id] = value.split(':');\n      if (kind === 'client') {\n        const entity = this.clientList.find(c => String(c?._id) === String(id)) || null;\n        return entity ? {\n          kind: 'client',\n          entity\n        } : null;\n      }\n      if (kind === 'hub') {\n        const entity = (this.hubs || []).find(h => String(h?._id) === String(id)) || null;\n        return entity ? {\n          kind: 'hub',\n          entity\n        } : null;\n      }\n      return null;\n    }\n    buildBillingAddressOptions(value) {\n      const result = [];\n      const resolved = this.getBillingSourceEntity(value);\n      if (!resolved) return result;\n      if (resolved.kind === 'client') {\n        const locations = Array.isArray(resolved.entity?.deliveryLocations) ? resolved.entity.deliveryLocations : [];\n        locations.forEach(loc => {\n          const label = this.formatLocation(loc);\n          const locationId = this.getLocationId(loc);\n          if (!label) return;\n          result.push({\n            label,\n            locationId,\n            address: label\n          });\n        });\n        if (!result.length && resolved.entity?.address) {\n          const label = String(resolved.entity.address || '').trim();\n          if (label) {\n            result.push({\n              label,\n              locationId: null,\n              address: label\n            });\n          }\n        }\n        return result;\n      }\n      if (resolved.kind === 'hub') {\n        const label = this.formatHubAddress(resolved.entity);\n        if (label) {\n          result.push({\n            label,\n            locationId: resolved.entity?._id ? String(resolved.entity._id) : null,\n            address: label\n          });\n        }\n      }\n      return result;\n    }\n    onBillingSourceSelect(value, preserve = false) {\n      this.billingSource = value;\n      const resolved = this.getBillingSourceEntity(value);\n      this.billingAddressOptions = this.buildBillingAddressOptions(value);\n      if (!preserve) {\n        this.billingLocationIndex = '';\n        this.billingLocationId = null;\n        this.billingPreviousSender = '';\n        this.billingClientId = null;\n        this.billingName = '';\n        this.billingGSTIN = '';\n        this.billingPhone = '';\n        this.billingAddress = '';\n        this.updatePaymentModeAvailability();\n      }\n      if (!resolved) return;\n      if (resolved.kind === 'client') {\n        this.billingName = resolved.entity.clientName || '';\n        this.billingGSTIN = resolved.entity.GSTIN || '';\n        this.billingPhone = resolved.entity.phoneNum || '';\n        this.billingClientId = resolved.entity._id || null;\n        this.billingPreviousSender = resolved.entity.clientName || '';\n        this.updatePaymentModeAvailability();\n        return;\n      }\n      if (resolved.kind === 'hub') {\n        this.billingName = resolved.entity.hubName || '';\n        this.billingGSTIN = '';\n        this.billingPhone = resolved.entity.phoneNum || '';\n        this.billingClientId = resolved.entity._id || null;\n        this.billingPreviousSender = resolved.entity.hubName || '';\n        this.updatePaymentModeAvailability();\n      }\n    }\n    onBillingAddressSelect(index, preserve = false) {\n      this.billingLocationIndex = index;\n      const option = this.billingAddressOptions[Number(index)];\n      if (!option) return;\n      this.billingAddress = option.address || '';\n      this.billingLocationId = option.locationId;\n      if (!preserve) {\n        this.refreshPricingSuggestions();\n      }\n    }\n    onBillingLocationSelect(index) {\n      this.billingLocationIndex = index;\n      const locations = this.getConsignorLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      this.billingAddress = this.formatLocation(loc);\n      this.billingLocationId = this.getLocationId(loc);\n      this.refreshPricingSuggestions();\n      if (this.pickupType === 'consignor' && this.pickupSource.startsWith('consignor:')) {\n        this.updatePickupFromConsignor();\n      }\n    }\n    onBillingPreviousSenderSelect(name) {\n      const selected = this.clientList.find(c => c.clientName === name);\n      if (!selected) return;\n      this.billingName = selected.clientName || '';\n      this.billingGSTIN = selected.GSTIN || '';\n      this.billingPhone = selected.phoneNum || '';\n      const locations = Array.isArray(selected.deliveryLocations) ? selected.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.billingAddress = primaryLocation ? this.formatLocation(primaryLocation) : selected.address || '';\n      this.billingLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      this.billingClientId = selected._id || null;\n      this.billingLocationIndex = '';\n      this.updatePaymentModeAvailability();\n      this.refreshPricingSuggestions();\n      if (this.pickupType === 'consignor' && this.pickupSource.startsWith('consignor:')) {\n        this.updatePickupFromConsignor();\n      }\n    }\n    onPickupLocationSelect(index) {\n      this.pickupLocationIndex = index;\n      const locations = this.getBillingConsignorLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      const client = this.getBillingConsignorClient();\n      if (client) {\n        this.pickupName = client.clientName || '';\n        this.pickupPhone = client.phoneNum || '';\n      }\n      this.pickupAddress = this.formatLocation(loc);\n      this.pickupPincode = this.getLocationPin(loc);\n      this.pickupLocationId = this.getLocationId(loc);\n      this.pickupSource = `consignor:${index}`;\n      this.onRouteChange();\n    }\n    onPickupBillingLocationSelect(index) {\n      this.pickupLocationIndex = index;\n      const locations = this.getPickupBillingLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      const resolved = this.getBillingSourceEntity(this.billingSource);\n      if (resolved?.kind === 'client') {\n        this.pickupName = resolved.entity.clientName || '';\n        this.pickupPhone = resolved.entity.phoneNum || '';\n      } else if (resolved?.kind === 'hub') {\n        this.pickupName = resolved.entity.hubName || '';\n        this.pickupPhone = resolved.entity.phoneNum || '';\n      }\n      this.pickupAddress = this.formatLocation(loc);\n      this.pickupPincode = this.getLocationPin(loc);\n      this.pickupLocationId = this.getLocationId(loc);\n      this.pickupSource = `billing:${index}`;\n      this.onRouteChange();\n    }\n    openPickupEditClient() {\n      const clientId = this.getPickupSourceClientId();\n      if (!clientId) return;\n      this.openClientModalForEdit(clientId);\n    }\n    onPickupPreviousSenderSelect(name) {\n      const selected = this.clientList.find(c => c.clientName === name);\n      if (!selected) return;\n      this.pickupName = selected.clientName || '';\n      this.pickupPhone = selected.phoneNum || '';\n      const locations = Array.isArray(selected.deliveryLocations) ? selected.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.pickupAddress = primaryLocation ? this.formatLocation(primaryLocation) : selected.address || '';\n      this.pickupPincode = primaryLocation ? this.getLocationPin(primaryLocation) : '';\n      this.pickupLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      const options = this.getPickupDifferentLocations();\n      this.pickupLocationIndex = options.length ? '0' : '';\n      this.pickupSource = options.length ? 'different:0' : this.pickupSource;\n      this.onRouteChange();\n    }\n    onPickupDifferentLocationSelect(index) {\n      this.pickupLocationIndex = index;\n      const locations = this.getPickupDifferentLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      const client = this.clientList.find(c => c.clientName === this.pickupPreviousSender);\n      if (client) {\n        this.pickupName = client.clientName || '';\n        this.pickupPhone = client.phoneNum || '';\n      }\n      this.pickupAddress = this.formatLocation(loc);\n      this.pickupPincode = this.getLocationPin(loc);\n      this.pickupLocationId = this.getLocationId(loc);\n      this.pickupSource = `different:${index}`;\n      this.onRouteChange();\n    }\n    onDeliveryLocationSelect(index) {\n      this.deliveryLocationIndex = index;\n      const locations = this.getConsigneeLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      this.deliveryAddress = this.formatLocation(loc);\n      this.deliveryPincode = this.getLocationPin(loc);\n      this.deliveryLocationId = this.getLocationId(loc);\n      const client = this.clientList.find(x => x.clientName === this.consignee);\n      this.deliveryID = client?._id || this.deliveryID;\n      this.onRouteChange();\n    }\n    onDeliveryPreviousReceiverSelect(name) {\n      const selected = this.clientList.find(c => c.clientName === name);\n      if (!selected) return;\n      this.deliveryType = 'different';\n      this.deliveryName = selected.clientName || '';\n      this.deliveryPhone = selected.phoneNum || '';\n      const locations = Array.isArray(selected.deliveryLocations) ? selected.deliveryLocations : [];\n      const primaryLocation = locations[0];\n      this.deliveryAddress = primaryLocation ? this.formatLocation(primaryLocation) : selected.address || '';\n      this.deliveryPincode = primaryLocation ? this.getLocationPin(primaryLocation) : '';\n      this.deliveryLocationId = primaryLocation ? this.getLocationId(primaryLocation) : null;\n      const options = this.getDeliverySelectedClientLocations();\n      this.deliveryLocationIndex = options.length ? '0' : '';\n      this.deliveryID = selected._id || null;\n      this.onRouteChange();\n      this.updateReceiverCreditAvailability();\n    }\n    onDeliverySelectedLocationSelect(index) {\n      this.deliveryLocationIndex = index;\n      const locations = this.getDeliverySelectedClientLocations();\n      const loc = locations[Number(index)];\n      if (!loc) return;\n      const client = this.clientList.find(c => c.clientName === this.deliveryPreviousReceiver);\n      if (client) {\n        this.deliveryName = client.clientName || '';\n        this.deliveryPhone = client.phoneNum || '';\n        this.deliveryID = client._id || null;\n      }\n      this.deliveryAddress = this.formatLocation(loc);\n      this.deliveryPincode = this.getLocationPin(loc);\n      this.deliveryLocationId = this.getLocationId(loc);\n      this.deliveryType = 'different';\n      this.onRouteChange();\n      this.updateReceiverCreditAvailability();\n    }\n    // SELECT HANDLERS\n    onConsignorSelect(name) {\n      const c = this.clientList.find(x => x.clientName === name);\n      if (c) {\n        this.consignorGST = c.GSTIN;\n        this.consignorAddress = c.address;\n        this.consignorPhone = c.phoneNum;\n        this.maxConsignorDiscount = Number(c.perDis) || 0;\n        this.charges.consignorDiscount = this.maxConsignorDiscount;\n        this.selectedConsignorId = c._id;\n        this.consignorId = c._id;\n        if (this.pickupType === 'consignor') {\n          this.updatePickupFromConsignor();\n        }\n        if (this.billingType === 'consignor') {\n          this.updateBillingFromConsignor();\n        } else {\n          this.billingLocationId = null;\n          this.billingLocationIndex = '';\n        }\n        this.pickupLocationIndex = '';\n        this.refreshPricingSuggestions();\n      }\n      this.updatePaymentModeAvailability();\n    }\n    onConsigneeSelect(name) {\n      const c = this.clientList.find(x => x.clientName === name);\n      if (c) {\n        this.consigneeGST = c.GSTIN;\n        this.consigneeAddress = c.address;\n        this.consigneePhone = c.phoneNum;\n        this.consigneeId = c._id;\n        if (!this.deliveryPreviousReceiver || this.deliveryPreviousReceiver === this.lastConsigneeName) {\n          this.deliveryPreviousReceiver = name;\n          this.onDeliveryPreviousReceiverSelect(this.deliveryPreviousReceiver);\n        }\n        if (this.deliveryType === 'consignee') {\n          this.updateDeliveryFromConsignee();\n        }\n        this.deliveryLocationIndex = '';\n      }\n      this.lastConsigneeName = name || '';\n      this.updateReceiverCreditAvailability();\n    }\n    onConsignorGuestSelect(name) {\n      const g = this.guestList.find(x => x.guestName === name);\n      if (g) {\n        this.consignorGST = 'GUEST';\n        this.consignorAddress = g.address;\n        this.consignorPhone = g.phoneNum;\n        this.charges.consignorDiscount = 0;\n        this.maxConsignorDiscount = 0;\n        this.selectedConsignorId = null;\n        this.consignorId = g._id || null;\n        if (this.pickupType === 'consignor') {\n          this.updatePickupFromConsignor();\n        }\n        if (this.billingType === 'consignor') {\n          this.updateBillingFromConsignor();\n        } else {\n          this.billingLocationId = null;\n          this.billingLocationIndex = '';\n        }\n        this.pickupLocationIndex = '';\n        this.suggestedRates = {};\n      }\n      this.updatePaymentModeAvailability();\n    }\n    syncConsignorDiscount() {\n      const name = (this.consignor || '').trim();\n      if (!name || this.consignorTab !== 'consignor') return;\n      const client = this.clientList.find(x => x.clientName === name);\n      this.maxConsignorDiscount = Number(client?.perDis) || 0;\n      this.charges.consignorDiscount = this.maxConsignorDiscount;\n    }\n    onConsignorDiscountChange(value) {\n      const raw = Number(value);\n      const clamped = Math.max(0, Math.min(Number.isFinite(raw) ? raw : 0, this.maxConsignorDiscount));\n      this.charges.consignorDiscount = clamped;\n      this.scheduleQuote();\n    }\n    onRateUnitChange() {\n      this.refreshPricingSuggestions();\n    }\n    onPaymentModeChange() {\n      if (this.isToPayMode()) {\n        this.shipmentStatus = 'To Pay';\n        return;\n      }\n      if (this.shipmentStatus === 'To Pay') {\n        this.shipmentStatus = 'Pending';\n      }\n    }\n    onRouteChange() {\n      this.refreshPricingSuggestions();\n    }\n    onProductTypeChange(product) {\n      const suggested = this.getSuggestedRate(product);\n      if (suggested === null) return;\n      const hasValue = product.ratePer !== null && product.ratePer !== undefined && String(product.ratePer).trim() !== '' && Number(product.ratePer) !== 0;\n      if (!hasValue) {\n        product.ratePer = suggested;\n        this.scheduleQuote();\n      }\n    }\n    onConsigneeGuestSelect(name) {\n      const g = this.guestList.find(x => x.guestName === name);\n      if (g) {\n        this.consigneeGST = 'GUEST';\n        this.consigneeAddress = g.address;\n        this.consigneePhone = g.phoneNum;\n        this.consigneeId = g._id || null;\n        if (this.deliveryPreviousReceiver === this.lastConsigneeName) {\n          this.deliveryPreviousReceiver = '';\n        }\n        if (this.deliveryType === 'consignee') {\n          this.updateDeliveryFromConsignee();\n        }\n        this.deliveryLocationIndex = '';\n      }\n      this.lastConsigneeName = '';\n      this.updateReceiverCreditAvailability();\n    }\n    onPackageList(name) {\n      this.pkgList.find(x => x.pkgName === name);\n    }\n    onProductList(name) {\n      this.productList.find(x => x.productName === name);\n    }\n    formatClientOption(client) {\n      const gstin = client?.GSTIN || '-';\n      const name = client?.clientName || '-';\n      const address = client?.address || '-';\n      return `${gstin} | ${name} | ${address}`;\n    }\n    formatGuestOption(guest) {\n      const name = guest?.guestName || '-';\n      const address = guest?.address || '-';\n      return `- | ${name} | ${address}`;\n    }\n    formatBranchAddress(branch) {\n      if (!branch) return '';\n      const parts = [branch.address, branch.city, branch.state, branch.pinCode].filter(Boolean);\n      return parts.join(', ');\n    }\n    getSelectedBranchAddressId(branch) {\n      const addresses = Array.isArray(branch?.addresses) ? branch.addresses : [];\n      const first = addresses[0] || null;\n      if (first) {\n        return this.getLocationId(first);\n      }\n      return branch?._id ? String(branch._id) : null;\n    }\n    formatHubAddress(hub) {\n      if (!hub) return '';\n      const parts = [hub.address, hub.city, hub.state, hub.pinCode].filter(Boolean);\n      return parts.join(', ');\n    }\n    getSelectedHub() {\n      const target = String(this.deliveryHub || '').trim();\n      if (!target) return null;\n      return (this.hubs || []).find(h => h.hubName === target) || null;\n    }\n    getSelectedHubAddresses() {\n      const hub = this.getSelectedHub();\n      if (!hub) return [];\n      const result = [];\n      if (hub.address) {\n        result.push({\n          address: hub.address,\n          city: hub.city,\n          state: hub.state,\n          pinCode: hub.pinCode\n        });\n      }\n      const extra = Array.isArray(hub.deliveryAddresses) ? hub.deliveryAddresses : [];\n      extra.forEach(loc => {\n        if (!loc) return;\n        result.push({\n          ...loc,\n          location: loc.location\n        });\n      });\n      return result;\n    }\n    updatePickupFromBranch() {\n      if (!this.branchDetails || this.branch === 'All Branches') {\n        this.pickupType = 'branch';\n        this.pickupName = '';\n        this.pickupAddress = '';\n        this.pickupPhone = '';\n        this.pickupPincode = '';\n        this.pickupLocationIndex = '';\n        this.pickupLocationId = null;\n        this.pickupSource = 'branch';\n        return;\n      }\n      this.pickupType = 'branch';\n      this.pickupName = this.branchDetails.branchName || this.branch;\n      this.pickupAddress = this.formatBranchAddress(this.branchDetails);\n      this.pickupPhone = this.branchDetails.phoneNum || '';\n      this.pickupPincode = String(this.branchDetails.pinCode || '').trim();\n      this.pickupLocationIndex = '';\n      this.pickupLocationId = this.getSelectedBranchAddressId(this.branchDetails);\n      this.pickupSource = 'branch';\n      this.onRouteChange();\n    }\n    updateDeliveryFromBranch() {\n      const target = String(this.deliveryBranch || this.branch || '').trim();\n      if (!target) {\n        this.deliveryName = '';\n        this.deliveryAddress = '';\n        this.deliveryPhone = '';\n        this.deliveryPincode = '';\n        this.deliveryLocationIndex = '';\n        this.deliveryLocationId = null;\n        return;\n      }\n      const selected = (this.branches || []).find(b => b.branchName === target);\n      const source = selected || (this.branchDetails?.branchName === target ? this.branchDetails : null);\n      if (!source) {\n        return;\n      }\n      this.deliveryID = source._id || null;\n      this.deliveryBranch = source.branchName || target;\n      this.deliveryName = source.branchName || target;\n      this.deliveryAddress = this.formatBranchAddress(source);\n      this.deliveryPhone = source.phoneNum || '';\n      this.deliveryPincode = String(source.pinCode || '').trim();\n      this.deliveryLocationIndex = '';\n      this.deliveryLocationId = this.getSelectedBranchAddressId(source);\n      this.onRouteChange();\n    }\n    updateDeliveryFromHub() {\n      const target = String(this.deliveryHub || '').trim();\n      if (!target) {\n        this.deliveryID = null;\n        this.deliveryName = '';\n        this.deliveryAddress = '';\n        this.deliveryPhone = '';\n        this.deliveryPincode = '';\n        this.deliveryHubLocationIndex = '';\n        this.deliveryLocationIndex = '';\n        this.deliveryLocationId = null;\n        return;\n      }\n      const hub = this.getSelectedHub();\n      if (!hub) {\n        return;\n      }\n      this.deliveryID = hub._id || null;\n      this.deliveryName = hub.hubName || target;\n      const addressOptions = this.getSelectedHubAddresses();\n      if (!this.deliveryHubLocationIndex && addressOptions.length) {\n        this.deliveryHubLocationIndex = '0';\n      }\n      const selected = addressOptions[Number(this.deliveryHubLocationIndex)];\n      this.deliveryAddress = selected ? this.formatLocation(selected) : hub.address || '';\n      this.deliveryPhone = hub.phoneNum || '';\n      this.deliveryPincode = String(this.getLocationPin(selected) || hub.pinCode || '').trim();\n      this.deliveryLocationIndex = '';\n      this.deliveryLocationId = this.getLocationId(selected);\n      this.onRouteChange();\n    }\n    getAvailableHubs() {\n      const allHubs = this.hubs || [];\n      const assignedoriginLocIds = this.isAdmin ? [] : this.getAssignedoriginLocIds();\n      const scopedHubs = this.isAdmin ? allHubs : assignedoriginLocIds.length ? allHubs.filter(h => assignedoriginLocIds.includes(String(h?.originLocId || '').trim())) : [];\n      if (this.branch && this.branch !== 'All Branches' && this.branch !== 'All Hubs') {\n        const originLocId = String(localStorage.getItem('originLocId') || '').trim();\n        return scopedHubs.filter(h => String(h?.branch || '') === this.branch || originLocId && String(h?.originLocId || '') === originLocId);\n      }\n      return scopedHubs;\n    }\n    getSelectedAllHub() {\n      const hubId = String(this.selectedAllHubId || '').trim();\n      if (!hubId) return null;\n      return (this.hubs || []).find(h => String(h?._id || '') === hubId) || null;\n    }\n    onAllHubsSelect(value) {\n      this.selectedAllHubId = value;\n      this.getCurrentConsignmentNumber();\n    }\n    getAllHubsOptions() {\n      if (this.isAdmin) return this.hubs || [];\n      const originLocIds = this.getAssignedoriginLocIds();\n      if (!originLocIds.length) return [];\n      return (this.hubs || []).filter(hub => originLocIds.includes(String(hub?.originLocId || '').trim()));\n    }\n    get isAllHubsSelectionRequired() {\n      return this.branch === 'All Hubs' && !String(this.selectedAllHubId || '').trim();\n    }\n    getAssignedoriginLocIds() {\n      try {\n        const storedIds = JSON.parse(localStorage.getItem('originLocIds') || '[]');\n        if (!Array.isArray(storedIds)) return [];\n        return storedIds.map(id => String(id || '').trim()).filter(id => id);\n      } catch {\n        return [];\n      }\n    }\n    loadBranchDetails() {\n      this.http.get('http://localhost:3000/api/branches').subscribe({\n        next: branches => {\n          this.branches = branches || [];\n          this.rebuildRateAddressOptions();\n          this.branchDetails = this.branches.find(b => b.branchName === this.branch) || null;\n          const storedoriginLocId = localStorage.getItem('originLocId') || 'all';\n          const resolvedoriginLocId = this.branchDetails?._id ? String(this.branchDetails._id) : '';\n          if (this.branch && this.branch !== 'All Branches' && resolvedoriginLocId && (storedoriginLocId === 'all' || !storedoriginLocId)) {\n            localStorage.setItem('originLocId', resolvedoriginLocId);\n            this.newClient.originLocId = resolvedoriginLocId;\n            this.getCurrentConsignmentNumber();\n            this.loadLists();\n          }\n          this.updatePickupFromBranch();\n          if (this.deliveryType === 'branch') {\n            this.updateDeliveryFromBranch();\n          }\n        },\n        error: () => {\n          this.branches = [];\n          this.branchDetails = null;\n          this.rebuildRateAddressOptions();\n          this.updatePickupFromBranch();\n        }\n      });\n    }\n    rebuildRateAddressOptions() {\n      const options = [];\n      (this.branches || []).forEach(branch => {\n        const addresses = Array.isArray(branch?.addresses) ? branch.addresses : [];\n        addresses.forEach(addr => {\n          const id = String(addr?._id || '').trim();\n          if (!id) return;\n          const parts = [addr.address, addr.city, addr.state, addr.pinCode].filter(Boolean);\n          const label = `Branch: ${branch?.branchName || ''} - ${parts.join(', ')}`;\n          options.push({\n            id,\n            label\n          });\n        });\n        if (!addresses.length && branch?._id) {\n          const parts = [branch.address, branch.city, branch.state, branch.pinCode].filter(Boolean);\n          const label = `Branch: ${branch?.branchName || ''} - ${parts.join(', ')}`.trim();\n          options.push({\n            id: String(branch._id),\n            label\n          });\n        }\n      });\n      (this.hubs || []).forEach(hub => {\n        const addresses = Array.isArray(hub?.deliveryAddresses) ? hub.deliveryAddresses : [];\n        addresses.forEach(addr => {\n          const id = String(addr?._id || '').trim();\n          if (!id) return;\n          const label = `Hub: ${hub?.hubName || ''} - ${addr?.location || ''}`.trim();\n          options.push({\n            id,\n            label\n          });\n        });\n      });\n      (this.rateAddressClients || this.clientList || []).forEach(client => {\n        const locations = Array.isArray(client?.deliveryLocations) ? client.deliveryLocations : [];\n        locations.forEach(loc => {\n          const id = String(loc?.delivery_id || loc?._id || '').trim();\n          if (!id) return;\n          const parts = [loc.address, loc.city, loc.state, loc.pinCode].filter(Boolean);\n          const label = `Client: ${client?.clientName || ''} - ${parts.join(', ')}`;\n          options.push({\n            id,\n            label\n          });\n        });\n      });\n      this.rateAddressOptions = options;\n      this.rateAddressLabelById = new Map(options.map(o => [o.id, o.label]));\n    }\n    updatePaymentModeAvailability() {\n      const billingClientId = String(this.billingClientId || '').trim();\n      const client = billingClientId ? this.clientList.find(x => String(x?._id) === billingClientId) : null;\n      const creditType = String(client?.creditType || '').toLowerCase();\n      this.allowAccountCredit = creditType === 'credit' || creditType === 'credit allowed';\n      this.paymentMode = this.allowAccountCredit ? 'Account Credit' : 'To Pay';\n      this.onPaymentModeChange();\n      this.updateReceiverCreditAvailability();\n    }\n    isPaymentModeEnabled() {\n      return Boolean(String(this.billingClientId || '').trim());\n    }\n    getReceiverCreditClient() {\n      if (this.consigneeTab === 'consignee') {\n        if (this.consigneeId) {\n          return this.clientList.find(x => String(x?._id) === String(this.consigneeId)) || null;\n        }\n        if (this.consignee) {\n          return this.clientList.find(x => x.clientName === this.consignee) || null;\n        }\n      }\n      if (this.deliveryPreviousReceiver) {\n        return this.clientList.find(x => x.clientName === this.deliveryPreviousReceiver) || null;\n      }\n      if (this.deliveryID) {\n        return this.clientList.find(x => String(x?._id) === String(this.deliveryID)) || null;\n      }\n      return null;\n    }\n    updateReceiverCreditAvailability() {\n      const client = this.getReceiverCreditClient();\n      const creditType = String(client?.creditType || '').toLowerCase();\n      this.allowReceiverCredit = creditType === 'credit' || creditType === 'credit allowed';\n      if (!this.allowReceiverCredit && this.paymentMode === 'To Pay with account credit') {\n        this.paymentMode = 'To Pay';\n        this.onPaymentModeChange();\n      }\n    }\n    isToPayMode(mode = null) {\n      const value = String(mode ?? this.paymentMode);\n      return value === 'To Pay' || value === 'To Pay with account credit';\n    }\n    getSuggestedRate(product) {\n      const name = String(product?.type || '').trim();\n      if (!name) return null;\n      const value = this.suggestedRates[name];\n      if (value === null || value === undefined) return null;\n      return Number(value) || 0;\n    }\n    buildSuggestionKey(clientId) {\n      const originLocId = localStorage.getItem('originLocId') || '';\n      return [clientId || '', originLocId || this.branch || '', String(this.pickupLocationId || '').trim(), String(this.deliveryLocationId || '').trim(), this.rateUnit || ''].join('|');\n    }\n    loadPricingSuggestions(clientId, requestKey, attempt = 0) {\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      if (!originLocId || originLocId === 'all') return;\n      if (!clientId) return;\n      if (requestKey !== this.suggestionRequestKey) return;\n      const branch = this.branch || '';\n      const params = clientId ? `originLocId=${encodeURIComponent(originLocId)}&branch=${encodeURIComponent(branch)}&clientId=${clientId}` : `originLocId=${encodeURIComponent(originLocId)}&branch=${encodeURIComponent(branch)}`;\n      const routeParams = [`pickupLocationId=${encodeURIComponent(this.pickupLocationId || '')}`, `deliveryLocationId=${encodeURIComponent(this.deliveryLocationId || '')}`, `rateUnit=${encodeURIComponent(this.rateUnit)}`].join('&');\n      this.http.get(`http://localhost:3000/api/pricing/suggestions?${params}&${routeParams}`).subscribe({\n        next: res => {\n          if (requestKey !== this.suggestionRequestKey) return;\n          if (res?.pricing) {\n            this.productList = res.pricing;\n            this.suggestedRates = {};\n            res.pricing.forEach(p => {\n              if (p?.suggestedRate !== null && p?.suggestedRate !== undefined) {\n                this.suggestedRates[p.productName] = Number(p.suggestedRate) || 0;\n              }\n            });\n          }\n          if (this.suggestionRetryHandle) {\n            clearTimeout(this.suggestionRetryHandle);\n            this.suggestionRetryHandle = null;\n          }\n        },\n        error: () => {\n          if (requestKey !== this.suggestionRequestKey) return;\n          if (attempt >= this.suggestionMaxRetries) {\n            return;\n          }\n          const delay = 500 * (attempt + 1);\n          if (this.suggestionRetryHandle) {\n            clearTimeout(this.suggestionRetryHandle);\n          }\n          this.suggestionRetryHandle = setTimeout(() => {\n            this.suggestionRetryHandle = null;\n            this.loadPricingSuggestions(clientId, requestKey, attempt + 1);\n          }, delay);\n        }\n      });\n    }\n    getClientIdByLocationId(id) {\n      if (!id) return null;\n      const client = this.clientList.find(c => Array.isArray(c?.deliveryLocations) && c.deliveryLocations.some(loc => this.getLocationId(loc) === id));\n      return client?._id || null;\n    }\n    getClientIdForPricing() {\n      const billingClientId = this.getClientIdByLocationId(this.billingLocationId);\n      if (billingClientId) return billingClientId;\n      if (this.billingClientId) return this.billingClientId;\n      return this.selectedConsignorId;\n    }\n    getPricingGstinId() {\n      const clientId = this.getClientIdForPricing();\n      const client = this.clientList.find(c => c?._id === clientId);\n      const gstin = (client?.GSTIN || '').trim();\n      if (gstin) return gstin;\n      const billingGstin = String(this.billingGSTIN || '').trim();\n      if (billingGstin) return billingGstin;\n      return '-';\n    }\n    refreshPricingSuggestions() {\n      if (this.shouldSuppressPricingSuggestions()) {\n        this.suggestedRates = {};\n        this.suggestionRequestKey = '';\n        if (this.suggestionRetryHandle) {\n          clearTimeout(this.suggestionRetryHandle);\n          this.suggestionRetryHandle = null;\n        }\n        return;\n      }\n      const clientId = this.getClientIdForPricing();\n      if (!clientId) {\n        this.suggestedRates = {};\n        this.suggestionRequestKey = '';\n        if (this.suggestionRetryHandle) {\n          clearTimeout(this.suggestionRetryHandle);\n          this.suggestionRetryHandle = null;\n        }\n        return;\n      }\n      const requestKey = this.buildSuggestionKey(clientId);\n      this.suggestionRequestKey = requestKey;\n      if (this.suggestionRetryHandle) {\n        clearTimeout(this.suggestionRetryHandle);\n        this.suggestionRetryHandle = null;\n      }\n      this.loadPricingSuggestions(clientId, requestKey, 0);\n    }\n    shouldSuppressPricingSuggestions() {\n      if (this.consignorTab === 'guest') return true;\n      const originLocId = String(localStorage.getItem('originLocId') || '').trim();\n      const branchName = String(this.branch || '').trim().toLowerCase();\n      if (originLocId === 'all-hubs' || branchName === 'all hubs') return true;\n      if (this.billingSource && this.billingSource.startsWith('hub:')) return true;\n      return false;\n    }\n    // QUICK ADD CLIENT/GUEST\n    openClientModal() {\n      if (!this.branch || this.branch === 'All Branches') {\n        alert('Select a branch before adding a client.');\n        return;\n      }\n      this.showClientAddTab = true;\n      this.clientModalTab = 'add';\n      this.newClient = {\n        clientName: '',\n        address: '',\n        city: '',\n        state: '',\n        pinCode: '',\n        GSTIN: '',\n        phoneNum: '',\n        perDis: 0,\n        creditType: 'no-credit',\n        products: [],\n        deliveryLocations: [{\n          address: '',\n          city: '',\n          state: '',\n          pinCode: ''\n        }],\n        status: 'active',\n        branch: this.branch,\n        originLocId: localStorage.getItem('originLocId') || 'all'\n      };\n      this.clientError = '';\n      this.editClientError = '';\n      this.selectedEditClientId = '';\n      this.showClientModal = true;\n    }\n    openClientModalForEdit(clientId) {\n      if (!this.branch || this.branch === 'All Branches') {\n        alert('Select a branch before editing a client.');\n        return;\n      }\n      if (!clientId) return;\n      this.showClientAddTab = false;\n      this.clientModalTab = 'edit';\n      this.clientError = '';\n      this.editClientError = '';\n      this.selectedEditClientId = clientId;\n      this.showClientModal = true;\n      this.loadEditableClients(clientId);\n    }\n    setClientModalTab(tab, selectId) {\n      this.clientModalTab = tab;\n      if (tab === 'edit') {\n        this.loadEditableClients(selectId);\n      }\n    }\n    loadEditableClients(selectId) {\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      if (!originLocId || originLocId === 'all') return;\n      this.http.get(`http://localhost:3000/api/clients?originLocId=${encodeURIComponent(originLocId)}`).subscribe({\n        next: res => {\n          this.editableClientList = res || [];\n          if (selectId) {\n            this.selectedEditClientId = selectId;\n            this.onEditClientSelect(selectId);\n          }\n        },\n        error: () => {\n          this.editableClientList = [];\n        }\n      });\n    }\n    onEditClientSelect(id) {\n      const c = this.editableClientList.find(x => x._id === id);\n      if (!c) return;\n      this.editClient = {\n        _id: c._id,\n        clientName: c.clientName || '',\n        GSTIN: c.GSTIN || '',\n        phoneNum: c.phoneNum || '',\n        address: c.address || '',\n        city: c.city || '',\n        state: c.state || '',\n        pinCode: c.pinCode || '',\n        branch: c.branch || '',\n        deliveryLocations: Array.isArray(c.deliveryLocations) ? c.deliveryLocations.map(d => ({\n          address: d.address || '',\n          city: d.city || '',\n          state: d.state || '',\n          pinCode: d.pinCode || ''\n        })) : []\n      };\n      if (!this.editClient.deliveryLocations.length) {\n        this.editClient.deliveryLocations = [{\n          address: '',\n          city: '',\n          state: '',\n          pinCode: ''\n        }];\n      }\n      this.editClientError = '';\n    }\n    addEditDeliveryLocation() {\n      if (!Array.isArray(this.editClient.deliveryLocations)) {\n        this.editClient.deliveryLocations = [];\n      }\n      this.editClient.deliveryLocations.push({\n        address: '',\n        city: '',\n        state: '',\n        pinCode: ''\n      });\n    }\n    removeEditDeliveryLocation(index) {\n      this.editClient.deliveryLocations.splice(index, 1);\n    }\n    openGuestModal() {\n      this.newGuest = {\n        guestName: '',\n        address: '',\n        city: '',\n        state: '',\n        pinCode: '',\n        phoneNum: '',\n        perDis: 0\n      };\n      this.guestError = '';\n      this.showGuestModal = true;\n    }\n    // QUICK ADD PRODUCT\n    openProductModal() {\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      if (!originLocId || originLocId === 'all') {\n        alert('Select a specific branch before adding a product.');\n        return;\n      }\n      this.productError = '';\n      this.newProduct = {\n        hsnNum: '',\n        productName: '',\n        status: 'active',\n        originLocId,\n        rates: [{\n          pickupLocationId: '',\n          deliveryLocationId: '',\n          rate: {\n            ratePerNum: 0,\n            ratePerVolume: 0,\n            ratePerKg: 0\n          }\n        }]\n      };\n      this.showProductModal = true;\n    }\n    closeProductModal() {\n      this.showProductModal = false;\n    }\n    addProductRateRow() {\n      if (!Array.isArray(this.newProduct.rates)) {\n        this.newProduct.rates = [];\n      }\n      this.newProduct.rates.push({\n        pickupLocationId: '',\n        deliveryLocationId: '',\n        rate: {\n          ratePerNum: 0,\n          ratePerVolume: 0,\n          ratePerKg: 0\n        }\n      });\n    }\n    removeProductRateRow(index) {\n      if (!Array.isArray(this.newProduct.rates)) return;\n      this.newProduct.rates.splice(index, 1);\n    }\n    saveNewProduct() {\n      this.productError = '';\n      const originLocId = localStorage.getItem('originLocId') || 'all';\n      if (!originLocId || originLocId === 'all') {\n        this.productError = 'Select a specific branch before adding a product.';\n        return;\n      }\n      if (!this.newProduct.hsnNum || !this.newProduct.productName) {\n        this.productError = 'Please enter HSN number and product name.';\n        return;\n      }\n      // Allow saving with an empty Rates by Route section by dropping incomplete rows.\n      const isValidObjectId = value => /^[a-f\\d]{24}$/i.test(String(value || '').trim());\n      const rates = Array.isArray(this.newProduct.rates) ? this.newProduct.rates : [];\n      const sanitizedRates = rates.filter(r => {\n        const pickupLocationId = String(r?.pickupLocationId || '').trim();\n        const deliveryLocationId = String(r?.deliveryLocationId || '').trim();\n        const ratePerNum = Number(r?.rate?.ratePerNum || 0);\n        const ratePerVolume = Number(r?.rate?.ratePerVolume || 0);\n        const ratePerKg = Number(r?.rate?.ratePerKg || 0);\n        const hasAnyRate = ratePerNum > 0 || ratePerVolume > 0 || ratePerKg > 0;\n        return isValidObjectId(pickupLocationId) && isValidObjectId(deliveryLocationId) && hasAnyRate;\n      });\n      this.newProduct.rates = sanitizedRates;\n      this.newProduct.originLocId = originLocId;\n      this.http.post('http://localhost:3000/api/products/add', this.newProduct, {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).subscribe({\n        next: () => {\n          this.closeProductModal();\n          this.loadLists();\n        },\n        error: err => {\n          this.productError = err?.error?.message || 'Failed to save product.';\n        }\n      });\n    }\n    saveNewClient() {\n      this.clientError = '';\n      if (!this.newClient.clientName || !this.newClient.address || !this.newClient.GSTIN || !this.newClient.phoneNum || !this.newClient.branch) {\n        this.clientError = 'Please fill required fields (name, address, GSTIN, phone, branch).';\n        return;\n      }\n      const isAllHubsSelection = this.newClient.branch === 'All Hubs' || this.newClient.originLocId === 'all-hubs';\n      this.newClient.originLocId = localStorage.getItem('originLocId') || 'all';\n      if (this.newClient.branch === 'All Hubs' || this.newClient.originLocId === 'all-hubs') {\n        const hub = this.getSelectedAllHub();\n        if (!hub) {\n          this.clientError = 'Select a hub before adding a client.';\n          return;\n        }\n        this.newClient.originLocId = String(hub?._id || '').trim();\n        this.newClient.branch = String(hub?.hubName || '').trim() || this.newClient.branch;\n      }\n      if (this.newClient.branch === 'All Branches' || this.newClient.originLocId === 'all') {\n        this.clientError = 'Select a specific branch before adding a client.';\n        return;\n      }\n      const payload = isAllHubsSelection ? {\n        ...this.newClient,\n        products: []\n      } : this.newClient;\n      this.http.post('http://localhost:3000/api/clients/add', payload).subscribe({\n        next: client => {\n          this.clientList = [client, ...this.clientList];\n          this.consignor = client.clientName;\n          this.onConsignorSelect(this.consignor);\n          this.showClientModal = false;\n        },\n        error: err => {\n          this.clientError = err?.error?.message || 'Failed to save client.';\n        }\n      });\n    }\n    saveEditedClient() {\n      this.editClientError = '';\n      if (!this.selectedEditClientId) {\n        this.editClientError = 'Select a client to edit.';\n        return;\n      }\n      const payload = {\n        deliveryLocations: (this.editClient.deliveryLocations || []).filter(d => d?.address)\n      };\n      this.http.put(`http://localhost:3000/api/clients/${this.selectedEditClientId}`, payload).subscribe({\n        next: () => {\n          this.showClientModal = false;\n        },\n        error: err => {\n          this.editClientError = err?.error?.message || 'Failed to update client.';\n        }\n      });\n    }\n    saveNewGuest() {\n      this.guestError = '';\n      if (!this.newGuest.guestName || !this.newGuest.address || !this.newGuest.phoneNum) {\n        this.guestError = 'Please fill required fields (name, address, phone).';\n        return;\n      }\n      this.http.post('http://localhost:3000/api/guests/add', this.newGuest).subscribe({\n        next: guest => {\n          this.guestList = [guest, ...this.guestList];\n          if (this.consignorTab === 'guest') {\n            this.consignor = guest.guestName;\n            this.onConsignorGuestSelect(this.consignor);\n          }\n          this.showGuestModal = false;\n        },\n        error: err => {\n          this.guestError = err?.error?.message || 'Failed to save guest.';\n        }\n      });\n    }\n    closeModals() {\n      this.showClientModal = false;\n      this.showGuestModal = false;\n    }\n    addClientProduct() {\n      this.newClient.products.push({\n        hsnNum: '',\n        productName: '',\n        ratePerNum: 0,\n        ratePerVolume: 0,\n        ratePerKg: 0\n      });\n    }\n    removeClientProduct(index) {\n      this.newClient.products.splice(index, 1);\n    }\n    addDeliveryLocation() {\n      this.newClient.deliveryLocations.push({\n        address: '',\n        city: '',\n        state: '',\n        pinCode: ''\n      });\n    }\n    removeDeliveryLocation(index) {\n      this.newClient.deliveryLocations.splice(index, 1);\n    }\n    static {\n      this.ɵfac = function NewShipmentComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || NewShipmentComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: NewShipmentComponent,\n        selectors: [[\"app-new-shipment\"]],\n        hostBindings: function NewShipmentComponent_HostBindings(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵlistener(\"beforeunload\", function NewShipmentComponent_beforeunload_HostBindingHandler() {\n              return ctx.onBeforeUnload();\n            }, false, i0.ɵɵresolveWindow);\n          }\n        },\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 233,\n        vars: 63,\n        consts: [[1, \"page-shell\"], [1, \"page-header\"], [1, \"eyebrow\"], [1, \"subhead\"], [1, \"meta-stack\"], [1, \"chip-field\"], [\"type\", \"date\", 3, \"ngModelChange\", \"ngModel\"], [1, \"layout\"], [1, \"col\"], [1, \"card\"], [1, \"card-head\"], [\"class\", \"head-actions\", 4, \"ngIf\"], [1, \"grid-2\"], [\"readonly\", \"\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"Optional reference ID\", 3, \"ngModelChange\", \"ngModel\"], [1, \"pill\"], [1, \"grid-2\", \"party-grid\"], [1, \"panel\"], [1, \"panel-head\"], [1, \"tab-buttons\"], [3, \"click\"], [\"class\", \"panel-body\", 4, \"ngIf\"], [1, \"panel\", \"soft\"], [4, \"ngIf\"], [1, \"panel-body\"], [1, \"inline-actions\"], [1, \"muted\"], [1, \"toggle-inline\"], [\"type\", \"checkbox\", 3, \"change\", \"checked\"], [1, \"toggle-track\"], [1, \"toggle-thumb\"], [1, \"tiny-btn\", 3, \"click\"], [3, \"ngModelChange\", \"change\", \"ngModel\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [3, \"ngModelChange\", \"change\", \"ngModel\", \"disabled\"], [1, \"field-display\"], [1, \"label\"], [1, \"value\"], [1, \"tab-buttons\", \"ghost\"], [1, \"panel\", \"soft\", \"span-2\"], [1, \"grid-2\", \"payment-grid\"], [\"class\", \"muted small-text\", 4, \"ngIf\"], [1, \"head-actions\"], [1, \"rate-unit\"], [\"value\", \"box\"], [\"value\", \"cm3\"], [\"value\", \"kg\"], [1, \"tiny-btn\", \"primary\", \"black\", 3, \"click\"], [\"class\", \"ewaybill\", 4, \"ngFor\", \"ngForOf\"], [1, \"inline-actions\", 2, \"margin-top\", \"8px\"], [1, \"charges-grid\"], [\"type\", \"number\", 3, \"ngModelChange\", \"ngModel\"], [1, \"discount-label\"], [\"type\", \"checkbox\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [1, \"discount-row\"], [\"type\", \"number\", \"placeholder\", \"% Discount\", 3, \"ngModelChange\", \"change\", \"ngModel\", \"disabled\"], [1, \"action-bar\"], [1, \"summary\"], [1, \"action-buttons\"], [1, \"ghost\", 3, \"click\"], [1, \"ghost\", 3, \"click\", \"disabled\"], [\"class\", \"modal-backdrop\", 4, \"ngIf\"], [3, \"value\"], [\"type\", \"search\", \"list\", \"consignor-client-list\", 3, \"ngModelChange\", \"ngModel\"], [\"id\", \"consignor-client-list\"], [\"class\", \"inline-actions\", 4, \"ngIf\"], [\"value\", \"branch\"], [\"label\", \"Consignor\", 4, \"ngIf\"], [\"label\", \"Billing\", 4, \"ngIf\"], [\"label\", \"Consignor\"], [\"label\", \"Billing\"], [\"type\", \"search\", \"list\", \"consignee-client-list\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [\"id\", \"consignee-client-list\"], [\"label\", \"Clients\"], [\"label\", \"Hubs\"], [\"value\", \"\", 4, \"ngIf\"], [\"label\", \"Consignee\", 4, \"ngIf\"], [\"label\", \"Consignee\"], [1, \"muted\", \"small-text\"], [1, \"ewaybill\"], [1, \"line-header\"], [1, \"icon-btn\", 3, \"click\"], [1, \"grid-3\", \"compact\"], [\"placeholder\", \"Customer Eway-bill No\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"invoice-block\", 4, \"ngFor\", \"ngForOf\"], [1, \"tiny-btn\", \"primary\", \"ghost\", 3, \"click\"], [1, \"invoice-block\"], [\"placeholder\", \"Customer INV No\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"placeholder\", \"Value\", 3, \"ngModelChange\", \"ngModel\"], [1, \"subsection\"], [1, \"subsection-head\"], [1, \"subsection-title\"], [\"class\", \"product-row\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"compact-row\", 4, \"ngFor\", \"ngForOf\"], [1, \"product-row\"], [1, \"compact-row\"], [\"type\", \"number\", \"placeholder\", \"Qty\", 3, \"ngModelChange\", \"ngModel\"], [1, \"rate-inline\"], [\"type\", \"number\", \"placeholder\", \"Rate / Unit\", 1, \"rate-input\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"suggested-rate\", 4, \"ngIf\"], [1, \"suggested-rate\"], [3, \"ngModelChange\", \"ngModel\"], [1, \"modal-backdrop\"], [1, \"modal\"], [1, \"modal-head\"], [1, \"modal-actions\"], [1, \"override-list\"], [1, \"override-head\"], [\"class\", \"override-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"override-item\"], [1, \"override-meta\"], [1, \"override-action\"], [1, \"toggle\"], [1, \"modal\", \"product-modal\"], [\"type\", \"button\", 1, \"icon-btn\", 3, \"click\"], [\"class\", \"inline-fields\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"tiny-btn\", 3, \"click\"], [\"id\", \"rate-addresses\"], [3, \"value\", \"label\", 4, \"ngFor\", \"ngForOf\"], [1, \"inline-fields\"], [\"placeholder\", \"Pickup Address Id\", \"list\", \"rate-addresses\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"Delivery Address Id\", \"list\", \"rate-addresses\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"placeholder\", \"Rate / Box\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"placeholder\", \"Rate / cmA3\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"placeholder\", \"Rate / Kg\", 3, \"ngModelChange\", \"ngModel\"], [3, \"value\", \"label\"], [\"class\", \"tab-buttons\", \"style\", \"margin-bottom: 12px;\", 4, \"ngIf\"], [1, \"tab-buttons\", 2, \"margin-bottom\", \"12px\"], [1, \"grid-3\"], [\"placeholder\", \"City\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"State\", 3, \"ngModelChange\", \"ngModel\"], [\"placeholder\", \"PIN\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"error\", 4, \"ngIf\"], [\"placeholder\", \"Delivery Address\", 1, \"flex-1\", 3, \"ngModelChange\", \"ngModel\"], [1, \"error\"], [3, \"click\", \"disabled\"], [\"readonly\", \"\", 3, \"ngModel\"]],\n        template: function NewShipmentComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\", 1)(2, \"div\")(3, \"p\", 2);\n            i0.ɵɵtext(4, \"Operations\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"h1\");\n            i0.ɵɵtext(6, \"New Shipment\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"p\", 3);\n            i0.ɵɵtext(8, \"Create and save a shipment with consignor/consignee, items, and charges.\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 4)(10, \"div\", 5)(11, \"span\");\n            i0.ɵɵtext(12, \"Branch\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(13, \"strong\");\n            i0.ɵɵtext(14);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(15, \"div\", 5)(16, \"span\");\n            i0.ɵɵtext(17, \"Consignment No.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"strong\");\n            i0.ɵɵtext(19);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(20, \"div\", 5)(21, \"span\");\n            i0.ɵɵtext(22, \"Date\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(23, \"input\", 6);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_23_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.date, $event) || (ctx.date = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(24, \"div\", 7)(25, \"div\", 8)(26, \"div\", 9)(27, \"div\", 10)(28, \"div\")(29, \"p\", 2);\n            i0.ɵɵtext(30, \"Shipment\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(31, \"h3\");\n            i0.ɵɵtext(32, \"Shipment Details\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(33, NewShipmentComponent_div_33_Template, 8, 2, \"div\", 11);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(34, \"div\", 12)(35, \"label\");\n            i0.ɵɵtext(36, \"Consignment Number* \");\n            i0.ɵɵelementStart(37, \"input\", 13);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_37_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.consignmentNumber, $event) || (ctx.consignmentNumber = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(38, \"label\");\n            i0.ɵɵtext(39, \"External Ref ID \");\n            i0.ɵɵelementStart(40, \"input\", 14);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_40_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.externalRefId, $event) || (ctx.externalRefId = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(41, \"div\", 9)(42, \"div\", 10)(43, \"div\")(44, \"p\", 2);\n            i0.ɵɵtext(45, \"Parties\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(46, \"h3\");\n            i0.ɵɵtext(47, \"Sender & Receiver\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(48, \"div\", 15);\n            i0.ɵɵtext(49, \"Branch scoped\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(50, \"div\", 16)(51, \"div\", 17)(52, \"div\", 18)(53, \"h4\");\n            i0.ɵɵtext(54, \"Consignor (Sender)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(55, \"div\", 19)(56, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_56_listener() {\n              return ctx.consignorTab = \"consignor\";\n            });\n            i0.ɵɵtext(57, \"Client\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(58, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_58_listener() {\n              return ctx.consignorTab = \"guest\";\n            });\n            i0.ɵɵtext(59, \"Guest\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(60, NewShipmentComponent_div_60_Template, 11, 2, \"div\", 21)(61, NewShipmentComponent_div_61_Template, 10, 2, \"div\", 21);\n            i0.ɵɵelementStart(62, \"div\", 22);\n            i0.ɵɵelement(63, \"div\", 18);\n            i0.ɵɵtemplate(64, NewShipmentComponent_div_64_Template, 9, 5, \"div\", 21)(65, NewShipmentComponent_div_65_Template, 21, 4, \"div\", 23);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(66, \"div\", 17)(67, \"div\", 18)(68, \"h4\");\n            i0.ɵɵtext(69, \"Consignee (Receiver)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(70, \"div\", 19)(71, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_71_listener() {\n              return ctx.consigneeTab = \"consignee\";\n            });\n            i0.ɵɵtext(72, \"Client\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(73, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_73_listener() {\n              return ctx.consigneeTab = \"guest\";\n            });\n            i0.ɵɵtext(74, \"Guest\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(75, NewShipmentComponent_div_75_Template, 11, 2, \"div\", 21)(76, NewShipmentComponent_div_76_Template, 10, 2, \"div\", 21);\n            i0.ɵɵelementStart(77, \"div\", 22)(78, \"div\", 24)(79, \"div\", 25)(80, \"span\", 26);\n            i0.ɵɵtext(81, \"Delivery Point\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(82, \"label\", 27)(83, \"input\", 28);\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_input_change_83_listener($event) {\n              return ctx.onDeliverySelfPickupToggle($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(84, \"span\", 29);\n            i0.ɵɵelement(85, \"span\", 30);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(86, \"span\");\n            i0.ɵɵtext(87);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(88, \"div\", 25)(89, \"button\", 31);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_89_listener() {\n              return ctx.openClientModal();\n            });\n            i0.ɵɵtext(90, \"+ New Client/Edit Client\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(91, \"label\");\n            i0.ɵɵtext(92, \"Client Name \");\n            i0.ɵɵelementStart(93, \"select\", 32);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_select_ngModelChange_93_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.deliveryPreviousReceiver, $event) || (ctx.deliveryPreviousReceiver = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_select_change_93_listener() {\n              return ctx.onDeliveryPreviousReceiverSelect(ctx.deliveryPreviousReceiver);\n            });\n            i0.ɵɵelementStart(94, \"option\", 33);\n            i0.ɵɵtext(95, \"Select client\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(96, NewShipmentComponent_option_96_Template, 2, 2, \"option\", 34);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(97, \"label\");\n            i0.ɵɵtext(98, \"Delivery Address \");\n            i0.ɵɵelementStart(99, \"select\", 35);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_select_ngModelChange_99_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.deliveryLocationIndex, $event) || (ctx.deliveryLocationIndex = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_select_change_99_listener() {\n              return ctx.onDeliverySelectedLocationSelect(ctx.deliveryLocationIndex);\n            });\n            i0.ɵɵelementStart(100, \"option\", 33);\n            i0.ɵɵtext(101, \"Select address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(102, NewShipmentComponent_option_102_Template, 2, 2, \"option\", 34);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(103, \"div\", 36)(104, \"span\", 37);\n            i0.ɵɵtext(105, \"Delivery Pincode\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(106, \"span\", 38);\n            i0.ɵɵtext(107);\n            i0.ɵɵelementEnd()()()()()();\n            i0.ɵɵelementStart(108, \"div\", 9)(109, \"div\", 10)(110, \"div\")(111, \"p\", 2);\n            i0.ɵɵtext(112, \"Addresses\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(113, \"h3\");\n            i0.ɵɵtext(114, \"Billing\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(115, \"div\", 12)(116, \"div\", 22)(117, \"div\", 18)(118, \"h4\");\n            i0.ɵɵtext(119, \"Billing\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(120, \"div\", 39)(121, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_121_listener() {\n              return ctx.setBillingType(\"consignor\");\n            });\n            i0.ɵɵtext(122, \"Consignor/ Consignee\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(123, \"button\", 20);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_123_listener() {\n              return ctx.setBillingType(\"different\");\n            });\n            i0.ɵɵtext(124, \"Different\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(125, \"div\", 40)(126, \"div\", 24)(127, \"div\", 41)(128, \"label\");\n            i0.ɵɵtext(129, \"Payment Mode \");\n            i0.ɵɵelementStart(130, \"select\", 35);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_select_ngModelChange_130_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.paymentMode, $event) || (ctx.paymentMode = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_select_change_130_listener() {\n              return ctx.onPaymentModeChange();\n            });\n            i0.ɵɵelementStart(131, \"option\");\n            i0.ɵɵtext(132, \"To Pay\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(133, NewShipmentComponent_option_133_Template, 2, 0, \"option\", 23)(134, NewShipmentComponent_option_134_Template, 2, 0, \"option\", 23);\n            i0.ɵɵelementStart(135, \"option\");\n            i0.ɵɵtext(136, \"Paid\");\n            i0.ɵɵelementEnd()()()()()()();\n            i0.ɵɵtemplate(137, NewShipmentComponent_div_137_Template, 31, 8, \"div\", 21)(138, NewShipmentComponent_div_138_Template, 7, 4, \"div\", 21)(139, NewShipmentComponent_div_139_Template, 2, 0, \"div\", 42);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(140, \"div\", 8)(141, \"div\", 9)(142, \"div\", 10)(143, \"div\")(144, \"p\", 2);\n            i0.ɵɵtext(145, \"Items\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(146, \"h3\");\n            i0.ɵɵtext(147, \"E-Waybills & Invoices\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(148, \"div\", 43)(149, \"div\", 44)(150, \"span\");\n            i0.ɵɵtext(151, \"Rate Unit\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(152, \"select\", 32);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_select_ngModelChange_152_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.rateUnit, $event) || (ctx.rateUnit = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_select_change_152_listener() {\n              return ctx.onRateUnitChange();\n            });\n            i0.ɵɵelementStart(153, \"option\", 45);\n            i0.ɵɵtext(154, \"Rate / Box\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(155, \"option\", 46);\n            i0.ɵɵtext(156, \"Rate / cmA3\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(157, \"option\", 47);\n            i0.ɵɵtext(158, \"Rate / Kg\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(159, \"button\", 48);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_159_listener() {\n              return ctx.addEwaybill();\n            });\n            i0.ɵɵtext(160, \"+ E-Waybill\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(161, NewShipmentComponent_div_161_Template, 12, 4, \"div\", 49);\n            i0.ɵɵelementStart(162, \"div\", 50)(163, \"span\", 26);\n            i0.ɵɵtext(164, \"Need another e-waybill?\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(165, \"button\", 48);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_165_listener() {\n              return ctx.addEwaybill();\n            });\n            i0.ɵɵtext(166, \"+ E-Waybill\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(167, \"div\", 9)(168, \"div\", 10)(169, \"div\")(170, \"p\", 2);\n            i0.ɵɵtext(171, \"Money\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(172, \"h3\");\n            i0.ɵɵtext(173, \"Charges & Payment\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(174, \"div\", 51)(175, \"label\");\n            i0.ɵɵtext(176, \"ODC \");\n            i0.ɵɵelementStart(177, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_177_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.odc, $event) || (ctx.charges.odc = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_177_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(178, \"label\");\n            i0.ɵɵtext(179, \"Unloading \");\n            i0.ɵɵelementStart(180, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_180_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.unloading, $event) || (ctx.charges.unloading = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_180_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(181, \"label\");\n            i0.ɵɵtext(182, \"Docket \");\n            i0.ɵɵelementStart(183, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_183_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.docket, $event) || (ctx.charges.docket = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_183_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(184, \"label\");\n            i0.ɵɵtext(185, \"Other \");\n            i0.ɵɵelementStart(186, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_186_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.other, $event) || (ctx.charges.other = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_186_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(187, \"label\");\n            i0.ɵɵtext(188, \"CCC \");\n            i0.ɵɵelementStart(189, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_189_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.ccc, $event) || (ctx.charges.ccc = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_189_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(190, \"label\")(191, \"div\", 53)(192, \"span\");\n            i0.ɵɵtext(193, \"Discount (Consignor)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(194, \"label\", 27)(195, \"input\", 54);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_195_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.applyConsignorDiscount, $event) || (ctx.applyConsignorDiscount = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_input_change_195_listener() {\n              return ctx.scheduleQuote();\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(196, \"span\", 29);\n            i0.ɵɵelement(197, \"span\", 30);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(198, \"div\", 55)(199, \"input\", 56);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_199_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.charges.consignorDiscount, $event) || (ctx.charges.consignorDiscount = $event);\n              return $event;\n            });\n            i0.ɵɵlistener(\"change\", function NewShipmentComponent_Template_input_change_199_listener() {\n              return ctx.onConsignorDiscountChange(ctx.charges.consignorDiscount);\n            });\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(200, \"label\");\n            i0.ɵɵtext(201, \"Initial Paid \");\n            i0.ɵɵelementStart(202, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_202_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.initialPaid, $event) || (ctx.initialPaid = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(203, \"label\");\n            i0.ɵɵtext(204, \"Final Amount \");\n            i0.ɵɵelementStart(205, \"input\", 52);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function NewShipmentComponent_Template_input_ngModelChange_205_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.finalAmount, $event) || (ctx.finalAmount = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()()()()()();\n            i0.ɵɵelementStart(206, \"div\", 57)(207, \"div\", 58)(208, \"div\")(209, \"span\", 2);\n            i0.ɵɵtext(210, \"Consignment\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(211, \"strong\");\n            i0.ɵɵtext(212);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(213, \"div\")(214, \"span\", 2);\n            i0.ɵɵtext(215, \"Branch\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(216, \"strong\");\n            i0.ɵɵtext(217);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(218, \"div\")(219, \"span\", 2);\n            i0.ɵɵtext(220, \"Final Amount\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(221, \"strong\");\n            i0.ɵɵtext(222);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(223, \"div\", 59)(224, \"button\", 60);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_224_listener() {\n              return ctx.resetForm();\n            });\n            i0.ɵɵtext(225, \"Reset\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(226, \"button\", 61);\n            i0.ɵɵlistener(\"click\", function NewShipmentComponent_Template_button_click_226_listener() {\n              return ctx.saveShipment();\n            });\n            i0.ɵɵtext(227);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(228, NewShipmentComponent_div_228_Template, 14, 0, \"div\", 62)(229, NewShipmentComponent_div_229_Template, 19, 2, \"div\", 62)(230, NewShipmentComponent_div_230_Template, 25, 4, \"div\", 62)(231, NewShipmentComponent_div_231_Template, 10, 4, \"div\", 62)(232, NewShipmentComponent_div_232_Template, 29, 8, \"div\", 62);\n          }\n          if (rf & 2) {\n            i0.ɵɵclassProp(\"all-hubs-lock\", ctx.isAllHubsSelectionRequired);\n            i0.ɵɵadvance(14);\n            i0.ɵɵtextInterpolate(ctx.branch || \"All Branches\");\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.consignmentNumber);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.date);\n            i0.ɵɵadvance(10);\n            i0.ɵɵproperty(\"ngIf\", ctx.branch === \"All Hubs\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.consignmentNumber);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.externalRefId);\n            i0.ɵɵadvance(16);\n            i0.ɵɵclassProp(\"active\", ctx.consignorTab === \"consignor\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.consignorTab === \"guest\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.consignorTab === \"consignor\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.consignorTab === \"guest\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.pickupType !== \"different\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.pickupType === \"branch\");\n            i0.ɵɵadvance(6);\n            i0.ɵɵclassProp(\"active\", ctx.consigneeTab === \"consignee\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.consigneeTab === \"guest\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.consigneeTab === \"consignee\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.consigneeTab === \"guest\");\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"checked\", ctx.deliveryType === \"branch\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵtextInterpolate(ctx.deliveryType === \"branch\" ? \"Customer Self Pickup\" : \"Out for delivery too\");\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.deliveryPreviousReceiver);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.clientList);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.deliveryLocationIndex);\n            i0.ɵɵproperty(\"disabled\", !ctx.deliveryPreviousReceiver);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.getDeliverySelectedClientLocations());\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.deliveryPincode || \"-\");\n            i0.ɵɵadvance(14);\n            i0.ɵɵclassProp(\"active\", ctx.billingType === \"consignor\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.billingType === \"different\");\n            i0.ɵɵadvance(7);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.paymentMode);\n            i0.ɵɵproperty(\"disabled\", !ctx.isPaymentModeEnabled());\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.allowReceiverCredit);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.allowAccountCredit);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.billingType === \"different\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.billingType === \"consignor\" && ctx.consignorTab === \"consignor\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.billingType === \"consignor\" && ctx.consignorTab === \"guest\");\n            i0.ɵɵadvance(13);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.rateUnit);\n            i0.ɵɵadvance(9);\n            i0.ɵɵproperty(\"ngForOf\", ctx.ewaybills);\n            i0.ɵɵadvance(16);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.odc);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.unloading);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.docket);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.other);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.ccc);\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.applyConsignorDiscount);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.charges.consignorDiscount);\n            i0.ɵɵproperty(\"disabled\", !ctx.applyConsignorDiscount);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.initialPaid);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.finalAmount);\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate(ctx.consignmentNumber);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.branch);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.finalAmount || 0);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", ctx.isSaving || !ctx.hasValidProduct());\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\" \", ctx.isSaving ? \"Saving...\" : \"Save\", \" \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showFinalAmountModal);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showRateOverrideModal);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showProductModal);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showClientModal);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.showGuestModal);\n          }\n        },\n        dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.CheckboxControlValueAccessor, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\"[_ngcontent-%COMP%]:root{--bg: #f6f8fb;--card: #ffffff;--border: #e5e7eb;--text: #000000;--muted: #000000;--primary: #2563eb;--primary-strong: #1e3a8a}.page-shell[_ngcontent-%COMP%]{max-width:1280px;margin:0 auto 72px;padding:24px;background:var(--bg);color:var(--text)}.all-hubs-lock[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{pointer-events:none;opacity:.6}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px;align-items:flex-start;margin-bottom:16px}.eyebrow[_ngcontent-%COMP%]{margin:0;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}h1[_ngcontent-%COMP%]{margin:4px 0;font-size:26px}.subhead[_ngcontent-%COMP%]{margin:0;color:var(--muted);font-size:14px}.meta-stack[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.chip-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:10px 12px;background:#eef2ff;border:1px solid #e0e7ff;border-radius:10px;min-width:160px}.chip-field[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;color:var(--muted)}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;align-items:start}.card[_ngcontent-%COMP%]{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:16px;box-shadow:0 4px 16px #0f172a0d}.card-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:12px}.head-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.rate-unit[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-size:12px;font-weight:600;color:var(--muted)}.rate-unit[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 8px;font-size:12px}.pill[_ngcontent-%COMP%]{padding:6px 10px;border-radius:20px;background:#e0f2fe;color:#0ea5e9;font-weight:600;font-size:12px;white-space:nowrap}.grid-2[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.payment-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.span-2[_ngcontent-%COMP%]{grid-column:1 / -1}.grid-3[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;font-weight:600;font-size:13px;color:#1f2937}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:10px;border:1px solid var(--border);border-radius:8px;font-size:14px;color:var(--text);background:#fff}textarea[_ngcontent-%COMP%]{min-height:70px;resize:vertical}.tab-buttons[_ngcontent-%COMP%]{display:inline-flex;background:#e5e7eb;border-radius:8px;padding:4px;gap:4px}.tab-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;background:transparent;padding:6px 12px;border-radius:6px;cursor:pointer;color:var(--muted);font-weight:600}.tab-buttons[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#fff;color:var(--primary-strong);box-shadow:0 2px 8px #0f172a1f}.tab-buttons.ghost[_ngcontent-%COMP%]{background:#f8fafc}.party-grid[_ngcontent-%COMP%]{gap:12px}.panel[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:10px;padding:12px;background:#fff;display:flex;flex-direction:column;gap:8px}.panel.soft[_ngcontent-%COMP%]{background:#f8fafc}.panel-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:10px;align-items:center}.panel-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.field-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-weight:600;font-size:13px;color:#1f2937}.field-display[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--muted)}.field-display[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--text)}.inline-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.muted[_ngcontent-%COMP%]{color:var(--muted)}.muted[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text)}.small-text[_ngcontent-%COMP%]{font-size:12px}.tiny-btn[_ngcontent-%COMP%]{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer;font-weight:600}.tiny-btn.primary[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border-color:var(--primary)}.tiny-btn.primary.black[_ngcontent-%COMP%]{background:#000;border-color:#000;color:#fff}.tiny-btn.primary.ghost[_ngcontent-%COMP%]{background:#eef2ff;color:var(--primary-strong)}.icon-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid var(--border);width:28px;height:28px;border-radius:6px;cursor:pointer;color:var(--muted)}.ewaybill[_ngcontent-%COMP%]{border:1px dashed var(--border);border-radius:12px;padding:12px;margin-bottom:12px;background:#f8fafc}.invoice-block[_ngcontent-%COMP%]{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;margin-top:10px;display:flex;flex-direction:column;gap:10px}.line-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;justify-content:space-between;flex-wrap:wrap}.grid-3.compact[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.compact-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 110px auto;gap:8px;align-items:center}.subsection[_ngcontent-%COMP%]{margin-top:8px;border:1px dashed var(--border);border-radius:10px;padding:10px;background:#fff}.subsection-title[_ngcontent-%COMP%]{font-weight:600;color:var(--muted);margin-bottom:8px}.subsection-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}.subsection-head[_ngcontent-%COMP%]   .subsection-title[_ngcontent-%COMP%]{margin-bottom:0}.charges-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-top:12px}.discount-label[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:8px}.discount-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.toggle-inline[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--muted)}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;pointer-events:none}.toggle-inline[_ngcontent-%COMP%]   .toggle-track[_ngcontent-%COMP%]{position:relative;width:38px;height:20px;background:#e5e7eb;border-radius:999px;display:inline-flex;align-items:center;padding:2px;box-sizing:border-box;transition:background .2s ease}.toggle-inline[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 1px 2px #00000026;transform:translate(0);transition:transform .2s ease}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]{background:#22c55e}.toggle-inline[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(18px)}.action-bar[_ngcontent-%COMP%]{position:sticky;bottom:0;display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 16px;background:#fffffff2;border:1px solid var(--border);border-radius:12px;box-shadow:0 -4px 16px #0f172a14;margin-top:12px}.summary[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.summary[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap}button.primary[_ngcontent-%COMP%]{background:var(--primary);color:#fff;border:1px solid var(--primary);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}button.ghost[_ngcontent-%COMP%]{background:#f8fafc;color:var(--text);border:1px solid var(--border);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000059;display:flex;align-items:center;justify-content:center;z-index:2000;padding:16px}.modal[_ngcontent-%COMP%], .product-modal[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;width:min(520px,100%);box-shadow:0 10px 40px #00000029;display:flex;flex-direction:column;gap:10px;max-height:90vh;overflow-y:auto}.product-modal[_ngcontent-%COMP%]   .modal-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.product-modal[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}.product-modal[_ngcontent-%COMP%]   .icon-btn[_ngcontent-%COMP%]{background:transparent;border:1px solid #e5e7eb;width:28px;height:28px;border-radius:6px;cursor:pointer;color:#6b7280}.product-modal[_ngcontent-%COMP%]   .inline-fields[_ngcontent-%COMP%]{display:flex;gap:8px;flex:1;min-width:260px;flex-wrap:wrap}.product-modal[_ngcontent-%COMP%]   .tiny-btn[_ngcontent-%COMP%]{background:#f8fafc;color:#111827;border:1px solid #e5e7eb;padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600}.modal-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.modal[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;min-height:70px}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px}.error[_ngcontent-%COMP%]{color:#b91c1c;font-size:12px}.override-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.override-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;font-weight:700;color:var(--muted);padding-bottom:4px;border-bottom:1px solid var(--border)}.override-item[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;font-size:13px}.override-meta[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;flex:1 1 260px}.override-action[_ngcontent-%COMP%]{min-width:200px}.toggle[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;font-size:12px;color:var(--muted)}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{position:absolute;opacity:0;pointer-events:none}.toggle-track[_ngcontent-%COMP%]{position:relative;width:38px;height:20px;background:#e5e7eb;border-radius:999px;display:inline-flex;align-items:center;padding:2px;box-sizing:border-box;transition:background .2s ease}.toggle-thumb[_ngcontent-%COMP%]{width:16px;height:16px;background:#fff;border-radius:50%;box-shadow:0 1px 2px #00000026;transform:translate(0);transition:transform .2s ease}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]{background:#22c55e}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .toggle-track[_ngcontent-%COMP%]   .toggle-thumb[_ngcontent-%COMP%]{transform:translate(18px)}.inline-fields[_ngcontent-%COMP%]{display:flex;gap:8px;flex:1;min-width:260px}.inline-fields[_ngcontent-%COMP%]   .flex-1[_ngcontent-%COMP%]{flex:1;min-width:160px}.product-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.rate-input[_ngcontent-%COMP%]{max-width:160px}.rate-inline[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.suggested-rate[_ngcontent-%COMP%]{color:#16a34a;font-size:12px;font-weight:600}@media (max-width: 1080px){.layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media (max-width: 720px){.grid-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.grid-3[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.meta-stack[_ngcontent-%COMP%], .action-bar[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}@media (max-width: 520px){.grid-3[_ngcontent-%COMP%]{grid-template-columns:1fr}.inline-fields[_ngcontent-%COMP%]{flex-direction:column}.compact-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return NewShipmentComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}