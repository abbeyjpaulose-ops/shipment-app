{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nfunction ProfileComponent_img_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 16);\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"src\", ctx_r0.profile.photo, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ProfileComponent_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"No Photo\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProfileComponent_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"h3\");\n    i0.ɵɵtext(2, \"Standard Pricing\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 18)(4, \"label\");\n    i0.ɵɵtext(5, \"Price per box (\\u20B9) \");\n    i0.ɵɵelementStart(6, \"input\", 19);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_div_40_Template_input_ngModelChange_6_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.profile.pricePerNumber, $event) || (ctx_r0.profile.pricePerNumber = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(7, \"br\");\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"Price per Kilogram (\\u20B9) \");\n    i0.ɵɵelementStart(10, \"input\", 19);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_div_40_Template_input_ngModelChange_10_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.profile.pricePerKg, $event) || (ctx_r0.profile.pricePerKg = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(11, \"br\");\n    i0.ɵɵelementStart(12, \"label\");\n    i0.ɵɵtext(13, \"Price per Area (cm\\u00B3 / sq units) (\\u20B9) \");\n    i0.ɵɵelementStart(14, \"input\", 19);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_div_40_Template_input_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.profile.pricePerArea, $event) || (ctx_r0.profile.pricePerArea = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.profile.pricePerNumber);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.profile.pricePerKg);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.profile.pricePerArea);\n  }\n}\nfunction ProfileComponent_button_44_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProfileComponent_button_44_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.backfillBusinessType());\n    });\n    i0.ɵɵtext(1, \"Backfill Business Type\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProfileComponent_button_45_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProfileComponent_button_45_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.clearProfile());\n    });\n    i0.ɵɵtext(1, \"Clear\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ProfileComponent = /*#__PURE__*/(() => {\n  class ProfileComponent {\n    constructor(http) {\n      this.http = http;\n      this.profile = {\n        name: '',\n        photo: '',\n        address: '',\n        company: '',\n        mobile: '',\n        email: '',\n        role: '',\n        businessType: '',\n        pricePerNumber: 0,\n        pricePerKg: 0,\n        pricePerArea: 0\n      };\n    }\n    ngOnInit() {\n      this.loadProfile();\n    }\n    isAdmin() {\n      const role = String(this.profile?.role || localStorage.getItem('role') || '').toLowerCase();\n      return role === 'admin';\n    }\n    loadProfile() {\n      const email = localStorage.getItem('email'); // set during login\n      const username = localStorage.getItem('username'); // set during login\n      this.http.get(`http://localhost:3000/api/profile?user=${username}&email=${email}`).subscribe({\n        next: data => {\n          this.profile = data[0] || this.profile;\n          if (this.profile?.businessType) {\n            localStorage.setItem('companyType', String(this.profile.businessType));\n          }\n          console.log(\"Profile loaded:\", this.profile);\n        },\n        error: err => console.error(\"Error loading products:\", err)\n      });\n    }\n    onFileSelected(event) {\n      const file = event.target.files[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = () => {\n          this.profile.photo = reader.result;\n        };\n        reader.readAsDataURL(file);\n      }\n    }\n    saveProfile() {\n      const email = this.profile?.email || localStorage.getItem('email') || '';\n      const username = this.profile?.username || localStorage.getItem('username') || '';\n      const payload = {\n        ...this.profile,\n        email,\n        username\n      };\n      console.log(\"Sending profile data:\", payload);\n      this.http.post('http://localhost:3000/api/profile/save', payload, {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).subscribe({\n        next: res => {\n          console.log(\"Profile saved\", res);\n          if (res) {\n            this.profile = res;\n          }\n          if (this.profile?.businessType) {\n            localStorage.setItem('companyType', String(this.profile.businessType));\n          }\n          this.loadProfile();\n        },\n        error: err => {\n          console.error(\"Error saving profile:\", err);\n          alert('Error: ' + err.error.message);\n        }\n      });\n    }\n    backfillBusinessType() {\n      const ok = window.confirm('Backfill business type for all profiles?');\n      if (!ok) return;\n      this.http.post('http://localhost:3000/api/profile/migrateBusinessType', {}).subscribe({\n        next: res => {\n          console.log('Profile businessType backfilled', res);\n          alert('Business type backfilled for profiles.');\n          this.loadProfile();\n        },\n        error: err => {\n          console.error('Error backfilling businessType:', err);\n          alert('Error: ' + (err.error?.message || 'Backfill failed'));\n        }\n      });\n    }\n    clearProfile() {\n      this.profile = {\n        name: '',\n        address: '',\n        company: '',\n        mobile: '',\n        //email: localStorage.getItem('email')|| '', \n        role: '',\n        photo: '',\n        businessType: ''\n        //username: localStorage.getItem('username')\n      };\n      console.log('Profile cleared locally.');\n    }\n    static {\n      this.ɵfac = function ProfileComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProfileComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ProfileComponent,\n        selectors: [[\"app-profile\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 46,\n        vars: 17,\n        consts: [[1, \"profile-container\"], [1, \"profile-main\"], [1, \"photo-section\"], [1, \"photo-frame\"], [\"alt\", \"Profile Photo\", 3, \"src\", 4, \"ngIf\"], [4, \"ngIf\"], [\"type\", \"file\", 3, \"change\", \"disabled\"], [1, \"form-section\"], [1, \"form-row\"], [\"placeholder\", \"Enter address\", 3, \"ngModelChange\", \"ngModel\", \"disabled\"], [\"type\", \"text\", \"placeholder\", \"Enter company name\", 3, \"ngModelChange\", \"ngModel\", \"disabled\"], [\"type\", \"text\", \"placeholder\", \"Enter mobile number\", 3, \"ngModelChange\", \"ngModel\", \"disabled\"], [\"class\", \"pricing-section\", 4, \"ngIf\"], [1, \"button-section\"], [3, \"click\", \"disabled\"], [3, \"click\", 4, \"ngIf\"], [\"alt\", \"Profile Photo\", 3, \"src\"], [1, \"pricing-section\"], [1, \"grid-3\"], [\"type\", \"number\", \"placeholder\", \"\\u20B9\", 3, \"ngModelChange\", \"ngModel\"], [3, \"click\"]],\n        template: function ProfileComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3);\n            i0.ɵɵtemplate(4, ProfileComponent_img_4_Template, 1, 1, \"img\", 4)(5, ProfileComponent_span_5_Template, 2, 0, \"span\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"input\", 6);\n            i0.ɵɵlistener(\"change\", function ProfileComponent_Template_input_change_6_listener($event) {\n              return ctx.onFileSelected($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"div\", 7)(8, \"div\", 8)(9, \"label\");\n            i0.ɵɵtext(10, \"Name:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"span\");\n            i0.ɵɵtext(12);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"div\", 8)(14, \"label\");\n            i0.ɵɵtext(15, \"Address:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"textarea\", 9);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_Template_textarea_ngModelChange_16_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.profile.address, $event) || (ctx.profile.address = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"div\", 8)(18, \"label\");\n            i0.ɵɵtext(19, \"Company Name:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"input\", 10);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_Template_input_ngModelChange_20_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.profile.company, $event) || (ctx.profile.company = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 8)(22, \"label\");\n            i0.ɵɵtext(23, \"Mobile Number:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"input\", 11);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function ProfileComponent_Template_input_ngModelChange_24_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.profile.mobile, $event) || (ctx.profile.mobile = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(25, \"div\", 8)(26, \"label\");\n            i0.ɵɵtext(27, \"Email:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(28, \"span\");\n            i0.ɵɵtext(29);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(30, \"div\", 8)(31, \"label\");\n            i0.ɵɵtext(32, \"GSTIN:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"span\");\n            i0.ɵɵtext(34);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(35, \"div\", 8)(36, \"label\");\n            i0.ɵɵtext(37, \"Role:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(38, \"span\");\n            i0.ɵɵtext(39);\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(40, ProfileComponent_div_40_Template, 15, 3, \"div\", 12);\n            i0.ɵɵelementStart(41, \"div\", 13)(42, \"button\", 14);\n            i0.ɵɵlistener(\"click\", function ProfileComponent_Template_button_click_42_listener() {\n              return ctx.saveProfile();\n            });\n            i0.ɵɵtext(43, \"Save\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(44, ProfileComponent_button_44_Template, 2, 0, \"button\", 15)(45, ProfileComponent_button_45_Template, 2, 0, \"button\", 15);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", ctx.profile.photo);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.profile.photo);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"disabled\", !ctx.isAdmin());\n            i0.ɵɵadvance(6);\n            i0.ɵɵtextInterpolate(ctx.profile.name);\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.profile.address);\n            i0.ɵɵproperty(\"disabled\", !ctx.isAdmin());\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.profile.company);\n            i0.ɵɵproperty(\"disabled\", !ctx.isAdmin());\n            i0.ɵɵadvance(4);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.profile.mobile);\n            i0.ɵɵproperty(\"disabled\", !ctx.isAdmin());\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.profile.email);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.profile.gstin);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.profile.role);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isAdmin());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", !ctx.isAdmin());\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.isAdmin());\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.isAdmin());\n          }\n        },\n        dependencies: [CommonModule, i2.NgIf, FormsModule, i3.DefaultValueAccessor, i3.NumberValueAccessor, i3.NgControlStatus, i3.NgModel],\n        styles: [\".profile-container[_ngcontent-%COMP%]{max-width:900px;margin:auto;background:#f9f9f9;padding:20px;border-radius:10px;display:flex;flex-direction:column;gap:20px}.profile-main[_ngcontent-%COMP%]{display:flex;gap:30px;align-items:flex-start}.photo-section[_ngcontent-%COMP%]{flex:1;text-align:center}.photo-frame[_ngcontent-%COMP%]{width:150px;height:150px;border:2px solid #ccc;border-radius:50%;margin:auto;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#eee}.photo-frame[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.photo-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-top:10px}.form-section[_ngcontent-%COMP%]{flex:2;display:grid;grid-template-columns:1fr 2fr;gap:15px 20px}.form-row[_ngcontent-%COMP%]{display:contents}.form-section[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;align-self:center}.form-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-section[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{padding:8px;border-radius:5px;border:1px solid #ccc;width:100%}.button-section[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:15px}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:5px;cursor:pointer}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background:#2c3e50;color:#fff}.button-section[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background:#e74c3c;color:#fff}\"]\n      });\n    }\n  }\n  return ProfileComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}