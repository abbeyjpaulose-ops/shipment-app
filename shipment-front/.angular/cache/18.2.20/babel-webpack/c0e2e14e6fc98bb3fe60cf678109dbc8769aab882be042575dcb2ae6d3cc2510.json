{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet ClientComponent = class ClientComponent {\n  constructor(http) {\n    this.http = http;\n    this.clients = [];\n    this.productOptions = [];\n    this.showAddClientPopup = false;\n    this.showEditClientPopup = false;\n    this.cbranch = localStorage.getItem('branch') || 'All Branches';\n    this.newClient = {\n      clientName: '',\n      address: '',\n      city: '',\n      state: '',\n      pinCode: '',\n      GSTIN: '',\n      phoneNum: '',\n      perDis: '',\n      creditType: 'no-credit',\n      products: [],\n      deliveryLocations: [{\n        address: '',\n        city: '',\n        state: '',\n        pinCode: ''\n      }],\n      status: 'active',\n      branch: localStorage.getItem('branch') || 'All Branches',\n      email: localStorage.getItem('email'),\n      username: localStorage.getItem('username')\n    };\n    this.editingClient = null;\n    this.onStorage = e => {\n      if (e.key === 'branch' && e.newValue && e.newValue !== this.cbranch) {\n        this.cbranch = e.newValue;\n        this.loadClients();\n        this.loadProducts();\n      }\n    };\n  }\n  ngOnInit() {\n    this.loadClients();\n    this.loadProducts();\n    // react to branch changes (same tab)\n    this.branchCheck = setInterval(() => {\n      const current = localStorage.getItem('branch') || 'All Branches';\n      if (current !== this.cbranch) {\n        this.cbranch = current;\n        this.loadClients();\n        this.loadProducts();\n      }\n    }, 1000);\n    // react to branch changes (other tabs)\n    window.addEventListener('storage', this.onStorage);\n  }\n  ngOnDestroy() {\n    if (this.branchCheck) clearInterval(this.branchCheck);\n    window.removeEventListener('storage', this.onStorage);\n  }\n  /** Load Clients */\n  loadClients() {\n    const email = localStorage.getItem('email');\n    this.cbranch = localStorage.getItem('branch') || 'All Branches';\n    this.http.get(`http://localhost:3000/api/clients?email=${email}&branch=${this.cbranch}`).subscribe({\n      next: data => {\n        console.log(\"Clients loaded:\", data);\n        this.clients = data;\n      },\n      error: err => console.error(\"Error loading clients:\", err)\n    });\n  }\n  /** Load Products for dropdown */\n  loadProducts() {\n    const branch = localStorage.getItem('branch') || 'All Branches';\n    this.http.get(`http://localhost:3000/api/products`).subscribe({\n      next: data => {\n        this.productOptions = (data || []).filter(p => branch === 'All Branches' ? true : p.branch === branch);\n      },\n      error: err => console.error('Error loading products:', err)\n    });\n  }\n  /** Popup Control */\n  openAddClientPopup() {\n    this.showAddClientPopup = true;\n  }\n  closeAddClientPopup() {\n    this.showAddClientPopup = false;\n  }\n  openEditClientPopup(client) {\n    this.editingClient = JSON.parse(JSON.stringify(client));\n    if (!Array.isArray(this.editingClient.products)) this.editingClient.products = [];\n    if (!Array.isArray(this.editingClient.deliveryLocations)) {\n      this.editingClient.deliveryLocations = [{\n        address: '',\n        city: '',\n        state: '',\n        pinCode: ''\n      }];\n    }\n    this.editingClient.products = this.editingClient.products.map(product => this.ensureProductRates(product));\n    this.showEditClientPopup = true;\n  }\n  closeEditClientPopup() {\n    this.showEditClientPopup = false;\n    this.editingClient = null;\n  }\n  /** Product Functions */\n  addProduct() {\n    this.newClient.products.push({\n      hsnNum: '',\n      productName: '',\n      rates: [this.createRateEntry()]\n    });\n  }\n  onProductSelect(row) {\n    const match = this.productOptions.find(p => p.productName === row.productName);\n    if (match) {\n      row.hsnNum = match.hsnNum;\n    }\n  }\n  removeProduct(index) {\n    this.newClient.products.splice(index, 1);\n  }\n  addProductEdit() {\n    this.editingClient.products.push({\n      hsnNum: '',\n      productName: '',\n      rates: [this.createRateEntry()]\n    });\n  }\n  removeProductEdit(index) {\n    this.editingClient.products.splice(index, 1);\n  }\n  addRateRow(product) {\n    if (!product.rates) {\n      product.rates = [];\n    }\n    product.rates.push(this.createRateEntry());\n  }\n  removeRateRow(product, index) {\n    if (!product.rates) {\n      return;\n    }\n    product.rates.splice(index, 1);\n  }\n  /** Delivery Location Functions */\n  addDeliveryLocation() {\n    this.newClient.deliveryLocations.push({\n      address: '',\n      city: '',\n      state: '',\n      pinCode: ''\n    });\n  }\n  removeDeliveryLocation(index) {\n    this.newClient.deliveryLocations.splice(index, 1);\n  }\n  addDeliveryLocationEdit() {\n    this.editingClient.deliveryLocations.push({\n      address: '',\n      city: '',\n      state: '',\n      pinCode: ''\n    });\n  }\n  removeDeliveryLocationEdit(index) {\n    this.editingClient.deliveryLocations.splice(index, 1);\n  }\n  /** Add Client */\n  addClient() {\n    console.log('ðŸ“¤ Sending client data:', this.newClient);\n    this.newClient.branch = localStorage.getItem('branch') || 'All Branches';\n    if (this.newClient.branch === 'All Branches') {\n      alert('Please select a specific branch before adding a client.');\n      return;\n    }\n    this.http.post('http://localhost:3000/api/clients/add', this.newClient, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).subscribe({\n      next: res => {\n        console.log('âœ… Client saved', res);\n        alert('Client added successfully!');\n        window.location.reload();\n      },\n      error: err => {\n        console.error('âŒ Error saving client:', err);\n        alert('Error: ' + err.error.message);\n      }\n    });\n  }\n  /** Edit Functions */\n  saveEdit() {\n    this.http.put(`http://localhost:3000/api/clients/${this.editingClient._id}`, this.editingClient).subscribe(() => {\n      this.loadClients();\n      this.closeEditClientPopup();\n    });\n  }\n  /** Toggle Functions */\n  toggleCreditType(client) {\n    this.http.patch(`http://localhost:3000/api/clients/${client._id}/credit`, {}).subscribe(() => this.loadClients());\n    console.log('Toggled credit type for client:', client._id);\n  }\n  toggleStatus(client) {\n    this.http.patch(`http://localhost:3000/api/clients/${client._id}/status`, {}).subscribe(() => this.loadClients());\n  }\n  createRateEntry() {\n    return {\n      pickupPincode: '',\n      deliveryPincode: '',\n      rate: {\n        ratePerNum: 0,\n        ratePerVolume: 0,\n        ratePerKg: 0\n      }\n    };\n  }\n  ensureProductRates(product) {\n    return {\n      ...product,\n      rates: Array.isArray(product.rates) && product.rates.length > 0 ? product.rates.map(rateEntry => ({\n        pickupPincode: rateEntry.pickupPincode || '',\n        deliveryPincode: rateEntry.deliveryPincode || '',\n        rate: {\n          ratePerNum: rateEntry.rate?.ratePerNum ?? 0,\n          ratePerVolume: rateEntry.rate?.ratePerVolume ?? 0,\n          ratePerKg: rateEntry.rate?.ratePerKg ?? 0\n        }\n      })) : [this.createRateEntry()]\n    };\n  }\n};\nClientComponent = __decorate([Component({\n  selector: 'app-client',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './client.component.html',\n  styleUrls: ['./client.component.css']\n})], ClientComponent);\nexport { ClientComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}