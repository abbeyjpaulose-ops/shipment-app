{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nlet StocksComponent = class StocksComponent {\n  constructor(http) {\n    this.http = http;\n    this.stocks = [];\n    this.filteredStocks = [];\n    this.searchText = '';\n    this.filterDate = '';\n    this.filterConsignor = '';\n    this.selectedStock = null;\n    this.editingStock = null; // ✅ track which stock is being edited\n    // Billing\n    this.billingType = 'consignor';\n    this.billingName = '';\n    this.billingAddress = '';\n    this.billingGSTIN = '';\n    this.billingPhone = '';\n    this.clientList = [];\n    this.guestList = [];\n    this.pkgList = [];\n    this.productList = [];\n    // Pickup\n    this.pickupType = 'consignor';\n    this.pickupName = '';\n    this.pickupAddress = '';\n    this.pickupPhone = '';\n    // Delivery\n    this.deliveryType = 'consignee';\n    this.deliveryName = '';\n    this.deliveryAddress = '';\n    this.deliveryPhone = '';\n    this.consignorTab = 'consignor';\n    this.consigneeTab = 'consignee';\n    this.email = '';\n    this.username = '';\n    this.branch = localStorage.getItem('branch') || 'All Branches';\n    this.consignmentNumber = localStorage.getItem('consignmentNumber') || '-999'; // will be loaded asynchronously\n    this.date = new Date().toISOString().split('T')[0];\n    this.ewaybillNumber = '';\n    this.consignor = '';\n    this.consignorGST = '';\n    this.consignorAddress = '';\n    this.consignorPhone = '';\n    this.consignee = '';\n    this.consigneeGST = '';\n    this.consigneeAddress = '';\n    this.consigneePhone = '';\n    this.paymentMode = 'Account Credit';\n    this.externalRefId = '';\n    this.invoices = [{\n      number: '',\n      value: 0\n    }];\n    this.packages = [{\n      type: '',\n      amount: 1\n    }];\n    this.products = [{\n      type: '',\n      amount: 1\n    }];\n    this.charges = {\n      odc: 0,\n      unloading: 0,\n      docket: 0,\n      other: 0,\n      ccc: 0\n    };\n    this.finalAmount = 0;\n    this.shipmentStatus = 'Pending';\n    this.shipmentStatusDetails = '';\n  }\n  // --- Methods ---\n  addInvoice() {\n    this.editingStock.invoices.push({\n      number: '',\n      value: 0\n    });\n  }\n  deleteInvoice(index) {\n    this.editingStock.invoices.splice(index, 1);\n  }\n  addPackage() {\n    alert(JSON.stringify(this.invoices));\n    this.editingStock.packages.push({\n      type: '',\n      amount: 1\n    });\n  }\n  deletePackage(index) {\n    alert(\"deletepackage\");\n    this.editingStock.packages.splice(index, 1);\n  }\n  addProduct() {\n    alert(\"addproduct\");\n    this.editingStock.products.push({\n      type: '',\n      amount: 1\n    });\n  }\n  deleteProduct(index) {\n    alert(\"deleteproduct\");\n    this.editingStock.products.splice(index, 1);\n  }\n  calculateFinalAmount() {\n    const invoiceTotal = this.editingStock.invoices.reduce((sum, i) => sum + (i.value || 0), 0);\n    const packageTotal = this.editingStock.packages.reduce((sum, p) => sum + (p.amount || 0), 0);\n    const chargeTotal = Object.values(this.charges).reduce((sum, c) => sum + (Number(c) || 0), 0);\n    this.editingStock.finalAmount = invoiceTotal + packageTotal + chargeTotal;\n  }\n  loadStocks() {\n    const email = localStorage.getItem('email');\n    this.http.get(`http://localhost:3000/api/newshipments?email=${email}`).subscribe({\n      next: res => {\n        // filter only INSTOCK shipments\n        this.stocks = res.filter(s => s.shipmentStatus === 'Pending');\n        console.log(this.stocks);\n        this.filteredStocks = [...this.stocks];\n      },\n      error: err => console.error('❌ Error loading stocks:', err)\n    });\n  }\n  applyFilters() {\n    this.filteredStocks = this.stocks.filter(s => (this.searchText ? s.consignmentNumber?.includes(this.searchText) || s.consignor?.includes(this.searchText) : true) && (this.filterDate ? new Date(s.date).toISOString().split('T')[0] === this.filterDate : true) && (this.filterConsignor ? s.consignor?.toLowerCase().includes(this.filterConsignor.toLowerCase()) : true));\n  }\n  toggleAllSelection(event) {\n    const checked = event.target.checked;\n    this.filteredStocks.forEach(s => s.selected = checked);\n  }\n  manifestSelected() {\n    const selectedConsignments = this.filteredStocks.filter(s => s.selected);\n    if (selectedConsignments.length === 0) {\n      console.warn('⚠️ No consignments selected for manifestation.');\n      return;\n    }\n    selectedConsignments.forEach(stock => {\n      const updatedStock = {\n        ...stock,\n        shipmentStatus: 'In Transit'\n      };\n      console.log(\"sqsqsqsqsqsqsqsqsqs\" + stock.shipmentStatus);\n      this.http.put(`http://localhost:3000/api/newshipments/${stock.consignmentNumber}`, updatedStock).subscribe({\n        next: () => {\n          console.log(`✅ Consignment ${stock.consignmentNumber} updated to In Transit`);\n          this.loadStocks(); // Refresh data\n        },\n        error: err => {\n          console.error(`❌ Error updating consignment ${stock.consignmentNumber}:`, err);\n        }\n      });\n    });\n    // Optionally clear selection after update\n    this.filteredStocks.forEach(s => s.selected = false);\n  }\n  openStockDetails(stock) {\n    this.selectedStock = stock;\n  }\n  closeStockDetails() {\n    this.selectedStock = null;\n  }\n  editStock(stock) {\n    console.log('✏️ Edit stock:', stock);\n    this.editingStock = {\n      ...stock\n    }; // ✅ copy so we don’t mutate directly\n  }\n  saveStockEdit() {\n    if (!this.editingStock) return;\n    console.log(\"kkkkkkkkkkklllllllllllllllll\" + this.editingStock.consignmentNumber);\n    this.http.put(`http://localhost:3000/api/newshipments/${this.editingStock.consignmentNumber}`, this.editingStock).subscribe({\n      next: () => {\n        console.log('✅ Stock updated');\n        this.loadStocks(); // reload updated data\n        this.editingStock = null; // close modal\n      },\n      error: err => console.error('❌ Error updating stock:', err)\n    });\n  }\n  cancelEdit() {\n    this.editingStock = null;\n  }\n  onConsignorSelect(name) {\n    const selectedconignor = this.clientList.find(c => c.clientName === name);\n    if (selectedconignor) {\n      this.editingStock.consignorGST = selectedconignor.GSTIN;\n      this.editingStock.consignorAddress = selectedconignor.address;\n      this.editingStock.consignorPhone = selectedconignor.phoneNum;\n    }\n  }\n  onConsigneeSelect(name) {\n    const selectedconignee = this.clientList.find(c => c.clientName === name);\n    if (selectedconignee) {\n      this.editingStock.consigneeGST = selectedconignee.GSTIN;\n      this.editingStock.consigneeAddress = selectedconignee.address;\n      this.editingStock.consigneePhone = selectedconignee.phoneNum;\n    }\n  }\n  onConsignorGuestSelect(name) {\n    const selectedguestconignor = this.guestList.find(c => c.guestName === name);\n    if (selectedguestconignor) {\n      this.editingStock.consignorGST = 'GUEST';\n      this.editingStock.consignorAddress = selectedguestconignor.address;\n      this.editingStock.consignorPhone = selectedguestconignor.phoneNum;\n    }\n  }\n  onConsigneeGuestSelect(name) {\n    const selectedguestconignee = this.guestList.find(c => c.guestName === name);\n    if (selectedguestconignee) {\n      this.editingStock.consigneeGST = 'GUEST';\n      this.editingStock.editingStock.consigneeAddress = selectedguestconignee.address;\n      this.editingStock.editingStock.consigneePhone = selectedguestconignee.phoneNum;\n    }\n  }\n  onPackageList(name) {\n    const selectedpackage = this.pkgList.find(c => c.pkgName === name);\n  }\n  onProductList(name) {\n    const selectedproduct = this.productList.find(c => c.productName === name);\n  }\n  ngOnInit() {\n    this.loadStocks();\n    this.email = localStorage.getItem('email') || '';\n    this.username = localStorage.getItem('username') || '';\n    this.branch = localStorage.getItem('branch') || 'All Branches';\n    //clients list  \n    this.http.get(`http://localhost:3000/api/clients/clientslist?emailId=${this.email}`).subscribe(data => {\n      this.clientList = data;\n    });\n    //guest list\n    this.http.get(`http://localhost:3000/api/guests/guestslist?emailId=${this.email}`).subscribe(data => {\n      this.guestList = data;\n    }, error => {\n      console.error('Error fetching guest list', error);\n    });\n    //package list\n    this.http.get(`http://localhost:3000/api/pkgs/pkglist?emailId=${this.email}`).subscribe(data => {\n      this.pkgList = data;\n    }, error => {\n      console.error('Error fetching package list', error);\n    });\n    //product list\n    this.http.get(`http://localhost:3000/api/products/productlist?emailId=${this.email}`).subscribe(data => {\n      this.productList = data;\n    }, error => {\n      console.error('Error fetching product list', error);\n    });\n  }\n};\nStocksComponent = __decorate([Component({\n  selector: 'app-stocks',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  templateUrl: './stocks.component.html',\n  styleUrls: ['./stocks.component.css']\n})], StocksComponent);\nexport { StocksComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}